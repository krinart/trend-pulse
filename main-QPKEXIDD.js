var zL=Object.create;var tb=Object.defineProperty,BL=Object.defineProperties,VL=Object.getOwnPropertyDescriptor,jL=Object.getOwnPropertyDescriptors,UL=Object.getOwnPropertyNames,G_=Object.getOwnPropertySymbols,$L=Object.getPrototypeOf,nb=Object.prototype.hasOwnProperty,gD=Object.prototype.propertyIsEnumerable;var mD=(r,s,a)=>s in r?tb(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a,bt=(r,s)=>{for(var a in s||={})nb.call(s,a)&&mD(r,a,s[a]);if(G_)for(var a of G_(s))gD.call(s,a)&&mD(r,a,s[a]);return r},Un=(r,s)=>BL(r,jL(s));var H_=(r,s)=>{var a={};for(var d in r)nb.call(r,d)&&s.indexOf(d)<0&&(a[d]=r[d]);if(r!=null&&G_)for(var d of G_(r))s.indexOf(d)<0&&gD.call(r,d)&&(a[d]=r[d]);return a};var GL=(r,s)=>()=>(s||r((s={exports:{}}).exports,s),s.exports);var HL=(r,s,a,d)=>{if(s&&typeof s=="object"||typeof s=="function")for(let y of UL(s))!nb.call(r,y)&&y!==a&&tb(r,y,{get:()=>s[y],enumerable:!(d=VL(s,y))||d.enumerable});return r};var qL=(r,s,a)=>(a=r!=null?zL($L(r)):{},HL(s||!r||!r.__esModule?tb(a,"default",{value:r,enumerable:!0}):a,r));var no=(r,s,a)=>new Promise((d,y)=>{var n=$=>{try{j(a.next($))}catch(ie){y(ie)}},R=$=>{try{j(a.throw($))}catch(ie){y(ie)}},j=$=>$.done?d($.value):Promise.resolve($.value).then(n,R);j((a=a.apply(r,s)).next())});var PR=GL((Kw,Qw)=>{"use strict";(function(r,s){typeof Kw=="object"&&typeof Qw<"u"?Qw.exports=s():typeof define=="function"&&define.amd?define(s):(r=typeof globalThis<"u"?globalThis:r||self,r.mapboxgl=s())})(Kw,function(){"use strict";var r,s,a;function d(n,R){if(!r)r=R;else if(!s)s=R;else{var j="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",$={};r($),a=R($),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}d(["exports"],function(n){function R(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var j,$={},ie={};function pe(){if(j)return ie;j=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.setMatrixArrayType=function(p){ie.ARRAY_TYPE=e=p},ie.toRadian=function(p){return p*c},ie.equals=function(p,u){return Math.abs(p-u)<=l*Math.max(1,Math.abs(p),Math.abs(u))},ie.RANDOM=ie.ARRAY_TYPE=ie.EPSILON=void 0;var l=1e-6;ie.EPSILON=l;var e=typeof Float32Array<"u"?Float32Array:Array;ie.ARRAY_TYPE=e;var i=Math.random;ie.RANDOM=i;var c=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var p=0,u=arguments.length;u--;)p+=arguments[u]*arguments[u];return Math.sqrt(p)}),ie}var Me,He={};function Be(){if(Me)return He;function l(u){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(u)}Me=1,Object.defineProperty(He,"__esModule",{value:!0}),He.create=function(){var u=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},He.clone=function(u){var m=new e.ARRAY_TYPE(4);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m},He.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u},He.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u},He.fromValues=function(u,m,x,I){var D=new e.ARRAY_TYPE(4);return D[0]=u,D[1]=m,D[2]=x,D[3]=I,D},He.set=function(u,m,x,I,D){return u[0]=m,u[1]=x,u[2]=I,u[3]=D,u},He.transpose=function(u,m){if(u===m){var x=m[1];u[1]=m[2],u[2]=x}else u[0]=m[0],u[1]=m[2],u[2]=m[1],u[3]=m[3];return u},He.invert=function(u,m){var x=m[0],I=m[1],D=m[2],_=m[3],E=x*_-D*I;return E?(u[0]=_*(E=1/E),u[1]=-I*E,u[2]=-D*E,u[3]=x*E,u):null},He.adjoint=function(u,m){var x=m[0];return u[0]=m[3],u[1]=-m[1],u[2]=-m[2],u[3]=x,u},He.determinant=function(u){return u[0]*u[3]-u[2]*u[1]},He.multiply=c,He.rotate=function(u,m,x){var I=m[0],D=m[1],_=m[2],E=m[3],C=Math.sin(x),w=Math.cos(x);return u[0]=I*w+_*C,u[1]=D*w+E*C,u[2]=I*-C+_*w,u[3]=D*-C+E*w,u},He.scale=function(u,m,x){var I=m[1],D=m[2],_=m[3],E=x[0],C=x[1];return u[0]=m[0]*E,u[1]=I*E,u[2]=D*C,u[3]=_*C,u},He.fromRotation=function(u,m){var x=Math.sin(m),I=Math.cos(m);return u[0]=I,u[1]=x,u[2]=-x,u[3]=I,u},He.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=m[1],u},He.str=function(u){return"mat2("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+")"},He.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3])},He.LDU=function(u,m,x,I){return u[2]=I[2]/I[0],x[0]=I[0],x[1]=I[1],x[3]=I[3]-u[2]*x[1],[u,m,x]},He.add=function(u,m,x){return u[0]=m[0]+x[0],u[1]=m[1]+x[1],u[2]=m[2]+x[2],u[3]=m[3]+x[3],u},He.subtract=p,He.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]},He.equals=function(u,m){var x=u[0],I=u[1],D=u[2],_=u[3],E=m[0],C=m[1],w=m[2],T=m[3];return Math.abs(x-E)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(E))&&Math.abs(I-C)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(C))&&Math.abs(D-w)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(w))&&Math.abs(_-T)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(T))},He.multiplyScalar=function(u,m,x){return u[0]=m[0]*x,u[1]=m[1]*x,u[2]=m[2]*x,u[3]=m[3]*x,u},He.multiplyScalarAndAdd=function(u,m,x,I){return u[0]=m[0]+x[0]*I,u[1]=m[1]+x[1]*I,u[2]=m[2]+x[2]*I,u[3]=m[3]+x[3]*I,u},He.sub=He.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||l(u)!=="object"&&typeof u!="function")return{default:u};var x=i(void 0);if(x&&x.has(u))return x.get(u);var I={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in u)if(_!=="default"&&Object.prototype.hasOwnProperty.call(u,_)){var E=D?Object.getOwnPropertyDescriptor(u,_):null;E&&(E.get||E.set)?Object.defineProperty(I,_,E):I[_]=u[_]}return I.default=u,x&&x.set(u,I),I}(pe());function i(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(i=function(I){return I?x:m})(u)}function c(u,m,x){var I=m[0],D=m[1],_=m[2],E=m[3],C=x[0],w=x[1],T=x[2],S=x[3];return u[0]=I*C+_*w,u[1]=D*C+E*w,u[2]=I*T+_*S,u[3]=D*T+E*S,u}function p(u,m,x){return u[0]=m[0]-x[0],u[1]=m[1]-x[1],u[2]=m[2]-x[2],u[3]=m[3]-x[3],u}return He.mul=c,He.sub=p,He}var lt,rt={};function At(){if(lt)return rt;function l(u){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(u)}lt=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.create=function(){var u=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[4]=0,u[5]=0),u[0]=1,u[3]=1,u},rt.clone=function(u){var m=new e.ARRAY_TYPE(6);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m[4]=u[4],m[5]=u[5],m},rt.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u[4]=m[4],u[5]=m[5],u},rt.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=0,u[5]=0,u},rt.fromValues=function(u,m,x,I,D,_){var E=new e.ARRAY_TYPE(6);return E[0]=u,E[1]=m,E[2]=x,E[3]=I,E[4]=D,E[5]=_,E},rt.set=function(u,m,x,I,D,_,E){return u[0]=m,u[1]=x,u[2]=I,u[3]=D,u[4]=_,u[5]=E,u},rt.invert=function(u,m){var x=m[0],I=m[1],D=m[2],_=m[3],E=m[4],C=m[5],w=x*_-I*D;return w?(u[0]=_*(w=1/w),u[1]=-I*w,u[2]=-D*w,u[3]=x*w,u[4]=(D*C-_*E)*w,u[5]=(I*E-x*C)*w,u):null},rt.determinant=function(u){return u[0]*u[3]-u[1]*u[2]},rt.multiply=c,rt.rotate=function(u,m,x){var I=m[0],D=m[1],_=m[2],E=m[3],C=m[4],w=m[5],T=Math.sin(x),S=Math.cos(x);return u[0]=I*S+_*T,u[1]=D*S+E*T,u[2]=I*-T+_*S,u[3]=D*-T+E*S,u[4]=C,u[5]=w,u},rt.scale=function(u,m,x){var I=m[1],D=m[2],_=m[3],E=m[4],C=m[5],w=x[0],T=x[1];return u[0]=m[0]*w,u[1]=I*w,u[2]=D*T,u[3]=_*T,u[4]=E,u[5]=C,u},rt.translate=function(u,m,x){var I=m[0],D=m[1],_=m[2],E=m[3],C=m[4],w=m[5],T=x[0],S=x[1];return u[0]=I,u[1]=D,u[2]=_,u[3]=E,u[4]=I*T+_*S+C,u[5]=D*T+E*S+w,u},rt.fromRotation=function(u,m){var x=Math.sin(m),I=Math.cos(m);return u[0]=I,u[1]=x,u[2]=-x,u[3]=I,u[4]=0,u[5]=0,u},rt.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=m[1],u[4]=0,u[5]=0,u},rt.fromTranslation=function(u,m){return u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=m[0],u[5]=m[1],u},rt.str=function(u){return"mat2d("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+")"},rt.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],1)},rt.add=function(u,m,x){return u[0]=m[0]+x[0],u[1]=m[1]+x[1],u[2]=m[2]+x[2],u[3]=m[3]+x[3],u[4]=m[4]+x[4],u[5]=m[5]+x[5],u},rt.subtract=p,rt.multiplyScalar=function(u,m,x){return u[0]=m[0]*x,u[1]=m[1]*x,u[2]=m[2]*x,u[3]=m[3]*x,u[4]=m[4]*x,u[5]=m[5]*x,u},rt.multiplyScalarAndAdd=function(u,m,x,I){return u[0]=m[0]+x[0]*I,u[1]=m[1]+x[1]*I,u[2]=m[2]+x[2]*I,u[3]=m[3]+x[3]*I,u[4]=m[4]+x[4]*I,u[5]=m[5]+x[5]*I,u},rt.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]&&u[4]===m[4]&&u[5]===m[5]},rt.equals=function(u,m){var x=u[0],I=u[1],D=u[2],_=u[3],E=u[4],C=u[5],w=m[0],T=m[1],S=m[2],k=m[3],L=m[4],B=m[5];return Math.abs(x-w)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(w))&&Math.abs(I-T)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(T))&&Math.abs(D-S)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(S))&&Math.abs(_-k)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(k))&&Math.abs(E-L)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(L))&&Math.abs(C-B)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(B))},rt.sub=rt.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||l(u)!=="object"&&typeof u!="function")return{default:u};var x=i(void 0);if(x&&x.has(u))return x.get(u);var I={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in u)if(_!=="default"&&Object.prototype.hasOwnProperty.call(u,_)){var E=D?Object.getOwnPropertyDescriptor(u,_):null;E&&(E.get||E.set)?Object.defineProperty(I,_,E):I[_]=u[_]}return I.default=u,x&&x.set(u,I),I}(pe());function i(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(i=function(I){return I?x:m})(u)}function c(u,m,x){var I=m[0],D=m[1],_=m[2],E=m[3],C=m[4],w=m[5],T=x[0],S=x[1],k=x[2],L=x[3],B=x[4],V=x[5];return u[0]=I*T+_*S,u[1]=D*T+E*S,u[2]=I*k+_*L,u[3]=D*k+E*L,u[4]=I*B+_*V+C,u[5]=D*B+E*V+w,u}function p(u,m,x){return u[0]=m[0]-x[0],u[1]=m[1]-x[1],u[2]=m[2]-x[2],u[3]=m[3]-x[3],u[4]=m[4]-x[4],u[5]=m[5]-x[5],u}return rt.mul=c,rt.sub=p,rt}var Kt,St={};function _n(){if(Kt)return St;function l(u){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},l(u)}Kt=1,Object.defineProperty(St,"__esModule",{value:!0}),St.create=function(){var u=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u},St.fromMat4=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[4],u[4]=m[5],u[5]=m[6],u[6]=m[8],u[7]=m[9],u[8]=m[10],u},St.clone=function(u){var m=new e.ARRAY_TYPE(9);return m[0]=u[0],m[1]=u[1],m[2]=u[2],m[3]=u[3],m[4]=u[4],m[5]=u[5],m[6]=u[6],m[7]=u[7],m[8]=u[8],m},St.copy=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=m[3],u[4]=m[4],u[5]=m[5],u[6]=m[6],u[7]=m[7],u[8]=m[8],u},St.fromValues=function(u,m,x,I,D,_,E,C,w){var T=new e.ARRAY_TYPE(9);return T[0]=u,T[1]=m,T[2]=x,T[3]=I,T[4]=D,T[5]=_,T[6]=E,T[7]=C,T[8]=w,T},St.set=function(u,m,x,I,D,_,E,C,w,T){return u[0]=m,u[1]=x,u[2]=I,u[3]=D,u[4]=_,u[5]=E,u[6]=C,u[7]=w,u[8]=T,u},St.identity=function(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},St.transpose=function(u,m){if(u===m){var x=m[1],I=m[2],D=m[5];u[1]=m[3],u[2]=m[6],u[3]=x,u[5]=m[7],u[6]=I,u[7]=D}else u[0]=m[0],u[1]=m[3],u[2]=m[6],u[3]=m[1],u[4]=m[4],u[5]=m[7],u[6]=m[2],u[7]=m[5],u[8]=m[8];return u},St.invert=function(u,m){var x=m[0],I=m[1],D=m[2],_=m[3],E=m[4],C=m[5],w=m[6],T=m[7],S=m[8],k=S*E-C*T,L=-S*_+C*w,B=T*_-E*w,V=x*k+I*L+D*B;return V?(u[0]=k*(V=1/V),u[1]=(-S*I+D*T)*V,u[2]=(C*I-D*E)*V,u[3]=L*V,u[4]=(S*x-D*w)*V,u[5]=(-C*x+D*_)*V,u[6]=B*V,u[7]=(-T*x+I*w)*V,u[8]=(E*x-I*_)*V,u):null},St.adjoint=function(u,m){var x=m[0],I=m[1],D=m[2],_=m[3],E=m[4],C=m[5],w=m[6],T=m[7],S=m[8];return u[0]=E*S-C*T,u[1]=D*T-I*S,u[2]=I*C-D*E,u[3]=C*w-_*S,u[4]=x*S-D*w,u[5]=D*_-x*C,u[6]=_*T-E*w,u[7]=I*w-x*T,u[8]=x*E-I*_,u},St.determinant=function(u){var m=u[3],x=u[4],I=u[5],D=u[6],_=u[7],E=u[8];return u[0]*(E*x-I*_)+u[1]*(-E*m+I*D)+u[2]*(_*m-x*D)},St.multiply=c,St.translate=function(u,m,x){var I=m[0],D=m[1],_=m[2],E=m[3],C=m[4],w=m[5],T=m[6],S=m[7],k=m[8],L=x[0],B=x[1];return u[0]=I,u[1]=D,u[2]=_,u[3]=E,u[4]=C,u[5]=w,u[6]=L*I+B*E+T,u[7]=L*D+B*C+S,u[8]=L*_+B*w+k,u},St.rotate=function(u,m,x){var I=m[0],D=m[1],_=m[2],E=m[3],C=m[4],w=m[5],T=m[6],S=m[7],k=m[8],L=Math.sin(x),B=Math.cos(x);return u[0]=B*I+L*E,u[1]=B*D+L*C,u[2]=B*_+L*w,u[3]=B*E-L*I,u[4]=B*C-L*D,u[5]=B*w-L*_,u[6]=T,u[7]=S,u[8]=k,u},St.scale=function(u,m,x){var I=x[0],D=x[1];return u[0]=I*m[0],u[1]=I*m[1],u[2]=I*m[2],u[3]=D*m[3],u[4]=D*m[4],u[5]=D*m[5],u[6]=m[6],u[7]=m[7],u[8]=m[8],u},St.fromTranslation=function(u,m){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=1,u[5]=0,u[6]=m[0],u[7]=m[1],u[8]=1,u},St.fromRotation=function(u,m){var x=Math.sin(m),I=Math.cos(m);return u[0]=I,u[1]=x,u[2]=0,u[3]=-x,u[4]=I,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},St.fromScaling=function(u,m){return u[0]=m[0],u[1]=0,u[2]=0,u[3]=0,u[4]=m[1],u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},St.fromMat2d=function(u,m){return u[0]=m[0],u[1]=m[1],u[2]=0,u[3]=m[2],u[4]=m[3],u[5]=0,u[6]=m[4],u[7]=m[5],u[8]=1,u},St.fromQuat=function(u,m){var x=m[0],I=m[1],D=m[2],_=m[3],E=x+x,C=I+I,w=D+D,T=x*E,S=I*E,k=I*C,L=D*E,B=D*C,V=D*w,N=_*E,G=_*C,H=_*w;return u[0]=1-k-V,u[3]=S-H,u[6]=L+G,u[1]=S+H,u[4]=1-T-V,u[7]=B-N,u[2]=L-G,u[5]=B+N,u[8]=1-T-k,u},St.normalFromMat4=function(u,m){var x=m[0],I=m[1],D=m[2],_=m[3],E=m[4],C=m[5],w=m[6],T=m[7],S=m[8],k=m[9],L=m[10],B=m[11],V=m[12],N=m[13],G=m[14],H=m[15],J=x*C-I*E,se=x*w-D*E,ee=x*T-_*E,ne=I*w-D*C,me=I*T-_*C,te=D*T-_*w,de=S*N-k*V,ve=S*G-L*V,xe=S*H-B*V,Ie=k*G-L*N,Ae=k*H-B*N,Pe=L*H-B*G,De=J*Pe-se*Ae+ee*Ie+ne*xe-me*ve+te*de;return De?(u[0]=(C*Pe-w*Ae+T*Ie)*(De=1/De),u[1]=(w*xe-E*Pe-T*ve)*De,u[2]=(E*Ae-C*xe+T*de)*De,u[3]=(D*Ae-I*Pe-_*Ie)*De,u[4]=(x*Pe-D*xe+_*ve)*De,u[5]=(I*xe-x*Ae-_*de)*De,u[6]=(N*te-G*me+H*ne)*De,u[7]=(G*ee-V*te-H*se)*De,u[8]=(V*me-N*ee+H*J)*De,u):null},St.projection=function(u,m,x){return u[0]=2/m,u[1]=0,u[2]=0,u[3]=0,u[4]=-2/x,u[5]=0,u[6]=-1,u[7]=1,u[8]=1,u},St.str=function(u){return"mat3("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+", "+u[6]+", "+u[7]+", "+u[8]+")"},St.frob=function(u){return Math.hypot(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8])},St.add=function(u,m,x){return u[0]=m[0]+x[0],u[1]=m[1]+x[1],u[2]=m[2]+x[2],u[3]=m[3]+x[3],u[4]=m[4]+x[4],u[5]=m[5]+x[5],u[6]=m[6]+x[6],u[7]=m[7]+x[7],u[8]=m[8]+x[8],u},St.subtract=p,St.multiplyScalar=function(u,m,x){return u[0]=m[0]*x,u[1]=m[1]*x,u[2]=m[2]*x,u[3]=m[3]*x,u[4]=m[4]*x,u[5]=m[5]*x,u[6]=m[6]*x,u[7]=m[7]*x,u[8]=m[8]*x,u},St.multiplyScalarAndAdd=function(u,m,x,I){return u[0]=m[0]+x[0]*I,u[1]=m[1]+x[1]*I,u[2]=m[2]+x[2]*I,u[3]=m[3]+x[3]*I,u[4]=m[4]+x[4]*I,u[5]=m[5]+x[5]*I,u[6]=m[6]+x[6]*I,u[7]=m[7]+x[7]*I,u[8]=m[8]+x[8]*I,u},St.exactEquals=function(u,m){return u[0]===m[0]&&u[1]===m[1]&&u[2]===m[2]&&u[3]===m[3]&&u[4]===m[4]&&u[5]===m[5]&&u[6]===m[6]&&u[7]===m[7]&&u[8]===m[8]},St.equals=function(u,m){var x=u[0],I=u[1],D=u[2],_=u[3],E=u[4],C=u[5],w=u[6],T=u[7],S=u[8],k=m[0],L=m[1],B=m[2],V=m[3],N=m[4],G=m[5],H=m[6],J=m[7],se=m[8];return Math.abs(x-k)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(k))&&Math.abs(I-L)<=e.EPSILON*Math.max(1,Math.abs(I),Math.abs(L))&&Math.abs(D-B)<=e.EPSILON*Math.max(1,Math.abs(D),Math.abs(B))&&Math.abs(_-V)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(E-N)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(N))&&Math.abs(C-G)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(G))&&Math.abs(w-H)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(H))&&Math.abs(T-J)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(J))&&Math.abs(S-se)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(se))},St.sub=St.mul=void 0;var e=function(u,m){if(u&&u.__esModule)return u;if(u===null||l(u)!=="object"&&typeof u!="function")return{default:u};var x=i(void 0);if(x&&x.has(u))return x.get(u);var I={},D=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in u)if(_!=="default"&&Object.prototype.hasOwnProperty.call(u,_)){var E=D?Object.getOwnPropertyDescriptor(u,_):null;E&&(E.get||E.set)?Object.defineProperty(I,_,E):I[_]=u[_]}return I.default=u,x&&x.set(u,I),I}(pe());function i(u){if(typeof WeakMap!="function")return null;var m=new WeakMap,x=new WeakMap;return(i=function(I){return I?x:m})(u)}function c(u,m,x){var I=m[0],D=m[1],_=m[2],E=m[3],C=m[4],w=m[5],T=m[6],S=m[7],k=m[8],L=x[0],B=x[1],V=x[2],N=x[3],G=x[4],H=x[5],J=x[6],se=x[7],ee=x[8];return u[0]=L*I+B*E+V*T,u[1]=L*D+B*C+V*S,u[2]=L*_+B*w+V*k,u[3]=N*I+G*E+H*T,u[4]=N*D+G*C+H*S,u[5]=N*_+G*w+H*k,u[6]=J*I+se*E+ee*T,u[7]=J*D+se*C+ee*S,u[8]=J*_+se*w+ee*k,u}function p(u,m,x){return u[0]=m[0]-x[0],u[1]=m[1]-x[1],u[2]=m[2]-x[2],u[3]=m[3]-x[3],u[4]=m[4]-x[4],u[5]=m[5]-x[5],u[6]=m[6]-x[6],u[7]=m[7]-x[7],u[8]=m[8]-x[8],u}return St.mul=c,St.sub=p,St}var hi,Dt={};function ai(){if(hi)return Dt;function l(_){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},l(_)}hi=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.create=function(){var _=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},Dt.clone=function(_){var E=new e.ARRAY_TYPE(16);return E[0]=_[0],E[1]=_[1],E[2]=_[2],E[3]=_[3],E[4]=_[4],E[5]=_[5],E[6]=_[6],E[7]=_[7],E[8]=_[8],E[9]=_[9],E[10]=_[10],E[11]=_[11],E[12]=_[12],E[13]=_[13],E[14]=_[14],E[15]=_[15],E},Dt.copy=function(_,E){return _[0]=E[0],_[1]=E[1],_[2]=E[2],_[3]=E[3],_[4]=E[4],_[5]=E[5],_[6]=E[6],_[7]=E[7],_[8]=E[8],_[9]=E[9],_[10]=E[10],_[11]=E[11],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15],_},Dt.fromValues=function(_,E,C,w,T,S,k,L,B,V,N,G,H,J,se,ee){var ne=new e.ARRAY_TYPE(16);return ne[0]=_,ne[1]=E,ne[2]=C,ne[3]=w,ne[4]=T,ne[5]=S,ne[6]=k,ne[7]=L,ne[8]=B,ne[9]=V,ne[10]=N,ne[11]=G,ne[12]=H,ne[13]=J,ne[14]=se,ne[15]=ee,ne},Dt.set=function(_,E,C,w,T,S,k,L,B,V,N,G,H,J,se,ee,ne){return _[0]=E,_[1]=C,_[2]=w,_[3]=T,_[4]=S,_[5]=k,_[6]=L,_[7]=B,_[8]=V,_[9]=N,_[10]=G,_[11]=H,_[12]=J,_[13]=se,_[14]=ee,_[15]=ne,_},Dt.identity=c,Dt.transpose=function(_,E){if(_===E){var C=E[1],w=E[2],T=E[3],S=E[6],k=E[7],L=E[11];_[1]=E[4],_[2]=E[8],_[3]=E[12],_[4]=C,_[6]=E[9],_[7]=E[13],_[8]=w,_[9]=S,_[11]=E[14],_[12]=T,_[13]=k,_[14]=L}else _[0]=E[0],_[1]=E[4],_[2]=E[8],_[3]=E[12],_[4]=E[1],_[5]=E[5],_[6]=E[9],_[7]=E[13],_[8]=E[2],_[9]=E[6],_[10]=E[10],_[11]=E[14],_[12]=E[3],_[13]=E[7],_[14]=E[11],_[15]=E[15];return _},Dt.invert=function(_,E){var C=E[0],w=E[1],T=E[2],S=E[3],k=E[4],L=E[5],B=E[6],V=E[7],N=E[8],G=E[9],H=E[10],J=E[11],se=E[12],ee=E[13],ne=E[14],me=E[15],te=C*L-w*k,de=C*B-T*k,ve=C*V-S*k,xe=w*B-T*L,Ie=w*V-S*L,Ae=T*V-S*B,Pe=N*ee-G*se,De=N*ne-H*se,$e=N*me-J*se,Je=G*ne-H*ee,ze=G*me-J*ee,dt=H*me-J*ne,it=te*dt-de*ze+ve*Je+xe*$e-Ie*De+Ae*Pe;return it?(_[0]=(L*dt-B*ze+V*Je)*(it=1/it),_[1]=(T*ze-w*dt-S*Je)*it,_[2]=(ee*Ae-ne*Ie+me*xe)*it,_[3]=(H*Ie-G*Ae-J*xe)*it,_[4]=(B*$e-k*dt-V*De)*it,_[5]=(C*dt-T*$e+S*De)*it,_[6]=(ne*ve-se*Ae-me*de)*it,_[7]=(N*Ae-H*ve+J*de)*it,_[8]=(k*ze-L*$e+V*Pe)*it,_[9]=(w*$e-C*ze-S*Pe)*it,_[10]=(se*Ie-ee*ve+me*te)*it,_[11]=(G*ve-N*Ie-J*te)*it,_[12]=(L*De-k*Je-B*Pe)*it,_[13]=(C*Je-w*De+T*Pe)*it,_[14]=(ee*de-se*xe-ne*te)*it,_[15]=(N*xe-G*de+H*te)*it,_):null},Dt.adjoint=function(_,E){var C=E[0],w=E[1],T=E[2],S=E[3],k=E[4],L=E[5],B=E[6],V=E[7],N=E[8],G=E[9],H=E[10],J=E[11],se=E[12],ee=E[13],ne=E[14],me=E[15];return _[0]=L*(H*me-J*ne)-G*(B*me-V*ne)+ee*(B*J-V*H),_[1]=-(w*(H*me-J*ne)-G*(T*me-S*ne)+ee*(T*J-S*H)),_[2]=w*(B*me-V*ne)-L*(T*me-S*ne)+ee*(T*V-S*B),_[3]=-(w*(B*J-V*H)-L*(T*J-S*H)+G*(T*V-S*B)),_[4]=-(k*(H*me-J*ne)-N*(B*me-V*ne)+se*(B*J-V*H)),_[5]=C*(H*me-J*ne)-N*(T*me-S*ne)+se*(T*J-S*H),_[6]=-(C*(B*me-V*ne)-k*(T*me-S*ne)+se*(T*V-S*B)),_[7]=C*(B*J-V*H)-k*(T*J-S*H)+N*(T*V-S*B),_[8]=k*(G*me-J*ee)-N*(L*me-V*ee)+se*(L*J-V*G),_[9]=-(C*(G*me-J*ee)-N*(w*me-S*ee)+se*(w*J-S*G)),_[10]=C*(L*me-V*ee)-k*(w*me-S*ee)+se*(w*V-S*L),_[11]=-(C*(L*J-V*G)-k*(w*J-S*G)+N*(w*V-S*L)),_[12]=-(k*(G*ne-H*ee)-N*(L*ne-B*ee)+se*(L*H-B*G)),_[13]=C*(G*ne-H*ee)-N*(w*ne-T*ee)+se*(w*H-T*G),_[14]=-(C*(L*ne-B*ee)-k*(w*ne-T*ee)+se*(w*B-T*L)),_[15]=C*(L*H-B*G)-k*(w*H-T*G)+N*(w*B-T*L),_},Dt.determinant=function(_){var E=_[0],C=_[1],w=_[2],T=_[3],S=_[4],k=_[5],L=_[6],B=_[7],V=_[8],N=_[9],G=_[10],H=_[11],J=_[12],se=_[13],ee=_[14],ne=_[15];return(E*k-C*S)*(G*ne-H*ee)-(E*L-w*S)*(N*ne-H*se)+(E*B-T*S)*(N*ee-G*se)+(C*L-w*k)*(V*ne-H*J)-(C*B-T*k)*(V*ee-G*J)+(w*B-T*L)*(V*se-N*J)},Dt.multiply=p,Dt.translate=function(_,E,C){var w,T,S,k,L,B,V,N,G,H,J,se,ee=C[0],ne=C[1],me=C[2];return E===_?(_[12]=E[0]*ee+E[4]*ne+E[8]*me+E[12],_[13]=E[1]*ee+E[5]*ne+E[9]*me+E[13],_[14]=E[2]*ee+E[6]*ne+E[10]*me+E[14],_[15]=E[3]*ee+E[7]*ne+E[11]*me+E[15]):(T=E[1],S=E[2],k=E[3],L=E[4],B=E[5],V=E[6],N=E[7],G=E[8],H=E[9],J=E[10],se=E[11],_[0]=w=E[0],_[1]=T,_[2]=S,_[3]=k,_[4]=L,_[5]=B,_[6]=V,_[7]=N,_[8]=G,_[9]=H,_[10]=J,_[11]=se,_[12]=w*ee+L*ne+G*me+E[12],_[13]=T*ee+B*ne+H*me+E[13],_[14]=S*ee+V*ne+J*me+E[14],_[15]=k*ee+N*ne+se*me+E[15]),_},Dt.scale=function(_,E,C){var w=C[0],T=C[1],S=C[2];return _[0]=E[0]*w,_[1]=E[1]*w,_[2]=E[2]*w,_[3]=E[3]*w,_[4]=E[4]*T,_[5]=E[5]*T,_[6]=E[6]*T,_[7]=E[7]*T,_[8]=E[8]*S,_[9]=E[9]*S,_[10]=E[10]*S,_[11]=E[11]*S,_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15],_},Dt.rotate=function(_,E,C,w){var T,S,k,L,B,V,N,G,H,J,se,ee,ne,me,te,de,ve,xe,Ie,Ae,Pe,De,$e,Je,ze=w[0],dt=w[1],it=w[2],et=Math.hypot(ze,dt,it);return et<e.EPSILON?null:(ze*=et=1/et,dt*=et,it*=et,T=Math.sin(C),S=Math.cos(C),B=E[1],V=E[2],N=E[3],H=E[5],J=E[6],se=E[7],ne=E[9],me=E[10],te=E[11],de=ze*ze*(k=1-S)+S,Ie=ze*dt*k-it*T,Ae=dt*dt*k+S,Pe=it*dt*k+ze*T,De=ze*it*k+dt*T,$e=dt*it*k-ze*T,Je=it*it*k+S,_[0]=(L=E[0])*de+(G=E[4])*(ve=dt*ze*k+it*T)+(ee=E[8])*(xe=it*ze*k-dt*T),_[1]=B*de+H*ve+ne*xe,_[2]=V*de+J*ve+me*xe,_[3]=N*de+se*ve+te*xe,_[4]=L*Ie+G*Ae+ee*Pe,_[5]=B*Ie+H*Ae+ne*Pe,_[6]=V*Ie+J*Ae+me*Pe,_[7]=N*Ie+se*Ae+te*Pe,_[8]=L*De+G*$e+ee*Je,_[9]=B*De+H*$e+ne*Je,_[10]=V*De+J*$e+me*Je,_[11]=N*De+se*$e+te*Je,E!==_&&(_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_)},Dt.rotateX=function(_,E,C){var w=Math.sin(C),T=Math.cos(C),S=E[4],k=E[5],L=E[6],B=E[7],V=E[8],N=E[9],G=E[10],H=E[11];return E!==_&&(_[0]=E[0],_[1]=E[1],_[2]=E[2],_[3]=E[3],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[4]=S*T+V*w,_[5]=k*T+N*w,_[6]=L*T+G*w,_[7]=B*T+H*w,_[8]=V*T-S*w,_[9]=N*T-k*w,_[10]=G*T-L*w,_[11]=H*T-B*w,_},Dt.rotateY=function(_,E,C){var w=Math.sin(C),T=Math.cos(C),S=E[0],k=E[1],L=E[2],B=E[3],V=E[8],N=E[9],G=E[10],H=E[11];return E!==_&&(_[4]=E[4],_[5]=E[5],_[6]=E[6],_[7]=E[7],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[0]=S*T-V*w,_[1]=k*T-N*w,_[2]=L*T-G*w,_[3]=B*T-H*w,_[8]=S*w+V*T,_[9]=k*w+N*T,_[10]=L*w+G*T,_[11]=B*w+H*T,_},Dt.rotateZ=function(_,E,C){var w=Math.sin(C),T=Math.cos(C),S=E[0],k=E[1],L=E[2],B=E[3],V=E[4],N=E[5],G=E[6],H=E[7];return E!==_&&(_[8]=E[8],_[9]=E[9],_[10]=E[10],_[11]=E[11],_[12]=E[12],_[13]=E[13],_[14]=E[14],_[15]=E[15]),_[0]=S*T+V*w,_[1]=k*T+N*w,_[2]=L*T+G*w,_[3]=B*T+H*w,_[4]=V*T-S*w,_[5]=N*T-k*w,_[6]=G*T-L*w,_[7]=H*T-B*w,_},Dt.fromTranslation=function(_,E){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=E[0],_[13]=E[1],_[14]=E[2],_[15]=1,_},Dt.fromScaling=function(_,E){return _[0]=E[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=E[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=E[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Dt.fromRotation=function(_,E,C){var w,T,S,k=C[0],L=C[1],B=C[2],V=Math.hypot(k,L,B);return V<e.EPSILON?null:(k*=V=1/V,L*=V,B*=V,w=Math.sin(E),T=Math.cos(E),_[0]=k*k*(S=1-T)+T,_[1]=L*k*S+B*w,_[2]=B*k*S-L*w,_[3]=0,_[4]=k*L*S-B*w,_[5]=L*L*S+T,_[6]=B*L*S+k*w,_[7]=0,_[8]=k*B*S+L*w,_[9]=L*B*S-k*w,_[10]=B*B*S+T,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)},Dt.fromXRotation=function(_,E){var C=Math.sin(E),w=Math.cos(E);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=w,_[6]=C,_[7]=0,_[8]=0,_[9]=-C,_[10]=w,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Dt.fromYRotation=function(_,E){var C=Math.sin(E),w=Math.cos(E);return _[0]=w,_[1]=0,_[2]=-C,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=C,_[9]=0,_[10]=w,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Dt.fromZRotation=function(_,E){var C=Math.sin(E),w=Math.cos(E);return _[0]=w,_[1]=C,_[2]=0,_[3]=0,_[4]=-C,_[5]=w,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Dt.fromRotationTranslation=u,Dt.fromQuat2=function(_,E){var C=new e.ARRAY_TYPE(3),w=-E[0],T=-E[1],S=-E[2],k=E[3],L=E[4],B=E[5],V=E[6],N=E[7],G=w*w+T*T+S*S+k*k;return G>0?(C[0]=2*(L*k+N*w+B*S-V*T)/G,C[1]=2*(B*k+N*T+V*w-L*S)/G,C[2]=2*(V*k+N*S+L*T-B*w)/G):(C[0]=2*(L*k+N*w+B*S-V*T),C[1]=2*(B*k+N*T+V*w-L*S),C[2]=2*(V*k+N*S+L*T-B*w)),u(_,E,C),_},Dt.getTranslation=function(_,E){return _[0]=E[12],_[1]=E[13],_[2]=E[14],_},Dt.getScaling=m,Dt.getRotation=function(_,E){var C=new e.ARRAY_TYPE(3);m(C,E);var w=1/C[0],T=1/C[1],S=1/C[2],k=E[0]*w,L=E[1]*T,B=E[2]*S,V=E[4]*w,N=E[5]*T,G=E[6]*S,H=E[8]*w,J=E[9]*T,se=E[10]*S,ee=k+N+se,ne=0;return ee>0?(ne=2*Math.sqrt(ee+1),_[3]=.25*ne,_[0]=(G-J)/ne,_[1]=(H-B)/ne,_[2]=(L-V)/ne):k>N&&k>se?(ne=2*Math.sqrt(1+k-N-se),_[3]=(G-J)/ne,_[0]=.25*ne,_[1]=(L+V)/ne,_[2]=(H+B)/ne):N>se?(ne=2*Math.sqrt(1+N-k-se),_[3]=(H-B)/ne,_[0]=(L+V)/ne,_[1]=.25*ne,_[2]=(G+J)/ne):(ne=2*Math.sqrt(1+se-k-N),_[3]=(L-V)/ne,_[0]=(H+B)/ne,_[1]=(G+J)/ne,_[2]=.25*ne),_},Dt.fromRotationTranslationScale=function(_,E,C,w){var T=E[0],S=E[1],k=E[2],L=E[3],B=T+T,V=S+S,N=k+k,G=T*B,H=T*V,J=T*N,se=S*V,ee=S*N,ne=k*N,me=L*B,te=L*V,de=L*N,ve=w[0],xe=w[1],Ie=w[2];return _[0]=(1-(se+ne))*ve,_[1]=(H+de)*ve,_[2]=(J-te)*ve,_[3]=0,_[4]=(H-de)*xe,_[5]=(1-(G+ne))*xe,_[6]=(ee+me)*xe,_[7]=0,_[8]=(J+te)*Ie,_[9]=(ee-me)*Ie,_[10]=(1-(G+se))*Ie,_[11]=0,_[12]=C[0],_[13]=C[1],_[14]=C[2],_[15]=1,_},Dt.fromRotationTranslationScaleOrigin=function(_,E,C,w,T){var S=E[0],k=E[1],L=E[2],B=E[3],V=S+S,N=k+k,G=L+L,H=S*V,J=S*N,se=S*G,ee=k*N,ne=k*G,me=L*G,te=B*V,de=B*N,ve=B*G,xe=w[0],Ie=w[1],Ae=w[2],Pe=T[0],De=T[1],$e=T[2],Je=(1-(ee+me))*xe,ze=(J+ve)*xe,dt=(se-de)*xe,it=(J-ve)*Ie,et=(1-(H+me))*Ie,Ye=(ne+te)*Ie,It=(se+de)*Ae,ht=(ne-te)*Ae,mt=(1-(H+ee))*Ae;return _[0]=Je,_[1]=ze,_[2]=dt,_[3]=0,_[4]=it,_[5]=et,_[6]=Ye,_[7]=0,_[8]=It,_[9]=ht,_[10]=mt,_[11]=0,_[12]=C[0]+Pe-(Je*Pe+it*De+It*$e),_[13]=C[1]+De-(ze*Pe+et*De+ht*$e),_[14]=C[2]+$e-(dt*Pe+Ye*De+mt*$e),_[15]=1,_},Dt.fromQuat=function(_,E){var C=E[0],w=E[1],T=E[2],S=E[3],k=C+C,L=w+w,B=T+T,V=C*k,N=w*k,G=w*L,H=T*k,J=T*L,se=T*B,ee=S*k,ne=S*L,me=S*B;return _[0]=1-G-se,_[1]=N+me,_[2]=H-ne,_[3]=0,_[4]=N-me,_[5]=1-V-se,_[6]=J+ee,_[7]=0,_[8]=H+ne,_[9]=J-ee,_[10]=1-V-G,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Dt.frustum=function(_,E,C,w,T,S,k){var L=1/(C-E),B=1/(T-w),V=1/(S-k);return _[0]=2*S*L,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*S*B,_[6]=0,_[7]=0,_[8]=(C+E)*L,_[9]=(T+w)*B,_[10]=(k+S)*V,_[11]=-1,_[12]=0,_[13]=0,_[14]=k*S*2*V,_[15]=0,_},Dt.perspectiveNO=x,Dt.perspectiveZO=function(_,E,C,w,T){var S,k=1/Math.tan(E/2);return _[0]=k/C,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=k,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,T!=null&&T!==1/0?(_[10]=T*(S=1/(w-T)),_[14]=T*w*S):(_[10]=-1,_[14]=-w),_},Dt.perspectiveFromFieldOfView=function(_,E,C,w){var T=Math.tan(E.upDegrees*Math.PI/180),S=Math.tan(E.downDegrees*Math.PI/180),k=Math.tan(E.leftDegrees*Math.PI/180),L=Math.tan(E.rightDegrees*Math.PI/180),B=2/(k+L),V=2/(T+S);return _[0]=B,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=V,_[6]=0,_[7]=0,_[8]=-(k-L)*B*.5,_[9]=(T-S)*V*.5,_[10]=w/(C-w),_[11]=-1,_[12]=0,_[13]=0,_[14]=w*C/(C-w),_[15]=0,_},Dt.orthoNO=I,Dt.orthoZO=function(_,E,C,w,T,S,k){var L=1/(E-C),B=1/(w-T),V=1/(S-k);return _[0]=-2*L,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=V,_[11]=0,_[12]=(E+C)*L,_[13]=(T+w)*B,_[14]=S*V,_[15]=1,_},Dt.lookAt=function(_,E,C,w){var T,S,k,L,B,V,N,G,H,J,se=E[0],ee=E[1],ne=E[2],me=w[0],te=w[1],de=w[2],ve=C[0],xe=C[1],Ie=C[2];return Math.abs(se-ve)<e.EPSILON&&Math.abs(ee-xe)<e.EPSILON&&Math.abs(ne-Ie)<e.EPSILON?c(_):(N=se-ve,G=ee-xe,H=ne-Ie,T=te*(H*=J=1/Math.hypot(N,G,H))-de*(G*=J),S=de*(N*=J)-me*H,k=me*G-te*N,(J=Math.hypot(T,S,k))?(T*=J=1/J,S*=J,k*=J):(T=0,S=0,k=0),L=G*k-H*S,B=H*T-N*k,V=N*S-G*T,(J=Math.hypot(L,B,V))?(L*=J=1/J,B*=J,V*=J):(L=0,B=0,V=0),_[0]=T,_[1]=L,_[2]=N,_[3]=0,_[4]=S,_[5]=B,_[6]=G,_[7]=0,_[8]=k,_[9]=V,_[10]=H,_[11]=0,_[12]=-(T*se+S*ee+k*ne),_[13]=-(L*se+B*ee+V*ne),_[14]=-(N*se+G*ee+H*ne),_[15]=1,_)},Dt.targetTo=function(_,E,C,w){var T=E[0],S=E[1],k=E[2],L=w[0],B=w[1],V=w[2],N=T-C[0],G=S-C[1],H=k-C[2],J=N*N+G*G+H*H;J>0&&(N*=J=1/Math.sqrt(J),G*=J,H*=J);var se=B*H-V*G,ee=V*N-L*H,ne=L*G-B*N;return(J=se*se+ee*ee+ne*ne)>0&&(se*=J=1/Math.sqrt(J),ee*=J,ne*=J),_[0]=se,_[1]=ee,_[2]=ne,_[3]=0,_[4]=G*ne-H*ee,_[5]=H*se-N*ne,_[6]=N*ee-G*se,_[7]=0,_[8]=N,_[9]=G,_[10]=H,_[11]=0,_[12]=T,_[13]=S,_[14]=k,_[15]=1,_},Dt.str=function(_){return"mat4("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+", "+_[4]+", "+_[5]+", "+_[6]+", "+_[7]+", "+_[8]+", "+_[9]+", "+_[10]+", "+_[11]+", "+_[12]+", "+_[13]+", "+_[14]+", "+_[15]+")"},Dt.frob=function(_){return Math.hypot(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])},Dt.add=function(_,E,C){return _[0]=E[0]+C[0],_[1]=E[1]+C[1],_[2]=E[2]+C[2],_[3]=E[3]+C[3],_[4]=E[4]+C[4],_[5]=E[5]+C[5],_[6]=E[6]+C[6],_[7]=E[7]+C[7],_[8]=E[8]+C[8],_[9]=E[9]+C[9],_[10]=E[10]+C[10],_[11]=E[11]+C[11],_[12]=E[12]+C[12],_[13]=E[13]+C[13],_[14]=E[14]+C[14],_[15]=E[15]+C[15],_},Dt.subtract=D,Dt.multiplyScalar=function(_,E,C){return _[0]=E[0]*C,_[1]=E[1]*C,_[2]=E[2]*C,_[3]=E[3]*C,_[4]=E[4]*C,_[5]=E[5]*C,_[6]=E[6]*C,_[7]=E[7]*C,_[8]=E[8]*C,_[9]=E[9]*C,_[10]=E[10]*C,_[11]=E[11]*C,_[12]=E[12]*C,_[13]=E[13]*C,_[14]=E[14]*C,_[15]=E[15]*C,_},Dt.multiplyScalarAndAdd=function(_,E,C,w){return _[0]=E[0]+C[0]*w,_[1]=E[1]+C[1]*w,_[2]=E[2]+C[2]*w,_[3]=E[3]+C[3]*w,_[4]=E[4]+C[4]*w,_[5]=E[5]+C[5]*w,_[6]=E[6]+C[6]*w,_[7]=E[7]+C[7]*w,_[8]=E[8]+C[8]*w,_[9]=E[9]+C[9]*w,_[10]=E[10]+C[10]*w,_[11]=E[11]+C[11]*w,_[12]=E[12]+C[12]*w,_[13]=E[13]+C[13]*w,_[14]=E[14]+C[14]*w,_[15]=E[15]+C[15]*w,_},Dt.exactEquals=function(_,E){return _[0]===E[0]&&_[1]===E[1]&&_[2]===E[2]&&_[3]===E[3]&&_[4]===E[4]&&_[5]===E[5]&&_[6]===E[6]&&_[7]===E[7]&&_[8]===E[8]&&_[9]===E[9]&&_[10]===E[10]&&_[11]===E[11]&&_[12]===E[12]&&_[13]===E[13]&&_[14]===E[14]&&_[15]===E[15]},Dt.equals=function(_,E){var C=_[0],w=_[1],T=_[2],S=_[3],k=_[4],L=_[5],B=_[6],V=_[7],N=_[8],G=_[9],H=_[10],J=_[11],se=_[12],ee=_[13],ne=_[14],me=_[15],te=E[0],de=E[1],ve=E[2],xe=E[3],Ie=E[4],Ae=E[5],Pe=E[6],De=E[7],$e=E[8],Je=E[9],ze=E[10],dt=E[11],it=E[12],et=E[13],Ye=E[14],It=E[15];return Math.abs(C-te)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(te))&&Math.abs(w-de)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(de))&&Math.abs(T-ve)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(ve))&&Math.abs(S-xe)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(xe))&&Math.abs(k-Ie)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ie))&&Math.abs(L-Ae)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(Ae))&&Math.abs(B-Pe)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(Pe))&&Math.abs(V-De)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(De))&&Math.abs(N-$e)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs($e))&&Math.abs(G-Je)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(Je))&&Math.abs(H-ze)<=e.EPSILON*Math.max(1,Math.abs(H),Math.abs(ze))&&Math.abs(J-dt)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(dt))&&Math.abs(se-it)<=e.EPSILON*Math.max(1,Math.abs(se),Math.abs(it))&&Math.abs(ee-et)<=e.EPSILON*Math.max(1,Math.abs(ee),Math.abs(et))&&Math.abs(ne-Ye)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Ye))&&Math.abs(me-It)<=e.EPSILON*Math.max(1,Math.abs(me),Math.abs(It))},Dt.sub=Dt.mul=Dt.ortho=Dt.perspective=void 0;var e=function(_,E){if(_&&_.__esModule)return _;if(_===null||l(_)!=="object"&&typeof _!="function")return{default:_};var C=i(void 0);if(C&&C.has(_))return C.get(_);var w={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var S in _)if(S!=="default"&&Object.prototype.hasOwnProperty.call(_,S)){var k=T?Object.getOwnPropertyDescriptor(_,S):null;k&&(k.get||k.set)?Object.defineProperty(w,S,k):w[S]=_[S]}return w.default=_,C&&C.set(_,w),w}(pe());function i(_){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(i=function(w){return w?C:E})(_)}function c(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function p(_,E,C){var w=E[0],T=E[1],S=E[2],k=E[3],L=E[4],B=E[5],V=E[6],N=E[7],G=E[8],H=E[9],J=E[10],se=E[11],ee=E[12],ne=E[13],me=E[14],te=E[15],de=C[0],ve=C[1],xe=C[2],Ie=C[3];return _[0]=de*w+ve*L+xe*G+Ie*ee,_[1]=de*T+ve*B+xe*H+Ie*ne,_[2]=de*S+ve*V+xe*J+Ie*me,_[3]=de*k+ve*N+xe*se+Ie*te,_[4]=(de=C[4])*w+(ve=C[5])*L+(xe=C[6])*G+(Ie=C[7])*ee,_[5]=de*T+ve*B+xe*H+Ie*ne,_[6]=de*S+ve*V+xe*J+Ie*me,_[7]=de*k+ve*N+xe*se+Ie*te,_[8]=(de=C[8])*w+(ve=C[9])*L+(xe=C[10])*G+(Ie=C[11])*ee,_[9]=de*T+ve*B+xe*H+Ie*ne,_[10]=de*S+ve*V+xe*J+Ie*me,_[11]=de*k+ve*N+xe*se+Ie*te,_[12]=(de=C[12])*w+(ve=C[13])*L+(xe=C[14])*G+(Ie=C[15])*ee,_[13]=de*T+ve*B+xe*H+Ie*ne,_[14]=de*S+ve*V+xe*J+Ie*me,_[15]=de*k+ve*N+xe*se+Ie*te,_}function u(_,E,C){var w=E[0],T=E[1],S=E[2],k=E[3],L=w+w,B=T+T,V=S+S,N=w*L,G=w*B,H=w*V,J=T*B,se=T*V,ee=S*V,ne=k*L,me=k*B,te=k*V;return _[0]=1-(J+ee),_[1]=G+te,_[2]=H-me,_[3]=0,_[4]=G-te,_[5]=1-(N+ee),_[6]=se+ne,_[7]=0,_[8]=H+me,_[9]=se-ne,_[10]=1-(N+J),_[11]=0,_[12]=C[0],_[13]=C[1],_[14]=C[2],_[15]=1,_}function m(_,E){var C=E[4],w=E[5],T=E[6],S=E[8],k=E[9],L=E[10];return _[0]=Math.hypot(E[0],E[1],E[2]),_[1]=Math.hypot(C,w,T),_[2]=Math.hypot(S,k,L),_}function x(_,E,C,w,T){var S,k=1/Math.tan(E/2);return _[0]=k/C,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=k,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,T!=null&&T!==1/0?(_[10]=(T+w)*(S=1/(w-T)),_[14]=2*T*w*S):(_[10]=-1,_[14]=-2*w),_}function I(_,E,C,w,T,S,k){var L=1/(E-C),B=1/(w-T),V=1/(S-k);return _[0]=-2*L,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*B,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*V,_[11]=0,_[12]=(E+C)*L,_[13]=(T+w)*B,_[14]=(k+S)*V,_[15]=1,_}function D(_,E,C){return _[0]=E[0]-C[0],_[1]=E[1]-C[1],_[2]=E[2]-C[2],_[3]=E[3]-C[3],_[4]=E[4]-C[4],_[5]=E[5]-C[5],_[6]=E[6]-C[6],_[7]=E[7]-C[7],_[8]=E[8]-C[8],_[9]=E[9]-C[9],_[10]=E[10]-C[10],_[11]=E[11]-C[11],_[12]=E[12]-C[12],_[13]=E[13]-C[13],_[14]=E[14]-C[14],_[15]=E[15]-C[15],_}return Dt.perspective=x,Dt.ortho=I,Dt.mul=p,Dt.sub=D,Dt}var Zi,kt={},Bt={};function sa(){if(Zi)return Bt;function l(T){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},l(T)}Zi=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.create=c,Bt.clone=function(T){var S=new e.ARRAY_TYPE(3);return S[0]=T[0],S[1]=T[1],S[2]=T[2],S},Bt.length=p,Bt.fromValues=function(T,S,k){var L=new e.ARRAY_TYPE(3);return L[0]=T,L[1]=S,L[2]=k,L},Bt.copy=function(T,S){return T[0]=S[0],T[1]=S[1],T[2]=S[2],T},Bt.set=function(T,S,k,L){return T[0]=S,T[1]=k,T[2]=L,T},Bt.add=function(T,S,k){return T[0]=S[0]+k[0],T[1]=S[1]+k[1],T[2]=S[2]+k[2],T},Bt.subtract=u,Bt.multiply=m,Bt.divide=x,Bt.ceil=function(T,S){return T[0]=Math.ceil(S[0]),T[1]=Math.ceil(S[1]),T[2]=Math.ceil(S[2]),T},Bt.floor=function(T,S){return T[0]=Math.floor(S[0]),T[1]=Math.floor(S[1]),T[2]=Math.floor(S[2]),T},Bt.min=function(T,S,k){return T[0]=Math.min(S[0],k[0]),T[1]=Math.min(S[1],k[1]),T[2]=Math.min(S[2],k[2]),T},Bt.max=function(T,S,k){return T[0]=Math.max(S[0],k[0]),T[1]=Math.max(S[1],k[1]),T[2]=Math.max(S[2],k[2]),T},Bt.round=function(T,S){return T[0]=Math.round(S[0]),T[1]=Math.round(S[1]),T[2]=Math.round(S[2]),T},Bt.scale=function(T,S,k){return T[0]=S[0]*k,T[1]=S[1]*k,T[2]=S[2]*k,T},Bt.scaleAndAdd=function(T,S,k,L){return T[0]=S[0]+k[0]*L,T[1]=S[1]+k[1]*L,T[2]=S[2]+k[2]*L,T},Bt.distance=I,Bt.squaredDistance=D,Bt.squaredLength=_,Bt.negate=function(T,S){return T[0]=-S[0],T[1]=-S[1],T[2]=-S[2],T},Bt.inverse=function(T,S){return T[0]=1/S[0],T[1]=1/S[1],T[2]=1/S[2],T},Bt.normalize=function(T,S){var k=S[0],L=S[1],B=S[2],V=k*k+L*L+B*B;return V>0&&(V=1/Math.sqrt(V)),T[0]=S[0]*V,T[1]=S[1]*V,T[2]=S[2]*V,T},Bt.dot=E,Bt.cross=function(T,S,k){var L=S[0],B=S[1],V=S[2],N=k[0],G=k[1],H=k[2];return T[0]=B*H-V*G,T[1]=V*N-L*H,T[2]=L*G-B*N,T},Bt.lerp=function(T,S,k,L){var B=S[0],V=S[1],N=S[2];return T[0]=B+L*(k[0]-B),T[1]=V+L*(k[1]-V),T[2]=N+L*(k[2]-N),T},Bt.hermite=function(T,S,k,L,B,V){var N=V*V,G=N*(2*V-3)+1,H=N*(V-2)+V,J=N*(V-1),se=N*(3-2*V);return T[0]=S[0]*G+k[0]*H+L[0]*J+B[0]*se,T[1]=S[1]*G+k[1]*H+L[1]*J+B[1]*se,T[2]=S[2]*G+k[2]*H+L[2]*J+B[2]*se,T},Bt.bezier=function(T,S,k,L,B,V){var N=1-V,G=N*N,H=V*V,J=G*N,se=3*V*G,ee=3*H*N,ne=H*V;return T[0]=S[0]*J+k[0]*se+L[0]*ee+B[0]*ne,T[1]=S[1]*J+k[1]*se+L[1]*ee+B[1]*ne,T[2]=S[2]*J+k[2]*se+L[2]*ee+B[2]*ne,T},Bt.random=function(T,S){S=S||1;var k=2*e.RANDOM()*Math.PI,L=2*e.RANDOM()-1,B=Math.sqrt(1-L*L)*S;return T[0]=Math.cos(k)*B,T[1]=Math.sin(k)*B,T[2]=L*S,T},Bt.transformMat4=function(T,S,k){var L=S[0],B=S[1],V=S[2],N=k[3]*L+k[7]*B+k[11]*V+k[15];return T[0]=(k[0]*L+k[4]*B+k[8]*V+k[12])/(N=N||1),T[1]=(k[1]*L+k[5]*B+k[9]*V+k[13])/N,T[2]=(k[2]*L+k[6]*B+k[10]*V+k[14])/N,T},Bt.transformMat3=function(T,S,k){var L=S[0],B=S[1],V=S[2];return T[0]=L*k[0]+B*k[3]+V*k[6],T[1]=L*k[1]+B*k[4]+V*k[7],T[2]=L*k[2]+B*k[5]+V*k[8],T},Bt.transformQuat=function(T,S,k){var L=k[0],B=k[1],V=k[2],N=S[0],G=S[1],H=S[2],J=B*H-V*G,se=V*N-L*H,ee=L*G-B*N,ne=B*ee-V*se,me=V*J-L*ee,te=L*se-B*J,de=2*k[3];return se*=de,ee*=de,me*=2,te*=2,T[0]=N+(J*=de)+(ne*=2),T[1]=G+se+me,T[2]=H+ee+te,T},Bt.rotateX=function(T,S,k,L){var B=[],V=[];return B[0]=S[0]-k[0],B[1]=S[1]-k[1],B[2]=S[2]-k[2],V[0]=B[0],V[1]=B[1]*Math.cos(L)-B[2]*Math.sin(L),V[2]=B[1]*Math.sin(L)+B[2]*Math.cos(L),T[0]=V[0]+k[0],T[1]=V[1]+k[1],T[2]=V[2]+k[2],T},Bt.rotateY=function(T,S,k,L){var B=[],V=[];return B[0]=S[0]-k[0],B[1]=S[1]-k[1],B[2]=S[2]-k[2],V[0]=B[2]*Math.sin(L)+B[0]*Math.cos(L),V[1]=B[1],V[2]=B[2]*Math.cos(L)-B[0]*Math.sin(L),T[0]=V[0]+k[0],T[1]=V[1]+k[1],T[2]=V[2]+k[2],T},Bt.rotateZ=function(T,S,k,L){var B=[],V=[];return B[0]=S[0]-k[0],B[1]=S[1]-k[1],B[2]=S[2]-k[2],V[0]=B[0]*Math.cos(L)-B[1]*Math.sin(L),V[1]=B[0]*Math.sin(L)+B[1]*Math.cos(L),V[2]=B[2],T[0]=V[0]+k[0],T[1]=V[1]+k[1],T[2]=V[2]+k[2],T},Bt.angle=function(T,S){var k=T[0],L=T[1],B=T[2],V=S[0],N=S[1],G=S[2],H=Math.sqrt(k*k+L*L+B*B)*Math.sqrt(V*V+N*N+G*G),J=H&&E(T,S)/H;return Math.acos(Math.min(Math.max(J,-1),1))},Bt.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T},Bt.str=function(T){return"vec3("+T[0]+", "+T[1]+", "+T[2]+")"},Bt.exactEquals=function(T,S){return T[0]===S[0]&&T[1]===S[1]&&T[2]===S[2]},Bt.equals=function(T,S){var k=T[0],L=T[1],B=T[2],V=S[0],N=S[1],G=S[2];return Math.abs(k-V)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(V))&&Math.abs(L-N)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(N))&&Math.abs(B-G)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(G))},Bt.forEach=Bt.sqrLen=Bt.len=Bt.sqrDist=Bt.dist=Bt.div=Bt.mul=Bt.sub=void 0;var e=function(T,S){if(T&&T.__esModule)return T;if(T===null||l(T)!=="object"&&typeof T!="function")return{default:T};var k=i(void 0);if(k&&k.has(T))return k.get(T);var L={},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in T)if(V!=="default"&&Object.prototype.hasOwnProperty.call(T,V)){var N=B?Object.getOwnPropertyDescriptor(T,V):null;N&&(N.get||N.set)?Object.defineProperty(L,V,N):L[V]=T[V]}return L.default=T,k&&k.set(T,L),L}(pe());function i(T){if(typeof WeakMap!="function")return null;var S=new WeakMap,k=new WeakMap;return(i=function(L){return L?k:S})(T)}function c(){var T=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0),T}function p(T){return Math.hypot(T[0],T[1],T[2])}function u(T,S,k){return T[0]=S[0]-k[0],T[1]=S[1]-k[1],T[2]=S[2]-k[2],T}function m(T,S,k){return T[0]=S[0]*k[0],T[1]=S[1]*k[1],T[2]=S[2]*k[2],T}function x(T,S,k){return T[0]=S[0]/k[0],T[1]=S[1]/k[1],T[2]=S[2]/k[2],T}function I(T,S){return Math.hypot(S[0]-T[0],S[1]-T[1],S[2]-T[2])}function D(T,S){var k=S[0]-T[0],L=S[1]-T[1],B=S[2]-T[2];return k*k+L*L+B*B}function _(T){var S=T[0],k=T[1],L=T[2];return S*S+k*k+L*L}function E(T,S){return T[0]*S[0]+T[1]*S[1]+T[2]*S[2]}Bt.sub=u,Bt.mul=m,Bt.div=x,Bt.dist=I,Bt.sqrDist=D,Bt.len=p,Bt.sqrLen=_;var C,w=(C=c(),function(T,S,k,L,B,V){var N,G;for(S||(S=3),k||(k=0),G=L?Math.min(L*S+k,T.length):T.length,N=k;N<G;N+=S)C[0]=T[N],C[1]=T[N+1],C[2]=T[N+2],B(C,C,V),T[N]=C[0],T[N+1]=C[1],T[N+2]=C[2];return T});return Bt.forEach=w,Bt}var Ss,Uu,Qt={};function hr(){if(Ss)return Qt;function l(w){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},l(w)}Ss=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.create=c,Qt.clone=function(w){var T=new e.ARRAY_TYPE(4);return T[0]=w[0],T[1]=w[1],T[2]=w[2],T[3]=w[3],T},Qt.fromValues=function(w,T,S,k){var L=new e.ARRAY_TYPE(4);return L[0]=w,L[1]=T,L[2]=S,L[3]=k,L},Qt.copy=function(w,T){return w[0]=T[0],w[1]=T[1],w[2]=T[2],w[3]=T[3],w},Qt.set=function(w,T,S,k,L){return w[0]=T,w[1]=S,w[2]=k,w[3]=L,w},Qt.add=function(w,T,S){return w[0]=T[0]+S[0],w[1]=T[1]+S[1],w[2]=T[2]+S[2],w[3]=T[3]+S[3],w},Qt.subtract=p,Qt.multiply=u,Qt.divide=m,Qt.ceil=function(w,T){return w[0]=Math.ceil(T[0]),w[1]=Math.ceil(T[1]),w[2]=Math.ceil(T[2]),w[3]=Math.ceil(T[3]),w},Qt.floor=function(w,T){return w[0]=Math.floor(T[0]),w[1]=Math.floor(T[1]),w[2]=Math.floor(T[2]),w[3]=Math.floor(T[3]),w},Qt.min=function(w,T,S){return w[0]=Math.min(T[0],S[0]),w[1]=Math.min(T[1],S[1]),w[2]=Math.min(T[2],S[2]),w[3]=Math.min(T[3],S[3]),w},Qt.max=function(w,T,S){return w[0]=Math.max(T[0],S[0]),w[1]=Math.max(T[1],S[1]),w[2]=Math.max(T[2],S[2]),w[3]=Math.max(T[3],S[3]),w},Qt.round=function(w,T){return w[0]=Math.round(T[0]),w[1]=Math.round(T[1]),w[2]=Math.round(T[2]),w[3]=Math.round(T[3]),w},Qt.scale=function(w,T,S){return w[0]=T[0]*S,w[1]=T[1]*S,w[2]=T[2]*S,w[3]=T[3]*S,w},Qt.scaleAndAdd=function(w,T,S,k){return w[0]=T[0]+S[0]*k,w[1]=T[1]+S[1]*k,w[2]=T[2]+S[2]*k,w[3]=T[3]+S[3]*k,w},Qt.distance=x,Qt.squaredDistance=I,Qt.length=D,Qt.squaredLength=_,Qt.negate=function(w,T){return w[0]=-T[0],w[1]=-T[1],w[2]=-T[2],w[3]=-T[3],w},Qt.inverse=function(w,T){return w[0]=1/T[0],w[1]=1/T[1],w[2]=1/T[2],w[3]=1/T[3],w},Qt.normalize=function(w,T){var S=T[0],k=T[1],L=T[2],B=T[3],V=S*S+k*k+L*L+B*B;return V>0&&(V=1/Math.sqrt(V)),w[0]=S*V,w[1]=k*V,w[2]=L*V,w[3]=B*V,w},Qt.dot=function(w,T){return w[0]*T[0]+w[1]*T[1]+w[2]*T[2]+w[3]*T[3]},Qt.cross=function(w,T,S,k){var L=S[0]*k[1]-S[1]*k[0],B=S[0]*k[2]-S[2]*k[0],V=S[0]*k[3]-S[3]*k[0],N=S[1]*k[2]-S[2]*k[1],G=S[1]*k[3]-S[3]*k[1],H=S[2]*k[3]-S[3]*k[2],J=T[0],se=T[1],ee=T[2],ne=T[3];return w[0]=se*H-ee*G+ne*N,w[1]=-J*H+ee*V-ne*B,w[2]=J*G-se*V+ne*L,w[3]=-J*N+se*B-ee*L,w},Qt.lerp=function(w,T,S,k){var L=T[0],B=T[1],V=T[2],N=T[3];return w[0]=L+k*(S[0]-L),w[1]=B+k*(S[1]-B),w[2]=V+k*(S[2]-V),w[3]=N+k*(S[3]-N),w},Qt.random=function(w,T){var S,k,L,B,V,N;T=T||1;do V=(S=2*e.RANDOM()-1)*S+(k=2*e.RANDOM()-1)*k;while(V>=1);do N=(L=2*e.RANDOM()-1)*L+(B=2*e.RANDOM()-1)*B;while(N>=1);var G=Math.sqrt((1-V)/N);return w[0]=T*S,w[1]=T*k,w[2]=T*L*G,w[3]=T*B*G,w},Qt.transformMat4=function(w,T,S){var k=T[0],L=T[1],B=T[2],V=T[3];return w[0]=S[0]*k+S[4]*L+S[8]*B+S[12]*V,w[1]=S[1]*k+S[5]*L+S[9]*B+S[13]*V,w[2]=S[2]*k+S[6]*L+S[10]*B+S[14]*V,w[3]=S[3]*k+S[7]*L+S[11]*B+S[15]*V,w},Qt.transformQuat=function(w,T,S){var k=T[0],L=T[1],B=T[2],V=S[0],N=S[1],G=S[2],H=S[3],J=H*k+N*B-G*L,se=H*L+G*k-V*B,ee=H*B+V*L-N*k,ne=-V*k-N*L-G*B;return w[0]=J*H+ne*-V+se*-G-ee*-N,w[1]=se*H+ne*-N+ee*-V-J*-G,w[2]=ee*H+ne*-G+J*-N-se*-V,w[3]=T[3],w},Qt.zero=function(w){return w[0]=0,w[1]=0,w[2]=0,w[3]=0,w},Qt.str=function(w){return"vec4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+")"},Qt.exactEquals=function(w,T){return w[0]===T[0]&&w[1]===T[1]&&w[2]===T[2]&&w[3]===T[3]},Qt.equals=function(w,T){var S=w[0],k=w[1],L=w[2],B=w[3],V=T[0],N=T[1],G=T[2],H=T[3];return Math.abs(S-V)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(V))&&Math.abs(k-N)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(N))&&Math.abs(L-G)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(G))&&Math.abs(B-H)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(H))},Qt.forEach=Qt.sqrLen=Qt.len=Qt.sqrDist=Qt.dist=Qt.div=Qt.mul=Qt.sub=void 0;var e=function(w,T){if(w&&w.__esModule)return w;if(w===null||l(w)!=="object"&&typeof w!="function")return{default:w};var S=i(void 0);if(S&&S.has(w))return S.get(w);var k={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in w)if(B!=="default"&&Object.prototype.hasOwnProperty.call(w,B)){var V=L?Object.getOwnPropertyDescriptor(w,B):null;V&&(V.get||V.set)?Object.defineProperty(k,B,V):k[B]=w[B]}return k.default=w,S&&S.set(w,k),k}(pe());function i(w){if(typeof WeakMap!="function")return null;var T=new WeakMap,S=new WeakMap;return(i=function(k){return k?S:T})(w)}function c(){var w=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(w[0]=0,w[1]=0,w[2]=0,w[3]=0),w}function p(w,T,S){return w[0]=T[0]-S[0],w[1]=T[1]-S[1],w[2]=T[2]-S[2],w[3]=T[3]-S[3],w}function u(w,T,S){return w[0]=T[0]*S[0],w[1]=T[1]*S[1],w[2]=T[2]*S[2],w[3]=T[3]*S[3],w}function m(w,T,S){return w[0]=T[0]/S[0],w[1]=T[1]/S[1],w[2]=T[2]/S[2],w[3]=T[3]/S[3],w}function x(w,T){return Math.hypot(T[0]-w[0],T[1]-w[1],T[2]-w[2],T[3]-w[3])}function I(w,T){var S=T[0]-w[0],k=T[1]-w[1],L=T[2]-w[2],B=T[3]-w[3];return S*S+k*k+L*L+B*B}function D(w){return Math.hypot(w[0],w[1],w[2],w[3])}function _(w){var T=w[0],S=w[1],k=w[2],L=w[3];return T*T+S*S+k*k+L*L}Qt.sub=p,Qt.mul=u,Qt.div=m,Qt.dist=x,Qt.sqrDist=I,Qt.len=D,Qt.sqrLen=_;var E,C=(E=c(),function(w,T,S,k,L,B){var V,N;for(T||(T=4),S||(S=0),N=k?Math.min(k*T+S,w.length):w.length,V=S;V<N;V+=T)E[0]=w[V],E[1]=w[V+1],E[2]=w[V+2],E[3]=w[V+3],L(E,E,B),w[V]=E[0],w[V+1]=E[1],w[V+2]=E[2],w[V+3]=E[3];return w});return Qt.forEach=C,Qt}function Jo(){if(Uu)return kt;function l(te){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(de){return typeof de}:function(de){return de&&typeof Symbol=="function"&&de.constructor===Symbol&&de!==Symbol.prototype?"symbol":typeof de},l(te)}Uu=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.create=x,kt.identity=function(te){return te[0]=0,te[1]=0,te[2]=0,te[3]=1,te},kt.setAxisAngle=I,kt.getAxisAngle=function(te,de){var ve=2*Math.acos(de[3]),xe=Math.sin(ve/2);return xe>e.EPSILON?(te[0]=de[0]/xe,te[1]=de[1]/xe,te[2]=de[2]/xe):(te[0]=1,te[1]=0,te[2]=0),ve},kt.getAngle=function(te,de){var ve=S(te,de);return Math.acos(2*ve*ve-1)},kt.multiply=D,kt.rotateX=function(te,de,ve){ve*=.5;var xe=de[0],Ie=de[1],Ae=de[2],Pe=de[3],De=Math.sin(ve),$e=Math.cos(ve);return te[0]=xe*$e+Pe*De,te[1]=Ie*$e+Ae*De,te[2]=Ae*$e-Ie*De,te[3]=Pe*$e-xe*De,te},kt.rotateY=function(te,de,ve){ve*=.5;var xe=de[0],Ie=de[1],Ae=de[2],Pe=de[3],De=Math.sin(ve),$e=Math.cos(ve);return te[0]=xe*$e-Ae*De,te[1]=Ie*$e+Pe*De,te[2]=Ae*$e+xe*De,te[3]=Pe*$e-Ie*De,te},kt.rotateZ=function(te,de,ve){ve*=.5;var xe=de[0],Ie=de[1],Ae=de[2],Pe=de[3],De=Math.sin(ve),$e=Math.cos(ve);return te[0]=xe*$e+Ie*De,te[1]=Ie*$e-xe*De,te[2]=Ae*$e+Pe*De,te[3]=Pe*$e-Ae*De,te},kt.calculateW=function(te,de){var ve=de[0],xe=de[1],Ie=de[2];return te[0]=ve,te[1]=xe,te[2]=Ie,te[3]=Math.sqrt(Math.abs(1-ve*ve-xe*xe-Ie*Ie)),te},kt.exp=_,kt.ln=E,kt.pow=function(te,de,ve){return E(te,de),T(te,te,ve),_(te,te),te},kt.slerp=C,kt.random=function(te){var de=e.RANDOM(),ve=e.RANDOM(),xe=e.RANDOM(),Ie=Math.sqrt(1-de),Ae=Math.sqrt(de);return te[0]=Ie*Math.sin(2*Math.PI*ve),te[1]=Ie*Math.cos(2*Math.PI*ve),te[2]=Ae*Math.sin(2*Math.PI*xe),te[3]=Ae*Math.cos(2*Math.PI*xe),te},kt.invert=function(te,de){var ve=de[0],xe=de[1],Ie=de[2],Ae=de[3],Pe=ve*ve+xe*xe+Ie*Ie+Ae*Ae,De=Pe?1/Pe:0;return te[0]=-ve*De,te[1]=-xe*De,te[2]=-Ie*De,te[3]=Ae*De,te},kt.conjugate=function(te,de){return te[0]=-de[0],te[1]=-de[1],te[2]=-de[2],te[3]=de[3],te},kt.fromMat3=w,kt.fromEuler=function(te,de,ve,xe){var Ie=.5*Math.PI/180;de*=Ie,ve*=Ie,xe*=Ie;var Ae=Math.sin(de),Pe=Math.cos(de),De=Math.sin(ve),$e=Math.cos(ve),Je=Math.sin(xe),ze=Math.cos(xe);return te[0]=Ae*$e*ze-Pe*De*Je,te[1]=Pe*De*ze+Ae*$e*Je,te[2]=Pe*$e*Je-Ae*De*ze,te[3]=Pe*$e*ze+Ae*De*Je,te},kt.str=function(te){return"quat("+te[0]+", "+te[1]+", "+te[2]+", "+te[3]+")"},kt.setAxes=kt.sqlerp=kt.rotationTo=kt.equals=kt.exactEquals=kt.normalize=kt.sqrLen=kt.squaredLength=kt.len=kt.length=kt.lerp=kt.dot=kt.scale=kt.mul=kt.add=kt.set=kt.copy=kt.fromValues=kt.clone=void 0;var e=m(pe()),i=m(_n()),c=m(sa()),p=m(hr());function u(te){if(typeof WeakMap!="function")return null;var de=new WeakMap,ve=new WeakMap;return(u=function(xe){return xe?ve:de})(te)}function m(te,de){if(te&&te.__esModule)return te;if(te===null||l(te)!=="object"&&typeof te!="function")return{default:te};var ve=u(de);if(ve&&ve.has(te))return ve.get(te);var xe={},Ie=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ae in te)if(Ae!=="default"&&Object.prototype.hasOwnProperty.call(te,Ae)){var Pe=Ie?Object.getOwnPropertyDescriptor(te,Ae):null;Pe&&(Pe.get||Pe.set)?Object.defineProperty(xe,Ae,Pe):xe[Ae]=te[Ae]}return xe.default=te,ve&&ve.set(te,xe),xe}function x(){var te=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(te[0]=0,te[1]=0,te[2]=0),te[3]=1,te}function I(te,de,ve){ve*=.5;var xe=Math.sin(ve);return te[0]=xe*de[0],te[1]=xe*de[1],te[2]=xe*de[2],te[3]=Math.cos(ve),te}function D(te,de,ve){var xe=de[0],Ie=de[1],Ae=de[2],Pe=de[3],De=ve[0],$e=ve[1],Je=ve[2],ze=ve[3];return te[0]=xe*ze+Pe*De+Ie*Je-Ae*$e,te[1]=Ie*ze+Pe*$e+Ae*De-xe*Je,te[2]=Ae*ze+Pe*Je+xe*$e-Ie*De,te[3]=Pe*ze-xe*De-Ie*$e-Ae*Je,te}function _(te,de){var ve=de[0],xe=de[1],Ie=de[2],Ae=de[3],Pe=Math.sqrt(ve*ve+xe*xe+Ie*Ie),De=Math.exp(Ae),$e=Pe>0?De*Math.sin(Pe)/Pe:0;return te[0]=ve*$e,te[1]=xe*$e,te[2]=Ie*$e,te[3]=De*Math.cos(Pe),te}function E(te,de){var ve=de[0],xe=de[1],Ie=de[2],Ae=de[3],Pe=Math.sqrt(ve*ve+xe*xe+Ie*Ie),De=Pe>0?Math.atan2(Pe,Ae)/Pe:0;return te[0]=ve*De,te[1]=xe*De,te[2]=Ie*De,te[3]=.5*Math.log(ve*ve+xe*xe+Ie*Ie+Ae*Ae),te}function C(te,de,ve,xe){var Ie,Ae,Pe,De,$e,Je=de[0],ze=de[1],dt=de[2],it=de[3],et=ve[0],Ye=ve[1],It=ve[2],ht=ve[3];return(Ae=Je*et+ze*Ye+dt*It+it*ht)<0&&(Ae=-Ae,et=-et,Ye=-Ye,It=-It,ht=-ht),1-Ae>e.EPSILON?(Ie=Math.acos(Ae),Pe=Math.sin(Ie),De=Math.sin((1-xe)*Ie)/Pe,$e=Math.sin(xe*Ie)/Pe):(De=1-xe,$e=xe),te[0]=De*Je+$e*et,te[1]=De*ze+$e*Ye,te[2]=De*dt+$e*It,te[3]=De*it+$e*ht,te}function w(te,de){var ve,xe=de[0]+de[4]+de[8];if(xe>0)ve=Math.sqrt(xe+1),te[3]=.5*ve,te[0]=(de[5]-de[7])*(ve=.5/ve),te[1]=(de[6]-de[2])*ve,te[2]=(de[1]-de[3])*ve;else{var Ie=0;de[4]>de[0]&&(Ie=1),de[8]>de[3*Ie+Ie]&&(Ie=2);var Ae=(Ie+1)%3,Pe=(Ie+2)%3;ve=Math.sqrt(de[3*Ie+Ie]-de[3*Ae+Ae]-de[3*Pe+Pe]+1),te[Ie]=.5*ve,te[3]=(de[3*Ae+Pe]-de[3*Pe+Ae])*(ve=.5/ve),te[Ae]=(de[3*Ae+Ie]+de[3*Ie+Ae])*ve,te[Pe]=(de[3*Pe+Ie]+de[3*Ie+Pe])*ve}return te}kt.clone=p.clone,kt.fromValues=p.fromValues,kt.copy=p.copy,kt.set=p.set,kt.add=p.add,kt.mul=D;var T=p.scale;kt.scale=T;var S=p.dot;kt.dot=S,kt.lerp=p.lerp;var k=p.length;kt.length=k,kt.len=k;var L=p.squaredLength;kt.squaredLength=L,kt.sqrLen=L;var B=p.normalize;kt.normalize=B,kt.exactEquals=p.exactEquals,kt.equals=p.equals;var V,N,G,H=(V=c.create(),N=c.fromValues(1,0,0),G=c.fromValues(0,1,0),function(te,de,ve){var xe=c.dot(de,ve);return xe<-.999999?(c.cross(V,N,de),c.len(V)<1e-6&&c.cross(V,G,de),c.normalize(V,V),I(te,V,Math.PI),te):xe>.999999?(te[0]=0,te[1]=0,te[2]=0,te[3]=1,te):(c.cross(V,de,ve),te[0]=V[0],te[1]=V[1],te[2]=V[2],te[3]=1+xe,B(te,te))});kt.rotationTo=H;var J,se,ee=(J=x(),se=x(),function(te,de,ve,xe,Ie,Ae){return C(J,de,Ie,Ae),C(se,ve,xe,Ae),C(te,J,se,2*Ae*(1-Ae)),te});kt.sqlerp=ee;var ne,me=(ne=i.create(),function(te,de,ve,xe){return ne[0]=ve[0],ne[3]=ve[1],ne[6]=ve[2],ne[1]=xe[0],ne[4]=xe[1],ne[7]=xe[2],ne[2]=-de[0],ne[5]=-de[1],ne[8]=-de[2],B(te,w(te,ne))});return kt.setAxes=me,kt}var Wa,Yt={};function aa(){if(Wa)return Yt;function l(C){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},l(C)}Wa=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.create=function(){var C=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0,C[4]=0,C[5]=0,C[6]=0,C[7]=0),C[3]=1,C},Yt.clone=function(C){var w=new e.ARRAY_TYPE(8);return w[0]=C[0],w[1]=C[1],w[2]=C[2],w[3]=C[3],w[4]=C[4],w[5]=C[5],w[6]=C[6],w[7]=C[7],w},Yt.fromValues=function(C,w,T,S,k,L,B,V){var N=new e.ARRAY_TYPE(8);return N[0]=C,N[1]=w,N[2]=T,N[3]=S,N[4]=k,N[5]=L,N[6]=B,N[7]=V,N},Yt.fromRotationTranslationValues=function(C,w,T,S,k,L,B){var V=new e.ARRAY_TYPE(8);V[0]=C,V[1]=w,V[2]=T,V[3]=S;var N=.5*k,G=.5*L,H=.5*B;return V[4]=N*S+G*T-H*w,V[5]=G*S+H*C-N*T,V[6]=H*S+N*w-G*C,V[7]=-N*C-G*w-H*T,V},Yt.fromRotationTranslation=m,Yt.fromTranslation=function(C,w){return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=.5*w[0],C[5]=.5*w[1],C[6]=.5*w[2],C[7]=0,C},Yt.fromRotation=function(C,w){return C[0]=w[0],C[1]=w[1],C[2]=w[2],C[3]=w[3],C[4]=0,C[5]=0,C[6]=0,C[7]=0,C},Yt.fromMat4=function(C,w){var T=i.create();c.getRotation(T,w);var S=new e.ARRAY_TYPE(3);return c.getTranslation(S,w),m(C,T,S),C},Yt.copy=x,Yt.identity=function(C){return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C[4]=0,C[5]=0,C[6]=0,C[7]=0,C},Yt.set=function(C,w,T,S,k,L,B,V,N){return C[0]=w,C[1]=T,C[2]=S,C[3]=k,C[4]=L,C[5]=B,C[6]=V,C[7]=N,C},Yt.getDual=function(C,w){return C[0]=w[4],C[1]=w[5],C[2]=w[6],C[3]=w[7],C},Yt.setDual=function(C,w){return C[4]=w[0],C[5]=w[1],C[6]=w[2],C[7]=w[3],C},Yt.getTranslation=function(C,w){var T=w[4],S=w[5],k=w[6],L=w[7],B=-w[0],V=-w[1],N=-w[2],G=w[3];return C[0]=2*(T*G+L*B+S*N-k*V),C[1]=2*(S*G+L*V+k*B-T*N),C[2]=2*(k*G+L*N+T*V-S*B),C},Yt.translate=function(C,w,T){var S=w[0],k=w[1],L=w[2],B=w[3],V=.5*T[0],N=.5*T[1],G=.5*T[2],H=w[4],J=w[5],se=w[6],ee=w[7];return C[0]=S,C[1]=k,C[2]=L,C[3]=B,C[4]=B*V+k*G-L*N+H,C[5]=B*N+L*V-S*G+J,C[6]=B*G+S*N-k*V+se,C[7]=-S*V-k*N-L*G+ee,C},Yt.rotateX=function(C,w,T){var S=-w[0],k=-w[1],L=-w[2],B=w[3],V=w[4],N=w[5],G=w[6],H=w[7],J=V*B+H*S+N*L-G*k,se=N*B+H*k+G*S-V*L,ee=G*B+H*L+V*k-N*S,ne=H*B-V*S-N*k-G*L;return i.rotateX(C,w,T),C[4]=J*(B=C[3])+ne*(S=C[0])+se*(L=C[2])-ee*(k=C[1]),C[5]=se*B+ne*k+ee*S-J*L,C[6]=ee*B+ne*L+J*k-se*S,C[7]=ne*B-J*S-se*k-ee*L,C},Yt.rotateY=function(C,w,T){var S=-w[0],k=-w[1],L=-w[2],B=w[3],V=w[4],N=w[5],G=w[6],H=w[7],J=V*B+H*S+N*L-G*k,se=N*B+H*k+G*S-V*L,ee=G*B+H*L+V*k-N*S,ne=H*B-V*S-N*k-G*L;return i.rotateY(C,w,T),C[4]=J*(B=C[3])+ne*(S=C[0])+se*(L=C[2])-ee*(k=C[1]),C[5]=se*B+ne*k+ee*S-J*L,C[6]=ee*B+ne*L+J*k-se*S,C[7]=ne*B-J*S-se*k-ee*L,C},Yt.rotateZ=function(C,w,T){var S=-w[0],k=-w[1],L=-w[2],B=w[3],V=w[4],N=w[5],G=w[6],H=w[7],J=V*B+H*S+N*L-G*k,se=N*B+H*k+G*S-V*L,ee=G*B+H*L+V*k-N*S,ne=H*B-V*S-N*k-G*L;return i.rotateZ(C,w,T),C[4]=J*(B=C[3])+ne*(S=C[0])+se*(L=C[2])-ee*(k=C[1]),C[5]=se*B+ne*k+ee*S-J*L,C[6]=ee*B+ne*L+J*k-se*S,C[7]=ne*B-J*S-se*k-ee*L,C},Yt.rotateByQuatAppend=function(C,w,T){var S=T[0],k=T[1],L=T[2],B=T[3],V=w[0],N=w[1],G=w[2],H=w[3];return C[0]=V*B+H*S+N*L-G*k,C[1]=N*B+H*k+G*S-V*L,C[2]=G*B+H*L+V*k-N*S,C[3]=H*B-V*S-N*k-G*L,C[4]=(V=w[4])*B+(H=w[7])*S+(N=w[5])*L-(G=w[6])*k,C[5]=N*B+H*k+G*S-V*L,C[6]=G*B+H*L+V*k-N*S,C[7]=H*B-V*S-N*k-G*L,C},Yt.rotateByQuatPrepend=function(C,w,T){var S=w[0],k=w[1],L=w[2],B=w[3],V=T[0],N=T[1],G=T[2],H=T[3];return C[0]=S*H+B*V+k*G-L*N,C[1]=k*H+B*N+L*V-S*G,C[2]=L*H+B*G+S*N-k*V,C[3]=B*H-S*V-k*N-L*G,C[4]=S*(H=T[7])+B*(V=T[4])+k*(G=T[6])-L*(N=T[5]),C[5]=k*H+B*N+L*V-S*G,C[6]=L*H+B*G+S*N-k*V,C[7]=B*H-S*V-k*N-L*G,C},Yt.rotateAroundAxis=function(C,w,T,S){if(Math.abs(S)<e.EPSILON)return x(C,w);var k=Math.hypot(T[0],T[1],T[2]);S*=.5;var L=Math.sin(S),B=L*T[0]/k,V=L*T[1]/k,N=L*T[2]/k,G=Math.cos(S),H=w[0],J=w[1],se=w[2],ee=w[3];C[0]=H*G+ee*B+J*N-se*V,C[1]=J*G+ee*V+se*B-H*N,C[2]=se*G+ee*N+H*V-J*B,C[3]=ee*G-H*B-J*V-se*N;var ne=w[4],me=w[5],te=w[6],de=w[7];return C[4]=ne*G+de*B+me*N-te*V,C[5]=me*G+de*V+te*B-ne*N,C[6]=te*G+de*N+ne*V-me*B,C[7]=de*G-ne*B-me*V-te*N,C},Yt.add=function(C,w,T){return C[0]=w[0]+T[0],C[1]=w[1]+T[1],C[2]=w[2]+T[2],C[3]=w[3]+T[3],C[4]=w[4]+T[4],C[5]=w[5]+T[5],C[6]=w[6]+T[6],C[7]=w[7]+T[7],C},Yt.multiply=I,Yt.scale=function(C,w,T){return C[0]=w[0]*T,C[1]=w[1]*T,C[2]=w[2]*T,C[3]=w[3]*T,C[4]=w[4]*T,C[5]=w[5]*T,C[6]=w[6]*T,C[7]=w[7]*T,C},Yt.lerp=function(C,w,T,S){var k=1-S;return D(w,T)<0&&(S=-S),C[0]=w[0]*k+T[0]*S,C[1]=w[1]*k+T[1]*S,C[2]=w[2]*k+T[2]*S,C[3]=w[3]*k+T[3]*S,C[4]=w[4]*k+T[4]*S,C[5]=w[5]*k+T[5]*S,C[6]=w[6]*k+T[6]*S,C[7]=w[7]*k+T[7]*S,C},Yt.invert=function(C,w){var T=E(w);return C[0]=-w[0]/T,C[1]=-w[1]/T,C[2]=-w[2]/T,C[3]=w[3]/T,C[4]=-w[4]/T,C[5]=-w[5]/T,C[6]=-w[6]/T,C[7]=w[7]/T,C},Yt.conjugate=function(C,w){return C[0]=-w[0],C[1]=-w[1],C[2]=-w[2],C[3]=w[3],C[4]=-w[4],C[5]=-w[5],C[6]=-w[6],C[7]=w[7],C},Yt.normalize=function(C,w){var T=E(w);if(T>0){T=Math.sqrt(T);var S=w[0]/T,k=w[1]/T,L=w[2]/T,B=w[3]/T,V=w[4],N=w[5],G=w[6],H=w[7],J=S*V+k*N+L*G+B*H;C[0]=S,C[1]=k,C[2]=L,C[3]=B,C[4]=(V-S*J)/T,C[5]=(N-k*J)/T,C[6]=(G-L*J)/T,C[7]=(H-B*J)/T}return C},Yt.str=function(C){return"quat2("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+", "+C[4]+", "+C[5]+", "+C[6]+", "+C[7]+")"},Yt.exactEquals=function(C,w){return C[0]===w[0]&&C[1]===w[1]&&C[2]===w[2]&&C[3]===w[3]&&C[4]===w[4]&&C[5]===w[5]&&C[6]===w[6]&&C[7]===w[7]},Yt.equals=function(C,w){var T=C[0],S=C[1],k=C[2],L=C[3],B=C[4],V=C[5],N=C[6],G=C[7],H=w[0],J=w[1],se=w[2],ee=w[3],ne=w[4],me=w[5],te=w[6],de=w[7];return Math.abs(T-H)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(H))&&Math.abs(S-J)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(J))&&Math.abs(k-se)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(se))&&Math.abs(L-ee)<=e.EPSILON*Math.max(1,Math.abs(L),Math.abs(ee))&&Math.abs(B-ne)<=e.EPSILON*Math.max(1,Math.abs(B),Math.abs(ne))&&Math.abs(V-me)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(me))&&Math.abs(N-te)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(te))&&Math.abs(G-de)<=e.EPSILON*Math.max(1,Math.abs(G),Math.abs(de))},Yt.sqrLen=Yt.squaredLength=Yt.len=Yt.length=Yt.dot=Yt.mul=Yt.setReal=Yt.getReal=void 0;var e=u(pe()),i=u(Jo()),c=u(ai());function p(C){if(typeof WeakMap!="function")return null;var w=new WeakMap,T=new WeakMap;return(p=function(S){return S?T:w})(C)}function u(C,w){if(C&&C.__esModule)return C;if(C===null||l(C)!=="object"&&typeof C!="function")return{default:C};var T=p(w);if(T&&T.has(C))return T.get(C);var S={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var L in C)if(L!=="default"&&Object.prototype.hasOwnProperty.call(C,L)){var B=k?Object.getOwnPropertyDescriptor(C,L):null;B&&(B.get||B.set)?Object.defineProperty(S,L,B):S[L]=C[L]}return S.default=C,T&&T.set(C,S),S}function m(C,w,T){var S=.5*T[0],k=.5*T[1],L=.5*T[2],B=w[0],V=w[1],N=w[2],G=w[3];return C[0]=B,C[1]=V,C[2]=N,C[3]=G,C[4]=S*G+k*N-L*V,C[5]=k*G+L*B-S*N,C[6]=L*G+S*V-k*B,C[7]=-S*B-k*V-L*N,C}function x(C,w){return C[0]=w[0],C[1]=w[1],C[2]=w[2],C[3]=w[3],C[4]=w[4],C[5]=w[5],C[6]=w[6],C[7]=w[7],C}function I(C,w,T){var S=w[0],k=w[1],L=w[2],B=w[3],V=T[4],N=T[5],G=T[6],H=T[7],J=w[4],se=w[5],ee=w[6],ne=w[7],me=T[0],te=T[1],de=T[2],ve=T[3];return C[0]=S*ve+B*me+k*de-L*te,C[1]=k*ve+B*te+L*me-S*de,C[2]=L*ve+B*de+S*te-k*me,C[3]=B*ve-S*me-k*te-L*de,C[4]=S*H+B*V+k*G-L*N+J*ve+ne*me+se*de-ee*te,C[5]=k*H+B*N+L*V-S*G+se*ve+ne*te+ee*me-J*de,C[6]=L*H+B*G+S*N-k*V+ee*ve+ne*de+J*te-se*me,C[7]=B*H-S*V-k*N-L*G+ne*ve-J*me-se*te-ee*de,C}Yt.getReal=i.copy,Yt.setReal=i.copy,Yt.mul=I;var D=i.dot;Yt.dot=D;var _=i.length;Yt.length=_,Yt.len=_;var E=i.squaredLength;return Yt.squaredLength=E,Yt.sqrLen=E,Yt}var xc,Za,Wt={};function bc(){if(xc)return Wt;function l(w){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},l(w)}xc=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.create=c,Wt.clone=function(w){var T=new e.ARRAY_TYPE(2);return T[0]=w[0],T[1]=w[1],T},Wt.fromValues=function(w,T){var S=new e.ARRAY_TYPE(2);return S[0]=w,S[1]=T,S},Wt.copy=function(w,T){return w[0]=T[0],w[1]=T[1],w},Wt.set=function(w,T,S){return w[0]=T,w[1]=S,w},Wt.add=function(w,T,S){return w[0]=T[0]+S[0],w[1]=T[1]+S[1],w},Wt.subtract=p,Wt.multiply=u,Wt.divide=m,Wt.ceil=function(w,T){return w[0]=Math.ceil(T[0]),w[1]=Math.ceil(T[1]),w},Wt.floor=function(w,T){return w[0]=Math.floor(T[0]),w[1]=Math.floor(T[1]),w},Wt.min=function(w,T,S){return w[0]=Math.min(T[0],S[0]),w[1]=Math.min(T[1],S[1]),w},Wt.max=function(w,T,S){return w[0]=Math.max(T[0],S[0]),w[1]=Math.max(T[1],S[1]),w},Wt.round=function(w,T){return w[0]=Math.round(T[0]),w[1]=Math.round(T[1]),w},Wt.scale=function(w,T,S){return w[0]=T[0]*S,w[1]=T[1]*S,w},Wt.scaleAndAdd=function(w,T,S,k){return w[0]=T[0]+S[0]*k,w[1]=T[1]+S[1]*k,w},Wt.distance=x,Wt.squaredDistance=I,Wt.length=D,Wt.squaredLength=_,Wt.negate=function(w,T){return w[0]=-T[0],w[1]=-T[1],w},Wt.inverse=function(w,T){return w[0]=1/T[0],w[1]=1/T[1],w},Wt.normalize=function(w,T){var S=T[0],k=T[1],L=S*S+k*k;return L>0&&(L=1/Math.sqrt(L)),w[0]=T[0]*L,w[1]=T[1]*L,w},Wt.dot=function(w,T){return w[0]*T[0]+w[1]*T[1]},Wt.cross=function(w,T,S){var k=T[0]*S[1]-T[1]*S[0];return w[0]=w[1]=0,w[2]=k,w},Wt.lerp=function(w,T,S,k){var L=T[0],B=T[1];return w[0]=L+k*(S[0]-L),w[1]=B+k*(S[1]-B),w},Wt.random=function(w,T){T=T||1;var S=2*e.RANDOM()*Math.PI;return w[0]=Math.cos(S)*T,w[1]=Math.sin(S)*T,w},Wt.transformMat2=function(w,T,S){var k=T[0],L=T[1];return w[0]=S[0]*k+S[2]*L,w[1]=S[1]*k+S[3]*L,w},Wt.transformMat2d=function(w,T,S){var k=T[0],L=T[1];return w[0]=S[0]*k+S[2]*L+S[4],w[1]=S[1]*k+S[3]*L+S[5],w},Wt.transformMat3=function(w,T,S){var k=T[0],L=T[1];return w[0]=S[0]*k+S[3]*L+S[6],w[1]=S[1]*k+S[4]*L+S[7],w},Wt.transformMat4=function(w,T,S){var k=T[0],L=T[1];return w[0]=S[0]*k+S[4]*L+S[12],w[1]=S[1]*k+S[5]*L+S[13],w},Wt.rotate=function(w,T,S,k){var L=T[0]-S[0],B=T[1]-S[1],V=Math.sin(k),N=Math.cos(k);return w[0]=L*N-B*V+S[0],w[1]=L*V+B*N+S[1],w},Wt.angle=function(w,T){var S=w[0],k=w[1],L=T[0],B=T[1],V=Math.sqrt(S*S+k*k)*Math.sqrt(L*L+B*B);return Math.acos(Math.min(Math.max(V&&(S*L+k*B)/V,-1),1))},Wt.zero=function(w){return w[0]=0,w[1]=0,w},Wt.str=function(w){return"vec2("+w[0]+", "+w[1]+")"},Wt.exactEquals=function(w,T){return w[0]===T[0]&&w[1]===T[1]},Wt.equals=function(w,T){var S=w[0],k=w[1],L=T[0],B=T[1];return Math.abs(S-L)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(L))&&Math.abs(k-B)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(B))},Wt.forEach=Wt.sqrLen=Wt.sqrDist=Wt.dist=Wt.div=Wt.mul=Wt.sub=Wt.len=void 0;var e=function(w,T){if(w&&w.__esModule)return w;if(w===null||l(w)!=="object"&&typeof w!="function")return{default:w};var S=i(void 0);if(S&&S.has(w))return S.get(w);var k={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in w)if(B!=="default"&&Object.prototype.hasOwnProperty.call(w,B)){var V=L?Object.getOwnPropertyDescriptor(w,B):null;V&&(V.get||V.set)?Object.defineProperty(k,B,V):k[B]=w[B]}return k.default=w,S&&S.set(w,k),k}(pe());function i(w){if(typeof WeakMap!="function")return null;var T=new WeakMap,S=new WeakMap;return(i=function(k){return k?S:T})(w)}function c(){var w=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(w[0]=0,w[1]=0),w}function p(w,T,S){return w[0]=T[0]-S[0],w[1]=T[1]-S[1],w}function u(w,T,S){return w[0]=T[0]*S[0],w[1]=T[1]*S[1],w}function m(w,T,S){return w[0]=T[0]/S[0],w[1]=T[1]/S[1],w}function x(w,T){return Math.hypot(T[0]-w[0],T[1]-w[1])}function I(w,T){var S=T[0]-w[0],k=T[1]-w[1];return S*S+k*k}function D(w){return Math.hypot(w[0],w[1])}function _(w){var T=w[0],S=w[1];return T*T+S*S}Wt.len=D,Wt.sub=p,Wt.mul=u,Wt.div=m,Wt.dist=x,Wt.sqrDist=I,Wt.sqrLen=_;var E,C=(E=c(),function(w,T,S,k,L,B){var V,N;for(T||(T=2),S||(S=0),N=k?Math.min(k*T+S,w.length):w.length,V=S;V<N;V+=T)E[0]=w[V],E[1]=w[V+1],L(E,E,B),w[V]=E[0],w[V+1]=E[1];return w});return Wt.forEach=C,Wt}function ao(){if(Za)return $;function l(w){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},l(w)}Za=1,Object.defineProperty($,"__esModule",{value:!0}),$.vec4=$.vec3=$.vec2=$.quat2=$.quat=$.mat4=$.mat3=$.mat2d=$.mat2=$.glMatrix=void 0;var e=C(pe());$.glMatrix=e;var i=C(Be());$.mat2=i;var c=C(At());$.mat2d=c;var p=C(_n());$.mat3=p;var u=C(ai());$.mat4=u;var m=C(Jo());$.quat=m;var x=C(aa());$.quat2=x;var I=C(bc());$.vec2=I;var D=C(sa());$.vec3=D;var _=C(hr());function E(w){if(typeof WeakMap!="function")return null;var T=new WeakMap,S=new WeakMap;return(E=function(k){return k?S:T})(w)}function C(w,T){if(w&&w.__esModule)return w;if(w===null||l(w)!=="object"&&typeof w!="function")return{default:w};var S=E(T);if(S&&S.has(w))return S.get(w);var k={},L=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in w)if(B!=="default"&&Object.prototype.hasOwnProperty.call(w,B)){var V=L?Object.getOwnPropertyDescriptor(w,B):null;V&&(V.get||V.set)?Object.defineProperty(k,B,V):k[B]=w[B]}return k.default=w,S&&S.set(w,k),k}return $.vec4=_,$}var Zr,Xa,wc,la,Ee=ao(),Ko=function(){if(Xa)return Zr;function l(e,i,c,p){this.cx=3*e,this.bx=3*(c-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(p-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=c,this.p2y=p}return Xa=1,Zr=l,l.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var c=e,p=0;p<8;p++){var u=this.sampleCurveX(c)-e;if(Math.abs(u)<i)return c;var m=this.sampleCurveDerivativeX(c);if(Math.abs(m)<1e-6)break;c-=u/m}var x=0,I=1;for(c=e,p=0;p<20&&(u=this.sampleCurveX(c),!(Math.abs(u-e)<i));p++)e>u?x=c:I=c,c=.5*(I-x)+x;return c},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Zr}(),As=R(Ko);function Ec(){if(la)return wc;function l(e,i){this.x=e,this.y=i}return la=1,wc=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,c=e.y-this.y;return i*i+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),c=Math.sin(e),p=c*this.x+i*this.y;return this.x=i*this.x-c*this.y,this.y=p,this},_rotateAround:function(e,i){var c=Math.cos(e),p=Math.sin(e),u=i.y+p*(this.x-i.x)+c*(this.y-i.y);return this.x=i.x+c*(this.x-i.x)-p*(this.y-i.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(e){return e instanceof l?e:Array.isArray(e)?new l(e[0],e[1]):e},wc}var ot=R(Ec());function ca(l,e){if(Array.isArray(l)){if(!Array.isArray(e)||l.length!==e.length)return!1;for(let i=0;i<l.length;i++)if(!ca(l[i],e[i]))return!1;return!0}if(typeof l=="object"&&l!==null&&e!==null){if(typeof e!="object"||Object.keys(l).length!==Object.keys(e).length)return!1;for(let i in l)if(!ca(l[i],e[i]))return!1;return!0}return l===e}let Xi=Math.PI/180,Qo=180/Math.PI;function ln(l){return l*Xi}function $i(l){return l*Qo}let lo=[[0,0],[1,0],[1,1],[0,1]];function ua(l){if(l<=0)return 0;if(l>=1)return 1;let e=l*l,i=e*l;return 4*(l<.5?i:3*(l-e)+i-.75)}function Rs(l,e,i,c){let p=new As(l,e,i,c);return function(u){return p.solve(u)}}let Ya=Rs(.25,.1,.25,1);function jt(l,e,i){return Math.min(i,Math.max(e,l))}function Ja(l,e,i){return(i=jt((i-l)/(e-l),0,1))*i*(3-2*i)}function es(l,e,i){let c=i-e,p=((l-e)%c+c)%c+e;return p===e?i:p}function ha(l,e,i){if(!l.length)return i(null,[]);let c=l.length,p=new Array(l.length),u=null;l.forEach((m,x)=>{e(m,(I,D)=>{I&&(u=I),p[x]=D,--c==0&&i(u,p)})})}function ar(l,...e){for(let i of e)for(let c in i)l[c]=i[c];return l}let Mr=1;function Ic(){return Mr++}function Tc(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function Ka(l,e){l.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function ts(l,e){return l.indexOf(e,l.length-e.length)!==-1}function da(l,e,i){let c={};for(let p in l)c[p]=e.call(this,l[p],p,l);return c}function Qa(l,e,i){let c={};for(let p in l)e.call(this,l[p],p,l)&&(c[p]=l[p]);return c}function Xr(l){return Array.isArray(l)?l.map(Xr):typeof l=="object"&&l?da(l,Xr):l}let Cc={};function fn(l){Cc[l]||(typeof console<"u"&&console.warn(l),Cc[l]=!0)}function Ao(l,e,i){return(i.y-l.y)*(e.x-l.x)>(e.y-l.y)*(i.x-l.x)}function $u(l){let e=0;for(let i,c,p=0,u=l.length,m=u-1;p<u;m=p++)i=l[p],c=l[m],e+=(c.x-i.x)*(i.y+c.y);return e}function Sr([l,e,i]){let c=ln(e+90),p=ln(i);return{x:l*Math.cos(c)*Math.sin(p),y:l*Math.sin(c)*Math.sin(p),z:l*Math.cos(p),azimuthal:e,polar:i}}function fa(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Dc(l){let e={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,c,p,u)=>{let m=p||u;return e[c]=!m||m.toLowerCase(),""}),e["max-age"]){let i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Mc=null;function el(l,e){return[l[4*e],l[4*e+1],l[4*e+2],l[4*e+3]]}function Sc(l,e,i,c){for(;e<i;){let p=e+i>>1;l[p]<c?e=p+1:i=p}return e}function Ne(l,e,i,c){for(;e<i;){let p=e+i>>1;l[p]<=c?e=p+1:i=p}return e}function Y(l){return l>0?1/(1.001-l):1+l}function K(l){return l>0?1-1/(1.001-l):-l}let ce={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ce.API_URL)return null;try{let l=new URL(ce.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function we(l){return ce.API_URL_REGEX.test(l)}function fe(l){return ce.API_SPRITE_REGEX.test(l)}let Te,Le,Se,Fe,je,Ue;function Qe(){return Te==null&&(Te=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Te}let ct={now:()=>Fe!==void 0?Fe:performance.now(),setNow(l){Fe=l},restoreNow(){Fe=void 0},frame(l){let e=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(l,e=0){let{width:i,height:c}=l;je||(je=document.createElement("canvas"));let p=je.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(i>je.width||c>je.height)&&(je.width=i,je.height=c),p.clearRect(-e,-e,i+2*e,c+2*e),p.drawImage(l,0,0,i,c),p.getImageData(-e,-e,i+2*e,c+2*e)},resolveURL:l=>(Le||(Le=document.createElement("a")),Le.href=l,Le.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Se==null&&(Se=window.matchMedia("(prefers-reduced-motion: reduce)")),Se.matches)},hasCanvasFingerprintNoise(){if(Ue!==void 0)return Ue;if(!Qe())return Ue=!1,!1;let l=new OffscreenCanvas(85,1),e=l.getContext("2d",{willReadFrequently:!0}),i=0;for(let p=0;p<l.width;++p)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(p,0,1,1);let c=e.getImageData(0,0,l.width,l.height);i=0;for(let p=0;p<c.data.length;++p)if(p%4!=3&&i++!==c.data[p])return Ue=!0,!0;return Ue=!1,!1}};function _t(l,e){let i=l.indexOf("?");if(i<0)return`${l}?${new URLSearchParams(e).toString()}`;let c=new URLSearchParams(l.slice(i));for(let p in e)c.set(p,e[p]);return`${l.slice(0,i)}?${c.toString()}`}function Lt(l,e={persistentParams:[]}){let i=l.indexOf("?");if(i<0)return l;let c=new URLSearchParams,p=new URLSearchParams(l.slice(i));for(let m of e.persistentParams){let x=p.get(m);x&&c.set(m,x)}let u=c.toString();return`${l.slice(0,i)}${u.length>0?`?${u}`:""}`}let Ut="mapbox-tiles",$t=500,Nt=50,Sn=["language","worldview","jobid"],xn,en;function Fn(){try{return caches}catch{}}function ti(){let l=Fn();l&&xn==null&&(xn=l.open(Ut))}let Bi=1/0,Yi={supported:!1,testSupport:function(l){!Ps&&Ji&&(Ro?Hu(l):Ai=l)}},Ai,Ji,Ps=!1,Ro=!1,Gu=typeof self<"u"?self:{};function Hu(l){let e=l.createTexture();l.bindTexture(l.TEXTURE_2D,e);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,Ji),l.isContextLost())return;Yi.supported=!0}catch{}l.deleteTexture(e),Ps=!0}Gu.document&&(Ji=Gu.document.createElement("img"),Ji.onload=function(){Ai&&Hu(Ai),Ai=null,Ro=!0},Ji.onerror=function(){Ps=!0,Ai=null},Ji.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let qu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(qu);class Jd extends Error{constructor(e,i,c){i===401&&we(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Kd=fa()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,tl=function(l,e){if(!(/^file:/.test(i=l.url)||/^file:/.test(Kd())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,p){let u=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Kd(),referrerPolicy:c.referrerPolicy,signal:u.signal}),x=!1,I=!1,D=(_=m.url).indexOf("sku=")>0&&we(_);var _;c.type==="json"&&m.headers.set("Accept","application/json");let E=(w,T,S)=>{if(I)return;if(w&&w.message!=="SecurityError"&&fn(w.toString()),T&&S)return C(T);let k=Date.now();fetch(m).then(L=>{if(L.ok){let B=D?L.clone():null;return C(L,B,k)}return p(new Jd(L.statusText,L.status,c.url))}).catch(L=>{L.name!=="AbortError"&&p(new Error(`${L.message} ${c.url}`))})},C=(w,T,S)=>{(c.type==="arrayBuffer"?w.arrayBuffer():c.type==="json"?w.json():w.text()).then(k=>{I||(T&&S&&function(L,B,V){if(ti(),xn==null)return;let N=Dc(B.headers.get("Cache-Control")||"");if(N["no-store"])return;let G={status:B.status,statusText:B.statusText,headers:new Headers};B.headers.forEach((se,ee)=>G.headers.set(ee,se)),N["max-age"]&&G.headers.set("Expires",new Date(V+1e3*N["max-age"]).toUTCString());let H=G.headers.get("Expires");if(!H||new Date(H).getTime()-V<42e4)return;let J=Lt(L.url,{persistentParams:Sn});if(B.status===206){let se=L.headers.get("Range");if(!se)return;G.status=200,J=_t(J,{range:se})}(function(se,ee){if(en===void 0)try{new Response(new ReadableStream),en=!0}catch{en=!1}en?ee(se.body):se.blob().then(ee)})(B,se=>{let ee=new Response((ne=B.status)!==200&&ne!==404&&[101,103,204,205,304].includes(ne)?null:se,G);var ne;ti(),xn?.then(me=>me.put(J,ee)).catch(me=>fn(me.message))})}(m,T,S),x=!0,p(null,k,w.headers.get("Cache-Control"),w.headers.get("Expires")))}).catch(k=>{I||p(new Error(k.message))})};return D?function(w,T){if(ti(),xn==null)return T(null);xn.then(S=>{let k=Lt(w.url,{persistentParams:Sn}),L=w.headers.get("Range");L&&(k=_t(k,{range:L})),S.match(k).then(B=>{let V=function(N){if(!N)return!1;let G=new Date(N.headers.get("Expires")||0),H=Dc(N.headers.get("Cache-Control")||"");return G>Date.now()&&!H["no-cache"]}(B);S.delete(k),V&&S.put(k,B.clone()),T(null,B,V)}).catch(T)}).catch(T)}(m,E):E(null,null),{cancel:()=>{I=!0,x||u.abort()}}}(l,e);if(fa()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,e,void 0,!0)}var i;return function(c,p){let u=new XMLHttpRequest;u.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let m in c.headers)u.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=c.credentials==="include",u.onerror=()=>{p(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let m=u.response;if(c.type==="json")try{m=JSON.parse(u.response)}catch(x){return p(x)}p(null,m,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else p(new Jd(u.statusText,u.status,c.url))},u.send(c.body),{cancel:()=>u.abort()}}(l,e)},nl=function(l,e){return tl(ar(l,{type:"arrayBuffer"}),e)};function Yr(l){let e=document.createElement("a");return e.href=l,e.protocol===location.protocol&&e.host===location.host}let co="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",uo,xr;uo=[],xr=0;let Po=function(l,e){if(Yi.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),xr>=ce.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:l,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return uo.push(u),u}xr++;let i=!1,c=()=>{if(!i)for(i=!0,xr--;uo.length&&xr<ce.MAX_PARALLEL_IMAGE_REQUESTS;){let u=uo.shift(),{requestParameters:m,callback:x,cancelled:I}=u;I||(u.cancel=Po(m,x).cancel)}},p=nl(l,(u,m,x,I)=>{c(),u?e(u):m&&(self.createImageBitmap?function(D,_){let E=new Blob([new Uint8Array(D)],{type:"image/png"});createImageBitmap(E).then(C=>{_(null,C)}).catch(C=>{_(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(D,_)=>e(D,_,x,I)):function(D,_){let E=new Image;E.onload=()=>{_(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=co})},E.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let C=new Blob([new Uint8Array(D)],{type:"image/png"});E.src=D.byteLength?URL.createObjectURL(C):co}(m,(D,_)=>e(D,_,x,I)))});return{cancel:()=>{p.cancel(),c()}}};var Ac,Qd,ef,Oo={exports:{}},Wu={exports:{}},eg={exports:{}},p0=function(){if(ef)return Oo.exports;ef=1;var l=(Ac||(Ac=1,Wu.exports=function(i,c){var p,u,m,x,I,D,_,E;for(u=i.length-(p=3&i.length),m=c,I=3432918353,D=461845907,E=0;E<u;)_=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,m=27492+(65535&(x=5*(65535&(m=(m^=_=(65535&(_=(_=(65535&_)*I+(((_>>>16)*I&65535)<<16)&4294967295)<<15|_>>>17))*D+(((_>>>16)*D&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(_=0,p){case 3:_^=(255&i.charCodeAt(E+2))<<16;case 2:_^=(255&i.charCodeAt(E+1))<<8;case 1:m^=_=(65535&(_=(_=(65535&(_^=255&i.charCodeAt(E)))*I+(((_>>>16)*I&65535)<<16)&4294967295)<<15|_>>>17))*D+(((_>>>16)*D&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Wu.exports),e=(Qd||(Qd=1,eg.exports=function(i,c){for(var p,u=i.length,m=c^u,x=0;u>=4;)p=1540483477*(65535&(p=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(p>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),u-=4,++x;switch(u){case 3:m^=(255&i.charCodeAt(x+2))<<16;case 2:m^=(255&i.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),eg.exports);return Oo.exports=l,Oo.exports.murmur3=l,Oo.exports.murmur2=e,Oo.exports}(),br=R(p0);class Os{constructor(e,...i){ar(this,i[0]||{}),this.type=e}}class Rc extends Os{constructor(e,i={}){super("error",ar({error:e},i))}}function il(l,e,i){i[l]&&i[l].indexOf(e)!==-1||(i[l]=i[l]||[],i[l].push(e))}function tf(l,e,i){if(i&&i[l]){let c=i[l].indexOf(e);c!==-1&&i[l].splice(c,1)}}class rl{on(e,i){return this._listeners=this._listeners||{},il(e,i,this._listeners),this}off(e,i){return tf(e,i,this._listeners),tf(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},il(e,i,this._oneTimeListeners),this):new Promise(c=>this.once(e,c))}fire(e,i){let c=typeof e=="string"?new Os(e,i):e,p=c.type;if(this.listens(p)){c.target=this;let u=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(let I of u)I.call(this,c);let m=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(let I of m)tf(p,I,this._oneTimeListeners),I.call(this,c);let x=this._eventedParent;x&&(ar(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(c))}else c instanceof Rc&&console.error(c.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var nf,bn={},rf=function(){if(nf)return bn;nf=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(u){return(u=Math.round(u))<0?0:u>255?255:u}function i(u){return e(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function c(u){return(m=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:m>1?1:m;var m}function p(u,m,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?u+(m-u)*x*6:2*x<1?m:3*x<2?u+(m-u)*(2/3-x)*6:u}try{bn.parseCSSColor=function(u){var m,x=u.replace(/ /g,"").toLowerCase();if(x in l)return l[x].slice();if(x[0]==="#")return x.length===4?(m=parseInt(x.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:x.length===7&&(m=parseInt(x.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var I=x.indexOf("("),D=x.indexOf(")");if(I!==-1&&D+1===x.length){var _=x.substr(0,I),E=x.substr(I+1,D-(I+1)).split(","),C=1;switch(_){case"rgba":if(E.length!==4)return null;C=c(E.pop());case"rgb":return E.length!==3?null:[i(E[0]),i(E[1]),i(E[2]),C];case"hsla":if(E.length!==4)return null;C=c(E.pop());case"hsl":if(E.length!==3)return null;var w=(parseFloat(E[0])%360+360)%360/360,T=c(E[1]),S=c(E[2]),k=S<=.5?S*(T+1):S+T-S*T,L=2*S-k;return[e(255*p(L,k,w+1/3)),e(255*p(L,k,w)),e(255*p(L,k,w-1/3)),C];default:return null}}return null}}catch{}return bn}();class On{constructor(e,i,c,p=1){this.r=e,this.g=i,this.b=c,this.a=p}static parse(e){if(!e)return;if(e instanceof On)return e;if(typeof e!="string")return;let i=rf.parseCSSColor(e);return i?new On(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){let[e,i,c,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(c)},${p})`}toRenderColor(e){let{r:i,g:c,b:p,a:u}=this;return new m0(e,i,c,p,u)}}class m0{constructor(e,i,c,p,u){if(e){let m=e.image.height,x=m*m;i=u===0?0:i/u*(m-1),c=u===0?0:c/u*(m-1),p=u===0?0:p/u*(m-1);let I=Math.floor(i),D=Math.floor(c),_=Math.floor(p),E=Math.ceil(i),C=Math.ceil(c),w=Math.ceil(p),T=i-I,S=c-D,k=p-_,L=e.image.data,B=4*(I+D*x+_*m),V=4*(I+D*x+w*m),N=4*(I+C*x+_*m),G=4*(I+C*x+w*m),H=4*(E+D*x+_*m),J=4*(E+D*x+w*m),se=4*(E+C*x+_*m),ee=4*(E+C*x+w*m);if(B<0||ee>=L.length)throw new Error("out of range");this.r=Rt(Rt(Rt(L[B],L[V],k),Rt(L[N],L[G],k),S),Rt(Rt(L[H],L[J],k),Rt(L[se],L[ee],k),S),T)/255*u,this.g=Rt(Rt(Rt(L[B+1],L[V+1],k),Rt(L[N+1],L[G+1],k),S),Rt(Rt(L[H+1],L[J+1],k),Rt(L[se+1],L[ee+1],k),S),T)/255*u,this.b=Rt(Rt(Rt(L[B+2],L[V+2],k),Rt(L[N+2],L[G+2],k),S),Rt(Rt(L[H+2],L[J+2],k),Rt(L[se+2],L[ee+2],k),S),T)/255*u,this.a=u}else this.r=i,this.g=c,this.b=p,this.a=u}toArray(){let{r:e,g:i,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*e/p,255*i/p,255*c/p,p]}toArray01(){let{r:e,g:i,b:c,a:p}=this;return p===0?[0,0,0,0]:[e/p,i/p,c/p,p]}toArray01Scaled(e){let{r:i,g:c,b:p,a:u}=this;return u===0?[0,0,0]:[i/u*e,c/u*e,p/u*e]}toArray01PremultipliedAlpha(){let{r:e,g:i,b:c,a:p}=this;return[e,i,c,p]}toArray01Linear(){let{r:e,g:i,b:c,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(e/p,2.2),Math.pow(i/p,2.2),Math.pow(c/p,2.2),p]}}function Rt(l,e,i){return l*(1-i)+e*i}function Pc(l,e,i){return l.map((c,p)=>Rt(c,e[p],i))}On.black=new On(0,0,0,1),On.white=new On(1,1,1,1),On.transparent=new On(0,0,0,0),On.red=new On(1,0,0,1),On.blue=new On(0,0,1,1);var pa=Object.freeze({__proto__:null,array:Pc,color:function(l,e,i){return new On(Rt(l.r,e.r,i),Rt(l.g,e.g,i),Rt(l.b,e.b,i),Rt(l.a,e.a,i))},number:Rt});function ol(l,...e){for(let i of e)for(let c in i)l[c]=i[c];return l}class ho extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Zu{constructor(e,i=[]){this.parent=e,this.bindings={};for(let[c,p]of i)this.bindings[c]=p}concat(e){return new Zu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let fo={kind:"null"},gt={kind:"number"},pn={kind:"string"},mn={kind:"boolean"},wr={kind:"color"},lr={kind:"object"},yn={kind:"value"},Xu={kind:"collator"},sl={kind:"formatted"},al={kind:"resolvedImage"};function dr(l,e){return{kind:"array",itemType:l,N:e}}function _i(l){if(l.kind==="array"){let e=_i(l.itemType);return typeof l.N=="number"?`array<${e}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${e}>`}return l.kind}let tg=[fo,gt,pn,mn,wr,sl,lr,dr(yn),al];function ll(l,e){if(e.kind==="error")return null;if(l.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ll(l.itemType,e.itemType))&&(typeof l.N!="number"||l.N===e.N))return null}else{if(l.kind===e.kind)return null;if(l.kind==="value"){for(let i of tg)if(!ll(i,e))return null}}return`Expected ${_i(l)} but found ${_i(e)} instead.`}function cl(l,e){return e.some(i=>i.kind===l.kind)}function ko(l,e){return e.some(i=>i==="null"?l===null:i==="array"?Array.isArray(l):i==="object"?l&&!Array.isArray(l)&&typeof l=="object":i===typeof l)}class Yu{constructor(e,i,c){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ar{constructor(e,i,c,p,u){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=c,this.fontStack=p,this.textColor=u}}class cr{constructor(e){this.sections=e}static fromString(e){return new cr([new Ar(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof cr?e:cr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);let c={};i.fontStack&&(c["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(c["font-scale"]=i.scale),i.textColor&&(c["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(c)}return e}}class fr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new fr({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function ng(l,e,i,c){return typeof l=="number"&&l>=0&&l<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[l,e,i,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[l,e,i,c]:[l,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ks(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof On||l instanceof Yu||l instanceof cr||l instanceof fr)return!0;if(Array.isArray(l)){for(let e of l)if(!ks(e))return!1;return!0}if(typeof l=="object"){for(let e in l)if(!ks(l[e]))return!1;return!0}return!1}function Ci(l){if(l===null)return fo;if(typeof l=="string")return pn;if(typeof l=="boolean")return mn;if(typeof l=="number")return gt;if(l instanceof On)return wr;if(l instanceof Yu)return Xu;if(l instanceof cr)return sl;if(l instanceof fr)return al;if(Array.isArray(l)){let e=l.length,i;for(let c of l){let p=Ci(c);if(i){if(i===p)continue;i=yn;break}i=p}return dr(i||yn,e)}return lr}function pr(l){let e=typeof l;return l===null?"":e==="string"||e==="number"||e==="boolean"?String(l):l instanceof On||l instanceof cr||l instanceof fr?l.toString():JSON.stringify(l)}class po{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ks(e[1]))return i.error("invalid value");let c=e[1],p=Ci(c),u=i.expectedType;return p.kind!=="array"||p.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(p=u),new po(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof On?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof cr?this.value.serialize():this.value}}class Vi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let of={string:pn,number:gt,boolean:mn,object:lr};class mo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let c,p=1,u=e[0];if(u==="array"){let x,I;if(e.length>2){let D=e[1];if(typeof D!="string"||!(D in of)||D==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=of[D],p++}else x=yn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);I=e[2],p++}c=dr(x,I)}else c=of[u];let m=[];for(;p<e.length;p++){let x=i.parse(e[p],p,yn);if(!x)return null;m.push(x)}return new mo(c,m)}evaluate(e){for(let i=0;i<this.args.length;i++){let c=this.args[i].evaluate(e);if(!ll(this.type,Ci(c)))return c;if(i===this.args.length-1)throw new Vi(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${_i(Ci(c))} but was expected to be of type ${_i(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,i=[e.kind];if(e.kind==="array"){let c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){i.push(c.kind);let p=e.N;(typeof p=="number"||this.args.length>1)&&i.push(p)}}return i.concat(this.args.map(c=>c.serialize()))}}class ul{constructor(e){this.type=sl,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let c=e[1];if(!Array.isArray(c)&&typeof c=="object")return i.error("First argument must be an image or text section.");let p=[],u=!1;for(let m=1;m<=e.length-1;++m){let x=e[m];if(u&&typeof x=="object"&&!Array.isArray(x)){u=!1;let I=null;if(x["font-scale"]&&(I=i.parseObjectValue(x["font-scale"],m,"font-scale",gt),!I))return null;let D=null;if(x["text-font"]&&(D=i.parseObjectValue(x["text-font"],m,"text-font",dr(pn)),!D))return null;let _=null;if(x["text-color"]&&(_=i.parseObjectValue(x["text-color"],m,"text-color",wr),!_))return null;let E=p[p.length-1];E.scale=I,E.font=D,E.textColor=_}else{let I=i.parse(e[m],m,yn);if(!I)return null;let D=I.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,p.push({content:I,scale:null,font:null,textColor:null})}}return new ul(p)}evaluate(e){return new cr(this.sections.map(i=>{let c=i.content.evaluate(e);return Ci(c)===al?new Ar("",c,null,null,null):new Ar(pr(c),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(let i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let i of this.sections){e.push(i.content.serialize());let c={};i.scale&&(c["font-scale"]=i.scale.serialize()),i.font&&(c["text-font"]=i.font.serialize()),i.textColor&&(c["text-color"]=i.textColor.serialize()),e.push(c)}return e}}class ma{constructor(e,i){this.type=al,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let c=i.parse(e[1],1,pn);if(!c)return i.error("No image name provided.");if(e.length===2)return new ma(c);let p=i.parse(e[2],1,pn);return p?new ma(c,p):i.error("Secondary image variant is not a string.")}evaluate(e){let i=fr.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ga(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}let Ju={"to-boolean":mn,"to-color":wr,"to-number":gt,"to-string":pn};class ns{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let c=e[0],p=[],u=fo;if(c==="to-array"){if(!Array.isArray(e[1]))return null;let m=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);u=dr(i.expectedType.itemType,m)}else{if(!(m>0&&ks(e[1][0])))return null;u=dr(Ci(e[1][0]),m)}for(let x=0;x<m;x++){let I=e[1][x],D;if(ga(I)==="array")D=i.parse(I,void 0,u.itemType);else{let _=ga(I);if(_!==u.itemType.kind)return i.error(`Expected ${u.itemType.kind} but found ${_}.`);D=i.registry.literal.parse(["literal",I===void 0?null:I],i)}if(!D)return null;p.push(D)}}else{if((c==="to-boolean"||c==="to-string")&&e.length!==2)return i.error("Expected one argument.");u=Ju[c];for(let m=1;m<e.length;m++){let x=i.parse(e[m],m,yn);if(!x)return null;p.push(x)}}return new ns(u,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,c;for(let p of this.args){if(i=p.evaluate(e),c=null,i instanceof On)return i;if(typeof i=="string"){let u=e.parseColor(i);if(u)return u}else if(Array.isArray(i)&&(c=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ng(i[0],i[1],i[2],i[3]),!c))return new On(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Vi(c||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(let c of this.args){if(i=c.evaluate(e),i===null)return 0;let p=Number(i);if(!isNaN(p))return p}throw new Vi(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?cr.fromString(pr(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?fr.fromString(pr(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):pr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ul([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ma(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}let g0=["Unknown","Point","LineString","Polygon"];class ig{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?g0[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:c,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*i-e[0])+this.featureDistanceData.bearing[1]*(p*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=On.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Er{constructor(e,i,c,p,u){this.name=e,this.type=i,this._evaluate=c,this.args=p,this._overloadIndex=u}evaluate(e){if(!this._evaluate){let i=Er.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){let c=e[0],p=Er.definitions[c];if(!p)return i.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(p)?p[0]:p.type,m=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=[],I=null,D=-1;for(let[_,E]of m){if(Array.isArray(_)&&_.length!==e.length-1)continue;x.push(_),D++,I=new mg(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);let C=[],w=!1;for(let T=1;T<e.length;T++){let S=e[T],k=Array.isArray(_)?_[T-1]:_.type,L=I.parse(S,1+C.length,k);if(!L){w=!0;break}C.push(L)}if(!w)if(Array.isArray(_)&&_.length!==C.length)I.error(`Expected ${_.length} arguments, but found ${C.length} instead.`);else{for(let T=0;T<C.length;T++){let S=Array.isArray(_)?_[T]:_.type,k=C[T];I.concat(T+1).checkSubtype(S,k.type)}if(I.errors.length===0)return new Er(c,u,E,C,D)}}if(x.length===1)i.errors.push(...I.errors);else{let _=(x.length?x:m.map(([C])=>C)).map(_0).join(" | "),E=[];for(let C=1;C<e.length;C++){let w=i.parse(e[C],1+E.length);if(!w)return null;E.push(_i(w.type))}i.error(`Expected arguments of type ${_}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){Er.definitions=i;for(let c in i)e[c]=Er}}function _0(l){return Array.isArray(l)?`(${l.map(_i).join(", ")})`:`(${_i(l.type)}...)`}class Ku{constructor(e,i,c){this.type=Xu,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");let c=e[1];if(typeof c!="object"||Array.isArray(c))return i.error("Collator options argument must be an object.");let p=c["case-sensitive"]===void 0?i.parse(!1,1,mn):i.parseObjectValue(c["case-sensitive"],1,"case-sensitive",mn);if(!p)return null;let u=c["diacritic-sensitive"]===void 0?i.parse(!1,1,mn):i.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",mn);if(!u)return null;let m=null;return c.locale&&(m=i.parseObjectValue(c.locale,1,"locale",pn),!m)?null:new Ku(p,u,m)}evaluate(e){return new Yu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function rg(l,e,i=0,c=l.length-1,p=dl){for(;c>i;){if(c-i>600){let I=c-i+1,D=e-i+1,_=Math.log(I),E=.5*Math.exp(2*_/3),C=.5*Math.sqrt(_*E*(I-E)/I)*(D-I/2<0?-1:1);rg(l,e,Math.max(i,Math.floor(e-D*E/I+C)),Math.min(c,Math.floor(e+(I-D)*E/I+C)),p)}let u=l[e],m=i,x=c;for(hl(l,i,e),p(l[c],u)>0&&hl(l,i,c);m<x;){for(hl(l,m,x),m++,x--;p(l[m],u)<0;)m++;for(;p(l[x],u)>0;)x--}p(l[i],u)===0?hl(l,i,x):(x++,hl(l,x,c)),x<=e&&(i=x+1),e<=x&&(c=x-1)}}function hl(l,e,i){let c=l[e];l[e]=l[i],l[i]=c}function dl(l,e){return l<e?-1:l>e?1:0}function y0(l){let e=0;for(let i,c,p=0,u=l.length,m=u-1;p<u;m=p++)i=l[p],c=l[m],e+=(c.x-i.x)*(i.y+c.y);return e}function Oc(l,e){l[0]=Math.min(l[0],e[0]),l[1]=Math.min(l[1],e[1]),l[2]=Math.max(l[2],e[0]),l[3]=Math.max(l[3],e[1])}function _a(l,e){return!(l[0]<=e[0]||l[2]>=e[2]||l[1]<=e[1]||l[3]>=e[3])}function v0(l,e,i){let c=l[0]-e[0],p=l[1]-e[1],u=l[0]-i[0],m=l[1]-i[1];return c*m-u*p==0&&c*u<=0&&p*m<=0}function fl(l,e,i=!1){let c=!1;for(let x=0,I=e.length;x<I;x++){let D=e[x];for(let _=0,E=D.length,C=E-1;_<E;C=_++){let w=D[C],T=D[_];if(v0(l,w,T))return i;(u=w)[1]>(p=l)[1]!=(m=T)[1]>p[1]&&p[0]<(m[0]-u[0])*(p[1]-u[1])/(m[1]-u[1])+u[0]&&(c=!c)}}var p,u,m;return c}function og(l,e,i,c){let p=c[0]-i[0],u=c[1]-i[1],m=(l[0]-i[0])*u-p*(l[1]-i[1]),x=(e[0]-i[0])*u-p*(e[1]-i[1]);return m>0&&x<0||m<0&&x>0}function Qu(l,e,i,c){return(p=[c[0]-i[0],c[1]-i[1]])[0]*(u=[e[0]-l[0],e[1]-l[1]])[1]-p[1]*u[0]!=0&&!(!og(l,e,i,c)||!og(i,c,l,e));var p,u}let Rr=8192;function sn(l,e){let i=(180+l[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(i*p*Rr),Math.round(c*p*Rr)]}function Ct(l,e){for(let i=0;i<e.length;i++)if(fl(l,e[i]))return!0;return!1}function sf(l,e,i){for(let c of i)for(let p=0,u=c.length,m=u-1;p<u;m=p++)if(Qu(l,e,c[m],c[p]))return!0;return!1}function Gt(l,e){for(let i=0;i<l.length;++i)if(!fl(l[i],e))return!1;for(let i=0;i<l.length-1;++i)if(sf(l[i],l[i+1],e))return!1;return!0}function af(l,e){for(let i=0;i<e.length;i++)if(Gt(l,e[i]))return!0;return!1}function kc(l,e,i){let c=[];for(let p=0;p<l.length;p++){let u=[];for(let m=0;m<l[p].length;m++){let x=sn(l[p][m],i);Oc(e,x),u.push(x)}c.push(u)}return c}function zt(l,e,i){let c=[];for(let p=0;p<l.length;p++){let u=kc(l[p],e,i);c.push(u)}return c}function lf(l,e,i,c){if(l[0]<i[0]||l[0]>i[2]){let p=.5*c,u=l[0]-i[0]>p?-c:i[0]-l[0]>p?c:0;u===0&&(u=l[0]-i[2]>p?-c:i[2]-l[0]>p?c:0),l[0]+=u}Oc(e,l)}function eh(l,e,i,c){let p=Math.pow(2,c.z)*Rr,u=[c.x*Rr,c.y*Rr],m=[];if(!l)return m;for(let x of l)for(let I of x){let D=[I.x+u[0],I.y+u[1]];lf(D,e,i,p),m.push(D)}return m}function cf(l,e,i,c){let p=Math.pow(2,c.z)*Rr,u=[c.x*Rr,c.y*Rr],m=[];if(!l)return m;for(let I of l){let D=[];for(let _ of I){let E=[_.x+u[0],_.y+u[1]];Oc(e,E),D.push(E)}m.push(D)}if(e[2]-e[0]<=p/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(let I of m)for(let D of I)lf(D,e,i,p)}var x;return m}class Ls{constructor(e,i){this.type=mn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ks(e[1])){let c=e[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){let u=c.features[p].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ls(c,c.features[p].geometry)}else if(c.type==="Feature"){let p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ls(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Ls(c,c)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,c){let p=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(c.type==="Polygon"){let x=kc(c.coordinates,u,m),I=eh(i.geometry(),p,u,m);if(!_a(p,u))return!1;for(let D of I)if(!fl(D,x))return!1}if(c.type==="MultiPolygon"){let x=zt(c.coordinates,u,m),I=eh(i.geometry(),p,u,m);if(!_a(p,u))return!1;for(let D of I)if(!Ct(D,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,c){let p=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(c.type==="Polygon"){let x=kc(c.coordinates,u,m),I=cf(i.geometry(),p,u,m);if(!_a(p,u))return!1;for(let D of I)if(!Gt(D,x))return!1}if(c.type==="MultiPolygon"){let x=zt(c.coordinates,u,m),I=cf(i.geometry(),p,u,m);if(!_a(p,u))return!1;for(let D of I)if(!af(D,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}let ya={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ki=1/298.257223563,th=Ki*(2-Ki),pl=Math.PI/180;class ml{static fromTile(e,i,c){let p=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),u=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/pl;return new ml(u,c)}static get units(){return ya}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!ya[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(ya).join(", ")}`);let c=6378.137*pl*(i?ya[i]:1),p=Math.cos(e*pl),u=1/(1-th*(1-p*p)),m=Math.sqrt(u);this.kx=c*m*p,this.ky=c*m*u*(1-th)}distance(e,i){let c=di(e[0]-i[0])*this.kx,p=(e[1]-i[1])*this.ky;return Math.sqrt(c*c+p*p)}bearing(e,i){let c=di(i[0]-e[0])*this.kx;return Math.atan2(c,(i[1]-e[1])*this.ky)/pl}destination(e,i,c){let p=c*pl;return this.offset(e,Math.sin(p)*i,Math.cos(p)*i)}offset(e,i,c){return[e[0]+i/this.kx,e[1]+c/this.ky]}lineDistance(e){let i=0;for(let c=0;c<e.length-1;c++)i+=this.distance(e[c],e[c+1]);return i}area(e){let i=0;for(let c=0;c<e.length;c++){let p=e[c];for(let u=0,m=p.length,x=m-1;u<m;x=u++)i+=di(p[u][0]-p[x][0])*(p[u][1]+p[x][1])*(c?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let c=0;if(i<=0)return e[0];for(let p=0;p<e.length-1;p++){let u=e[p],m=e[p+1],x=this.distance(u,m);if(c+=x,c>i)return is(u,m,(i-(c-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,i,c){let[p,u]=i,m=di(c[0]-p)*this.kx,x=(c[1]-u)*this.ky;if(m!==0||x!==0){let I=(di(e[0]-p)*this.kx*m+(e[1]-u)*this.ky*x)/(m*m+x*x);I>1?(p=c[0],u=c[1]):I>0&&(p+=m/this.kx*I,u+=x/this.ky*I)}return m=di(e[0]-p)*this.kx,x=(e[1]-u)*this.ky,Math.sqrt(m*m+x*x)}pointOnLine(e,i){let c=1/0,p=e[0][0],u=e[0][1],m=0,x=0;for(let I=0;I<e.length-1;I++){let D=e[I][0],_=e[I][1],E=di(e[I+1][0]-D)*this.kx,C=(e[I+1][1]-_)*this.ky,w=0;E===0&&C===0||(w=(di(i[0]-D)*this.kx*E+(i[1]-_)*this.ky*C)/(E*E+C*C),w>1?(D=e[I+1][0],_=e[I+1][1]):w>0&&(D+=E/this.kx*w,_+=C/this.ky*w)),E=di(i[0]-D)*this.kx,C=(i[1]-_)*this.ky;let T=E*E+C*C;T<c&&(c=T,p=D,u=_,m=I,x=w)}return{point:[p,u],index:m,t:Math.max(0,Math.min(1,x))}}lineSlice(e,i,c){let p=this.pointOnLine(c,e),u=this.pointOnLine(c,i);if(p.index>u.index||p.index===u.index&&p.t>u.t){let D=p;p=u,u=D}let m=[p.point],x=p.index+1,I=u.index;!nh(c[x],m[0])&&x<=I&&m.push(c[x]);for(let D=x+1;D<=I;D++)m.push(c[D]);return nh(c[I],u.point)||m.push(u.point),m}lineSliceAlong(e,i,c){let p=0,u=[];for(let m=0;m<c.length-1;m++){let x=c[m],I=c[m+1],D=this.distance(x,I);if(p+=D,p>e&&u.length===0&&u.push(is(x,I,(e-(p-D))/D)),p>=i)return u.push(is(x,I,(i-(p-D))/D)),u;p>e&&u.push(I)}return u}bufferPoint(e,i){let c=i/this.ky,p=i/this.kx;return[e[0]-p,e[1]-c,e[0]+p,e[1]+c]}bufferBBox(e,i){let c=i/this.ky,p=i/this.kx;return[e[0]-p,e[1]-c,e[2]+p,e[3]+c]}insideBBox(e,i){return di(e[0]-i[0])>=0&&di(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function nh(l,e){return l[0]===e[0]&&l[1]===e[1]}function is(l,e,i){let c=di(e[0]-l[0]);return[l[0]+c*i,l[1]+(e[1]-l[1])*i]}function di(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class uf{constructor(e=[],i=(c,p)=>c<p?-1:c>p?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:i,compare:c}=this,p=i[e];for(;e>0;){let u=e-1>>1,m=i[u];if(c(p,m)>=0)break;i[e]=m,e=u}i[e]=p}_down(e){let{data:i,compare:c}=this,p=this.length>>1,u=i[e];for(;e<p;){let m=1+(e<<1),x=m+1;if(x<this.length&&c(i[x],i[m])<0&&(m=x),c(i[m],u)>=0)break;i[e]=i[m],e=m}i[e]=u}}var st=8192;function sg(l,e){return e.dist-l.dist}let gl=100,ih=50;function rh(l){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==l.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==l[i])return!1;return!0}function oh(l){return l[1]-l[0]+1}function rs(l,e){let i=l[1]>=l[0]&&l[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function hf(l,e){if(l[0]>l[1])return[null,null];let i=oh(l);if(e){if(i===2)return[l,null];let c=Math.floor(i/2);return[[l[0],l[0]+c],[l[0]+c,l[1]]]}{if(i===1)return[l,null];let c=Math.floor(i/2)-1;return[[l[0],l[0]+c],[l[0]+c+1,l[1]]]}}function Pr(l,e){let i=[1/0,1/0,-1/0,-1/0];if(!rs(e,l.length))return i;for(let c=e[0];c<=e[1];++c)Oc(i,l[c]);return i}function sh(l){let e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<l.length;++i)for(let c=0;c<l[i].length;++c)Oc(e,l[i][c]);return e}function _l(l,e,i){if(rh(l)||rh(e))return NaN;let c=0,p=0;return l[2]<e[0]&&(c=e[0]-l[2]),l[0]>e[2]&&(c=l[0]-e[2]),l[1]>e[3]&&(p=l[1]-e[3]),l[3]<e[1]&&(p=e[1]-l[3]),i.distance([0,0],[c,p])}function ag(l){return 360*l-180}function lg(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Or(l,e){let i=Math.pow(2,e.z),c=(l.y/st+e.y)/i;return[ag((l.x/st+e.x)/i),lg(c)]}function cg(l,e){let i=[];for(let c=0;c<l.length;++c)i.push(Or(l[c],e));return i}function df(l,e,i){let c=i.pointOnLine(e,l).point;return i.distance(l,c)}function ff(l,e,i,c,p){let u=i.slice(c[0],c[1]+1),m=1/0;for(let x=e[0];x<=e[1];++x)if((m=Math.min(m,df(l[x],u,p)))===0)return 0;return m}function ah(l,e,i,c,p){let u=Math.min(p.pointToSegmentDistance(l,i,c),p.pointToSegmentDistance(e,i,c)),m=Math.min(p.pointToSegmentDistance(i,l,e),p.pointToSegmentDistance(c,l,e));return Math.min(u,m)}function ug(l,e,i,c,p){if(!rs(e,l.length)||!rs(c,i.length))return NaN;let u=1/0;for(let m=e[0];m<e[1];++m)for(let x=c[0];x<c[1];++x){if(Qu(l[m],l[m+1],i[x],i[x+1]))return 0;u=Math.min(u,ah(l[m],l[m+1],i[x],i[x+1],p))}return u}function hg(l,e,i,c,p){if(!rs(e,l.length)||!rs(c,i.length))return NaN;let u=1/0;for(let m=e[0];m<=e[1];++m)for(let x=c[0];x<=c[1];++x)if((u=Math.min(u,p.distance(l[m],i[x])))===0)return u;return u}function dg(l,e,i){if(fl(l,e,!0))return 0;let c=1/0;for(let p of e){let u=p.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[u-1]&&(c=Math.min(c,i.pointToSegmentDistance(l,p[u-1],p[0])))===0||(c=Math.min(c,df(l,p,i)))===0)return c}return c}function fg(l,e,i,c){if(!rs(e,l.length))return NaN;for(let u=e[0];u<=e[1];++u)if(fl(l[u],i,!0))return 0;let p=1/0;for(let u=e[0];u<e[1];++u)for(let m of i)for(let x=0,I=m.length,D=I-1;x<I;D=x++){if(Qu(l[u],l[u+1],m[D],m[x]))return 0;p=Math.min(p,ah(l[u],l[u+1],m[D],m[x],c))}return p}function pf(l,e){for(let i of l)for(let c=0;c<=i.length-1;++c)if(fl(i[c],e,!0))return!0;return!1}function pg(l,e,i,c=1/0){let p=sh(l),u=sh(e);if(c!==1/0&&_l(p,u,i)>=c)return c;if(_a(p,u)){if(pf(l,e))return 0}else if(pf(e,l))return 0;let m=c;for(let x of l)for(let I=0,D=x.length,_=D-1;I<D;_=I++)for(let E of e)for(let C=0,w=E.length,T=w-1;C<w;T=C++){if(Qu(x[_],x[I],E[T],E[C]))return 0;m=Math.min(m,ah(x[_],x[I],E[T],E[C],i))}return m}function Lc(l,e,i,c,p,u,m){if(u===null||m===null)return;let x=_l(Pr(c,u),Pr(p,m),i);x<e&&l.push({dist:x,range1:u,range2:m})}function lh(l,e,i,c,p=1/0){let u=Math.min(c.distance(l[0],i[0][0]),p);if(u===0)return u;let m=new uf([{dist:0,range1:[0,l.length-1],range2:[0,0]}],sg),x=e?ih:gl,I=sh(i);for(;m.length;){let D=m.pop();if(D.dist>=u)continue;let _=D.range1;if(oh(_)<=x){if(!rs(_,l.length))return NaN;if(e){let E=fg(l,_,i,c);if((u=Math.min(u,E))===0)return u}else for(let E=_[0];E<=_[1];++E){let C=dg(l[E],i,c);if((u=Math.min(u,C))===0)return u}}else{let E=hf(_,e);if(E[0]!==null){let C=_l(Pr(l,E[0]),I,c);C<u&&m.push({dist:C,range1:E[0],range2:[0,0]})}if(E[1]!==null){let C=_l(Pr(l,E[1]),I,c);C<u&&m.push({dist:C,range1:E[1],range2:[0,0]})}}}return u}function Fc(l,e,i,c,p,u=1/0){let m=Math.min(u,p.distance(l[0],i[0]));if(m===0)return m;let x=new uf([{dist:0,range1:[0,l.length-1],range2:[0,i.length-1]}],sg),I=e?ih:gl,D=c?ih:gl;for(;x.length;){let _=x.pop();if(_.dist>=m)continue;let E=_.range1,C=_.range2;if(oh(E)<=I&&oh(C)<=D){if(!rs(E,l.length)||!rs(C,i.length))return NaN;if(e&&c?m=Math.min(m,ug(l,E,i,C,p)):e||c?e&&!c?m=Math.min(m,ff(i,C,l,E,p)):!e&&c&&(m=Math.min(m,ff(l,E,i,C,p))):m=Math.min(m,hg(l,E,i,C,p)),m===0)return m}else{let w=hf(E,e),T=hf(C,c);Lc(x,m,p,l,i,w[0],T[0]),Lc(x,m,p,l,i,w[0],T[1]),Lc(x,m,p,l,i,w[1],T[0]),Lc(x,m,p,l,i,w[1],T[1])}}return m}function yl(l,e,i,c,p=1/0){let u=p,m=Pr(l,[0,l.length-1]);for(let x of i)if(!(u!==1/0&&_l(m,Pr(x,[0,x.length-1]),c)>=u)&&(u=Math.min(u,Fc(l,e,x,!0,c,u)),u===0))return u;return u}function Nc(l,e,i,c,p=1/0){let u=p,m=Pr(l,[0,l.length-1]);for(let x of i){if(u!==1/0&&_l(m,sh(x),c)>=u)continue;let I=lh(l,e,x,c,u);if(isNaN(I))return I;if((u=Math.min(u,I))===0)return u}return u}function ch(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class Fs{constructor(e,i){this.type=gt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ks(e[1])){let c=e[1];if(c.type==="FeatureCollection"){for(let p=0;p<c.features.length;++p)if(ch(c.features[p].geometry.type))return new Fs(c,c.features[p].geometry)}else if(c.type==="Feature"){if(ch(c.geometry.type))return new Fs(c,c.geometry)}else if(ch(c.type))return new Fs(c,c)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let i=e.geometry(),c=e.canonicalID();if(i!=null&&c!=null){if(e.geometryType()==="Point")return function(p,u,m){let x=[];for(let D of p)for(let _ of D)x.push(Or(_,u));let I=new ml(x[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Fc(x,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",I):m.type==="MultiLineString"?yl(x,!1,m.coordinates,I):m.type==="Polygon"||m.type==="MultiPolygon"?Nc(x,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,I):null}(i,c,this.geometries);if(e.geometryType()==="LineString")return function(p,u,m){let x=[];for(let D of p){let _=[];for(let E of D)_.push(Or(E,u));x.push(_)}let I=new ml(x[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return yl(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,I);if(m.type==="MultiLineString"){let D=1/0;for(let _=0;_<m.coordinates.length;_++){let E=yl(m.coordinates[_],!0,x,I,D);if(isNaN(E))return E;if((D=Math.min(D,E))===0)return D}return D}if(m.type==="Polygon"||m.type==="MultiPolygon"){let D=1/0;for(let _=0;_<x.length;_++){let E=Nc(x[_],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,I,D);if(isNaN(E))return E;if((D=Math.min(D,E))===0)return D}return D}return null}(i,c,this.geometries);if(e.geometryType()==="Polygon")return function(p,u,m){let x=[];for(let D of function(_,E){let C=_.length;if(C<=1)return[_];let w=[],T,S;for(let k=0;k<C;k++){let L=y0(_[k]);L!==0&&(_[k].area=Math.abs(L),S===void 0&&(S=L<0),S===L<0?(T&&w.push(T),T=[_[k]]):T.push(_[k]))}return T&&w.push(T),w}(p)){let _=[];for(let E=0;E<D.length;++E)_.push(cg(D[E],u));x.push(_)}let I=new ml(x[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Nc(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x,I);if(m.type==="MultiLineString"){let D=1/0;for(let _=0;_<m.coordinates.length;_++){let E=Nc(m.coordinates[_],!0,x,I,D);if(isNaN(E))return E;if((D=Math.min(D,E))===0)return D}return D}return m.type==="Polygon"||m.type==="MultiPolygon"?function(D,_,E){let C=1/0;for(let w of D)for(let T of _){let S=pg(w,T,E,C);if(isNaN(S))return S;if((C=Math.min(C,S))===0)return C}return C}(m.type==="Polygon"?[m.coordinates]:m.coordinates,x,I):null}(i,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ns(l,e){switch(l){case"string":return pr(e);case"number":return+e;case"boolean":return!!e;case"color":return On.parse(e);case"formatted":return cr.fromString(pr(e));case"resolvedImage":return fr.fromString(pr(e))}return e}function dn(l,e,i,c){return c!==void 0&&(l=c*Math.round(l/c)),e!==void 0&&l<e&&(l=e),i!==void 0&&l>i&&(l=i),l}class vl{constructor(e,i,c){this.type=e,this.key=i,this.scope=c}static parse(e,i){let c=i.expectedType;if(c==null&&(c=yn),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");let p=i.parse(e[1],1);if(!(p instanceof po))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let u=i.parse(e[2],2);return u instanceof po?new vl(c,pr(p.value),pr(u.value)):i.error("Scope of 'config' expression must be a string literal.")}return new vl(c,pr(p.value))}evaluate(e){let i=[this.key,this.scope,e.scope].filter(Boolean).join(""),c=e.getConfig(i);if(!c)return null;let{type:p,value:u,values:m,minValue:x,maxValue:I,stepValue:D}=c,_=c.default.evaluate(e),E=_;if(u){let C=e.scope;e.scope=(C||"").split("").slice(1).join(""),E=u.evaluate(e),e.scope=C}return p&&(E=Ns(p,E)),E===void 0||x===void 0&&I===void 0&&D===void 0||(typeof E=="number"?E=dn(E,x,I,D):Array.isArray(E)&&(E=E.map(C=>typeof C=="number"?dn(C,x,I,D):C))),u!==void 0&&E!==void 0&&m&&!m.includes(E)&&(E=_,p&&(E=Ns(p,E))),(p&&p!==this.type||E!==void 0&&Ci(E)!==this.type)&&(E=Ns(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function zc(l){if(l instanceof Er&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Ls||l instanceof Fs)return!1;let e=!0;return l.eachChild(i=>{e&&!zc(i)&&(e=!1)}),e}function uh(l){if(l instanceof Er&&l.name==="feature-state")return!1;let e=!0;return l.eachChild(i=>{e&&!uh(i)&&(e=!1)}),e}function Bc(l){if(l instanceof vl)return new Set([l.key]);let e=new Set;return l.eachChild(i=>{e=new Set([...e,...Bc(i)])}),e}function xl(l,e){if(l instanceof Er&&e.indexOf(l.name)>=0)return!1;let i=!0;return l.eachChild(c=>{i&&!xl(c,e)&&(i=!1)}),i}class Hn{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let c=e[1];return i.scope.has(c)?new Hn(c,i.scope.get(c)):i.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class mf{constructor(e,i=[],c,p=new Zu,u=[],m,x){this.registry=e,this.path=i,this.key=i.map(I=>typeof I=="string"?`['${I}']`:`[${I}]`).join(""),this.scope=p,this.errors=u,this.expectedType=c,this._scope=m,this.options=x}parse(e,i,c,p,u={}){return i||c?this.concat(i,null,c,p)._parse(e,u):this._parse(e,u)}parseObjectValue(e,i,c,p,u,m={}){return this.concat(i,c,p,u)._parse(e,m)}_parse(e,i){function c(p,u,m){return m==="assert"?new mo(u,[p]):m==="coerce"?new ns(u,[p]):p}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let p=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(p){let u=p.parse(e,this);if(!u)return null;if(this.expectedType){let m=this.expectedType,x=u.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||x.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(m,x))return null}else u=c(u,m,i.typeAnnotation||"coerce");else u=c(u,m,i.typeAnnotation||"assert")}if(!(u instanceof po)&&u.type.kind!=="resolvedImage"&&gf(u)){let m=new ig(this._scope,this.options);try{u=new po(u.type,u.evaluate(m))}catch(x){return this.error(x.message),null}}return u}return ns.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,c,p){let u=typeof e=="number"?this.path.concat(e):this.path;u=typeof i=="string"?u.concat(i):u;let m=p?this.scope.concat(p):this.scope;return new mf(this.registry,u,c||null,m,this.errors,this._scope,this.options)}error(e,...i){let c=`${this.key}${i.map(p=>`[${p}]`).join("")}`;this.errors.push(new ho(c,e))}checkSubtype(e,i){let c=ll(e,i);return c&&this.error(c),c}}var mg=mf;function gf(l){if(l instanceof Hn)return gf(l.boundExpression);if(l instanceof Er&&l.name==="error"||l instanceof Ku||l instanceof Ls||l instanceof Fs||l instanceof vl)return!1;let e=l instanceof ns||l instanceof mo,i=!0;return l.eachChild(c=>{i=e?i&&gf(c):i&&c instanceof po}),!!i&&zc(l)&&xl(l,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function hh(l,e){let i=l.length-1,c,p,u=0,m=i,x=0;for(;u<=m;)if(x=Math.floor((u+m)/2),c=l[x],p=l[x+1],c<=e){if(x===i||e<p)return x;u=x+1}else{if(!(c>e))throw new Vi("Input is not a number.");m=x-1}return 0}class Vc{constructor(e,i,c){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(let[p,u]of c)this.labels.push(p),this.outputs.push(u)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");let c=i.parse(e[1],1,gt);if(!c)return null;let p=[],u=null;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);for(let m=1;m<e.length;m+=2){let x=m===1?-1/0:e[m],I=e[m+1],D=m,_=m+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);let E=i.parse(I,_,u);if(!E)return null;u=u||E.type,p.push([x,E])}return new Vc(u,c,p)}evaluate(e){let i=this.labels,c=this.outputs;if(i.length===1)return c[0].evaluate(e);let p=this.input.evaluate(e);if(p<=i[0])return c[0].evaluate(e);let u=i.length;return p>=i[u-1]?c[u-1].evaluate(e):c[hh(i,p)].evaluate(e)}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}let gg=.95047,_g=1.08883,yg=4/29,bl=6/29,vg=3*bl*bl,x0=bl*bl*bl,b0=Math.PI/180,w0=180/Math.PI;function _f(l){return l>x0?Math.pow(l,1/3):l/vg+yg}function yf(l){return l>bl?l*l*l:vg*(l-yg)}function vf(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function xf(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function xg(l){let e=xf(l.r),i=xf(l.g),c=xf(l.b),p=_f((.4124564*e+.3575761*i+.1804375*c)/gg),u=_f((.2126729*e+.7151522*i+.072175*c)/1);return{l:116*u-16,a:500*(p-u),b:200*(u-_f((.0193339*e+.119192*i+.9503041*c)/_g)),alpha:l.a}}function bg(l){let e=(l.l+16)/116,i=isNaN(l.a)?e:e+l.a/500,c=isNaN(l.b)?e:e-l.b/200;return e=1*yf(e),i=gg*yf(i),c=_g*yf(c),new On(vf(3.2404542*i-1.5371385*e-.4985314*c),vf(-.969266*i+1.8760108*e+.041556*c),vf(.0556434*i-.2040259*e+1.0572252*c),l.alpha)}function E0(l,e,i){let c=e-l;return l+i*(c>180||c<-180?c-360*Math.round(c/360):c)}let jc={forward:xg,reverse:bg,interpolate:function(l,e,i){return{l:Rt(l.l,e.l,i),a:Rt(l.a,e.a,i),b:Rt(l.b,e.b,i),alpha:Rt(l.alpha,e.alpha,i)}}},Uc={forward:function(l){let{l:e,a:i,b:c}=xg(l),p=Math.atan2(c,i)*w0;return{h:p<0?p+360:p,c:Math.sqrt(i*i+c*c),l:e,alpha:l.a}},reverse:function(l){let e=l.h*b0,i=l.c;return bg({l:l.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:l.alpha})},interpolate:function(l,e,i){return{h:E0(l.h,e.h,i),c:Rt(l.c,e.c,i),l:Rt(l.l,e.l,i),alpha:Rt(l.alpha,e.alpha,i)}}};var wg=Object.freeze({__proto__:null,hcl:Uc,lab:jc});class kr{constructor(e,i,c,p,u){this.type=e,this.operator=i,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(let[m,x]of u)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(e,i,c,p){let u=0;if(e.name==="exponential")u=bf(i,e.base,c,p);else if(e.name==="linear")u=bf(i,1,c,p);else if(e.name==="cubic-bezier"){let m=e.controlPoints;u=new As(m[0],m[1],m[2],m[3]).solve(bf(i,1,c,p))}return u}static parse(e,i){let[c,p,u,...m]=e;if(!Array.isArray(p)||p.length===0)return i.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){let D=p[1];if(typeof D!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:D}}else{if(p[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(p[0])}`,1,0);{let D=p.slice(1);if(D.length!==4||D.some(_=>typeof _!="number"||_<0||_>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(u=i.parse(u,2,gt),!u)return null;let x=[],I=null;c==="interpolate-hcl"||c==="interpolate-lab"?I=wr:i.expectedType&&i.expectedType.kind!=="value"&&(I=i.expectedType);for(let D=0;D<m.length;D+=2){let _=m[D],E=m[D+1],C=D+3,w=D+4;if(typeof _!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(x.length&&x[x.length-1][0]>=_)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);let T=i.parse(E,w,I);if(!T)return null;I=I||T.type,x.push([_,T])}return I.kind==="number"||I.kind==="color"||I.kind==="array"&&I.itemType.kind==="number"&&typeof I.N=="number"?new kr(I,c,p,u,x):i.error(`Type ${_i(I)} is not interpolatable.`)}evaluate(e){let i=this.labels,c=this.outputs;if(i.length===1)return c[0].evaluate(e);let p=this.input.evaluate(e);if(p<=i[0])return c[0].evaluate(e);let u=i.length;if(p>=i[u-1])return c[u-1].evaluate(e);let m=hh(i,p),x=kr.interpolationFactor(this.interpolation,p,i[m],i[m+1]),I=c[m].evaluate(e),D=c[m+1].evaluate(e);return this.operator==="interpolate"?pa[this.type.kind.toLowerCase()](I,D,x):this.operator==="interpolate-hcl"?Uc.reverse(Uc.interpolate(Uc.forward(I),Uc.forward(D),x)):jc.reverse(jc.interpolate(jc.forward(I),jc.forward(D),x))}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let i=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)i.push(this.labels[c],this.outputs[c].serialize());return i}}function bf(l,e,i,c){let p=c-i,u=l-i;return p===0?0:e===1?u/p:(Math.pow(e,u)-1)/(Math.pow(e,p)-1)}class dh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let c=null,p=i.expectedType;p&&p.kind!=="value"&&(c=p);let u=[];for(let x of e.slice(1)){let I=i.parse(x,1+u.length,c,void 0,{typeAnnotation:"omit"});if(!I)return null;c=c||I.type,u.push(I)}let m=p&&u.some(x=>ll(p,x.type));return new dh(m?yn:c,u)}evaluate(e){let i,c=null,p=0;for(let u of this.args){if(p++,c=u.evaluate(e),c&&c instanceof fr&&!c.available&&(i||(i=c),c=null,p===this.args.length))return i;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class fh{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let c=[];for(let u=1;u<e.length-1;u+=2){let m=e[u];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,u);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",u);let x=i.parse(e[u+1],u+1);if(!x)return null;c.push([m,x])}let p=i.parse(e[e.length-1],e.length-1,i.expectedType,c);return p?new fh(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[i,c]of this.bindings)e.push(i,c.serialize());return e.push(this.result.serialize()),e}}class wf{constructor(e,i,c){this.type=e,this.index=i,this.input=c}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let c=i.parse(e[1],1,gt),p=i.parse(e[2],2,dr(i.expectedType||yn));return c&&p?new wf(p.type.itemType,c,p):null}evaluate(e){let i=this.index.evaluate(e),c=this.input.evaluate(e);if(i<0)throw new Vi(`Array index out of bounds: ${i} < 0.`);if(i>c.length-1)throw new Vi(`Array index out of bounds: ${i} > ${c.length-1}.`);if(i===Math.floor(i))return c[i];let p=Math.floor(i),u=Math.ceil(i),m=c[p],x=c[u];if(typeof m!="number"||typeof x!="number")throw new Vi(`Cannot interpolate between non-number values at index ${i}.`);let I=i-p;return m*(1-I)+x*I}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ef{constructor(e,i){this.type=mn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let c=i.parse(e[1],1,yn),p=i.parse(e[2],2,yn);return c&&p?cl(c.type,[mn,pn,gt,fo,yn])?new Ef(c,p):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${_i(c.type)} instead`):null}evaluate(e){let i=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!ko(i,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${_i(Ci(i))} instead.`);if(!ko(c,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${_i(Ci(c))} instead.`);return c.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ph{constructor(e,i,c){this.type=gt,this.needle=e,this.haystack=i,this.fromIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let c=i.parse(e[1],1,yn),p=i.parse(e[2],2,yn);if(!c||!p)return null;if(!cl(c.type,[mn,pn,gt,fo,yn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${_i(c.type)} instead`);if(e.length===4){let u=i.parse(e[3],3,gt);return u?new ph(c,p,u):null}return new ph(c,p)}evaluate(e){let i=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!ko(i,["boolean","string","number","null"]))throw new Vi(`Expected first argument to be of type boolean, string, number or null, but found ${_i(Ci(i))} instead.`);if(!ko(c,["string","array"]))throw new Vi(`Expected second argument to be of type array or string, but found ${_i(Ci(c))} instead.`);if(this.fromIndex){let p=this.fromIndex.evaluate(e);return c.indexOf(i,p)}return c.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class If{constructor(e,i,c,p,u,m){this.inputType=e,this.type=i,this.input=c,this.cases=p,this.outputs=u,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let c,p;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);let u={},m=[];for(let D=2;D<e.length-1;D+=2){let _=e[D],E=e[D+1];Array.isArray(_)||(_=[_]);let C=i.concat(D);if(_.length===0)return C.error("Expected at least one branch label.");for(let T of _){if(typeof T!="number"&&typeof T!="string")return C.error("Branch labels must be numbers or strings.");if(typeof T=="number"&&Math.abs(T)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof T=="number"&&Math.floor(T)!==T)return C.error("Numeric branch labels must be integer values.");if(c){if(C.checkSubtype(c,Ci(T)))return null}else c=Ci(T);if(u[String(T)]!==void 0)return C.error("Branch labels must be unique.");u[String(T)]=m.length}let w=i.parse(E,D,p);if(!w)return null;p=p||w.type,m.push(w)}let x=i.parse(e[1],1,yn);if(!x)return null;let I=i.parse(e[e.length-1],e.length-1,p);return I?x.type.kind!=="value"&&i.concat(1).checkSubtype(c,x.type)?null:new If(c,p,x,u,m,I):null}evaluate(e){let i=this.input.evaluate(e);return(Ci(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),c=[],p={};for(let m of i){let x=p[this.cases[m]];x===void 0?(p[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[x][1].push(m)}let u=m=>this.inputType.kind==="number"?Number(m):m;for(let[m,x]of c)e.push(x.length===1?u(x[0]):x.map(u)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class $c{constructor(e,i,c){this.type=e,this.branches=i,this.otherwise=c}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);let p=[];for(let m=1;m<e.length-1;m+=2){let x=i.parse(e[m],m,mn);if(!x)return null;let I=i.parse(e[m+1],m+1,c);if(!I)return null;p.push([x,I]),c=c||I.type}let u=i.parse(e[e.length-1],e.length-1,c);return u?new $c(c,p,u):null}evaluate(e){for(let[i,c]of this.branches)if(i.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[i,c]of this.branches)e(i),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class mh{constructor(e,i,c,p){this.type=e,this.input=i,this.beginIndex=c,this.endIndex=p}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let c=i.parse(e[1],1,yn),p=i.parse(e[2],2,gt);if(!c||!p)return null;if(!cl(c.type,[dr(yn),pn,yn]))return i.error(`Expected first argument to be of type array or string, but found ${_i(c.type)} instead`);if(e.length===4){let u=i.parse(e[3],3,gt);return u?new mh(c.type,c,p,u):null}return new mh(c.type,c,p)}evaluate(e){let i=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!ko(i,["string","array"]))throw new Vi(`Expected first argument to be of type array or string, but found ${_i(Ci(i))} instead.`);if(this.endIndex){let p=this.endIndex.evaluate(e);return i.slice(c,p)}return i.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Tf(l,e){return l==="=="||l==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Eg(l,e,i,c){return c.compare(e,i)===0}function wl(l,e,i){let c=l!=="=="&&l!=="!=";return class RR{constructor(u,m,x){this.type=mn,this.lhs=u,this.rhs=m,this.collator=x,this.hasUntypedArgument=u.type.kind==="value"||m.type.kind==="value"}static parse(u,m){if(u.length!==3&&u.length!==4)return m.error("Expected two or three arguments.");let x=u[0],I=m.parse(u[1],1,yn);if(!I)return null;if(!Tf(x,I.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${_i(I.type)}'.`);let D=m.parse(u[2],2,yn);if(!D)return null;if(!Tf(x,D.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${_i(D.type)}'.`);if(I.type.kind!==D.type.kind&&I.type.kind!=="value"&&D.type.kind!=="value")return m.error(`Cannot compare types '${_i(I.type)}' and '${_i(D.type)}'.`);c&&(I.type.kind==="value"&&D.type.kind!=="value"?I=new mo(D.type,[I]):I.type.kind!=="value"&&D.type.kind==="value"&&(D=new mo(I.type,[D])));let _=null;if(u.length===4){if(I.type.kind!=="string"&&D.type.kind!=="string"&&I.type.kind!=="value"&&D.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(_=m.parse(u[3],3,Xu),!_)return null}return new RR(I,D,_)}evaluate(u){let m=this.lhs.evaluate(u),x=this.rhs.evaluate(u);if(c&&this.hasUntypedArgument){let I=Ci(m),D=Ci(x);if(I.kind!==D.kind||I.kind!=="string"&&I.kind!=="number")throw new Vi(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${I.kind}, ${D.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){let I=Ci(m),D=Ci(x);if(I.kind!=="string"||D.kind!=="string")return e(u,m,x)}return this.collator?i(u,m,x,this.collator.evaluate(u)):e(u,m,x)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[l];return this.eachChild(m=>{u.push(m.serialize())}),u}}}let I0=wl("==",function(l,e,i){return e===i},Eg),Ig=wl("!=",function(l,e,i){return e!==i},function(l,e,i,c){return!Eg(0,e,i,c)}),Tg=wl("<",function(l,e,i){return e<i},function(l,e,i,c){return c.compare(e,i)<0}),El=wl(">",function(l,e,i){return e>i},function(l,e,i,c){return c.compare(e,i)>0}),Cg=wl("<=",function(l,e,i){return e<=i},function(l,e,i,c){return c.compare(e,i)<=0}),Dg=wl(">=",function(l,e,i){return e>=i},function(l,e,i,c){return c.compare(e,i)>=0});class Cf{constructor(e,i,c,p,u,m){this.type=pn,this.number=e,this.locale=i,this.currency=c,this.unit=p,this.minFractionDigits=u,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");let c=i.parse(e[1],1,gt);if(!c)return null;let p=e[2];if(typeof p!="object"||Array.isArray(p))return i.error("NumberFormat options argument must be an object.");let u=null;if(p.locale&&(u=i.parseObjectValue(p.locale,2,"locale",pn),!u))return null;let m=null;if(p.currency&&(m=i.parseObjectValue(p.currency,2,"currency",pn),!m))return null;let x=null;if(p.unit&&(x=i.parseObjectValue(p.unit,2,"unit",pn),!x))return null;let I=null;if(p["min-fraction-digits"]&&(I=i.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",gt),!I))return null;let D=null;return p["max-fraction-digits"]&&(D=i.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",gt),!D)?null:new Cf(c,u,m,x,I,D)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Gc{constructor(e){this.type=gt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);let c=i.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${_i(c.type)} instead.`):new Gc(c):null}evaluate(e){let i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Vi(`Expected value to be of type string or array, but found ${_i(Ci(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function gh(l){return function(){l=1831565813+(l|=0)|0;let e=Math.imul(l^l>>>15,1|l);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Il={"==":I0,"!=":Ig,">":El,"<":Tg,">=":Dg,"<=":Cg,array:mo,at:wf,boolean:mo,case:$c,coalesce:dh,collator:Ku,format:ul,image:ma,in:Ef,"index-of":ph,interpolate:kr,"interpolate-hcl":kr,"interpolate-lab":kr,length:Gc,let:fh,literal:po,match:If,number:mo,"number-format":Cf,object:mo,slice:mh,step:Vc,string:mo,"to-boolean":ns,"to-color":ns,"to-number":ns,"to-string":ns,var:Hn,within:Ls,distance:Fs,config:vl};function Mg(l,[e,i,c,p]){e=e.evaluate(l),i=i.evaluate(l),c=c.evaluate(l);let u=p?p.evaluate(l):1,m=ng(e,i,c,u);if(m)throw new Vi(m);return new On(e/255*u,i/255*u,c/255*u,u)}function Df(l,[e,i,c,p]){e=e.evaluate(l),i=i.evaluate(l),c=c.evaluate(l);let u=p?p.evaluate(l):1,m=function(D,_,E,C){return typeof D=="number"&&D>=0&&D<=360?typeof _=="number"&&_>=0&&_<=100&&typeof E=="number"&&E>=0&&E<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[D,_,E,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[D,_,E,C]:[D,_,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[D,_,E,C]:[D,_,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,c,u);if(m)throw new Vi(m);let x=`hsla(${e}, ${i}%, ${c}%, ${u})`,I=On.parse(x);if(!I)throw new Vi(`Failed to parse HSLA color: ${x}`);return I}function Mf(l,e){return l in e}function Sf(l,e){let i=e[l];return i===void 0?null:i}function va(l){return{type:l}}function Sg(l){return{result:"success",value:l}}function os(l){return{result:"error",value:l}}function _h(l,e){return!!l&&!!l.parameters&&l.parameters.indexOf(e)>-1}function xa(l){return l["property-type"]==="data-driven"}function Ag(l){return _h(l.expression,"measure-light")}function Af(l){return _h(l.expression,"zoom")}function Rf(l){return!!l.expression&&l.expression.interpolated}function Pf(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function Rg(l){return l}function Of(l,e){let i=e.type==="color",c=l.stops&&typeof l.stops[0][0]=="object",p=c||!(c||l.property!==void 0),u=l.type||(Rf(e)?"exponential":"interval");if(i&&((l=ol({},l)).stops&&(l.stops=l.stops.map(D=>[D[0],On.parse(D[1])])),l.default=On.parse(l.default?l.default:e.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!wg[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let m,x,I;if(u==="exponential")m=kf;else if(u==="interval")m=C0;else if(u==="categorical"){m=T0,x=Object.create(null);for(let D of l.stops)x[D[0]]=D[1];I=typeof l.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);m=D0}if(c){let D={},_=[];for(let w=0;w<l.stops.length;w++){let T=l.stops[w],S=T[0].zoom;D[S]===void 0&&(D[S]={zoom:S,type:l.type,property:l.property,default:l.default,stops:[]},_.push(S)),D[S].stops.push([T[0].value,T[1]])}let E=[];for(let w of _)E.push([D[w].zoom,Of(D[w],e)]);let C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:kr.interpolationFactor.bind(void 0,C),zoomStops:E.map(w=>w[0]),evaluate:({zoom:w},T)=>kf({stops:E,base:l.base},e,w).evaluate(w,T)}}if(p){let D=u==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:kr.interpolationFactor.bind(void 0,D),zoomStops:l.stops.map(_=>_[0]),evaluate:({zoom:_})=>m(l,e,_,x,I)}}return{kind:"source",evaluate(D,_){let E=_&&_.properties?_.properties[l.property]:void 0;return E===void 0?Hc(l.default,e.default):m(l,e,E,x,I)}}}function Hc(l,e,i){return l!==void 0?l:e!==void 0?e:i!==void 0?i:void 0}function T0(l,e,i,c,p){return Hc(typeof i===p?c[i]:void 0,l.default,e.default)}function C0(l,e,i){if(ga(i)!=="number")return Hc(l.default,e.default);let c=l.stops.length;if(c===1||i<=l.stops[0][0])return l.stops[0][1];if(i>=l.stops[c-1][0])return l.stops[c-1][1];let p=hh(l.stops.map(u=>u[0]),i);return l.stops[p][1]}function kf(l,e,i){let c=l.base!==void 0?l.base:1;if(ga(i)!=="number")return Hc(l.default,e.default);let p=l.stops.length;if(p===1||i<=l.stops[0][0])return l.stops[0][1];if(i>=l.stops[p-1][0])return l.stops[p-1][1];let u=hh(l.stops.map(_=>_[0]),i),m=function(_,E,C,w){let T=w-C,S=_-C;return T===0?0:E===1?S/T:(Math.pow(E,S)-1)/(Math.pow(E,T)-1)}(i,c,l.stops[u][0],l.stops[u+1][0]),x=l.stops[u][1],I=l.stops[u+1][1],D=pa[e.type]||Rg;if(l.colorSpace&&l.colorSpace!=="rgb"){let _=wg[l.colorSpace];D=(E,C)=>_.reverse(_.interpolate(_.forward(E),_.forward(C),m))}return typeof x.evaluate=="function"?{evaluate(..._){let E=x.evaluate.apply(void 0,_),C=I.evaluate.apply(void 0,_);if(E!==void 0&&C!==void 0)return D(E,C,m)}}:D(x,I,m)}function D0(l,e,i){return e.type==="color"?i=On.parse(i):e.type==="formatted"?i=cr.fromString(i.toString()):e.type==="resolvedImage"?i=fr.fromString(i.toString()):ga(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Hc(i,l.default,e.default)}Er.register(Il,{error:[{kind:"error"},[pn],(l,[e])=>{throw new Vi(e.evaluate(l))}],typeof:[pn,[yn],(l,[e])=>_i(Ci(e.evaluate(l)))],"to-rgba":[dr(gt,4),[wr],(l,[e])=>e.evaluate(l).toRenderColor(null).toArray()],rgb:[wr,[gt,gt,gt],Mg],rgba:[wr,[gt,gt,gt,gt],Mg],hsl:[wr,[gt,gt,gt],Df],hsla:[wr,[gt,gt,gt,gt],Df],has:{type:mn,overloads:[[[pn],(l,[e])=>Mf(e.evaluate(l),l.properties())],[[pn,lr],(l,[e,i])=>Mf(e.evaluate(l),i.evaluate(l))]]},get:{type:yn,overloads:[[[pn],(l,[e])=>Sf(e.evaluate(l),l.properties())],[[pn,lr],(l,[e,i])=>Sf(e.evaluate(l),i.evaluate(l))]]},"feature-state":[yn,[pn],(l,[e])=>Sf(e.evaluate(l),l.featureState||{})],properties:[lr,[],l=>l.properties()],"geometry-type":[pn,[],l=>l.geometryType()],id:[yn,[],l=>l.id()],zoom:[gt,[],l=>l.globals.zoom],pitch:[gt,[],l=>l.globals.pitch||0],"distance-from-center":[gt,[],l=>l.distanceFromCenter()],"measure-light":[gt,[pn],(l,[e])=>l.measureLight(e.evaluate(l))],"heatmap-density":[gt,[],l=>l.globals.heatmapDensity||0],"line-progress":[gt,[],l=>l.globals.lineProgress||0],"raster-value":[gt,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[gt,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[gt,[],l=>l.globals.skyRadialProgress||0],accumulated:[yn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[gt,va(gt),(l,e)=>{let i=0;for(let c of e)i+=c.evaluate(l);return i}],"*":[gt,va(gt),(l,e)=>{let i=1;for(let c of e)i*=c.evaluate(l);return i}],"-":{type:gt,overloads:[[[gt,gt],(l,[e,i])=>e.evaluate(l)-i.evaluate(l)],[[gt],(l,[e])=>-e.evaluate(l)]]},"/":[gt,[gt,gt],(l,[e,i])=>e.evaluate(l)/i.evaluate(l)],"%":[gt,[gt,gt],(l,[e,i])=>e.evaluate(l)%i.evaluate(l)],ln2:[gt,[],()=>Math.LN2],pi:[gt,[],()=>Math.PI],e:[gt,[],()=>Math.E],"^":[gt,[gt,gt],(l,[e,i])=>Math.pow(e.evaluate(l),i.evaluate(l))],sqrt:[gt,[gt],(l,[e])=>Math.sqrt(e.evaluate(l))],log10:[gt,[gt],(l,[e])=>Math.log(e.evaluate(l))/Math.LN10],ln:[gt,[gt],(l,[e])=>Math.log(e.evaluate(l))],log2:[gt,[gt],(l,[e])=>Math.log(e.evaluate(l))/Math.LN2],sin:[gt,[gt],(l,[e])=>Math.sin(e.evaluate(l))],cos:[gt,[gt],(l,[e])=>Math.cos(e.evaluate(l))],tan:[gt,[gt],(l,[e])=>Math.tan(e.evaluate(l))],asin:[gt,[gt],(l,[e])=>Math.asin(e.evaluate(l))],acos:[gt,[gt],(l,[e])=>Math.acos(e.evaluate(l))],atan:[gt,[gt],(l,[e])=>Math.atan(e.evaluate(l))],min:[gt,va(gt),(l,e)=>Math.min(...e.map(i=>i.evaluate(l)))],max:[gt,va(gt),(l,e)=>Math.max(...e.map(i=>i.evaluate(l)))],abs:[gt,[gt],(l,[e])=>Math.abs(e.evaluate(l))],round:[gt,[gt],(l,[e])=>{let i=e.evaluate(l);return i<0?-Math.round(-i):Math.round(i)}],floor:[gt,[gt],(l,[e])=>Math.floor(e.evaluate(l))],ceil:[gt,[gt],(l,[e])=>Math.ceil(e.evaluate(l))],"filter-==":[mn,[pn,yn],(l,[e,i])=>l.properties()[e.value]===i.value],"filter-id-==":[mn,[yn],(l,[e])=>l.id()===e.value],"filter-type-==":[mn,[pn],(l,[e])=>l.geometryType()===e.value],"filter-<":[mn,[pn,yn],(l,[e,i])=>{let c=l.properties()[e.value],p=i.value;return typeof c==typeof p&&c<p}],"filter-id-<":[mn,[yn],(l,[e])=>{let i=l.id(),c=e.value;return typeof i==typeof c&&i<c}],"filter->":[mn,[pn,yn],(l,[e,i])=>{let c=l.properties()[e.value],p=i.value;return typeof c==typeof p&&c>p}],"filter-id->":[mn,[yn],(l,[e])=>{let i=l.id(),c=e.value;return typeof i==typeof c&&i>c}],"filter-<=":[mn,[pn,yn],(l,[e,i])=>{let c=l.properties()[e.value],p=i.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[mn,[yn],(l,[e])=>{let i=l.id(),c=e.value;return typeof i==typeof c&&i<=c}],"filter->=":[mn,[pn,yn],(l,[e,i])=>{let c=l.properties()[e.value],p=i.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[mn,[yn],(l,[e])=>{let i=l.id(),c=e.value;return typeof i==typeof c&&i>=c}],"filter-has":[mn,[yn],(l,[e])=>e.value in l.properties()],"filter-has-id":[mn,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[mn,[dr(pn)],(l,[e])=>e.value.indexOf(l.geometryType())>=0],"filter-id-in":[mn,[dr(yn)],(l,[e])=>e.value.indexOf(l.id())>=0],"filter-in-small":[mn,[pn,dr(yn)],(l,[e,i])=>i.value.indexOf(l.properties()[e.value])>=0],"filter-in-large":[mn,[pn,dr(yn)],(l,[e,i])=>function(c,p,u,m){for(;u<=m;){let x=u+m>>1;if(p[x]===c)return!0;p[x]>c?m=x-1:u=x+1}return!1}(l.properties()[e.value],i.value,0,i.value.length-1)],all:{type:mn,overloads:[[[mn,mn],(l,[e,i])=>e.evaluate(l)&&i.evaluate(l)],[va(mn),(l,e)=>{for(let i of e)if(!i.evaluate(l))return!1;return!0}]]},any:{type:mn,overloads:[[[mn,mn],(l,[e,i])=>e.evaluate(l)||i.evaluate(l)],[va(mn),(l,e)=>{for(let i of e)if(i.evaluate(l))return!0;return!1}]]},"!":[mn,[mn],(l,[e])=>!e.evaluate(l)],"is-supported-script":[mn,[pn],(l,[e])=>{let i=l.globals&&l.globals.isSupportedScript;return!i||i(e.evaluate(l))}],upcase:[pn,[pn],(l,[e])=>e.evaluate(l).toUpperCase()],downcase:[pn,[pn],(l,[e])=>e.evaluate(l).toLowerCase()],concat:[pn,va(yn),(l,e)=>e.map(i=>pr(i.evaluate(l))).join("")],"resolved-locale":[pn,[Xu],(l,[e])=>e.evaluate(l).resolvedLocale()],random:[gt,[gt,gt,yn],(l,e)=>{let[i,c,p]=e.map(m=>m.evaluate(l));if(i>c||i===c)return i;let u;if(typeof p=="string")u=function(m){let x=0;if(m.length===0)return x;for(let I=0;I<m.length;I++)x=(x<<5)-x+m.charCodeAt(I),x|=0;return x}(p);else{if(typeof p!="number")throw new Vi(`Invalid seed input: ${p}`);u=p}return i+gh(u)()*(c-i)}]});class Lf{constructor(e,i,c,p){this.expression=e,this._warningHistory={},this._evaluator=new ig(c,p),this._defaultValue=i?function(u){return u.type==="color"&&(Pf(u.default)||Array.isArray(u.default))?new On(0,0,0,0):u.type==="color"?On.parse(u.default)||null:u.default===void 0?null:u.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Bc(e)}evaluateWithoutErrorHandling(e,i,c,p,u,m,x,I){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=I||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,c,p,u,m,x,I){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=I||null;try{let D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Vi(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${D.message}`)),this._defaultValue}}}function yh(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in Il}function Tl(l,e,i,c){let p=new mg(Il,[],e?function(m){let x={color:wr,string:pn,number:gt,enum:pn,boolean:mn,formatted:sl,resolvedImage:al};return m.type==="array"?dr(x[m.value]||yn,m.length):x[m.type]}(e):void 0,void 0,void 0,i,c),u=p.parse(l,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Sg(new Lf(u,e,i,c)):os(p.errors)}class vh{constructor(e,i,c){this.kind=e,this._styleExpression=i,this.isLightConstant=c,this.isStateDependent=e!=="constant"&&!uh(i.expression),this.configDependencies=Bc(i.expression)}evaluateWithoutErrorHandling(e,i,c,p,u,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,c,p,u,m)}evaluate(e,i,c,p,u,m){return this._styleExpression.evaluate(e,i,c,p,u,m)}}class qc{constructor(e,i,c,p,u){this.kind=e,this.zoomStops=c,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!uh(i.expression),this.isLightConstant=u,this.configDependencies=Bc(i.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,i,c,p,u,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,c,p,u,m)}evaluate(e,i,c,p,u,m){return this._styleExpression.evaluate(e,i,c,p,u,m)}interpolationFactor(e,i,c){return this.interpolationType?kr.interpolationFactor(this.interpolationType,e,i,c):0}}function ba(l,e,i,c){if((l=Tl(l,e,i,c)).result==="error")return l;let p=l.value.expression,u=zc(p);if(!u&&!xa(e))return os([new ho("","data expressions not supported")]);let m=xl(p,["zoom","pitch","distance-from-center"]);if(!m&&!Af(e))return os([new ho("","zoom expressions not supported")]);let x=xl(p,["measure-light"]);if(!x&&!Ag(e))return os([new ho("","measure-light expression not supported")]);let I=xl(p,["line-progress"]);if(!I&&!function(E){return _h(E.expression,"line-progress")}(e))return os([new ho("","line-progress expression not supported")]);let D=e.expression&&e.expression.relaxZoomRestriction,_=bh(p);return _||m||D?_ instanceof ho?os([_]):_ instanceof kr&&!Rf(e)?os([new ho("",'"interpolate" expressions cannot be used with this property')]):Sg(_?new qc(u&&I?"camera":"composite",l.value,_.labels,_ instanceof kr?_.interpolation:void 0,x):new vh(u&&I?"constant":"source",l.value,x)):os([new ho("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class xh{constructor(e,i){this._parameters=e,this._specification=i,ol(this,Of(this._parameters,this._specification))}static deserialize(e){return new xh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function bh(l){let e=null;if(l instanceof fh)e=bh(l.result);else if(l instanceof dh){for(let i of l.args)if(e=bh(i),e)break}else(l instanceof Vc||l instanceof kr)&&l.input instanceof Er&&l.input.name==="zoom"&&(e=l);return e instanceof ho||l.eachChild(i=>{let c=bh(i);c instanceof ho?e=c:e&&c&&e!==c&&(e=new ho("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Ff,Nf,Pg=function(){if(Nf)return Ff;Nf=1,Ff=e;var l=3;function e(i,c,p){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var m=new Int32Array(this.arrayBuffer);i=m[0],this.d=(c=m[1])+2*(p=m[2]);for(var x=0;x<this.d*this.d;x++){var I=m[l+x],D=m[l+x+1];u.push(I===D?null:m.subarray(I,D))}var _=m[l+u.length+1];this.keys=m.subarray(m[l+u.length],_),this.bboxes=m.subarray(_),this.insert=this._insertReadonly}else{this.d=c+2*p;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=i,this.padding=p,this.scale=c/i,this.uid=0;var C=p/c*i;this.min=-C,this.max=i+C}return e.prototype.insert=function(i,c,p,u,m){this._forEachCell(c,p,u,m,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(u),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,c,p,u,m,x){this.cells[m].push(x)},e.prototype.query=function(i,c,p,u,m){var x=this.min,I=this.max;if(i<=x&&c<=x&&I<=p&&I<=u&&!m)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(i,c,p,u,this._queryCell,D,{},m),D},e.prototype._queryCell=function(i,c,p,u,m,x,I,D){var _=this.cells[m];if(_!==null)for(var E=this.keys,C=this.bboxes,w=0;w<_.length;w++){var T=_[w];if(I[T]===void 0){var S=4*T;(D?D(C[S+0],C[S+1],C[S+2],C[S+3]):i<=C[S+2]&&c<=C[S+3]&&p>=C[S+0]&&u>=C[S+1])?(I[T]=!0,x.push(E[T])):I[T]=!1}}},e.prototype._forEachCell=function(i,c,p,u,m,x,I,D){for(var _=this._convertToCellCoord(i),E=this._convertToCellCoord(c),C=this._convertToCellCoord(p),w=this._convertToCellCoord(u),T=_;T<=C;T++)for(var S=E;S<=w;S++){var k=this.d*S+T;if((!D||D(this._convertFromCellCoord(T),this._convertFromCellCoord(S),this._convertFromCellCoord(T+1),this._convertFromCellCoord(S+1)))&&m.call(this,i,c,p,u,k,x,I,D))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,c=l+this.cells.length+1+1,p=0,u=0;u<this.cells.length;u++)p+=this.cells[u].length;var m=new Int32Array(c+p+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var x=c,I=0;I<i.length;I++){var D=i[I];m[l+I]=x,m.set(D,x),x+=D.length}return m[l+i.length]=x,m.set(this.keys,x),m[l+i.length+1]=x+=this.keys.length,m.set(this.bboxes,x),x+=this.bboxes.length,m.buffer},Ff}(),wa=R(Pg);let Wc={};function ft(l,e,i={}){Object.defineProperty(l,"_classRegistryKey",{value:e,writable:!1}),Wc[e]={klass:l,omit:i.omit||[]}}ft(Object,"Object"),wa.serialize=function(l,e){let i=l.toArrayBuffer();return e&&e.add(i),{buffer:i}},wa.deserialize=function(l){return new wa(l.buffer)},Object.defineProperty(wa,"name",{value:"Grid"}),ft(wa,"Grid"),ft(On,"Color"),ft(Error,"Error"),ft(cr,"Formatted"),ft(Ar,"FormattedSection"),ft(Jd,"AJAXError"),ft(fr,"ResolvedImage"),ft(xh,"StylePropertyFunction"),ft(Lf,"StyleExpression",{omit:["_evaluator"]}),ft(qc,"ZoomDependentExpression"),ft(vh,"ZoomConstantExpression"),ft(Er,"CompoundExpression",{omit:["_evaluate"]});for(let l in Il)Wc[Il[l]._classRegistryKey]||ft(Il[l],`Expression${l}`);function wh(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function zf(l){return self.ImageBitmap&&l instanceof ImageBitmap}function Ea(l,e){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(wh(l)||zf(l))return e&&e.add(l),l;if(ArrayBuffer.isView(l)){let i=l;return e&&e.add(i.buffer),i}if(l instanceof ImageData)return e&&e.add(l.data.buffer),l;if(Array.isArray(l)){let i=[];for(let c of l)i.push(Ea(c,e));return i}if(l instanceof Map){let i={$name:"Map"};for(let[c,p]of l.entries())i[c]=Ea(p);return i}if(l instanceof Set){let i={$name:"Set"},c=0;for(let p of l.values())i[++c]=Ea(p);return i}if(typeof l=="object"){let i=l.constructor,c=i._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);let p=i.serialize?i.serialize(l,e):{};if(!i.serialize){for(let u in l)l.hasOwnProperty(u)&&(Wc[c].omit.indexOf(u)>=0||(p[u]=Ea(l[u],e)));l instanceof Error&&(p.message=l.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof l)}function zs(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||wh(l)||zf(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(zs);if(typeof l=="object"){let e=l.$name||"Object";if(e==="Map"){let p=new Map;for(let u of Object.keys(l))u!=="$name"&&p.set(u,zs(l[u]));return p}if(e==="Set"){let p=new Set;for(let u of Object.keys(l))u!=="$name"&&p.add(zs(l[u]));return p}let{klass:i}=Wc[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(l);let c=Object.create(i.prototype);for(let p of Object.keys(l))p!=="$name"&&(c[p]=zs(l[p]));return c}throw new Error("can't deserialize object of type "+typeof l)}let xt={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function Bf(l){for(let e of l)if(Cl(e.charCodeAt(0)))return!0;return!1}function Og(l){for(let e of l)if(!M0(e.charCodeAt(0)))return!1;return!0}function M0(l){return!(xt.Arabic(l)||xt["Arabic Supplement"](l)||xt["Arabic Extended-A"](l)||xt["Arabic Presentation Forms-A"](l)||xt["Arabic Presentation Forms-B"](l))}function Cl(l){return!(l!==746&&l!==747&&(l<4352||!(xt["Bopomofo Extended"](l)||xt.Bopomofo(l)||xt["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||xt["CJK Compatibility Ideographs"](l)||xt["CJK Compatibility"](l)||xt["CJK Radicals Supplement"](l)||xt["CJK Strokes"](l)||!(!xt["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||xt["CJK Unified Ideographs Extension A"](l)||xt["CJK Unified Ideographs"](l)||xt["Enclosed CJK Letters and Months"](l)||xt["Hangul Compatibility Jamo"](l)||xt["Hangul Jamo Extended-A"](l)||xt["Hangul Jamo Extended-B"](l)||xt["Hangul Jamo"](l)||xt["Hangul Syllables"](l)||xt.Hiragana(l)||xt["Ideographic Description Characters"](l)||xt.Kanbun(l)||xt["Kangxi Radicals"](l)||xt["Katakana Phonetic Extensions"](l)||xt.Katakana(l)&&l!==12540||!(!xt["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!xt["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||xt["Unified Canadian Aboriginal Syllabics"](l)||xt["Unified Canadian Aboriginal Syllabics Extended"](l)||xt["Vertical Forms"](l)||xt["Yijing Hexagram Symbols"](l)||xt["Yi Syllables"](l)||xt["Yi Radicals"](l))))}function Vf(l){return!(Cl(l)||function(e){return!!(xt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||xt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||xt["Letterlike Symbols"](e)||xt["Number Forms"](e)||xt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||xt["Control Pictures"](e)&&e!==9251||xt["Optical Character Recognition"](e)||xt["Enclosed Alphanumerics"](e)||xt["Geometric Shapes"](e)||xt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||xt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||xt["CJK Symbols and Punctuation"](e)||xt.Katakana(e)||xt["Private Use Area"](e)||xt["CJK Compatibility Forms"](e)||xt["Small Form Variants"](e)||xt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(l))}function Zc(l){return l>=1424&&l<=2303||xt["Arabic Presentation Forms-A"](l)||xt["Arabic Presentation Forms-B"](l)}function kg(l,e){return!(!e&&Zc(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||xt.Khmer(l))}function S0(l){for(let e of l)if(Zc(e.charCodeAt(0)))return!0;return!1}let jf="deferred",Xc="loading",Yc="loaded",Eh=null,Qi="unavailable",Lr=null,Lg=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Qi="error"),Eh&&Eh(l)};function Uf(){$f.fire(new Os("pluginStateChange",{pluginStatus:Qi,pluginURL:Lr}))}let $f=new rl,Gf=function(){return Qi},Fg=function(){if(Qi!==jf||!Lr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Qi=Xc,Uf(),Lr&&nl({url:Lr},l=>{l?Lg(l):(Qi=Yc,Uf())})},Fr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Qi===Yc||Fr.applyArabicShaping!=null,isLoading:()=>Qi===Xc,setState(l){Qi=l.pluginStatus,Lr=l.pluginURL},isParsed:()=>Fr.applyArabicShaping!=null&&Fr.processBidirectionalText!=null&&Fr.processStyledBidirectionalText!=null,getPluginURL:()=>Lr};class li{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,c){for(let p of i)if(!kg(p.charCodeAt(0),c))return!1;return!0}(e,Fr.isLoaded())}}class Ih{constructor(e,i,c,p){this.property=e,this.value=i,this.expression=function(u,m,x,I){if(Pf(u))return new xh(u,m);if(yh(u)||Array.isArray(u)&&u.length>0){let D=ba(u,m,x,I);if(D.result==="error")throw new Error(D.value.map(_=>`${_.key}: ${_.message}`).join(", "));return D.value}{let D=u;return typeof u=="string"&&m.type==="color"&&(D=On.parse(u)),{kind:"constant",configDependencies:new Set,evaluate:()=>D}}}(i===void 0?e.specification.default:i,e.specification,c,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,c){return this.property.possiblyEvaluate(this,e,i,c)}}class Hf{constructor(e,i,c){this.property=e,this.value=new Ih(e,void 0,i,c)}transitioned(e,i){return new zg(this.property,this.value,i,ar({},e.transition,this.transition),e.now)}untransitioned(){return new zg(this.property,this.value,null,{},0)}}class Ng{constructor(e,i,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=c,this.configDependencies=new Set}getValue(e){return Xr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Hf(this._values[e].property,this._scope,this._options)),this._values[e].value=new Ih(this._values[e].property,i===null?void 0:Xr(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);let c=this._properties.properties;if(e)for(let p in e){let u=e[p];if(ts(p,"-transition")){let m=p.slice(0,-11);c[m]&&this.setTransition(m,u)}else c.hasOwnProperty(p)&&this.setValue(p,u)}}getTransition(e){return Xr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Hf(this._values[e].property)),this._values[e].transition=Xr(i)||void 0}serialize(){let e={};for(let i of Object.keys(this._values)){let c=this.getValue(i);c!==void 0&&(e[i]=c);let p=this.getTransition(i);p!==void 0&&(e[`${i}-transition`]=p)}return e}transitioned(e,i){let c=new Bg(this._properties);for(let p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(e,i._values[p]);return c}untransitioned(){let e=new Bg(this._properties);for(let i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class zg{constructor(e,i,c,p,u){let m=p.delay||0,x=p.duration||0;u=u||0,this.property=e,this.value=i,this.begin=u+m,this.end=this.begin+x,e.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(e,i,c){let p=e.now||0,u=this.value.possiblyEvaluate(e,i,c),m=this.prior;if(m){if(p>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(p<this.begin)return m.possiblyEvaluate(e,i,c);{let x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,c),u,ua(x))}}return u}}class Bg{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,c){let p=new Ml(this._properties);for(let u of Object.keys(this._values))p._values[u]=this._values[u].possiblyEvaluate(e,i,c);return p}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class A0{constructor(e,i,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=c,this.configDependencies=new Set}getValue(e){return Xr(this._values[e].value)}setValue(e,i){this._values[e]=new Ih(this._values[e].property,i===null?void 0:Xr(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){let e={};for(let i of Object.keys(this._values)){let c=this.getValue(i);c!==void 0&&(e[i]=c)}return e}possiblyEvaluate(e,i,c){let p=new Ml(this._properties);for(let u of Object.keys(this._values))p._values[u]=this._values[u].possiblyEvaluate(e,i,c);return p}}class Dl{constructor(e,i,c){this.property=e,this.value=i,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,c,p){return this.property.evaluate(this.value,this.parameters,e,i,c,p)}}class Ml{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class tt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,c){let p=pa[this.specification.type];return p?p(e,i,c):e}}class wt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,c,p){return new Dl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},c,p)}:e.expression,i)}interpolate(e,i,c){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Dl(this,{kind:"constant",value:void 0},e.parameters);let p=pa[this.specification.type];return p?new Dl(this,{kind:"constant",value:p(e.value.value,i.value.value,c)},e.parameters):e}evaluate(e,i,c,p,u,m){return e.kind==="constant"?e.value:e.evaluate(i,c,p,u,m)}}class Sl{constructor(e){this.specification=e}possiblyEvaluate(e,i,c,p){return!!e.expression.evaluate(i,null,{},c,p)}interpolate(){return!1}}class Kn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new li(0,{});for(let c in e){let p=e[c];p.specification.overridable&&this.overridableProperties.push(c);let u=this.defaultPropertyValues[c]=new Ih(p,void 0),m=this.defaultTransitionablePropertyValues[c]=new Hf(p);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=u.possiblyEvaluate(i)}}}ft(wt,"DataDrivenProperty"),ft(tt,"DataConstantProperty"),ft(Sl,"ColorRampProperty");var Re=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,90],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"rain":{"density":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"centerThinning":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function qf(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Ia(l){if(Array.isArray(l))return l.map(Ia);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){let e={};for(let i in l)e[i]=Ia(l[i]);return e}return qf(l)}function Wf(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(let e of l.slice(1))if(!Wf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Th(l,e="",i=null,c="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Wf(l)||(l=Ch(l));let p=l,u=!0;try{u=function(_){if(!go(_))return _;let E=Ia(_);return Zf(E),E=ss(E),E}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let m=null,x=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){x=Re[`filter_${c}`];let _=Tl(u,x,e,i);if(_.result==="error")throw new Error(_.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,C,w)=>_.value.evaluate(E,C,{},w)}let I=null,D=null;if(u!==p){let _=Tl(p,x,e,i);if(_.result==="error")throw new Error(_.value.map(E=>`${E.key}: ${E.message}`).join(", "));I=(E,C,w,T,S)=>_.value.evaluate(E,C,{},w,void 0,void 0,T,S),D=!zc(_.value.expression)}return{filter:m,dynamicFilter:I||void 0,needGeometry:Vg(u),needFeature:!!D}}function ss(l){if(!Array.isArray(l))return l;let e=function(i){if(R0.has(i[0])){for(let c=1;c<i.length;c++)if(go(i[c]))return!0}return i}(l);return e===!0?e:e.map(i=>ss(i))}function Zf(l){let e=!1,i=[];if(l[0]==="case"){for(let c=1;c<l.length-1;c+=2)e=e||go(l[c]),i.push(l[c+1]);i.push(l[l.length-1])}else if(l[0]==="match"){e=e||go(l[1]);for(let c=2;c<l.length-1;c+=2)i.push(l[c+1]);i.push(l[l.length-1])}else if(l[0]==="step"){e=e||go(l[1]);for(let c=1;c<l.length-1;c+=2)i.push(l[c+1])}e&&(l.length=0,l.push("any",...i));for(let c=1;c<l.length;c++)Zf(l[c])}function go(l){if(!Array.isArray(l))return!1;if((e=l[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<l.length;i++)if(go(l[i]))return!0;return!1}let R0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function P0(l,e){return l<e?-1:l>e?1:0}function Vg(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let e=1;e<l.length;e++)if(Vg(l[e]))return!0;return!1}function Ch(l){if(!l)return!0;let e=l[0];return l.length<=1?e!=="any":e==="=="?Xf(l[1],l[2],"=="):e==="!="?Ta(Xf(l[1],l[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Xf(l[1],l[2],e):e==="any"?(i=l.slice(1),["any"].concat(i.map(Ch))):e==="all"?["all"].concat(l.slice(1).map(Ch)):e==="none"?["all"].concat(l.slice(1).map(Ch).map(Ta)):e==="in"?Yf(l[1],l.slice(2)):e==="!in"?Ta(Yf(l[1],l.slice(2))):e==="has"?Dh(l[1]):e!=="!has"||Ta(Dh(l[1]));var i}function Xf(l,e,i){switch(l){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,l,e]}}function Yf(l,e){if(e.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",l,["literal",e.sort(P0)]]:["filter-in-small",l,["literal",e]]}}function Dh(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Ta(l){return["!",l]}let Jc="";function Mh(l,e){return e?`${l}${Jc}${e}`:l}let jg="-transition",Lo=new Set(["fill","line","background","hillshade","raster"]);class mr extends rl{constructor(e,i,c,p,u){if(super(),this.id=e.id,this.fqid=Mh(this.id,c),this.type=e.type,this.scope=c,this.lut=p,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;let m=Tl(this.filter,Re[`filter_${e.type}`]);m.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...m.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new A0(i.layout,this.scope,u),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Ng(i.paint,this.scope,u);for(let m in e.paint)this.setPaintProperty(m,e.paint[m]);for(let m in e.layout)this.setLayoutProperty(m,e.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ml(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&Lo.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);let c=this._unevaluatedLayout;c._properties.properties[e]&&(c.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return ts(e,jg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){let c=this._transitionablePaint,p=c._properties.properties;if(ts(e,jg)){let E=e.slice(0,-11);return p[E]&&c.setTransition(E,i||void 0),!1}if(!p[e])return!1;let u=c._values[e],m=u.value.isDataDriven(),x=u.value;c.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);let I=c._values[e].value,D=I.isDataDriven(),_=ts(e,"pattern")||e==="line-dasharray";return D||m||_||this._handleOverridablePaintPropertyUpdate(e,x,I)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,c){return null}_handleOverridablePaintPropertyUpdate(e,i,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Qa({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let i=this.paint.get(e);if(i instanceof Dl&&xa(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Th(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,c,p,u,m,x,I,D){}queryIntersectsMatchingFeature(e,i,c,p){}}let Ug={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Kc{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function wn(l,e=1){let i=0,c=0;return{members:l.map(p=>{let u=Ug[p.type].BYTES_PER_ELEMENT,m=i=$g(i,Math.max(e,u)),x=p.components||1;return c=Math.max(c,u),i+=u*x,{name:p.name,type:p.type,components:x,offset:m}}),size:$g(i,Math.max(c,e)),alignment:e}}function $g(l,e){return Math.ceil(l/e)*e}class Bs extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){let c=this.length;return this.resize(c+1),this.emplace(c,e,i)}emplace(e,i,c){let p=2*e;return this.int16[p+0]=i,this.int16[p+1]=c,e}}Bs.prototype.bytesPerElement=4,ft(Bs,"StructArrayLayout2i4");class Sh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,c)}emplace(e,i,c,p){let u=3*e;return this.int16[u+0]=i,this.int16[u+1]=c,this.int16[u+2]=p,e}}Sh.prototype.bytesPerElement=6,ft(Sh,"StructArrayLayout3i6");class Al extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c,p){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,c,p)}emplace(e,i,c,p,u){let m=4*e;return this.int16[m+0]=i,this.int16[m+1]=c,this.int16[m+2]=p,this.int16[m+3]=u,e}}Al.prototype.bytesPerElement=8,ft(Al,"StructArrayLayout4i8");class Jf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,i,c,p,u)}emplace(e,i,c,p,u,m){let x=5*e;return this.int16[x+0]=i,this.int16[x+1]=c,this.int16[x+2]=p,this.int16[x+3]=u,this.int16[x+4]=m,e}}Jf.prototype.bytesPerElement=10,ft(Jf,"StructArrayLayout5i10");class Qc extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x){let I=this.length;return this.resize(I+1),this.emplace(I,e,i,c,p,u,m,x)}emplace(e,i,c,p,u,m,x,I){let D=6*e,_=12*e,E=3*e;return this.int16[D+0]=i,this.int16[D+1]=c,this.uint8[_+4]=p,this.uint8[_+5]=u,this.uint8[_+6]=m,this.uint8[_+7]=x,this.float32[E+2]=I,e}}Qc.prototype.bytesPerElement=12,ft(Qc,"StructArrayLayout2i4ub1f12");class as extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,c,p)}emplace(e,i,c,p,u){let m=4*e;return this.float32[m+0]=i,this.float32[m+1]=c,this.float32[m+2]=p,this.float32[m+3]=u,e}}as.prototype.bytesPerElement=16,ft(as,"StructArrayLayout4f16");class Vs extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,c)}emplace(e,i,c,p){let u=3*e;return this.float32[u+0]=i,this.float32[u+1]=c,this.float32[u+2]=p,e}}Vs.prototype.bytesPerElement=12,ft(Vs,"StructArrayLayout3f12");class ls extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,i,c,p,u)}emplace(e,i,c,p,u,m){let x=6*e,I=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=c,this.uint16[x+2]=p,this.uint16[x+3]=u,this.float32[I+2]=m,e}}ls.prototype.bytesPerElement=12,ft(ls,"StructArrayLayout4ui1f12");class Ah extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,c,p){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,c,p)}emplace(e,i,c,p,u){let m=4*e;return this.uint16[m+0]=i,this.uint16[m+1]=c,this.uint16[m+2]=p,this.uint16[m+3]=u,e}}Ah.prototype.bytesPerElement=8,ft(Ah,"StructArrayLayout4ui8");class eu extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m){let x=this.length;return this.resize(x+1),this.emplace(x,e,i,c,p,u,m)}emplace(e,i,c,p,u,m,x){let I=6*e;return this.int16[I+0]=i,this.int16[I+1]=c,this.int16[I+2]=p,this.int16[I+3]=u,this.int16[I+4]=m,this.int16[I+5]=x,e}}eu.prototype.bytesPerElement=12,ft(eu,"StructArrayLayout6i12");class Rl extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x,I,D,_,E,C){let w=this.length;return this.resize(w+1),this.emplace(w,e,i,c,p,u,m,x,I,D,_,E,C)}emplace(e,i,c,p,u,m,x,I,D,_,E,C,w){let T=12*e;return this.int16[T+0]=i,this.int16[T+1]=c,this.int16[T+2]=p,this.int16[T+3]=u,this.uint16[T+4]=m,this.uint16[T+5]=x,this.uint16[T+6]=I,this.uint16[T+7]=D,this.int16[T+8]=_,this.int16[T+9]=E,this.int16[T+10]=C,this.int16[T+11]=w,e}}Rl.prototype.bytesPerElement=24,ft(Rl,"StructArrayLayout4i4ui4i24");class Kf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m){let x=this.length;return this.resize(x+1),this.emplace(x,e,i,c,p,u,m)}emplace(e,i,c,p,u,m,x){let I=10*e,D=5*e;return this.int16[I+0]=i,this.int16[I+1]=c,this.int16[I+2]=p,this.float32[D+2]=u,this.float32[D+3]=m,this.float32[D+4]=x,e}}Kf.prototype.bytesPerElement=20,ft(Kf,"StructArrayLayout3i3f20");class Qf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Qf.prototype.bytesPerElement=4,ft(Qf,"StructArrayLayout1ul4");class js extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){let c=this.length;return this.resize(c+1),this.emplace(c,e,i)}emplace(e,i,c){let p=2*e;return this.uint16[p+0]=i,this.uint16[p+1]=c,e}}js.prototype.bytesPerElement=4,ft(js,"StructArrayLayout2ui4");class ep extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x,I,D,_,E,C,w){let T=this.length;return this.resize(T+1),this.emplace(T,e,i,c,p,u,m,x,I,D,_,E,C,w)}emplace(e,i,c,p,u,m,x,I,D,_,E,C,w,T){let S=20*e,k=10*e;return this.int16[S+0]=i,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+3]=u,this.int16[S+4]=m,this.float32[k+3]=x,this.float32[k+4]=I,this.float32[k+5]=D,this.float32[k+6]=_,this.int16[S+14]=E,this.uint32[k+8]=C,this.uint16[S+18]=w,this.uint16[S+19]=T,e}}ep.prototype.bytesPerElement=40,ft(ep,"StructArrayLayout5i4f1i1ul2ui40");class Rh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x){let I=this.length;return this.resize(I+1),this.emplace(I,e,i,c,p,u,m,x)}emplace(e,i,c,p,u,m,x,I){let D=8*e;return this.int16[D+0]=i,this.int16[D+1]=c,this.int16[D+2]=p,this.int16[D+4]=u,this.int16[D+5]=m,this.int16[D+6]=x,this.int16[D+7]=I,e}}Rh.prototype.bytesPerElement=16,ft(Rh,"StructArrayLayout3i2i2i16");class Pl extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,i,c,p,u)}emplace(e,i,c,p,u,m){let x=4*e,I=8*e;return this.float32[x+0]=i,this.float32[x+1]=c,this.float32[x+2]=p,this.int16[I+6]=u,this.int16[I+7]=m,e}}Pl.prototype.bytesPerElement=16,ft(Pl,"StructArrayLayout2f1f2i16");class Ol extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m){let x=this.length;return this.resize(x+1),this.emplace(x,e,i,c,p,u,m)}emplace(e,i,c,p,u,m,x){let I=20*e,D=5*e;return this.uint8[I+0]=i,this.uint8[I+1]=c,this.float32[D+1]=p,this.float32[D+2]=u,this.float32[D+3]=m,this.float32[D+4]=x,e}}Ol.prototype.bytesPerElement=20,ft(Ol,"StructArrayLayout2ub4f20");class si extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,c){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,c)}emplace(e,i,c,p){let u=3*e;return this.uint16[u+0]=i,this.uint16[u+1]=c,this.uint16[u+2]=p,e}}si.prototype.bytesPerElement=6,ft(si,"StructArrayLayout3ui6");class kl extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k,L,B,V,N,G){let H=this.length;return this.resize(H+1),this.emplace(H,e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k,L,B,V,N,G)}emplace(e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k,L,B,V,N,G,H){let J=30*e,se=15*e,ee=60*e;return this.int16[J+0]=i,this.int16[J+1]=c,this.int16[J+2]=p,this.float32[se+2]=u,this.float32[se+3]=m,this.uint16[J+8]=x,this.uint16[J+9]=I,this.uint32[se+5]=D,this.uint32[se+6]=_,this.uint32[se+7]=E,this.uint16[J+16]=C,this.uint16[J+17]=w,this.uint16[J+18]=T,this.float32[se+10]=S,this.float32[se+11]=k,this.uint8[ee+48]=L,this.uint8[ee+49]=B,this.uint8[ee+50]=V,this.uint32[se+13]=N,this.int16[J+28]=G,this.uint8[ee+58]=H,e}}kl.prototype.bytesPerElement=60,ft(kl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class tp extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k,L,B,V,N,G,H,J,se,ee,ne,me,te,de,ve,xe,Ie){let Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k,L,B,V,N,G,H,J,se,ee,ne,me,te,de,ve,xe,Ie)}emplace(e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k,L,B,V,N,G,H,J,se,ee,ne,me,te,de,ve,xe,Ie,Ae){let Pe=20*e,De=40*e,$e=80*e;return this.float32[Pe+0]=i,this.float32[Pe+1]=c,this.int16[De+4]=p,this.int16[De+5]=u,this.int16[De+6]=m,this.int16[De+7]=x,this.int16[De+8]=I,this.int16[De+9]=D,this.int16[De+10]=_,this.int16[De+11]=E,this.int16[De+12]=C,this.uint16[De+13]=w,this.uint16[De+14]=T,this.uint16[De+15]=S,this.uint16[De+16]=k,this.uint16[De+17]=L,this.uint16[De+18]=B,this.uint16[De+19]=V,this.uint16[De+20]=N,this.uint16[De+21]=G,this.uint16[De+22]=H,this.uint16[De+23]=J,this.uint16[De+24]=se,this.uint16[De+25]=ee,this.uint16[De+26]=ne,this.uint16[De+27]=me,this.uint32[Pe+14]=te,this.float32[Pe+15]=de,this.float32[Pe+16]=ve,this.float32[Pe+17]=xe,this.float32[Pe+18]=Ie,this.uint8[$e+76]=Ae,e}}tp.prototype.bytesPerElement=80,ft(tp,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ll extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ll.prototype.bytesPerElement=4,ft(Ll,"StructArrayLayout1f4");class Ca extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u){let m=this.length;return this.resize(m+1),this.emplace(m,e,i,c,p,u)}emplace(e,i,c,p,u,m){let x=5*e;return this.float32[x+0]=i,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=u,this.float32[x+4]=m,e}}Ca.prototype.bytesPerElement=20,ft(Ca,"StructArrayLayout5f20");class np extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x){let I=this.length;return this.resize(I+1),this.emplace(I,e,i,c,p,u,m,x)}emplace(e,i,c,p,u,m,x,I){let D=7*e;return this.float32[D+0]=i,this.float32[D+1]=c,this.float32[D+2]=p,this.float32[D+3]=u,this.float32[D+4]=m,this.float32[D+5]=x,this.float32[D+6]=I,e}}np.prototype.bytesPerElement=28,ft(np,"StructArrayLayout7f28");class Ph extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x,I,D,_,E){let C=this.length;return this.resize(C+1),this.emplace(C,e,i,c,p,u,m,x,I,D,_,E)}emplace(e,i,c,p,u,m,x,I,D,_,E,C){let w=11*e;return this.float32[w+0]=i,this.float32[w+1]=c,this.float32[w+2]=p,this.float32[w+3]=u,this.float32[w+4]=m,this.float32[w+5]=x,this.float32[w+6]=I,this.float32[w+7]=D,this.float32[w+8]=_,this.float32[w+9]=E,this.float32[w+10]=C,e}}Ph.prototype.bytesPerElement=44,ft(Ph,"StructArrayLayout11f44");class Gg extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x,I,D){let _=this.length;return this.resize(_+1),this.emplace(_,e,i,c,p,u,m,x,I,D)}emplace(e,i,c,p,u,m,x,I,D,_){let E=9*e;return this.float32[E+0]=i,this.float32[E+1]=c,this.float32[E+2]=p,this.float32[E+3]=u,this.float32[E+4]=m,this.float32[E+5]=x,this.float32[E+6]=I,this.float32[E+7]=D,this.float32[E+8]=_,e}}Gg.prototype.bytesPerElement=36,ft(Gg,"StructArrayLayout9f36");class tu extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,c,p){let u=this.length;return this.resize(u+1),this.emplace(u,e,i,c,p)}emplace(e,i,c,p,u){let m=6*e;return this.uint32[3*e+0]=i,this.uint16[m+2]=c,this.uint16[m+3]=p,this.uint16[m+4]=u,e}}tu.prototype.bytesPerElement=12,ft(tu,"StructArrayLayout1ul3ui12");class ip extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}ip.prototype.bytesPerElement=2,ft(ip,"StructArrayLayout1ui2");class nu extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){let c=this.length;return this.resize(c+1),this.emplace(c,e,i)}emplace(e,i,c){let p=2*e;return this.float32[p+0]=i,this.float32[p+1]=c,e}}nu.prototype.bytesPerElement=8,ft(nu,"StructArrayLayout2f8");class iu extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k){let L=this.length;return this.resize(L+1),this.emplace(L,e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k)}emplace(e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k,L){let B=16*e;return this.float32[B+0]=i,this.float32[B+1]=c,this.float32[B+2]=p,this.float32[B+3]=u,this.float32[B+4]=m,this.float32[B+5]=x,this.float32[B+6]=I,this.float32[B+7]=D,this.float32[B+8]=_,this.float32[B+9]=E,this.float32[B+10]=C,this.float32[B+11]=w,this.float32[B+12]=T,this.float32[B+13]=S,this.float32[B+14]=k,this.float32[B+15]=L,e}}iu.prototype.bytesPerElement=64,ft(iu,"StructArrayLayout16f64");class Oh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,c,p,u,m,x){let I=this.length;return this.resize(I+1),this.emplace(I,e,i,c,p,u,m,x)}emplace(e,i,c,p,u,m,x,I){let D=10*e,_=5*e;return this.uint16[D+0]=i,this.uint16[D+1]=c,this.uint16[D+2]=p,this.uint16[D+3]=u,this.float32[_+2]=m,this.float32[_+3]=x,this.float32[_+4]=I,e}}Oh.prototype.bytesPerElement=20,ft(Oh,"StructArrayLayout4ui3f20");class kh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}kh.prototype.bytesPerElement=2,ft(kh,"StructArrayLayout1i2");class Lh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Lh.prototype.bytesPerElement=1,ft(Lh,"StructArrayLayout1ub1");class Hg extends Kc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Hg.prototype.size=40;class Fh extends ep{get(e){return new Hg(this,e)}}ft(Fh,"CollisionBoxArray");class ru extends Kc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ru.prototype.size=60;class rp extends kl{get(e){return new ru(this,e)}}ft(rp,"PlacedSymbolArray");class qg extends Kc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}qg.prototype.size=80;class op extends tp{get(e){return new qg(this,e)}}ft(op,"SymbolInstanceArray");class Wg extends Ll{getoffsetX(e){return this.float32[1*e+0]}}ft(Wg,"GlyphOffsetArray");class Nh extends Bs{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ft(Nh,"SymbolLineVertexArray");class Zg extends Kc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Zg.prototype.size=12;class Xg extends tu{get(e){return new Zg(this,e)}}ft(Xg,"FeatureIndexArray");class Yg extends js{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ft(Yg,"FillExtrusionCentroidArray");class Jg extends Kc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Jg.prototype.size=6;class sp extends Sh{get(e){return new Jg(this,e)}}ft(sp,"FillExtrusionWallArray");let O0=wn([{name:"a_pos",components:2,type:"Int16"}],4),k0=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class pi{constructor(e=[]){this.segments=e}_prepareSegment(e,i,c,p){let u=this.segments[this.segments.length-1];return e>pi.MAX_VERTEX_ARRAY_LENGTH&&fn(`Max vertices per segment is ${pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>pi.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==p)&&(u={vertexOffset:i,primitiveOffset:c,vertexLength:0,primitiveLength:0},p!==void 0&&(u.sortKey=p),this.segments.push(u)),u}prepareSegment(e,i,c,p){return this._prepareSegment(e,i.length,c.length,p)}get(){return this.segments}destroy(){for(let e of this.segments)for(let i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,c,p){return new pi([{vertexOffset:e,primitiveOffset:i,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function Kg(l,e){return 256*(l=jt(Math.floor(l),0,255))+jt(Math.floor(e),0,255)}pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ft(pi,"SegmentVector");let L0=wn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),F0=wn([{name:"a_dash",components:4,type:"Uint16"}]);class ou{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,c,p){this.ids.push(Qg(e)),this.positions.push(i,c,p)}eachPosition(e,i){let c=Qg(e),p=0,u=this.ids.length-1;for(;p<u;){let m=p+u>>1;this.ids[m]>=c?u=m:p=m+1}for(;this.ids[p]===c;)i(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(e,i){let c=new Float64Array(e.ids),p=new Uint32Array(e.positions);return Fl(c,p,0,c.length-1),i&&(i.add(c.buffer),i.add(p.buffer)),{ids:c,positions:p}}static deserialize(e){let i=new ou,c;i.ids=e.ids,i.positions=e.positions;for(let p of i.ids)p!==c&&i.uniqueIds.push(p),c=p;return i.indexed=!0,i}}function Qg(l){let e=+l;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:br(String(l))}function Fl(l,e,i,c){for(;i<c;){let p=l[i+c>>1],u=i-1,m=c+1;for(;;){do u++;while(l[u]<p);do m--;while(l[m]>p);if(u>=m)break;zh(l,u,m),zh(e,3*u,3*m),zh(e,3*u+1,3*m+1),zh(e,3*u+2,3*m+2)}m-i<c-m?(Fl(l,e,i,m),i=m+1):(Fl(l,e,m+1,c),c=m)}}function zh(l,e,i){let c=l[e];l[e]=l[i],l[i]=c}ft(ou,"FeaturePositionMap");class cs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Da extends cs{constructor(e){super(e),this.current=0}set(e,i,c){this.fetchUniformLocation(e,i)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class ki extends cs{constructor(e){super(e),this.current=0}set(e,i,c){this.fetchUniformLocation(e,i)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Fo extends cs{constructor(e){super(e),this.current=[0,0]}set(e,i,c){this.fetchUniformLocation(e,i)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class ap extends cs{constructor(e){super(e),this.current=[0,0,0]}set(e,i,c){this.fetchUniformLocation(e,i)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class Bh extends cs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,c){this.fetchUniformLocation(e,i)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class lp extends cs{constructor(e){super(e),this.current=On.transparent.toRenderColor(null)}set(e,i,c){this.fetchUniformLocation(e,i)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}let e_=new Float32Array(16);class su extends cs{constructor(e){super(e),this.current=e_}set(e,i,c){if(this.fetchUniformLocation(e,i)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let p=1;p<16;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}let N0=new Float32Array(9),t_=new Float32Array(4);class Vh extends cs{constructor(e){super(e),this.current=t_}set(e,i,c){if(this.fetchUniformLocation(e,i)){for(let p=0;p<4;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function cp(l){return[Kg(255*l.r,255*l.g),Kg(255*l.b,255*l.a)]}class au{constructor(e,i,c,p){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=c,this.context=p}setUniform(e,i,c,p,u){let m=p.constantOr(this.value);i.set(e,u,m instanceof On?m.toRenderColor(this.context.lut):m)}getBinding(e,i){return this.type==="color"?new lp(e):new ki(e)}}class Nl{constructor(e,i){this.uniformNames=i.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,c,p,u){let m=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;m&&i.set(e,u,m)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Bh(e):new ki(e)}}class us{constructor(e,i,c,p){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=i.map(u=>({name:`a_${u}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,c,p,u,m,x){let I=this.paintVertexArray.length,D=this.expression.evaluate(new li(0,{brightness:m}),i,{},u,p,x);this.paintVertexArray.resize(e),this._setPaintValue(I,e,D,this.context)}updatePaintArray(e,i,c,p,u,m,x){let I=this.expression.evaluate({zoom:0,brightness:x},c,p,void 0,u);this._setPaintValue(e,i,I,this.context)}_setPaintValue(e,i,c,p){if(this.type==="color"){let u=cp(c.toRenderColor(p.lut));for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _o{constructor(e,i,c,p,u,m){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=p,this.context=u,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,i,c,p,u,m,x){let I=this.expression.evaluate(new li(this.context.zoom,{brightness:m}),i,{},u,p,x),D=this.expression.evaluate(new li(this.context.zoom+1,{brightness:m}),i,{},u,p,x),_=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(_,e,I,D,this.context)}updatePaintArray(e,i,c,p,u,m,x){let I=this.expression.evaluate({zoom:this.context.zoom,brightness:x},c,p,void 0,u),D=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x},c,p,void 0,u);this._setPaintValue(e,i,I,D,this.context)}_setPaintValue(e,i,c,p,u){if(this.type==="color"){let m=cp(c.toRenderColor(u.lut)),x=cp(c.toRenderColor(u.lut));for(let I=e;I<i;I++)this.paintVertexArray.emplace(I,m[0],m[1],x[0],x[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,c,p,u){let m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=jt(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);i.set(e,u,x)}getBinding(e,i){return new ki(e)}}class hs{constructor(e,i,c,p,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(c==="array"?F0:L0).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new p}populatePaintArray(e,i,c,p){let u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],c)}updatePaintArray(e,i,c,p,u,m,x){this._setPaintValues(e,i,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(e,i,c,p){if(!p||!c)return;let u=p[c];if(!u)return;let{tl:m,br:x,pixelRatio:I}=u;for(let D=e;D<i;D++)this.paintVertexArray.emplace(D,m[0],m[1],x[0],x[1],I)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ds{constructor(e,i,c=()=>!0){this.binders={},this._buffers=[],this.context=i;let p=[];for(let u in e.paint._values){let m=e.paint.get(u);if(!c(u)||!(m instanceof Dl&&xa(m.property.specification)))continue;let x=B0(u,e.type),I=m.value,D=m.property.specification.type,_=!!m.property.useIntegerZoom,E=u==="line-dasharray"||u.endsWith("pattern"),C=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(I.kind!=="constant"||C)if(I.kind==="source"||C||E){let w=n_(u,D,"source");this.binders[u]=E?new hs(I,x,D,w,e.id):new us(I,x,D,w),p.push(`/a_${u}`)}else{let w=n_(u,D,"composite");this.binders[u]=new _o(I,x,D,_,i,w),p.push(`/z_${u}`)}else this.binders[u]=E?new Nl(I.value,x):new au(I.value,x,D,i),p.push(`/u_${u}`)}this.cacheKey=p.sort().join("")}getMaxValue(e){let i=this.binders[e];return i instanceof us||i instanceof _o?i.maxValue:0}populatePaintArrays(e,i,c,p,u,m,x){for(let I in this.binders){let D=this.binders[I];D.context=this.context,(D instanceof us||D instanceof _o||D instanceof hs)&&D.populatePaintArray(e,i,c,p,u,m,x)}}setConstantPatternPositions(e){for(let i in this.binders){let c=this.binders[i];c instanceof Nl&&c.setConstantPatternPositions(e)}}updatePaintArrays(e,i,c,p,u,m,x,I){let D=!1,_=Object.keys(e),E=_.length!==0,C=E?_:i.uniqueIds;this.context.lut=u.lut;for(let w in this.binders){let T=this.binders[w];if(T.context=this.context,(T instanceof us||T instanceof _o||T instanceof hs)&&(T.expression.isStateDependent===!0||T.expression.isLightConstant===!1)){let S=u.paint.get(w);T.expression=S.value;for(let k of C){let L=e[k.toString()];i.eachPosition(k,(B,V,N)=>{let G=p.feature(B);T.updatePaintArray(V,N,G,L,m,x,I)})}if(!E)for(let k of c.uniqueIds){let L=e[k.toString()];c.eachPosition(k,(B,V,N)=>{let G=p.feature(B);T.updatePaintArray(V,N,G,L,m,x,I)})}D=!0}}return D}defines(){let e=[];for(let i in this.binders){let c=this.binders[i];(c instanceof au||c instanceof Nl)&&e.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){let e=[];for(let i in this.binders){let c=this.binders[i];if(c instanceof us||c instanceof _o||c instanceof hs)for(let p=0;p<c.paintVertexAttributes.length;p++)e.push(c.paintVertexAttributes[p].name)}return e}getBinderUniforms(){let e=[];for(let i in this.binders){let c=this.binders[i];if(c instanceof au||c instanceof Nl||c instanceof _o)for(let p of c.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let i=[];for(let c in this.binders){let p=this.binders[c];if(p instanceof au||p instanceof Nl||p instanceof _o)for(let u of p.uniformNames)i.push({name:u,property:c,binding:p.getBinding(e,u)})}return i}setUniforms(e,i,c,p,u){for(let{name:m,property:x,binding:I}of c)this.binders[x].setUniform(e,I,u,p.get(x),m)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let i=this.binders[e];(i instanceof us||i instanceof _o||i instanceof hs)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(let i in this.binders){let c=this.binders[i];(c instanceof us||c instanceof _o||c instanceof hs)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let i=this.binders[e];(i instanceof us||i instanceof _o||i instanceof hs)&&i.destroy()}}}class No{constructor(e,i,c=()=>!0){this.programConfigurations={};for(let p of e)this.programConfigurations[p.id]=new ds(p,i,c);this.needsUpload=!1,this._featureMap=new ou,this._featureMapWithoutIds=new ou,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,c,p,u,m,x,I){for(let D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(e,i,p,u,m,x,I);i.id!==void 0?this._featureMap.add(i.id,c,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,c,p,u,m){for(let x of c)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,x,p,u,m||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let z0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function B0(l,e){return z0[l]||[l.replace(`${e}-`,"").replace(/-/g,"_")]}let V0={"line-pattern":{source:ls,composite:ls},"fill-pattern":{source:ls,composite:ls},"fill-extrusion-pattern":{source:ls,composite:ls},"line-dasharray":{source:Ah,composite:Ah}},j0={color:{source:nu,composite:as},number:{source:Ll,composite:nu}};function n_(l,e,i){let c=V0[l];return c&&c[i]||j0[e][i]}ft(au,"ConstantBinder"),ft(Nl,"PatternConstantBinder"),ft(us,"SourceExpressionBinder"),ft(hs,"PatternCompositeBinder"),ft(_o,"CompositeExpressionBinder"),ft(ds,"ProgramConfiguration",{omit:["_buffers"]}),ft(No,"ProgramConfigurationSet");let er=st/Math.PI/2,i_=5,h=6,t=16383,o=64,f=[o,32,16],g=-er,v=er;function b(l,e,i,c=er){return i=ln(i),[l*Math.sin(i)*c,-e*c,l*Math.cos(i)*c]}function M(l,e,i){return b(Math.cos(ln(l)),Math.sin(ln(l)),e,i)}let A=63710088e-1,O=2*Math.PI*A;class P{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new P(es(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let i=Math.PI/180,c=this.lat*i,p=e.lat*i,u=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((e.lng-this.lng)*i);return A*Math.acos(Math.min(u,1))}toBounds(e=0){let i=360*e/40075017,c=i/Math.cos(Math.PI/180*this.lat);return new F({lng:this.lng-c,lat:this.lat-i},{lng:this.lng+c,lat:this.lat+i})}toEcef(e){return M(this.lat,this.lng,er+e*er/A)}static convert(e){if(e instanceof P)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new P(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new P(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class F{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){let c=e;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{let c=e;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(e){return this._ne=e instanceof P?new P(e.lng,e.lat):P.convert(e),this}setSouthWest(e){return this._sw=e instanceof P?new P(e.lng,e.lat):P.convert(e),this}extend(e){let i=this._sw,c=this._ne,p,u;if(e instanceof P)p=e,u=e;else{if(!(e instanceof F))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(F.convert(e)):this.extend(P.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(P.convert(e)):this;if(p=e._sw,u=e._ne,!p||!u)return this}return i||c?(i.lng=Math.min(p.lng,i.lng),i.lat=Math.min(p.lat,i.lat),c.lng=Math.max(u.lng,c.lng),c.lat=Math.max(u.lat,c.lat)):(this._sw=new P(p.lng,p.lat),this._ne=new P(u.lng,u.lat)),this}getCenter(){return new P((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new P(this.getWest(),this.getNorth())}getSouthEast(){return new P(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:i,lat:c}=P.convert(e),p=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(e){if(e)return e instanceof F?e:new F(e)}}let z=0,U=25.5;function W(l){return O*Math.cos(l*Math.PI/180)}function q(l){return(180+l)/360}function X(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Z(l,e){return l/W(e)}function Q(l){return 360*l-180}function re(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function oe(l,e){return l*W(re(e))}let ae=85.051129;function ue(l){return Math.cos(ln(jt(l,-ae,ae)))}function le(l,e){let i=jt(e,z,U),c=Math.pow(2,i);return ue(l)*O/(512*c)}function he(l){return 1/Math.cos(l*Math.PI/180)}function ge(l,e=0){let i=Math.exp(Math.PI*(1-(l.y+e/st)/(1<<l.z)*2));return 80150034*i/(i*i+1)/st/(1<<l.z)}class be{constructor(e,i,c=0){this.x=+e,this.y=+i,this.z=+c}static fromLngLat(e,i=0){let c=P.convert(e);return new be(q(c.lng),X(c.lat),Z(i,c.lat))}toLngLat(){return new P(Q(this.x),re(this.y))}toAltitude(){return oe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/O*he(re(this.y))}}function ye(l,e,i,c,p,u,m,x,I){let D=(e+c)/2,_=(i+p)/2,E=new ot(D,_);x(E),function(C,w,T,S,k,L){let B=T-k,V=S-L;return Math.abs((S-w)*B-(T-C)*V)/Math.hypot(B,V)}(E.x,E.y,u.x,u.y,m.x,m.y)>=I?(ye(l,e,i,D,_,u,E,x,I),ye(l,D,_,c,p,E,m,x,I)):l.push(m)}function _e(l,e,i){let c=l[0],p=c.x,u=c.y;e(c);let m=[c];for(let x=1;x<l.length;x++){let I=l[x],{x:D,y:_}=I;e(I),ye(m,p,u,D,_,c,I,e,i),p=D,u=_,c=I}return m}function Oe(l,e,i,c){if(c(e,i)){let p=e.add(i)._mult(.5);Oe(l,e,p,c),Oe(l,p,i,c)}else l.push(i)}function Ve(l,e){let i=l[0],c=[i];for(let p=1;p<l.length;p++){let u=l[p];Oe(c,i,u,e),i=u}return c}let Ze=Math.pow(2,14)-1,Ke=-Ze-1;function nt(l,e){let i=Math.round(l.x*e),c=Math.round(l.y*e);return l.x=jt(i,Ke,Ze),l.y=jt(c,Ke,Ze),(i<l.x||i>l.x+1||c<l.y||c>l.y+1)&&fn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function Ce(l,e,i){let c=l.loadGeometry(),p=l.extent,u=st/p;if(e&&i&&i.projection.isReprojectedInTileSpace){let m=1<<e.z,{scale:x,x:I,y:D,projection:_}=i,E=C=>{let w=Q((e.x+C.x/p)/m),T=re((e.y+C.y/p)/m),S=_.project(w,T);C.x=(S.x*x-I)*p,C.y=(S.y*x-D)*p};for(let C=0;C<c.length;C++)if(l.type!==1)c[C]=_e(c[C],E,1);else{let w=[];for(let T of c[C])T.x<0||T.x>=p||T.y<0||T.y>=p||(E(T),w.push(T));c[C]=w}}for(let m of c)for(let x of m)nt(x,u);return c}function qe(l,e){return{type:l.type,id:l.id,properties:l.properties,geometry:e?Ce(l):[]}}function ke(l,e,i,c,p){l.emplaceBack(2*e+(c+1)/2,2*i+(p+1)/2)}function We(l,e,i){l.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Xe{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Bs,this.indexArray=new si,this.segments=new pi,this.programConfigurations=new No(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,c,p){let u=this.layers[0],m=[],x=null;u.type==="circle"&&(x=u.layout.get("circle-sort-key"));for(let{feature:D,id:_,index:E,sourceLayerIndex:C}of e){let w=this.layers[0]._featureFilter.needGeometry,T=qe(D,w);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),T,c))continue;let S=x?x.evaluate(T,{},c):void 0,k={id:_,properties:D.properties,type:D.type,sourceLayerIndex:C,index:E,geometry:w?T.geometry:Ce(D,c,p),patterns:{},sortKey:S};m.push(k)}x&&m.sort((D,_)=>D.sortKey-_.sortKey);let I=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new eu,I=p.projection);for(let D of m){let{geometry:_,index:E,sourceLayerIndex:C}=D,w=e[E].feature;this.addFeature(D,_,E,i.availableImages,c,I,i.brightness),i.featureIndex.insert(w,_,E,C,this.index)}}update(e,i,c,p,u){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,m?this.stateDependentLayers:this.layers,c,p,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,O0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,k0.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,c,p,u,m,x){for(let I of i)for(let D of I){let _=D.x,E=D.y;if(_<0||_>=st||E<0||E>=st)continue;if(m){let T=m.projectTilePoint(_,E,u),S=m.upVector(u,_,E),k=this.globeExtVertexArray;We(k,T,S),We(k,T,S),We(k,T,S),We(k,T,S)}let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),w=C.vertexLength;ke(this.layoutVertexArray,_,E,-1,-1),ke(this.layoutVertexArray,_,E,1,-1),ke(this.layoutVertexArray,_,E,1,1),ke(this.layoutVertexArray,_,E,-1,1),this.indexArray.emplaceBack(w,w+1,w+2),this.indexArray.emplaceBack(w,w+2,w+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},p,u,x)}}function Ge(l,e){for(let i=0;i<l.length;i++)if(cn(e,l[i]))return!0;for(let i=0;i<e.length;i++)if(cn(l,e[i]))return!0;return!!pt(l,e)}function at(l,e,i){return!!cn(l,e)||!!ut(e,l,i)}function vt(l,e){if(l.length===1)return Ht(e,l[0]);for(let i=0;i<e.length;i++){let c=e[i];for(let p=0;p<c.length;p++)if(cn(l,c[p]))return!0}for(let i=0;i<l.length;i++)if(Ht(e,l[i]))return!0;for(let i=0;i<e.length;i++)if(pt(l,e[i]))return!0;return!1}function Et(l,e,i){if(l.length>1){if(pt(l,e))return!0;for(let c=0;c<e.length;c++)if(ut(e[c],l,i))return!0}for(let c=0;c<l.length;c++)if(ut(l[c],e,i))return!0;return!1}function pt(l,e){if(l.length===0||e.length===0)return!1;for(let i=0;i<l.length-1;i++){let c=l[i],p=l[i+1];for(let u=0;u<e.length-1;u++)if(Tt(c,p,e[u],e[u+1]))return!0}return!1}function Tt(l,e,i,c){return Ao(l,i,c)!==Ao(e,i,c)&&Ao(l,e,i)!==Ao(l,e,c)}function ut(l,e,i){let c=i*i;if(e.length===1)return l.distSqr(e[0])<c;for(let p=1;p<e.length;p++)if(Mt(l,e[p-1],e[p])<c)return!0;return!1}function Mt(l,e,i){let c=e.distSqr(i);if(c===0)return l.distSqr(e);let p=((l.x-e.x)*(i.x-e.x)+(l.y-e.y)*(i.y-e.y))/c;return l.distSqr(p<0?e:p>1?i:i.sub(e)._mult(p)._add(e))}function Ht(l,e){let i,c,p,u=!1;for(let m=0;m<l.length;m++){i=l[m];for(let x=0,I=i.length-1;x<i.length;I=x++)c=i[x],p=i[I],c.y>e.y!=p.y>e.y&&e.x<(p.x-c.x)*(e.y-c.y)/(p.y-c.y)+c.x&&(u=!u)}return u}function cn(l,e){let i=!1;for(let c=0,p=l.length-1;c<l.length;p=c++){let u=l[c],m=l[p];u.y>e.y!=m.y>e.y&&e.x<(m.x-u.x)*(e.y-u.y)/(m.y-u.y)+u.x&&(i=!i)}return i}function Vn(l,e,i,c,p){for(let m of l)if(e<=m.x&&i<=m.y&&c>=m.x&&p>=m.y)return!0;let u=[new ot(e,i),new ot(e,p),new ot(c,p),new ot(c,i)];if(l.length>2){for(let m of u)if(cn(l,m))return!0}for(let m=0;m<l.length-1;m++)if(vn(l[m],l[m+1],u))return!0;return!1}function vn(l,e,i){let c=i[0],p=i[2];if(l.x<c.x&&e.x<c.x||l.x>p.x&&e.x>p.x||l.y<c.y&&e.y<c.y||l.y>p.y&&e.y>p.y)return!1;let u=Ao(l,e,i[0]);return u!==Ao(l,e,i[1])||u!==Ao(l,e,i[2])||u!==Ao(l,e,i[3])}function Zn(l,e,i,c,p,u){let m=e.y-l.y,x=l.x-e.x;if(u=u||0){let I=m*m+x*x;if(I===0)return!0;let D=Math.sqrt(I);m/=D,x/=D}return!((i.x-l.x)*m+(i.y-l.y)*x-u<0||(c.x-l.x)*m+(c.y-l.y)*x-u<0||(p.x-l.x)*m+(p.y-l.y)*x-u<0)}function In(l,e,i,c,p,u,m){return!(Zn(l,e,c,p,u,m)||Zn(e,i,c,p,u,m)||Zn(i,l,c,p,u,m)||Zn(c,p,l,e,i,m)||Zn(p,u,l,e,i,m)||Zn(u,c,l,e,i,m))}function jn(l,e,i){let c=e.paint.get(l).value;return c.kind==="constant"?c.value:i.programConfigurations.get(e.id).getMaxValue(l)}function nn(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Nn(l,e,i,c,p){if(!e[0]&&!e[1])return l;let u=ot.convert(e)._mult(p);i==="viewport"&&u._rotate(-c);let m=[];for(let x=0;x<l.length;x++)m.push(l[x].sub(u));return m}function Ln(l,e,i,c){let p=ot.convert(l)._mult(c);return e==="viewport"&&p._rotate(-i),p}let Cn,ni;ft(Xe,"CircleBucket",{omit:["layers"]});var Ri,Nr={exports:{}},Jr=(Ri||(Ri=1,function(l,e){(function(i){function c(u,m,x){var I=p(256*u,256*(m=Math.pow(2,x)-m-1),x),D=p(256*(u+1),256*(m+1),x);return I[0]+","+I[1]+","+D[0]+","+D[1]}function p(u,m,x){var I=2*Math.PI*6378137/256/Math.pow(2,x);return[u*I-2*Math.PI*6378137/2,m*I-2*Math.PI*6378137/2]}i.getURL=function(u,m,x,I,D,_){return _=_||{},u+"?"+["bbox="+c(x,I,D),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+m].join("&")},i.getTileBBox=c,i.getMercCoords=p,Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Nr.exports)),Nr.exports);class Li{constructor(e,i,c){this.z=e,this.x=i,this.y=c,this.key=Tn(0,e,e,i,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){let c=Jr.getTileBBox(this.x,this.y,this.z),p=function(u,m,x){let I,D="";for(let _=u;_>0;_--)I=1<<_-1,D+=(m&I?1:0)+(x&I?2:0);return D}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class gn{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Tn(e,i.z,i.z,i.x,i.y)}}class un{constructor(e,i,c,p,u){this.overscaledZ=e,this.wrap=i,this.canonical=new Li(c,+p,+u),this.key=i===0&&e===c?this.canonical.key:Tn(i,e,c,p,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let i=this.canonical.z-e;return e>this.canonical.z?new un(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new un(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Tn(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{let c=this.canonical.z-e;return Tn(this.wrap*+i,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new un(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new un(i,this.wrap,i,c,p),new un(i,this.wrap,i,c+1,p),new un(i,this.wrap,i,c,p+1),new un(i,this.wrap,i,c+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new un(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new un(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gn(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Tn(l,e,i,c,p){let u=1<<Math.min(i,22),m=u*(p%u)+c%u;return l&&i<22&&(m+=u*u*((l<0?-2*l-1:2*l)%(1<<2*(22-i)))),16*(32*m+i)+(e-i)}let qn=[l=>{let e=l.canonical.x-1,i=l.wrap;return e<0&&(e=(1<<l.canonical.z)-1,i--),new un(l.overscaledZ,i,l.canonical.z,e,l.canonical.y)},l=>{let e=l.canonical.x+1,i=l.wrap;return e===1<<l.canonical.z&&(e=0,i++),new un(l.overscaledZ,i,l.canonical.z,e,l.canonical.y)},l=>new un(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new un(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];ft(Li,"CanonicalTileID"),ft(un,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let mi=wn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ii}=mi,ji=wn([{name:"a_pos_3",components:3,type:"Int16"}]);var zo=wn([{name:"a_pos",type:"Int16",components:2}]);class Ir{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,c){let p=Ee.vec3.dot(i,this.dir);if(Math.abs(p)<1e-6)return!1;let u=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/p;return c[0]=this.pos[0]+this.dir[0]*u,c[1]=this.pos[1]+this.dir[1]*u,c[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,i,c){if(Ee.vec3.equals(this.pos,e)||i===0)return c[0]=c[1]=c[2]=0,!1;let[p,u,m]=this.dir,x=this.pos[0]-e[0],I=this.pos[1]-e[1],D=this.pos[2]-e[2],_=p*p+u*u+m*m,E=2*(x*p+I*u+D*m),C=E*E-4*_*(x*x+I*I+D*D-i*i);if(C<0){let w=Math.max(-E/2,0),T=x+p*w,S=I+u*w,k=D+m*w,L=Math.hypot(T,S,k);return c[0]=T*i/L,c[1]=S*i/L,c[2]=k*i/L,!1}{let w=(-E-Math.sqrt(C))/(2*_);if(w<0){let T=Math.hypot(x,I,D);return c[0]=x*i/T,c[1]=I*i/T,c[2]=D*i/T,!1}return c[0]=x+p*w,c[1]=I+u*w,c[2]=D+m*w,!0}}}class Tr{constructor(e,i,c,p,u){this.TL=e,this.TR=i,this.BR=c,this.BL=p,this.horizon=u}static fromInvProjectionMatrix(e,i,c){let p=[-1,1,1],u=[1,1,1],m=[1,-1,1],x=[-1,-1,1],I=Ee.vec3.transformMat4(p,p,e),D=Ee.vec3.transformMat4(u,u,e),_=Ee.vec3.transformMat4(m,m,e),E=Ee.vec3.transformMat4(x,x,e);return new Tr(I,D,_,E,i/c)}}function Kr(l,e,i){let c=1/0,p=-1/0,u=[];for(let m of l){Ee.vec3.sub(u,m,e);let x=Ee.vec3.dot(u,i);c=Math.min(c,x),p=Math.max(p,x)}return[c,p]}function yo(l,e){let i=!0;for(let c=0;c<l.planes.length;c++){let p=l.planes[c],u=0;for(let m=0;m<e.length;m++)u+=Ee.vec3.dot(p,e[m])+p[3]>=0;if(u===0)return 0;u!==e.length&&(i=!1)}return i?2:1}function Cr(l,e){for(let i of l.projections){let c=Kr(e,l.points[0],i.axis);if(i.projection[1]<c[0]||i.projection[0]>c[1])return 0}return 1}function fs(l,e){let i=0,c=[0,0,0,0];for(let p=0;p<l.length;p++)c[0]=l[p][0],c[1]=l[p][1],c[2]=l[p][2],c[3]=1,Ee.vec4.dot(c,e)>=0&&i++;return i}class Qr{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=An.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ee.vec3.sub([],this.points[2],this.points[3]),Ee.vec3.sub([],this.points[0],this.points[3]),Ee.vec3.sub([],this.points[4],this.points[0]),Ee.vec3.sub([],this.points[5],this.points[1]),Ee.vec3.sub([],this.points[6],this.points[2]),Ee.vec3.sub([],this.points[7],this.points[3])];for(let c of this.frustumEdges){let p=[0,-c[2],c[1]],u=[c[2],0,-c[0]];this.projections.push({axis:p,projection:Kr(this.points,this.points[0],p)}),this.projections.push({axis:u,projection:Kr(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,i,c,p){let u=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{let _=Ee.vec4.transformMat4([],D,e),E=1/_[3]/i*u;return Ee.vec4.mul(_,_,[E,E,p?1/_[3]:E,E])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{let _=Ee.vec3.sub([],m[D[0]],m[D[1]]),E=Ee.vec3.sub([],m[D[2]],m[D[1]]),C=Ee.vec3.normalize([],Ee.vec3.cross([],_,E)),w=-Ee.vec3.dot(C,m[D[1]]);return C.concat(w)}),I=[];for(let D=0;D<m.length;D++)I.push([m[D][0],m[D][1],m[D][2]]);return new Qr(I,x)}intersectsPrecise(e,i,c){for(let p=0;p<i.length;p++)if(!fs(e,i[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!fs(e,this.planes[p]))return 0;for(let p of c)for(let u of this.frustumEdges){let m=Ee.vec3.cross([],p,u),x=Ee.vec3.length(m);if(x===0)continue;Ee.vec3.scale(m,m,1/x);let I=Kr(this.points,this.points[0],m),D=Kr(e,this.points[0],m);if(I[0]>D[1]||D[0]>I[1])return 0}return 1}containsPoint(e){for(let i of this.planes){let c=i[3];if(Ee.vec3.dot([i[0],i[1],i[2]],e)+c<0)return!1}return!0}}class An{static fromPoints(e){let i=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(let p of e)Ee.vec3.min(i,i,p),Ee.vec3.max(c,c,p);return new An(i,c)}static fromTileIdAndHeight(e,i,c){let p=1<<e.canonical.z,u=e.canonical.x,m=e.canonical.y;return new An([u/p,m/p,i],[(u+1)/p,(m+1)/p,c])}static applyTransform(e,i){let c=e.getCorners();for(let p=0;p<c.length;++p)Ee.vec3.transformMat4(c[p],c[p],i);return An.fromPoints(c)}static applyTransformFast(e,i){let c=[i[12],i[13],i[14]],p=[...c];for(let u=0;u<3;u++)for(let m=0;m<3;m++){let x=i[4*m+u],I=x*e.min[m],D=x*e.max[m];c[u]+=Math.min(I,D),p[u]+=Math.max(I,D)}return new An(c,p)}static projectAabbCorners(e,i){let c=e.getCorners();for(let p=0;p<c.length;++p)Ee.vec3.transformMat4(c[p],c[p],i);return c}constructor(e,i){this.min=e,this.max=i,this.center=Ee.vec3.scale([],Ee.vec3.add([],this.min,this.max),.5)}quadrant(e){let i=[e%2==0,e<2],c=Ee.vec3.clone(this.min),p=Ee.vec3.clone(this.max);for(let u=0;u<i.length;u++)c[u]=i[u]?this.min[u]:this.center[u],p[u]=i[u]?this.center[u]:this.max[u];return p[2]=this.max[2],new An(c,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?yo(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?yo(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Cr(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Cr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function zl(l){return l*er/A}ft(An,"Aabb");let up=[new An([g,g,g],[v,v,v]),new An([g,g,g],[0,0,v]),new An([0,g,g],[v,0,v]),new An([g,0,g],[0,v,v]),new An([0,0,g],[v,v,v])];function Bl(l,e,i,c=!0){let p=Ee.vec3.scale([],l._camera.position,l.worldSize),u=[e,i,1,1];Ee.vec4.transformMat4(u,u,l.pixelMatrixInverse),Ee.vec4.scale(u,u,1/u[3]);let m=Ee.vec3.sub([],u,p),x=Ee.vec3.normalize([],m),I=l.globeMatrix,D=[I[12],I[13],I[14]],_=Ee.vec3.sub([],D,p),E=Ee.vec3.length(_),C=Ee.vec3.normalize([],_),w=l.worldSize/(2*Math.PI),T=Ee.vec3.dot(C,x),S=Math.asin(w/E);if(S<Math.acos(T)){if(!c)return null;let me=[],te=[];Ee.vec3.scale(me,x,E/T),Ee.vec3.normalize(te,Ee.vec3.sub(te,me,_)),Ee.vec3.normalize(x,Ee.vec3.add(x,_,Ee.vec3.scale(x,te,Math.tan(S)*E)))}let k=[];new Ir(p,x).closestPointOnSphere(D,w,k);let L=Ee.vec3.normalize([],el(I,0)),B=Ee.vec3.normalize([],el(I,1)),V=Ee.vec3.normalize([],el(I,2)),N=Ee.vec3.dot(L,k),G=Ee.vec3.dot(B,k),H=Ee.vec3.dot(V,k),J=$i(Math.asin(-G/w)),se=$i(Math.atan2(N,H));se=l.center.lng+function(me,te){let de=(te-me+180)%360-180;return de<-180?de+360:de}(l.center.lng,se);let ee=q(se),ne=jt(X(J),0,1);return new be(ee,ne)}class hp{constructor(e,i,c){this.a=Ee.vec3.sub([],e,c),this.b=Ee.vec3.sub([],i,c),this.center=c;let p=Ee.vec3.normalize([],this.a),u=Ee.vec3.normalize([],this.b);this.angle=Math.acos(Ee.vec3.dot(p,u))}}function lu(l,e){if(l.angle===0)return null;let i;return i=l.a[e]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[e]/l.a[e]/Math.sin(l.angle)-1/Math.tan(l.angle)),i<0||i>1?null:function(c,p,u,m){let x=Math.sin(u);return c*(Math.sin((1-m)*u)/x)+p*(Math.sin(m*u)/x)}(l.a[e],l.b[e],l.angle,jt(i,0,1))+l.center[e]}function Us(l){if(l.z<=1)return up[l.z+2*l.y+l.x];let e=U0(r_(l));return An.fromPoints(e)}function Ma(l,e,i){return Ee.vec3.scale(l,l,1-i),Ee.vec3.scaleAndAdd(l,l,e,i)}function JE(l,e,i){for(let c of l)Ee.vec3.transformMat4(c,c,e),Ee.vec3.scale(c,c,i)}function KE(l,e,i,c){let p=e/l.worldSize,u=l.globeMatrix;if(i.z<=1){let ee=Us(i).getCorners();return JE(ee,u,p),An.fromPoints(ee)}let m=r_(i,c),x=U0(m,er+zl(l._tileCoverLift));JE(x,u,p);let I=Number.MAX_VALUE,D=[-I,-I,-I],_=[I,I,I];if(m.contains(l.center)){for(let me of x)Ee.vec3.min(_,_,me),Ee.vec3.max(D,D,me);D[2]=0;let ee=l.point,ne=[ee.x*p,ee.y*p,0];return Ee.vec3.min(_,_,ne),Ee.vec3.max(D,D,ne),new An(_,D)}if(l._tileCoverLift>0){for(let ee of x)Ee.vec3.min(_,_,ee),Ee.vec3.max(D,D,ee);return new An(_,D)}let E=[u[12]*p,u[13]*p,u[14]*p],C=m.getCenter(),w=jt(l.center.lat,-ae,ae),T=jt(C.lat,-ae,ae),S=q(l.center.lng),k=X(w),L=S-q(C.lng),B=k-X(T);L>.5?L-=1:L<-.5&&(L+=1);let V=0;if(Math.abs(L)>Math.abs(B))V=L>=0?1:3;else{V=B>=0?0:2;let ee=[u[4]*p,u[5]*p,u[6]*p],ne=-Math.sin(ln(B>=0?m.getSouth():m.getNorth()))*er;Ee.vec3.scaleAndAdd(E,E,ee,ne)}let N=x[V],G=x[(V+1)%4],H=new hp(N,G,E),J=[lu(H,0)||N[0],lu(H,1)||N[1],lu(H,2)||N[2]],se=Vl(l.zoom);if(se>0){let ee=function({x:me,y:te,z:de},ve,xe,Ie,Ae){let Pe=1/(1<<de),De=me*Pe,$e=De+Pe,Je=te*Pe,ze=Je+Pe,dt=0,it=(De+$e)/2-Ie;return it>.5?dt=-1:it<-.5&&(dt=1),De=((De+dt)*ve-(Ie*=ve))*xe+Ie,$e=(($e+dt)*ve-Ie)*xe+Ie,Je=(Je*ve-(Ae*=ve))*xe+Ae,ze=(ze*ve-Ae)*xe+Ae,[[De,ze,0],[$e,ze,0],[$e,Je,0],[De,Je,0]]}(i,e,l._pixelsPerMercatorPixel,S,k);for(let me=0;me<x.length;me++)Ma(x[me],ee[me],se);let ne=Ee.vec3.add([],ee[V],ee[(V+1)%4]);Ee.vec3.scale(ne,ne,.5),Ma(J,ne,se)}for(let ee of x)Ee.vec3.min(_,_,ee),Ee.vec3.max(D,D,ee);return _[2]=Math.min(N[2],G[2]),Ee.vec3.min(_,_,J),Ee.vec3.max(D,D,J),new An(_,D)}function r_({x:l,y:e,z:i},c=!1){let p=1/(1<<i),u=new P(Q(l*p),e===(1<<i)-1&&c?-90:re((e+1)*p)),m=new P(Q((l+1)*p),e===0&&c?90:re(e*p));return new F(u,m)}function U0(l,e=er){let i=ln(l.getNorth()),c=ln(l.getSouth()),p=Math.cos(i),u=Math.cos(c),m=Math.sin(i),x=Math.sin(c),I=l.getWest(),D=l.getEast();return[b(u,x,I,e),b(u,x,D,e),b(p,m,D,e),b(p,m,I,e)]}function dp(l,e,i,c){let p=1<<i.z,u=(l/st+i.x)/p;return M(re((e/st+i.y)/p),Q(u),c)}function o_({min:l,max:e}){return t/Math.max(e[0]-l[0],e[1]-l[1],e[2]-l[2])}let QE=new Float64Array(16);function s_(l){let e=o_(l),i=Ee.mat4.fromScaling(QE,[e,e,e]);return Ee.mat4.translate(i,i,Ee.vec3.negate([],l.min))}function $0(l){let e=Ee.mat4.fromTranslation(QE,l.min),i=1/o_(l);return Ee.mat4.scale(e,e,[i,i,i])}function G0(l){let e=st/(2*Math.PI);return l/(2*Math.PI)/e}function eI(l,e){return st/(512*Math.pow(2,l))*o_(Us(e))}function tI(l,e,i,c,p){let u=G0(i),m=[l,e,-i/(2*Math.PI)],x=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.translate(x,x,m),Ee.mat4.scale(x,x,[u,u,u]),Ee.mat4.rotateX(x,x,ln(-p)),Ee.mat4.rotateY(x,x,ln(-c)),x}function Vl(l){return Ja(i_,h,l)}function nI(l,e){let i=M(e.lat,e.lng),c=function(u){let m=M(u._center.lat,u._center.lng),x=Ee.vec3.fromValues(0,1,0),I=Ee.vec3.cross([],x,m),D=Ee.mat4.fromRotation([],-u.angle,m);I=Ee.vec3.transformMat4(I,I,D),Ee.mat4.fromRotation(D,-u._pitch,I);let _=Ee.vec3.normalize([],m);return Ee.vec3.scale(_,_,zl(u.cameraToCenterDistance/u.pixelsPerMeter)),Ee.vec3.transformMat4(_,_,D),Ee.vec3.add([],m,_)}(l),p=Ee.vec3.subtract([],c,i);return Ee.vec3.angle(p,i)}function H0(l,e){return nI(l,e)>Math.PI/2*1.01}let iI=ln(85),sO=Math.cos(iI),aO=Math.sin(iI),lO=Ee.mat4.create(),rI=l=>{let e=[];return l.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function oI(l,e,i,c,p,u,m,x,I){if(u&&l.queryGeometry.isAboveHorizon)return!1;u&&(I*=l.pixelToTileUnitsFactor);let D=l.tileID.canonical,_=i.projection.upVectorScale(D,i.center.lat,i.worldSize).metersToTile;for(let E of e)for(let C of E){let w=C.add(x),T=p&&i.elevation?i.elevation.exaggeration()*p.getElevationAt(w.x,w.y,!0):0,S=i.projection.projectTilePoint(w.x,w.y,D);if(T>0){let V=i.projection.upVector(D,w.x,w.y);S.x+=V[0]*_*T,S.y+=V[1]*_*T,S.z+=V[2]*_*T}let k=u?w:cO(S.x,S.y,S.z,c),L=u?l.tilespaceRays.map(V=>hO(V,T)):l.queryGeometry.screenGeometry,B=Ee.vec4.transformMat4([],[S.x,S.y,S.z,1],c);if(!m&&u?I*=B[3]/i.cameraToCenterDistance:m&&!u&&(I*=i.cameraToCenterDistance/B[3]),u){let V=re((C.y/st+D.y)/(1<<D.z));I/=i.projection.pixelsPerMeter(V,1)/Z(1,V)}if(at(L,k,I))return!0}return!1}function cO(l,e,i,c){let p=Ee.vec4.transformMat4([],[l,e,i,1],c);return new ot(p[0]/p[3],p[1]/p[3])}let sI=Ee.vec3.fromValues(0,0,0),uO=Ee.vec3.fromValues(0,0,1);function hO(l,e){let i=Ee.vec3.create();return sI[2]=e,l.intersectsPlane(sI,uO,i),new ot(i[0],i[1])}class aI extends Xe{}let lI,cI,uI,hI;function dI(l,{width:e,height:i},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*i*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(e*i*c);return l.width=e,l.height=i,l.data=p,l}function fI(l,e,i){let{width:c,height:p}=e;c===l.width&&p===l.height||(q0(l,e,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,c),height:Math.min(l.height,p)},i,null),l.width=c,l.height=p,l.data=e.data)}function q0(l,e,i,c,p,u,m,x){if(p.width===0||p.height===0)return e;if(p.width>l.width||p.height>l.height||i.x>l.width-p.width||i.y>l.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||c.x>e.width-p.width||c.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");let I=l.data,D=e.data,_=u===4&&x;for(let E=0;E<p.height;E++){let C=((i.y+E)*l.width+i.x)*u,w=((c.y+E)*e.width+c.x)*u;if(_)for(let T=0;T<p.width;T++){let S=C+T*u+3,k=w+T*u;D[k+0]=255,D[k+1]=255,D[k+2]=255,D[k+3]=I[S]}else if(m)for(let T=0;T<p.width;T++){let S=C+T*u,k=w+T*u,L=I[S+3],B=new On(I[S+0]/255*L,I[S+1]/255*L,I[S+2]/255*L,L).toRenderColor(m).toArray();D[k+0]=B[0],D[k+1]=B[1],D[k+2]=B[2],D[k+3]=B[3]}else for(let T=0;T<p.width*u;T++)D[w+T]=I[C+T]}return e}ft(aI,"HeatmapBucket",{omit:["layers"]});class jl{constructor(e,i){dI(this,e,1,i)}resize(e){fI(this,new jl(e),1)}clone(){return new jl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,c,p,u){q0(e,i,c,p,u,1,null)}}class gr{constructor(e,i){dI(this,e,4,i)}resize(e){fI(this,new gr(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new gr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,c,p,u,m,x){q0(e,i,c,p,u,4,m,x)}}class pI{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function fp(l){let e={},i=l.resolution||256,c=l.clips?l.clips.length:1,p=l.image||new gr({width:i,height:c}),u=(m,x,I)=>{e[l.evaluationKey]=I;let D=l.expression.evaluate(e);D&&(p.data[m+x+0]=Math.floor(255*D.r/D.a),p.data[m+x+1]=Math.floor(255*D.g/D.a),p.data[m+x+2]=Math.floor(255*D.b/D.a),p.data[m+x+3]=Math.floor(255*D.a))};if(l.clips)for(let m=0,x=0;m<c;++m,x+=4*i)for(let I=0,D=0;I<i;I++,D+=4){let _=I/(i-1),{start:E,end:C}=l.clips[m];u(x,D,E*(1-_)+C*_)}else for(let m=0,x=0;m<i;m++,x+=4)u(0,x,m/(i-1));return p}ft(jl,"AlphaImage"),ft(gr,"RGBAImage");let dO=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:fO}=dO;function pp(l,e,i=2){let c=e&&e.length,p=c?e[0]*i:l.length,u=mI(l,0,p,i,!0),m=[];if(!u||u.next===u.prev)return m;let x,I,D;if(c&&(u=function(_,E,C,w){let T=[];for(let S=0,k=E.length;S<k;S++){let L=mI(_,E[S]*w,S<k-1?E[S+1]*w:_.length,w,!1);L===L.next&&(L.steiner=!0),T.push(bO(L))}T.sort(yO);for(let S=0;S<T.length;S++)C=vO(T[S],C);return C}(l,e,u,i)),l.length>80*i){x=1/0,I=1/0;let _=-1/0,E=-1/0;for(let C=i;C<p;C+=i){let w=l[C],T=l[C+1];w<x&&(x=w),T<I&&(I=T),w>_&&(_=w),T>E&&(E=T)}D=Math.max(_-x,E-I),D=D!==0?32767/D:0}return mp(u,m,i,x,I,D,0),m}function mI(l,e,i,c,p){let u;if(p===function(m,x,I,D){let _=0;for(let E=x,C=I-D;E<I;E+=D)_+=(m[C]-m[E])*(m[E+1]+m[C+1]),C=E;return _}(l,e,i,c)>0)for(let m=e;m<i;m+=c)u=yI(m/c|0,l[m],l[m+1],u);else for(let m=i-c;m>=e;m-=c)u=yI(m/c|0,l[m],l[m+1],u);return u&&a_(u,u.next)&&(_p(u),u=u.next),u}function cu(l,e){if(!l)return l;e||(e=l);let i,c=l;do if(i=!1,c.steiner||!a_(c,c.next)&&Fi(c.prev,c,c.next)!==0)c=c.next;else{if(_p(c),c=e=c.prev,c===c.next)break;i=!0}while(i||c!==e);return e}function mp(l,e,i,c,p,u,m){if(!l)return;!m&&u&&function(I,D,_,E){let C=I;do C.z===0&&(C.z=W0(C.x,C.y,D,_,E)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==I);C.prevZ.nextZ=null,C.prevZ=null,function(w){let T,S=1;do{let k,L=w;w=null;let B=null;for(T=0;L;){T++;let V=L,N=0;for(let H=0;H<S&&(N++,V=V.nextZ,V);H++);let G=S;for(;N>0||G>0&&V;)N!==0&&(G===0||!V||L.z<=V.z)?(k=L,L=L.nextZ,N--):(k=V,V=V.nextZ,G--),B?B.nextZ=k:w=k,k.prevZ=B,B=k;L=V}B.nextZ=null,S*=2}while(T>1)}(C)}(l,c,p,u);let x=l;for(;l.prev!==l.next;){let I=l.prev,D=l.next;if(u?mO(l,c,p,u):pO(l))e.push(I.i,l.i,D.i),_p(l),l=D.next,x=D.next;else if((l=D)===x){m?m===1?mp(l=gO(cu(l),e),e,i,c,p,u,2):m===2&&_O(l,e,i,c,p,u):mp(cu(l),e,i,c,p,u,1);break}}}function pO(l){let e=l.prev,i=l,c=l.next;if(Fi(e,i,c)>=0)return!1;let p=e.x,u=i.x,m=c.x,x=e.y,I=i.y,D=c.y,_=p<u?p<m?p:m:u<m?u:m,E=x<I?x<D?x:D:I<D?I:D,C=p>u?p>m?p:m:u>m?u:m,w=x>I?x>D?x:D:I>D?I:D,T=c.next;for(;T!==e;){if(T.x>=_&&T.x<=C&&T.y>=E&&T.y<=w&&jh(p,x,u,I,m,D,T.x,T.y)&&Fi(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function mO(l,e,i,c){let p=l.prev,u=l,m=l.next;if(Fi(p,u,m)>=0)return!1;let x=p.x,I=u.x,D=m.x,_=p.y,E=u.y,C=m.y,w=x<I?x<D?x:D:I<D?I:D,T=_<E?_<C?_:C:E<C?E:C,S=x>I?x>D?x:D:I>D?I:D,k=_>E?_>C?_:C:E>C?E:C,L=W0(w,T,e,i,c),B=W0(S,k,e,i,c),V=l.prevZ,N=l.nextZ;for(;V&&V.z>=L&&N&&N.z<=B;){if(V.x>=w&&V.x<=S&&V.y>=T&&V.y<=k&&V!==p&&V!==m&&jh(x,_,I,E,D,C,V.x,V.y)&&Fi(V.prev,V,V.next)>=0||(V=V.prevZ,N.x>=w&&N.x<=S&&N.y>=T&&N.y<=k&&N!==p&&N!==m&&jh(x,_,I,E,D,C,N.x,N.y)&&Fi(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;V&&V.z>=L;){if(V.x>=w&&V.x<=S&&V.y>=T&&V.y<=k&&V!==p&&V!==m&&jh(x,_,I,E,D,C,V.x,V.y)&&Fi(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;N&&N.z<=B;){if(N.x>=w&&N.x<=S&&N.y>=T&&N.y<=k&&N!==p&&N!==m&&jh(x,_,I,E,D,C,N.x,N.y)&&Fi(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function gO(l,e){let i=l;do{let c=i.prev,p=i.next.next;!a_(c,p)&&gI(c,i,i.next,p)&&gp(c,p)&&gp(p,c)&&(e.push(c.i,i.i,p.i),_p(i),_p(i.next),i=l=p),i=i.next}while(i!==l);return cu(i)}function _O(l,e,i,c,p,u){let m=l;do{let x=m.next.next;for(;x!==m.prev;){if(m.i!==x.i&&wO(m,x)){let I=_I(m,x);return m=cu(m,m.next),I=cu(I,I.next),mp(m,e,i,c,p,u,0),void mp(I,e,i,c,p,u,0)}x=x.next}m=m.next}while(m!==l)}function yO(l,e){return l.x-e.x}function vO(l,e){let i=function(p,u){let m=u,x=p.x,I=p.y,D,_=-1/0;do{if(I<=m.y&&I>=m.next.y&&m.next.y!==m.y){let S=m.x+(I-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(S<=x&&S>_&&(_=S,D=m.x<m.next.x?m:m.next,S===x))return D}m=m.next}while(m!==u);if(!D)return null;let E=D,C=D.x,w=D.y,T=1/0;m=D;do{if(x>=m.x&&m.x>=C&&x!==m.x&&jh(I<w?x:_,I,C,w,I<w?_:x,I,m.x,m.y)){let S=Math.abs(I-m.y)/(x-m.x);gp(m,p)&&(S<T||S===T&&(m.x>D.x||m.x===D.x&&xO(D,m)))&&(D=m,T=S)}m=m.next}while(m!==E);return D}(l,e);if(!i)return e;let c=_I(i,l);return cu(c,c.next),cu(i,i.next)}function xO(l,e){return Fi(l.prev,l,e.prev)<0&&Fi(e.next,l,l.next)<0}function W0(l,e,i,c,p){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-i)*p|0)|l<<8))|l<<4))|l<<2))|l<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function bO(l){let e=l,i=l;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==l);return i}function jh(l,e,i,c,p,u,m,x){return(p-m)*(e-x)>=(l-m)*(u-x)&&(l-m)*(c-x)>=(i-m)*(e-x)&&(i-m)*(u-x)>=(p-m)*(c-x)}function wO(l,e){return l.next.i!==e.i&&l.prev.i!==e.i&&!function(i,c){let p=i;do{if(p.i!==i.i&&p.next.i!==i.i&&p.i!==c.i&&p.next.i!==c.i&&gI(p,p.next,i,c))return!0;p=p.next}while(p!==i);return!1}(l,e)&&(gp(l,e)&&gp(e,l)&&function(i,c){let p=i,u=!1,m=(i.x+c.x)/2,x=(i.y+c.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&m<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(u=!u),p=p.next;while(p!==i);return u}(l,e)&&(Fi(l.prev,l,e.prev)||Fi(l,e.prev,e))||a_(l,e)&&Fi(l.prev,l,l.next)>0&&Fi(e.prev,e,e.next)>0)}function Fi(l,e,i){return(e.y-l.y)*(i.x-e.x)-(e.x-l.x)*(i.y-e.y)}function a_(l,e){return l.x===e.x&&l.y===e.y}function gI(l,e,i,c){let p=c_(Fi(l,e,i)),u=c_(Fi(l,e,c)),m=c_(Fi(i,c,l)),x=c_(Fi(i,c,e));return p!==u&&m!==x||!(p!==0||!l_(l,i,e))||!(u!==0||!l_(l,c,e))||!(m!==0||!l_(i,l,c))||!(x!==0||!l_(i,e,c))}function l_(l,e,i){return e.x<=Math.max(l.x,i.x)&&e.x>=Math.min(l.x,i.x)&&e.y<=Math.max(l.y,i.y)&&e.y>=Math.min(l.y,i.y)}function c_(l){return l>0?1:l<0?-1:0}function gp(l,e){return Fi(l.prev,l,l.next)<0?Fi(l,e,l.next)>=0&&Fi(l,l.prev,e)>=0:Fi(l,e,l.prev)<0||Fi(l,l.next,e)<0}function _I(l,e){let i=Z0(l.i,l.x,l.y),c=Z0(e.i,e.x,e.y),p=l.next,u=e.prev;return l.next=e,e.prev=l,i.next=p,p.prev=i,c.next=i,i.prev=c,u.next=c,c.prev=u,c}function yI(l,e,i,c){let p=Z0(l,e,i);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function _p(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Z0(l,e,i){return{i:l,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function u_(l,e){let i=l.length;if(i<=1)return[l];let c=[],p,u;for(let m=0;m<i;m++){let x=$u(l[m]);x!==0&&(l[m].area=Math.abs(x),u===void 0&&(u=x<0),u===x<0?(p&&c.push(p),p=[l[m]]):p.push(l[m]))}if(p&&c.push(p),e>1)for(let m=0;m<c.length;m++)c[m].length<=e||(rg(c[m],e,1,c[m].length-1,EO),c[m]=c[m].slice(0,e));return c}function EO(l,e){return e.area-l.area}function X0(l,e,i){let c=i.patternDependencies,p=!1;for(let u of e){let m=u.paint.get(`${l}-pattern`);m.isConstant()||(p=!0);let x=m.constantOr(null);x&&(p=!0,c[x]=!0)}return p}function Y0(l,e,i,c,p){let u=p.patternDependencies;for(let m of e){let x=m.paint.get(`${l}-pattern`).value;if(x.kind!=="constant"){let I=x.evaluate({zoom:c},i,{},p.availableImages);I=I&&I.name?I.name:I,u[I]=!0,i.patterns[m.id]=I}}return i}class J0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bs,this.indexArray=new si,this.indexArray2=new js,this.programConfigurations=new No(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new pi,this.segments2=new pi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}updateFootprints(e,i){}populate(e,i,c,p){this.hasPattern=X0("fill",this.layers,i);let u=this.layers[0].layout.get("fill-sort-key"),m=[];for(let{feature:x,id:I,index:D,sourceLayerIndex:_}of e){let E=this.layers[0]._featureFilter.needGeometry,C=qe(x,E);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),C,c))continue;let w=u?u.evaluate(C,{},c,i.availableImages):void 0,T={id:I,properties:x.properties,type:x.type,sourceLayerIndex:_,index:D,geometry:E?C.geometry:Ce(x,c,p),patterns:{},sortKey:w};m.push(T)}u&&m.sort((x,I)=>x.sortKey-I.sortKey);for(let x of m){let{geometry:I,index:D,sourceLayerIndex:_}=x;if(this.hasPattern){let E=Y0("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(E)}else this.addFeature(x,I,D,c,{},i.availableImages,i.brightness);i.featureIndex.insert(e[D].feature,I,D,_,this.index)}}update(e,i,c,p,u){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,m?this.stateDependentLayers:this.layers,c,p,u)}addFeatures(e,i,c,p,u,m){for(let x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fO),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,c,p,u,m=[],x){for(let I of u_(i,500)){let D=0;for(let S of I)D+=S.length;let _=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),E=_.vertexLength,C=[],w=[];for(let S of I){if(S.length===0)continue;S!==I[0]&&w.push(C.length/2);let k=this.segments2.prepareSegment(S.length,this.layoutVertexArray,this.indexArray2),L=k.vertexLength;this.layoutVertexArray.emplaceBack(S[0].x,S[0].y),this.indexArray2.emplaceBack(L+S.length-1,L),C.push(S[0].x),C.push(S[0].y);for(let B=1;B<S.length;B++)this.layoutVertexArray.emplaceBack(S[B].x,S[B].y),this.indexArray2.emplaceBack(L+B-1,L+B),C.push(S[B].x),C.push(S[B].y);k.vertexLength+=S.length,k.primitiveLength+=S.length}let T=pp(C,w);for(let S=0;S<T.length;S+=3)this.indexArray.emplaceBack(E+T[S],E+T[S+1],E+T[S+2]);_.vertexLength+=D,_.primitiveLength+=T.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,u,m,p,x)}}let vI,xI,bI,wI;ft(J0,"FillBucket",{omit:["layers","patternFeatures"]});class K0{constructor(e,i,c,p){if(this.triangleCount=i.length/3,this.min=new ot(0,0),this.max=new ot(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[u,m]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){let C=e[E];u.x=Math.min(u.x,C.x),u.y=Math.min(u.y,C.y),m.x=Math.max(m.x,C.x),m.y=Math.max(m.y,C.y)}if(p){let E=Math.ceil(Math.max(m.x-u.x,m.y-u.y)/p);c=Math.max(c,E)}if(c===0)return;this.min=u,this.max=m;let x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);let I=Math.max(x.x,x.y)/c;this.cellsX=Math.max(1,Math.ceil(x.x/I)),this.cellsY=Math.max(1,Math.ceil(x.y/I)),this.xScale=1/I,this.yScale=1/I;let D=[];for(let E=0;E<this.triangleCount;E++){let C=e[i[3*E+0]].sub(this.min),w=e[i[3*E+1]].sub(this.min),T=e[i[3*E+2]].sub(this.min),S=$s(Math.floor(Math.min(C.x,w.x,T.x)),this.xScale,this.cellsX),k=$s(Math.floor(Math.max(C.x,w.x,T.x)),this.xScale,this.cellsX),L=$s(Math.floor(Math.min(C.y,w.y,T.y)),this.yScale,this.cellsY),B=$s(Math.floor(Math.max(C.y,w.y,T.y)),this.yScale,this.cellsY),V=new ot(0,0),N=new ot(0,0),G=new ot(0,0),H=new ot(0,0);for(let J=L;J<=B;++J){V.y=N.y=J*I,G.y=H.y=(J+1)*I;for(let se=S;se<=k;++se)V.x=G.x=se*I,N.x=H.x=(se+1)*I,(In(C,w,T,V,N,H)||In(C,w,T,V,H,G))&&D.push({cellIdx:J*this.cellsX+se,triIdx:E})}}if(D.length===0)return;D.sort((E,C)=>E.cellIdx-C.cellIdx||E.triIdx-C.triIdx);let _=0;for(;_<D.length;){let E=D[_].cellIdx,C={start:this.payload.length,len:0};for(;_<D.length&&D[_].cellIdx===E;)++C.len,this.payload.push(D[_++].triIdx);this.cells[E]=C}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;let c=$s(e.x-this.min.x,this.xScale,this.cellsX),p=$s(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[p*this.cellsX+c];if(u){this._lazyInitLookup();for(let m=0;m<u.len;m++){let x=this.payload[u.start+m],I=Math.floor(x/8),D=1<<x%8;if(!(this.lookup[I]&D)&&(this.lookup[I]|=D,i.push(x),i.length===this.triangleCount))return}}}query(e,i,c){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();let p=$s(e.x-this.min.x,this.xScale,this.cellsX),u=$s(i.x-this.min.x,this.xScale,this.cellsX),m=$s(e.y-this.min.y,this.yScale,this.cellsY),x=$s(i.y-this.min.y,this.yScale,this.cellsY);for(let I=m;I<=x;I++)for(let D=p;D<=u;D++){let _=this.cells[I*this.cellsX+D];if(_)for(let E=0;E<_.len;E++){let C=this.payload[_.start+E],w=Math.floor(C/8),T=1<<C%8;if(!(this.lookup[w]&T)&&(this.lookup[w]|=T,c.push(C),c.length===this.triangleCount))return}}}}function $s(l,e,i){return Math.max(0,Math.min(i-1,Math.floor(l*e)))}ft(K0,"TriangleGridIndex");class EI{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(let c of this.footprints)i.push({footprint:c,id:e})}populate(e,i,c,p){let u=[];for(let{feature:m,id:x,index:I,sourceLayerIndex:D}of e){let _=this.layers[0]._featureFilter.needGeometry,E=qe(m,_);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),E,c))continue;let C={id:x,properties:m.properties,type:m.type,sourceLayerIndex:D,index:I,geometry:_?E.geometry:Ce(m,c,p),patterns:{}};u.push(C)}for(let m of u){let{geometry:x,index:I,sourceLayerIndex:D}=m;this.addFeature(m,x,I,c,{},i.availableImages,i.brightness),i.featureIndex.insert(e[I].feature,x,I,D,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,c,p,u){}destroy(){}addFeature(e,i,c,p,u,m=[],x){for(let I of u_(i,2)){let D=[],_=[],E=[],C=new ot(1/0,1/0),w=new ot(-1/0,-1/0);for(let k of I)if(k.length!==0){k!==I[0]&&E.push(_.length/2);for(let L=0;L<k.length;L++)_.push(k[L].x),_.push(k[L].y),D.push(k[L]),C.x=Math.min(C.x,k[L].x),C.y=Math.min(C.y,k[L].y),w.x=Math.max(w.x,k[L].x),w.y=Math.max(w.y,k[L].y)}let T=pp(_,E),S=new K0(D,T,8,256);this.footprints.push({vertices:D,indices:T,grid:S,min:C,max:w})}}}ft(EI,"ClipBucket",{omit:["layers"]});let IO=wn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),TO=wn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),CO=wn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),DO=wn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),MO=wn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),SO=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:AO}=IO;var Q0,II,ex,TI,tx,CI,DI,h_={};function MI(){if(II)return Q0;II=1;var l=Ec();function e(p,u,m,x,I){this.properties={},this.extent=m,this.type=0,this._pbf=p,this._geometry=-1,this._keys=x,this._values=I,p.readFields(i,this,u)}function i(p,u,m){p==1?u.id=m.readVarint():p==2?function(x,I){for(var D=x.readVarint()+x.pos;x.pos<D;){var _=I._keys[x.readVarint()],E=I._values[x.readVarint()];I.properties[_]=E}}(m,u):p==3?u.type=m.readVarint():p==4&&(u._geometry=m.pos)}function c(p){for(var u,m,x=0,I=0,D=p.length,_=D-1;I<D;_=I++)x+=((m=p[_]).x-(u=p[I]).x)*(u.y+m.y);return x}return Q0=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var u,m=p.readVarint()+p.pos,x=1,I=0,D=0,_=0,E=[];p.pos<m;){if(I<=0){var C=p.readVarint();x=7&C,I=C>>3}if(I--,x===1||x===2)D+=p.readSVarint(),_+=p.readSVarint(),x===1&&(u&&E.push(u),u=[]),u.push(new l(D,_));else{if(x!==7)throw new Error("unknown command "+x);u&&u.push(u[0].clone())}}return u&&E.push(u),E},e.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var u=p.readVarint()+p.pos,m=1,x=0,I=0,D=0,_=1/0,E=-1/0,C=1/0,w=-1/0;p.pos<u;){if(x<=0){var T=p.readVarint();m=7&T,x=T>>3}if(x--,m===1||m===2)(I+=p.readSVarint())<_&&(_=I),I>E&&(E=I),(D+=p.readSVarint())<C&&(C=D),D>w&&(w=D);else if(m!==7)throw new Error("unknown command "+m)}return[_,C,E,w]},e.prototype.toGeoJSON=function(p,u,m){var x,I,D=this.extent*Math.pow(2,m),_=this.extent*p,E=this.extent*u,C=this.loadGeometry(),w=e.types[this.type];function T(L){for(var B=0;B<L.length;B++){var V=L[B];L[B]=[360*(V.x+_)/D-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+E)/D)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(x=0;x<C.length;x++)S[x]=C[x][0];T(C=S);break;case 2:for(x=0;x<C.length;x++)T(C[x]);break;case 3:for(C=function(L){var B=L.length;if(B<=1)return[L];for(var V,N,G=[],H=0;H<B;H++){var J=c(L[H]);J!==0&&(N===void 0&&(N=J<0),N===J<0?(V&&G.push(V),V=[L[H]]):V.push(L[H]))}return V&&G.push(V),G}(C),x=0;x<C.length;x++)for(I=0;I<C[x].length;I++)T(C[x][I])}C.length===1?C=C[0]:w="Multi"+w;var k={type:"Feature",geometry:{type:w,coordinates:C},properties:this.properties};return"id"in this&&(k.id=this.id),k},Q0}function SI(){if(TI)return ex;TI=1;var l=MI();function e(c,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(i,this,p),this.length=this._features.length}function i(c,p,u){c===15?p.version=u.readVarint():c===1?p.name=u.readString():c===5?p.extent=u.readVarint():c===2?p._features.push(u.pos):c===3?p._keys.push(u.readString()):c===4&&p._values.push(function(m){for(var x=null,I=m.readVarint()+m.pos;m.pos<I;){var D=m.readVarint()>>3;x=D===1?m.readString():D===2?m.readFloat():D===3?m.readDouble():D===4?m.readVarint64():D===5?m.readVarint():D===6?m.readSVarint():D===7?m.readBoolean():null}return x}(u))}return ex=e,e.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var p=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,p,this.extent,this._keys,this._values)},ex}function AI(){return DI||(DI=1,h_.VectorTile=function(){if(CI)return tx;CI=1;var l=SI();function e(i,c,p){if(i===3){var u=new l(p,p.readVarint()+p.pos);u.length&&(c[u.name]=u)}}return tx=function(i,c){this.layers=i.readFields(e,{},c)},tx}(),h_.VectorTileFeature=MI(),h_.VectorTileLayer=SI()),h_}var Uh=AI();class uu extends ot{constructor(e,i,c){super(e,i),this.z=c}}class RI extends uu{constructor(e,i,c,p){super(e,i,c),this.w=p}}function d_(l,e,i,c){let p=[],u=c===0?(m,x,I,D,_,E)=>{m.push(new ot(E,I+(E-x)/(D-x)*(_-I)))}:(m,x,I,D,_,E)=>{m.push(new ot(x+(E-I)/(_-I)*(D-x),E))};for(let m of l){let x=[];for(let I of m){if(I.length<=2)continue;let D=[];for(let C=0;C<I.length-1;C++){let w=I[C].x,T=I[C].y,S=I[C+1].x,k=I[C+1].y,L=c===0?w:T,B=c===0?S:k;L<e?B>e&&u(D,w,T,S,k,e):L>i?B<i&&u(D,w,T,S,k,i):D.push(I[C]),B<e&&L>=e&&u(D,w,T,S,k,e),B>i&&L<=i&&u(D,w,T,S,k,i)}let _=I[I.length-1],E=c===0?_.x:_.y;E>=e&&E<=i&&D.push(_),D.length&&(_=D[D.length-1],D[0].x===_.x&&D[0].y===_.y||D.push(D[0]),x.push(D))}x.length&&p.push(x)}return p}function PI(l,e,i,c){let p=i==="x"?"y":"x",u=(c-l[i])/(e[i]-l[i]);l[p]=l[p]+(e[p]-l[p])*u,l[i]=c,l.hasOwnProperty("z")&&(l.z=Rt(l.z,e.z,u)),l.hasOwnProperty("w")&&(l.w=Rt(l.w,e.w,u))}function OI(l,e,i,c){let p=i,u=c;for(let m of["x","y"]){let x=l,I=e;x[m]>=I[m]&&(x=e,I=l),x[m]<p&&I[m]>p&&PI(x,I,m,p),x[m]<u&&I[m]>u&&PI(I,x,m,u)}}let f_=Number.MAX_SAFE_INTEGER;function kI(l,e,i,c){return l.order<e||l.order===f_||!(l.clipMask&i)||function(p,u){return u.length!==0&&u.find(m=>m===p)===void 0}(c,l.clipScope)}function p_(l,e){return l.x-e.x||l.y-e.y}function LI(l,e){return p_(l.min,e.min)===0&&p_(l.max,e.max)===0}function nx(l,e){return!(l.min.x>e.max.x||l.max.x<e.min.x||l.min.y>e.max.y||l.max.y<e.min.y)}function ix(l,e){if(l.length!==e.length)return!1;for(let i=0;i<l.length;i++)if(l[i].sourceId!==e[i].sourceId||!LI(l[i],e[i])||l[i].order!==e[i].order||l[i].clipMask!==e[i].clipMask||!ca(l[i].clipScope,e[i].clipScope))return!1;return!0}function FI(l,e,i){let c=1/st,p=1/(1<<i.canonical.z),u=(e.x*c+i.canonical.x)*p+i.wrap,m=(e.y*c+i.canonical.y)*p;return{min:new ot((l.x*c+i.canonical.x)*p+i.wrap,(l.y*c+i.canonical.y)*p),max:new ot(u,m)}}function RO(l,e,i){let c=1<<i.canonical.z,p=((e.x-i.wrap)*c-i.canonical.x)*st,u=(e.y*c-i.canonical.y)*st;return{min:new ot(((l.x-i.wrap)*c-i.canonical.x)*st,(l.y*c-i.canonical.y)*st),max:new ot(p,u)}}function NI(l,e,i,c,p,u,m){let x=l.indices,I=l.vertices,D=[];for(let _=c;_<c+p;_+=3){let E=e[i[_+0]+u],C=e[i[_+1]+u],w=e[i[_+2]+u],T=Math.min(E.x,C.x,w.x),S=Math.max(E.x,C.x,w.x),k=Math.min(E.y,C.y,w.y),L=Math.max(E.y,C.y,w.y);D.length=0,l.grid.query(new ot(T,k),new ot(S,L),D);for(let B=0;B<D.length;B++){let V=D[B];if(In(I[x[3*V+0]],I[x[3*V+1]],I[x[3*V+2]],E,C,w,m))return!0}}return!1}function zI(l,e,i,c){if(!l||!i)return!1;let p=l.vertices;if(!e.canonical.equals(c.canonical)||e.wrap!==c.wrap){if(i.vertices.length<l.vertices.length)return zI(i,c,l,e);let u=e.canonical,m=c.canonical,x=Math.pow(2,m.z-u.z);p=l.vertices.map(I=>new ot((I.x+u.x*st)*x-m.x*st,(I.y+u.y*st)*x-m.y*st))}return NI(i,p,l.indices,0,l.indices.length,0,0)}function BI(l,e,i,c){let p=Math.pow(2,c.z-i.z);return new ot((l+i.x*st)*p-c.x*st,(e+i.y*st)*p-c.y*st)}function VI(l,e){let i=[];e.grid.queryPoint(l,i);let c=e.indices,p=e.vertices;for(let u=0;u<i.length;u++){let m=i[u];if(cn([p[c[3*m+0]],p[c[3*m+1]],p[c[3*m+2]]],l))return!0}return!1}let rx=[new ot(0,0),new ot(st,0),new ot(st,st),new ot(0,st)];function jI(l,e){let i=[],c=[];if(!e||l.length<2)return[l];if(l.length===2)return vn(l[0],l[1],rx)?[l]:[];for(let p=0;p<l.length+2;p++){let u=l[p%l.length],m=l[(p+1)%l.length],x=vn(p===0?l[l.length-1]:l[(p-1)%l.length],u,rx),I=vn(u,m,rx),D=x||I;D&&c.push(u),D&&I||c.length>0&&(c.length>1&&i.push(c),c=[])}return c.length>1&&i.push(c),i}let ox=Uh.VectorTileFeature.types,PO=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],OO=["fill-extrusion-flood-light-ground-radius"],kO=Math.pow(2,13),LO=Math.pow(2,15)-1,UI=new ot(0,1),Ul=2147483648;function yp(l,e,i,c,p,u,m,x){l.emplaceBack((e<<1)+m,(i<<1)+u,(Math.floor(c*kO)<<1)+p,Math.round(x))}function vp(l,e,i){l.emplaceBack(e.x*st,e.y*st,i?1:0)}function m_(l,e,i,c,p,u){l.emplaceBack(e.x,e.y,(i.x<<1)+c,(i.y<<1)+p,u)}function xp(l,e,i){l.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class $I{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class GI{constructor(){this.centroidXY=new ot(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ot(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ot(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new ot(this.max.x-this.min.x,this.max.y-this.min.y)}}class HI{constructor(){this.acc=new ot(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,c){this.accCount++,this.acc._add(i);let p=!!this.borders;i.x<e.min.x?(e.min.x=i.x,p=!0):i.x>e.max.x&&(e.max.x=i.x,p=!0),i.y<e.min.y?(e.min.y=i.y,p=!0):i.y>e.max.y&&(e.max.y=i.y,p=!0),((i.x===0||i.x===st)&&i.x===c.x)!=((i.y===0||i.y===st)&&i.y===c.y)&&this.processBorderOverlap(i,c),p&&this.checkBorderIntersection(i,c)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Rt(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>st!=e.x>st&&this.addBorderIntersection(1,Rt(i.y,e.y,(st-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Rt(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>st!=e.y>st&&this.addBorderIntersection(3,Rt(i.x,e.x,(st-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let c=this.borders[e];i<c[0]&&(c[0]=i),i>c[1]&&(c[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;let c=e.x===0?0:1;this.addBorderIntersection(c,i.y),this.addBorderIntersection(c,e.y)}else{let c=e.y===0?2:3;this.addBorderIntersection(c,i.x),this.addBorderIntersection(c,e.x)}}centroid(){return this.accCount===0?new ot(0,0):new ot(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function qI(l,e){let i=l.add(e)._unit(),c=jt(l.x*i.x+l.y*i.y,-1,1);var p,u,m;return m=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(m)))/4*LO*((p=l).x*(u=e).y-p.y*u.x<0?-1:1)}let FO=[l=>l.x<0,l=>l.x>st,l=>l.y<0,l=>l.y>st];function NO(l,e,i,c){let p=[4];if(c===0)return p;i._mult(c);let u=l.sub(i),m=e.sub(i),x=[l,e,u,m];for(let I=0;I<4;I++)for(let D of x)if(FO[I](D)){p.push(I);break}return p}class WI{constructor(e){this.vertexArray=new Jf,this.indexArray=new si,this.programConfigurations=new No(e.layers,{zoom:e.zoom,lut:e.lut},i=>OO.includes(i)),this._segments=new pi,this.hiddenByLandmarkVertexArray=new Lh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new pi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,c,p=!1){let u=e.length;if(u>2){let m=Math.max(0,this._segments.get().length-1),x=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[m].length),I;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{let D=e[0],_=e[1];I=qI(D.sub(e[u-1])._perp()._unit(),_.sub(D)._perp()._unit())}for(let D=0;D<u;D++){let _=D===u-1?0:D+1,E=e[D],C=e[_],w=e[_===u-1?0:_+1],T=C.sub(E)._perp()._unit(),S=qI(T,w.sub(C)._perp()._unit()),k=I,L=S;if(sx(E,C,i)||p&&YI(E,i)&&YI(C,i)){I=S;continue}let B=x.vertexLength;m_(this.vertexArray,E,C,1,1,k),m_(this.vertexArray,E,C,1,0,k),m_(this.vertexArray,E,C,0,1,L),m_(this.vertexArray,E,C,0,0,L),x.vertexLength+=4;let V=NO(E,C,T,c);for(let N of V)this._segmentToGroundQuads[m].push({id:B,region:N}),this._segmentToRegionTriCounts[m][N]+=2,x.primitiveLength+=2;I=S}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),i=e.length;for(let c=0;c<i;c++)this._segmentToGroundQuads[c].sort((p,u)=>p.region-u.region);for(let c=0;c<i;c++){let p=this._segmentToGroundQuads[c],u=e[c],m=this._segmentToRegionTriCounts[c];m.reduce((I,D)=>I+D,0);let x=0;for(let I=0;I<=4;I++){let D=m[I];if(D!==0){let _=this.regionSegments[I];_||(_=this.regionSegments[I]=new pi);let E={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+x,vertexLength:u.vertexLength,primitiveLength:D};_.get().push(E)}x+=D}for(let I=0;I<p.length;I++){let D=p[I].id;this.indexArray.emplaceBack(D,D+1,D+3),this.indexArray.emplaceBack(D,D+3,D+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,c,p,u,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,c,p,u,m)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,TO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,c,p,u,m){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,c,p,u,m)}updateHiddenByLandmark(e){if(!this.hasData())return;let i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let c=e.flags&Ul?1:0;for(let p=e.groundVertexArrayOffset;p<i;++p)this.hiddenByLandmarkVertexArray.emplace(p,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,MO.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let i=this.regionSegments[e];i&&i.destroy()}}}}class g_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new si,this.footprintVertices=new Bs,this.footprintSegments=[],this.layoutVertexArray=new Al,this.centroidVertexArray=new Yg,this.wallVertexArray=new sp,this.indexArray=new si,this.programConfigurations=new No(e.layers,{zoom:e.zoom,lut:e.lut},i=>PO.includes(i)),this.segments=new pi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new WI(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,c,p){this.features=[],this.hasPattern=X0("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=ge(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(let{feature:u,id:m,index:x,sourceLayerIndex:I}of e){let D=this.layers[0]._featureFilter.needGeometry,_=qe(u,D);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),_,c))continue;let E={id:m,sourceLayerIndex:I,index:x,geometry:D?_.geometry:Ce(u,c,p),properties:u.properties,type:u.type,patterns:{}},C=this.layoutVertexArray.length,w=ox[E.type]==="Polygon";if(this.hasPattern)this.features.push(Y0("fill-extrusion",this.layers,E,this.zoom,i));else if(this.wallMode)for(let T of E.geometry)for(let S of jI(T,w))this.addFeature(E,[S],x,c,{},i.availableImages,p,i.brightness);else this.addFeature(E,E.geometry,x,c,{},i.availableImages,p,i.brightness);i.featureIndex.insert(u,E.geometry,x,I,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,c,p,u,m){for(let x of this.features){let I=ox[x.type]==="Polygon",{geometry:D}=x;if(this.wallMode)for(let _ of D)for(let E of jI(_,I))this.addFeature(x,[E],x.index,i,c,p,u,m);else this.addFeature(x,D,x.index,i,c,p,u,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,c,p,u){let m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;let x=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,x,c,p,u),this.groundEffect.update(e,i,x,c,p,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,AO),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,DO.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,SO.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,CO.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,c,p,u,m,x,I){let D=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,_=[new ot(0,0),new ot(st,st)],E=x.projection,C=E.name==="globe",w=this.wallMode||ox[e.type]==="Polygon",T=new HI;T.centroidDataIndex=this.centroidData.length;let S=new GI,k=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},p)<=0,L=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},p),B;if(S.height=L,S.vertexArrayOffset=this.layoutVertexArray.length,S.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new eu),this.wallMode){if(C)return void fn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;B=function(ne){let me=ne[0].x===ne[ne.length-1].x&&ne[0].y===ne[ne.length-1].y;(function(et){let Ye=0,It=et.length;for(let ht=0;ht<It;ht++)Ye+=(et[(ht+1)%It].x-et[ht].x)*(et[(ht+1)%It].y+et[ht].y);return Ye>=0})(ne)||(ne=ne.reverse());let de={geometry:[],joinNormals:[],indices:[]},ve=[],xe=[],Ie=[],Ae=ne.length;if(Ae<(me?3:2))return de;for(;Ae>=2&&ne[Ae-1].equals(ne[Ae-2]);)Ae--;let Pe,De,$e,Je,ze,dt=0;for(;dt<Ae-1&&ne[dt].equals(ne[dt+1]);)dt++;me&&(Pe=ne[Ae-2],ze=ne[dt].sub(Pe)._unit()._perp());for(let et=dt;et<Ae;et++){if($e=et===Ae-1?me?ne[dt+1]:void 0:ne[et+1],$e&&ne[et].equals($e))continue;ze&&(Je=ze),Pe&&(De=Pe),Pe=ne[et],ze=$e?$e.sub(Pe)._unit()._perp():Je,Je=Je||ze;let Ye=Je.add(ze);Ye.x===0&&Ye.y===0||Ye._unit();let It=Ye.x*ze.x+Ye.y*ze.y,ht=It!==0?1/It:1/0,mt=Je.x*ze.y-Je.y*ze.x>0,Vt="miter",Xt=2;Vt==="miter"&&ht>Xt&&(Vt="bevel"),Vt==="bevel"&&(ht>100&&(Vt="flipbevel"),ht<Xt&&(Vt="miter"));let Jt=(qt,rn,tn,Wn)=>{let zn=new ot(qt.x,qt.y),Pt=new ot(qt.x,qt.y);zn.x+=rn.x*Wn,zn.y+=rn.y*Wn,Pt.x-=rn.x*Math.max(tn,1),Pt.y-=rn.y*Math.max(tn,1),Ie.push(rn),ve.push(zn),xe.push(Pt)};if(Vt==="miter")Ye._mult(ht),Jt(Pe,Ye,0,0);else if(Vt==="flipbevel")Ye=ze.mult(-1),Jt(Pe,Ye,0,0),Jt(Pe,Ye.mult(-1),0,0);else{let qt=-Math.sqrt(ht*ht-1),rn=mt?qt:0,tn=mt?0:qt;De&&Jt(Pe,Je,rn,tn),$e&&Jt(Pe,ze,rn,tn)}}de.geometry=[...ve,...xe.reverse(),ve[0]],de.joinNormals=[...Ie,...Ie.reverse(),Ie[Ie.length-1]];let it=de.geometry.length-1;for(let et=0;et<it/2;et++)if(et+1<it/2){let Ye=et,It=et+1,ht=it-1-et,mt=it-2-et;Ye=Ye===0?it-1:Ye-1,It=It===0?it-1:It-1,ht=ht===0?it-1:ht-1,mt=mt===0?it-1:mt-1,de.indices.push(ht),de.indices.push(It),de.indices.push(Ye),de.indices.push(ht),de.indices.push(mt),de.indices.push(It)}return de}(i[0]),i=[B.geometry]}let V=(ne,me)=>ne<(me.length-1)/2||ne===me.length-1,N=this.wallMode?[i]:u_(i,500);for(let ne=N.length-1;ne>=0;ne--){let me=N[ne];(me.length===0||(G=me[0]).every(te=>te.x<=0)||G.every(te=>te.x>=st)||G.every(te=>te.y<=0)||G.every(te=>te.y>=st))&&N.splice(ne,1)}var G;let H;if(C)H=eT(N,_,p);else{H=[];for(let ne of N)H.push({polygon:ne,bounds:_})}let J=w?this.edgeRadius:0,se=J>0&&this.zoom<17,ee=(ne,me)=>{if(ne.length===0)return!1;let te=ne[ne.length-1];return me.x===te.x&&me.y===te.y};for(let{polygon:ne,bounds:me}of H){let te=0,de=0;for(let Ae of ne)w&&!Ae[0].equals(Ae[Ae.length-1])&&Ae.push(Ae[0]),de+=w?Ae.length-1:Ae.length;let ve=this.segments.prepareSegment((w?5:4)*de,this.layoutVertexArray,this.indexArray);S.footprintSegIdx<0&&(S.footprintSegIdx=this.footprintSegments.length),S.polygonSegIdx<0&&(S.polygonSegIdx=this.polygonSegments.length);let xe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ie=new $I;if(Ie.vertexOffset=this.footprintVertices.length,Ie.indexOffset=3*this.footprintIndices.length,Ie.ringIndices=[],w){let Ae=[],Pe=[];te=ve.vertexLength;for(let $e=0;$e<ne.length;$e++){let Je=ne[$e];Je.length&&$e!==0&&Pe.push(Ae.length/2);let ze=[],dt,it;dt=Je[1].sub(Je[0])._perp()._unit(),Ie.ringIndices.push(Je.length-1);for(let et=1;et<Je.length;et++){let Ye=Je[et],It=Je[et===Je.length-1?1:et+1],ht=Ye.clone();if(J){it=It.sub(Ye)._perp()._unit();let mt=dt.add(it)._unit(),Vt=J*Math.min(4,1/(dt.x*mt.x+dt.y*mt.y));ht.x+=Vt*mt.x,ht.y+=Vt*mt.y,ht.x=Math.round(ht.x),ht.y=Math.round(ht.y),dt=it}if(!k||J!==0&&!se||ee(ze,ht)||ze.push(ht),yp(this.layoutVertexArray,ht.x,ht.y,0,0,1,1,0),this.wallMode){let mt=V(et,Je);vp(this.wallVertexArray,B.joinNormals[et],!mt)}ve.vertexLength++,this.footprintVertices.emplaceBack(Ye.x,Ye.y),Ae.push(Ye.x,Ye.y),C&&xp(this.layoutVertexExtArray,E.projectTilePoint(ht.x,ht.y,p),E.upVector(p,ht.x,ht.y))}k&&(J===0||se)&&(ze.length!==0&&ee(ze,ze[0])&&ze.pop(),this.groundEffect.addData(ze,me,D))}let De=this.wallMode?B.indices:pp(Ae,Pe);for(let $e=0;$e<De.length;$e+=3)this.footprintIndices.emplaceBack(Ie.vertexOffset+De[$e+0],Ie.vertexOffset+De[$e+1],Ie.vertexOffset+De[$e+2]),this.indexArray.emplaceBack(te+De[$e],te+De[$e+2],te+De[$e+1]),ve.primitiveLength++;Ie.indexCount+=De.length,Ie.vertexCount+=this.footprintVertices.length-Ie.vertexOffset}for(let Ae=0;Ae<ne.length;Ae++){let Pe=ne[Ae];T.startRing(S,Pe[0]);let De=Pe.length>4&&JI(Pe[Pe.length-2],Pe[0],Pe[1]),$e=J?zO(Pe[Pe.length-2],Pe[0],Pe[1],J):0,Je=[],ze,dt,it;dt=Pe[1].sub(Pe[0])._perp()._unit();let et=!0;for(let Ye=1,It=0;Ye<Pe.length;Ye++){let ht=Pe[Ye-1],mt=Pe[Ye],Vt=Pe[Ye===Pe.length-1?1:Ye+1];if(T.appendEdge(S,mt,ht),sx(mt,ht,me)){J&&(dt=Vt.sub(mt)._perp()._unit(),et=!et);continue}let Xt=mt.sub(ht)._perp(),Jt=Xt.x/(Math.abs(Xt.x)+Math.abs(Xt.y)),qt=Xt.y>0?1:0,rn=ht.dist(mt);if(It+rn>32768&&(It=0),J){it=Vt.sub(mt)._perp()._unit();let Pt=XI(ht,mt,Vt,ZI(dt,it),J);isNaN(Pt)&&(Pt=0);let Dn=mt.sub(ht)._unit();ht=ht.add(Dn.mult($e))._round(),mt=mt.add(Dn.mult(-Pt))._round(),$e=Pt,dt=it,k&&this.zoom>=17&&(ee(Je,ht)||Je.push(ht),ee(Je,mt)||Je.push(mt))}let tn=ve.vertexLength,Wn=Pe.length>4&&JI(ht,mt,Vt),zn=KI(It,De,et);if(yp(this.layoutVertexArray,ht.x,ht.y,Jt,qt,0,0,zn),yp(this.layoutVertexArray,ht.x,ht.y,Jt,qt,0,1,zn),this.wallMode){let Pt=V(Ye-1,Pe),Dn=B.joinNormals[Ye-1];vp(this.wallVertexArray,Dn,Pt),vp(this.wallVertexArray,Dn,Pt)}if(It+=rn,zn=KI(It,Wn,!et),De=Wn,yp(this.layoutVertexArray,mt.x,mt.y,Jt,qt,0,0,zn),yp(this.layoutVertexArray,mt.x,mt.y,Jt,qt,0,1,zn),this.wallMode){let Pt=V(Ye,Pe),Dn=B.joinNormals[Ye];vp(this.wallVertexArray,Dn,Pt),vp(this.wallVertexArray,Dn,Pt)}if(ve.vertexLength+=4,this.indexArray.emplaceBack(tn+0,tn+1,tn+2),this.indexArray.emplaceBack(tn+1,tn+3,tn+2),ve.primitiveLength+=2,J){let Pt=te+(Ye===1?Pe.length-2:Ye-2),Dn=Ye===1?te:Pt+1;if(this.indexArray.emplaceBack(tn+1,Pt,tn+3),this.indexArray.emplaceBack(Pt,Dn,tn+3),ve.primitiveLength+=2,ze===void 0&&(ze=tn),!sx(Vt,Pe[Ye],me)){let Rn=Ye===Pe.length-1?ze:ve.vertexLength;this.indexArray.emplaceBack(tn+2,tn+3,Rn),this.indexArray.emplaceBack(tn+3,Rn+1,Rn),this.indexArray.emplaceBack(tn+3,Dn,Rn+1),ve.primitiveLength+=3}et=!et}if(C){let Pt=this.layoutVertexExtArray,Dn=E.projectTilePoint(ht.x,ht.y,p),Rn=E.projectTilePoint(mt.x,mt.y,p),ri=E.upVector(p,ht.x,ht.y),yi=E.upVector(p,mt.x,mt.y);xp(Pt,Dn,ri),xp(Pt,Dn,ri),xp(Pt,Rn,yi),xp(Pt,Rn,yi)}}w&&(te+=Pe.length-1),k&&J&&this.zoom>=17&&(Je.length!==0&&ee(Je,Je[0])&&Je.pop(),this.groundEffect.addData(Je,me,D,J>0))}this.footprintSegments.push(Ie),xe.triangleCount=this.indexArray.length-xe.triangleArrayOffset,this.polygonSegments.push(xe),++S.footprintSegLen,++S.polygonSegLen}if(S.vertexCount=this.layoutVertexArray.length-S.vertexArrayOffset,S.groundVertexCount=this.groundEffect.vertexArray.length-S.groundVertexArrayOffset,S.vertexCount!==0){if(S.centroidXY=T.borders?UI:this.encodeCentroid(T,S),this.centroidData.push(S),T.borders){this.featuresOnBorder.push(T);let ne=this.featuresOnBorder.length-1;for(let me=0;me<T.borders.length;me++)T.borders[me][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[me].push(ne)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,u,m,p,I),this.groundEffect.addPaintPropertiesData(e,c,u,m,p,I),this.maxHeight=Math.max(this.maxHeight,L)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,c)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}splitToSubtiles(){let e=[];for(let x=0;x<this.centroidData.length;x++){let I=this.centroidData[x],D=+(I.min.y+I.max.y>st),_=2*D+(+(I.min.x+I.max.x>st)^D);for(let E=0;E<I.polygonSegLen;E++){let C=I.polygonSegIdx+E;e.push({centroidIdx:x,subtile:_,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}let i=new si;e.sort((x,I)=>x.triangleSegmentIdx===I.triangleSegmentIdx?x.subtile-I.subtile:x.triangleSegmentIdx-I.triangleSegmentIdx);let c=0,p=0,u=0;for(let x of e){if(x.triangleSegmentIdx!==c)break;u++}let m=e.length;for(;p!==e.length;){c=e[p].triangleSegmentIdx;let x=0,I=p,D=p;for(let _=I;_<u&&e[_].subtile===x;_++)D++;for(;I!==u;){let _=e[I];x=_.subtile;let E=this.centroidData[_.centroidIdx].min.clone(),C=this.centroidData[_.centroidIdx].max.clone(),w={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let T=I;T<D;T++){let S=e[T],k=this.polygonSegments[S.polygonSegmentIdx],L=this.centroidData[S.centroidIdx].min,B=this.centroidData[S.centroidIdx].max,V=this.indexArray.uint16;for(let N=k.triangleArrayOffset;N<k.triangleArrayOffset+k.triangleCount;N++)i.emplaceBack(V[3*N],V[3*N+1],V[3*N+2]);w.primitiveLength+=k.triangleCount,E.x=Math.min(E.x,L.x),E.y=Math.min(E.y,L.y),C.x=Math.max(C.x,B.x),C.y=Math.max(C.y,B.y)}w.primitiveLength>0&&this.triangleSubSegments.push({segment:w,min:E,max:C}),I=D;for(let T=I;T<u&&e[T].subtile===e[I].subtile;T++)D++}p=u;for(let _=p;_<m&&e[_].triangleSegmentIdx===e[p].triangleSegmentIdx;_++)u++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,c){let p=new pi;if(this.wallMode){for(let S of this.triangleSubSegments)p.segments.push(S.segment);return p}let u=0,m=0,x=1<<e.canonical.z;if(i){let S=i.getMinMaxForTile(e);S&&(u=S.min,m=S.max)}m+=this.maxHeight;let I=e.toUnwrapped(),D,_=[I.canonical.x/x+I.wrap,I.canonical.y/x],E=[(I.canonical.x+1)/x+I.wrap,(I.canonical.y+1)/x],C=(S,k,L)=>[S[0]*(1-L[0])+k[0]*L[0],S[1]*(1-L[1])+k[1]*L[1]],w=[],T=[];for(let S of this.triangleSubSegments){w[0]=S.min.x/st,w[1]=S.min.y/st,T[0]=S.max.x/st,T[1]=S.max.y/st;let k=C(_,E,w),L=C(_,E,T);if(new An([k[0],k[1],u],[L[0],L[1],m]).intersectsPrecise(c)===0){D&&(p.segments.push(D),D=void 0);continue}let B=S.segment;D&&D.vertexOffset!==B.vertexOffset&&(p.segments.push(D),D=void 0),D?(D.vertexLength+=B.vertexLength,D.primitiveLength+=B.primitiveLength):D={vertexOffset:B.vertexOffset,primitiveLength:B.primitiveLength,vertexLength:B.vertexLength,primitiveOffset:B.primitiveOffset,sortKey:void 0,vaos:{}}}return D&&p.segments.push(D),p}encodeCentroid(e,i){let c=e.centroid(),p=i.span(),u=Math.min(7,Math.round(p.x*this.tileToMeter/10)),m=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new ot(jt(c.x,1,st-1)<<3|u,jt(c.y,1,st-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new ot(0,0);let i=e.borders,c=Number.MAX_VALUE;if(i[0][0]!==c||i[1][0]!==c){let p=i[0][0]!==c?0:1;return new ot(6|(i[0][0]!==c?0:65528),(i[p][0]+i[p][1])/2<<3|6)}{let p=i[2][0]!==c?2:3;return new ot((i[p][0]+i[p][1])/2<<3|6,6|(i[2][0]!==c?0:65528))}}showCentroid(e){let i=this.centroidData[e.centroidDataIndex];i.flags&=Ul,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let i=e.vertexArrayOffset,c=e.vertexCount+e.vertexArrayOffset,p=e.flags&Ul?UI:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==p.y||u!==p.x){for(let m=i;m<c;++m)this.centroidVertexArray.emplace(m,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,c){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let p=i.getReplacementRegionsForTile(e.toUnwrapped());if(ix(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let m of this.centroidData)m.flags&=2147483647;let u=[];for(let m of this.activeReplacements){if(m.order<c)continue;let x=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(let I of this.centroidData)if(!(I.flags&Ul||m.min.x>I.max.x||I.min.x>m.max.x||m.min.y>I.max.y||I.min.y>m.max.y))for(let D=0;D<I.footprintSegLen;D++){let _=this.footprintSegments[I.footprintSegIdx+D];if(u.length=0,BO(this.footprintVertices,_.vertexOffset,_.vertexCount,m.footprintTileId.canonical,e.canonical,u),NI(m.footprint,u,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-x)){I.flags|=Ul;break}}}for(let m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,c){let p=!1;for(let u=0;u<c.footprintSegLen;u++){let m=this.footprintSegments[c.footprintSegIdx+u],x=0;for(let I of m.ringIndices){for(let D=x,_=I+x-1;D<I+x;_=D++){let E=this.footprintVertices.int16[2*(D+m.vertexOffset)+0],C=this.footprintVertices.int16[2*(D+m.vertexOffset)+1],w=this.footprintVertices.int16[2*(_+m.vertexOffset)+1];C>i!=w>i&&e<(this.footprintVertices.int16[2*(_+m.vertexOffset)+0]-E)*(i-C)/(w-C)+E&&(p=!p)}x=I}}return p}getHeightAtTileCoord(e,i){let c=Number.NEGATIVE_INFINITY,p=!0,u=4*(e+st)*st+(i+st);if(this.partLookup.hasOwnProperty(u)){let m=this.partLookup[u];return m?{height:m.height,hidden:!!(m.flags&Ul)}:void 0}for(let m of this.centroidData)e>m.max.x||m.min.x>e||i>m.max.y||m.min.y>i||this.footprintContainsPoint(e,i,m)&&m&&m.height>c&&(c=m.height,this.partLookup[u]=m,p=!!(m.flags&Ul));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:p};this.partLookup[u]=void 0}}function ZI(l,e){let i=l.add(e)._unit();return l.x*i.x+l.y*i.y}function zO(l,e,i,c){let p=e.sub(l)._perp()._unit(),u=i.sub(e)._perp()._unit();return XI(l,e,i,ZI(p,u),c)}function XI(l,e,i,c,p){let u=Math.sqrt(1-c*c);return Math.min(l.dist(e)/3,e.dist(i)/3,p*u/c)}function sx(l,e,i){return l.x<i[0].x&&e.x<i[0].x||l.x>i[1].x&&e.x>i[1].x||l.y<i[0].y&&e.y<i[0].y||l.y>i[1].y&&e.y>i[1].y}function YI(l,e){return l.x<e[0].x||l.x>e[1].x||l.y<e[0].y||l.y>e[1].y}function JI(l,e,i){if(l.x<0||l.x>=st||e.x<0||e.x>=st||i.x<0||i.x>=st)return!1;let c=i.sub(e),p=c.perp(),u=l.sub(e);return(c.x*u.x+c.y*u.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(u.x*u.x+u.y*u.y))>-.866&&p.x*u.x+p.y*u.y<0}function KI(l,e,i){let c=e?2|l:-3&l;return i?1|c:-2&c}function QI(){let l=Math.PI/32,e=Math.tan(l),i=A;return i*Math.sqrt(1+2*e*e)-i}function eT(l,e,i){let c=1<<i.z,p=Q(i.x/c),u=Q((i.x+1)/c),m=re(i.y/c),x=re((i.y+1)/c);return function(I,D,_,E,C=0,w){let T=[];if(!I.length||!_||!E)return T;let S=(H,J)=>{for(let se of H)T.push({polygon:se,bounds:J})},k=Math.ceil(Math.log2(_)),L=Math.ceil(Math.log2(E)),B=k-L,V=[];for(let H=0;H<Math.abs(B);H++)V.push(B>0?0:1);for(let H=0;H<Math.min(k,L);H++)V.push(0),V.push(1);let N=I;if(N=d_(N,D[0].y-C,D[1].y+C,1),N=d_(N,D[0].x-C,D[1].x+C,0),!N.length)return T;let G=[];for(V.length?G.push({polygons:N,bounds:D,depth:0}):S(N,D);G.length;){let H=G.pop(),J=H.depth,se=V[J],ee=H.bounds[0],ne=H.bounds[1],me=se===0?ee.x:ee.y,te=se===0?ne.x:ne.y,de=w?w(se,me,te):.5*(me+te),ve=d_(H.polygons,me-C,de+C,se),xe=d_(H.polygons,de-C,te+C,se);if(ve.length){let Ie=[ee,new ot(se===0?de:ne.x,se===1?de:ne.y)];V.length>J+1?G.push({polygons:ve,bounds:Ie,depth:J+1}):S(ve,Ie)}if(xe.length){let Ie=[new ot(se===0?de:ee.x,se===1?de:ee.y),ne];V.length>J+1?G.push({polygons:xe,bounds:Ie,depth:J+1}):S(xe,Ie)}}return T}(l,e,Math.ceil((u-p)/11.25),Math.ceil((m-x)/11.25),1,(I,D,_)=>{if(I===0)return .5*(D+_);{let E=re((i.y+D/st)/c);return(X(.5*(re((i.y+_/st)/c)+E))*c-i.y)*st}})}function BO(l,e,i,c,p,u){let m=Math.pow(2,c.z-p.z);for(let x=0;x<i;x++){let I=l.int16[2*(x+e)+0],D=l.int16[2*(x+e)+1];I=(I+p.x*st)*m-c.x*st,D=(D+p.y*st)*m-c.y*st,u.push(new ot(I,D))}}let tT,nT;function bp(l,e){return l.x*e.x+l.y*e.y}function iT(l,e){if(l.length===1){let i=0,c=e[i++],p;for(;!p||c.equals(p);)if(p=e[i++],!p)return 1/0;for(;i<e.length;i++){let u=e[i],m=l[0],x=p.sub(c),I=u.sub(c),D=m.sub(c),_=bp(x,x),E=bp(x,I),C=bp(I,I),w=bp(D,x),T=bp(D,I),S=_*C-E*E,k=(C*w-E*T)/S,L=(_*T-E*w)/S,B=c.z*(1-k-L)+p.z*k+u.z*L;if(isFinite(B))return B}return 1/0}{let i=1/0;for(let c of e)i=Math.min(i,c.z);return i}}function rT(l,e,i,c,p,u,m,x){let I=m*p.getElevationAt(l,e,!0,!0),D=u[0]!==0,_=D?u[1]===0?m*(u[0]/7-450):m*function(E,C,w){let T=Math.floor(C[0]/8),S=Math.floor(C[1]/8),k=10*(C[0]-8*T),L=10*(C[1]-8*S),B=E.getElevationAt(T,S,!0,!0),V=E.getMeterToDEM(w),N=Math.floor(.5*(k*V-1)),G=Math.floor(.5*(L*V-1)),H=E.tileCoordToPixel(T,S),J=2*N+1,se=2*G+1,ee=function(xe,Ie,Ae,Pe,De){return[xe.getElevationAtPixel(Ie,Ae,!0),xe.getElevationAtPixel(Ie+De,Ae,!0),xe.getElevationAtPixel(Ie,Ae+De,!0),xe.getElevationAtPixel(Ie+Pe,Ae+De,!0)]}(E,H.x-N,H.y-G,J,se),ne=Math.abs(ee[0]-ee[1]),me=Math.abs(ee[2]-ee[3]),te=Math.abs(ee[0]-ee[2])+Math.abs(ee[1]-ee[3]),de=Math.min(.25,.5*V*(ne+me)/J),ve=Math.min(.25,.5*V*te/se);return B+Math.max(de*k,ve*L)}(p,u,x):I;return{base:I+(i===0?-1:i),top:D?Math.max(_+c,I+i+2):I+c}}ft(g_,"FillExtrusionBucket",{omit:["layers","features"]}),ft(GI,"PartData"),ft($I,"FootprintSegment"),ft(HI,"BorderCentroidData"),ft(WI,"GroundEffect");let VO=wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),jO=wn([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:UO}=VO,$O=wn([{name:"a_packed",components:4,type:"Float32"}]),{members:GO}=$O,HO=wn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:qO}=HO;class oT{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new jl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){let c=this.getKey(e,i);return this.positions[c]}trim(){let e=this.width,i=this.height=Tc(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,c){let p=[],u=e.length%2==1?-e[e.length-1]*c:0,m=e[0]*c,x=!0;p.push({left:u,right:m,isDash:x,zeroLength:e[0]===0});let I=e[0];for(let D=1;D<e.length;D++){x=!x;let _=e[D];u=I*c,I+=_,m=I*c,p.push({left:u,right:m,isDash:x,zeroLength:_===0})}return p}addRoundDash(e,i,c){let p=i/2;for(let u=-c;u<=c;u++){let m=this.width*(this.nextRow+c+u),x=0,I=e[x];for(let D=0;D<this.width;D++){D/I.right>1&&(I=e[++x]);let _=Math.abs(D-I.left),E=Math.abs(D-I.right),C=Math.min(_,E),w,T=u/c*(p+1);if(I.isDash){let S=p-Math.abs(T);w=Math.sqrt(C*C+S*S)}else w=p-Math.sqrt(C*C+T*T);this.image.data[m+D]=Math.max(0,Math.min(255,w+128))}}}addRegularDash(e,i){for(let I=e.length-1;I>=0;--I){let D=e[I],_=e[I+1];D.zeroLength?e.splice(I,1):_&&_.isDash===D.isDash&&(_.left=D.left,e.splice(I,1))}let c=e[0],p=e[e.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);let u=this.width*this.nextRow,m=0,x=e[m];for(let I=0;I<this.width;I++){I/x.right>1&&(x=e[++m]);let D=Math.abs(I-x.left),_=Math.abs(I-x.right),E=Math.min(D,_);this.image.data[u+I]=Math.max(0,Math.min(255,(x.isDash?E:-E)+i+128))}}addDash(e,i){let c=this.getKey(e,i);if(this.positions[c])return this.positions[c];let p=i==="round",u=p?7:0,m=2*u+1;if(this.nextRow+m>this.height)return fn("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let _=0;_<e.length;_++)e[_]<0&&(fn("Negative value is found in line dasharray, replacing values with 0"),e[_]=0),x+=e[_];if(x!==0){let _=this.width/x,E=this.getDashRanges(e,this.width,_);p?this.addRoundDash(E,_,u):this.addRegularDash(E,i==="square"?.5*_:0)}let I=this.nextRow+u;this.nextRow+=m;let D={tl:[I,u],br:[x,0]};return this.positions[c]=D,D}}ft(oT,"LineAtlas");let WO=Uh.VectorTileFeature.types,ZO=Math.cos(Math.PI/180*37.5),XO=Math.cos(Math.PI/180*5);class ax{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Qc,this.layoutVertexArray2=new as,this.patternVertexArray=new Vs,this.indexArray=new si,this.programConfigurations=new No(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new pi,this.maxLineLength=0,this.zOffsetVertexArray=new Ll,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:st/64}updateFootprints(e,i){}populate(e,i,c,p){this.hasPattern=X0("line",this.layers,i);let u=this.layers[0].layout.get("line-sort-key");this.hasZOffset=!this.layers[0].isDraped();let m=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&m==="none"&&fn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);let x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&x!==void 0;let I=[];for(let{feature:C,id:w,index:T,sourceLayerIndex:S}of e){let k=this.layers[0]._featureFilter.needGeometry,L=qe(C,k);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),L,c))continue;let B=u?u.evaluate(L,{},c):void 0,V={id:w,properties:C.properties,type:C.type,sourceLayerIndex:S,index:T,geometry:k?L.geometry:Ce(C,c,p),patterns:{},sortKey:B};I.push(V)}u&&I.sort((C,w)=>C.sortKey-w.sortKey);let{lineAtlas:D,featureIndex:_}=i,E=this.addConstantDashes(D);for(let C of I){let{geometry:w,index:T,sourceLayerIndex:S}=C;if(E&&this.addFeatureDashes(C,D),this.hasPattern){let k=Y0("line",this.layers,C,this.zoom,i);this.patternFeatures.push(k)}else this.addFeature(C,w,T,c,D.positions,i.availableImages,i.brightness);_.insert(e[T].feature,w,T,S,this.index)}}addConstantDashes(e){let i=!1;for(let c of this.layers){let p=c.paint.get("line-dasharray").value,u=c.layout.get("line-cap").value;if(p.kind!=="constant"||u.kind!=="constant")i=!0;else{let m=u.value,x=p.value;if(!x)continue;e.addDash(x,m)}}return i}addFeatureDashes(e,i){let c=this.zoom;for(let p of this.layers){let u=p.paint.get("line-dasharray").value,m=p.layout.get("line-cap").value;if(u.kind==="constant"&&m.kind==="constant")continue;let x,I;if(u.kind==="constant"){if(x=u.value,!x)continue}else x=u.evaluate({zoom:c},e);I=m.kind==="constant"?m.value:m.evaluate({zoom:c},e),i.addDash(x,I),e.patterns[p.id]=i.getKey(x,I)}}update(e,i,c,p,u){let m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,m?this.stateDependentLayers:this.layers,c,p,u)}addFeatures(e,i,c,p,u,m){for(let x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,c,p,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,GO)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,qO)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,jO.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,UO),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,c,p,u,m,x){let I=this.layers[0].layout,D=I.get("line-join").evaluate(e,{}),_=I.get("line-cap").evaluate(e,{}),E=I.get("line-miter-limit"),C=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=I.get("line-z-offset").value;for(let w of i)this.addLine(w,e,p,D,_,E,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,u,m,p,x)}addLine(e,i,c,p,u,m,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;let I=p==="none";if(this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let V=0;V<e.length-1;V++)this.totalDistance+=e[V].dist(e[V+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let D=WO[i.type]==="Polygon",_=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let E=0;for(;E<_-1&&e[E].equals(e[E+1]);)E++;if(_<(D?3:2))return;p==="bevel"&&(m=1.05);let C=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray),w,T,S,k,L,B;this.e1=this.e2=-1,D&&(w=e[_-2],L=e[E].sub(w)._unit()._perp());for(let V=E;V<_;V++){if(S=V===_-1?D?e[E+1]:void 0:e[V+1],S&&e[V].equals(S))continue;L&&(k=L),w&&(T=w),w=e[V],B=this.hasZOffset?this.evaluateElevationValue(T?T.dist(w):0):null,L=S?S.sub(w)._unit()._perp():k,k=k||L;let N=T&&S,G=N?p:D||I?"butt":u,H=k.x*L.x+k.y*L.y;if(I){let ve=function(xe){if(xe.patternJoinNone){let Ie=xe.segmentPoints.length/2,Ae=xe.lineSoFar-xe.segmentStart;for(let Pe=0;Pe<Ie;++Pe){let De=xe.segmentPoints[2*Pe+1],$e=Math.round(xe.segmentPoints[2*Pe])+.5+.25*De;xe.patternVertexArray.emplaceBack($e,Ae,xe.segmentStart),xe.patternVertexArray.emplaceBack($e,Ae,xe.segmentStart)}xe.segmentPoints.length=0}xe.e1=xe.e2=-1};if(N&&H<XO){this.updateDistance(T,w),this.addCurrentVertex(w,k,1,1,C,B),ve(this),this.addCurrentVertex(w,L,-1,-1,C,B);continue}if(T){if(!S){this.updateDistance(T,w),this.addCurrentVertex(w,k,1,1,C,B),ve(this);continue}G="miter"}}let J=k.add(L);J.x===0&&J.y===0||J._unit();let se=J.x*L.x+J.y*L.y,ee=se!==0?1/se:1/0,ne=2*Math.sqrt(2-2*se),me=se<ZO&&T&&S,te=k.x*L.y-k.y*L.x>0,de=this.overscaling<=16?15*st/(512*this.overscaling):0;if(N&&G==="round"){if(ee<x)G="miter";else if(ee<=2){let ve=lx(w,-10,st+10);G=this.hasZOffset&&(ve||this.hasCrossSlope)?"miter":"fakeround"}}if(G==="miter"&&ee>m&&(G="bevel"),G==="bevel"&&(ee>2&&(G="flipbevel"),ee<m&&(G="miter")),T&&!(G==="miter"&&me)&&this.updateDistance(T,w),G==="miter")if(me){let ve=w.dist(T);if(ve>2*de){let Ie=w.sub(w.sub(T)._mult(de/ve)._round());this.updateDistance(T,Ie),this.addCurrentVertex(Ie,k,0,0,C,B),T=Ie}this.updateDistance(T,w),J._mult(ee),this.addCurrentVertex(w,J,0,0,C,B);let xe=w.dist(S);if(xe>2*de){let Ie=w.add(S.sub(w)._mult(de/xe)._round());this.updateDistance(w,Ie),this.addCurrentVertex(Ie,L,0,0,C,B),w=Ie}}else J._mult(ee),this.addCurrentVertex(w,J,0,0,C,B);else if(G==="flipbevel"){if(ee>100)J=L.mult(-1);else{let ve=ee*k.add(L).mag()/k.sub(L).mag();J._perp()._mult(ve*(te?-1:1))}this.addCurrentVertex(w,J,0,0,C,B),this.addCurrentVertex(w,J.mult(-1),0,0,C,B)}else if(G==="bevel"||G==="fakeround"){B!=null&&T&&this.addCurrentVertex(w,k,-1,-1,C,B);let ve=w.dist(T)<=2*de&&G!=="bevel",xe=J.mult(te?1:-1);xe._mult(ee);let Ie=L.mult(te?-1:1),Ae=k.mult(te?-1:1),Pe=this.evaluateElevationValue(this.distance);if(B==null&&(this.addHalfVertex(w,xe.x,xe.y,!1,!te,0,C,Pe),ve||this.addHalfVertex(w,xe.x+2*Ae.x,xe.y+2*Ae.y,!1,te,0,C,Pe)),G==="fakeround"){let De=Math.round(180*ne/Math.PI/20);this.addHalfVertex(w,Ae.x,Ae.y,!1,te,0,C,Pe);for(let $e=0;$e<De;$e++){let Je=$e/De;if(Je!==.5){let dt=Je-.5;Je+=Je*dt*(Je-1)*((1.0904+H*(H*(3.55645-1.43519*H)-3.2452))*dt*dt+(.848013+H*(.215638*H-1.06021)))}let ze=Ie.sub(Ae)._mult(Je)._add(Ae)._unit();this.addHalfVertex(w,ze.x,ze.y,!1,te,0,C,Pe)}this.addHalfVertex(w,Ie.x,Ie.y,!1,te,0,C,Pe)}ve||B!=null||this.addHalfVertex(w,xe.x+2*Ie.x,xe.y+2*Ie.y,!1,te,0,C,Pe),B!=null&&S&&this.addCurrentVertex(w,L,1,1,C,B)}else G==="butt"?this.addCurrentVertex(w,J,0,0,C,B):G==="square"?(T||this.addCurrentVertex(w,J,-1,-1,C,B),this.addCurrentVertex(w,J,0,0,C,B),T&&this.addCurrentVertex(w,J,1,1,C,B)):G==="round"&&(T&&(this.addCurrentVertex(w,k,0,0,C,B),this.addCurrentVertex(w,k,1,1,C,B,!0)),S&&(this.addCurrentVertex(w,L,-1,-1,C,B,!0),this.addCurrentVertex(w,L,0,0,C,B)))}}addVerticesTo(e,i,c,p,u,m,x,I,D,_){let E=(i.w-e.w)/this.tessellationStep|0,C=0,w=this.scaledDistance;if(E>1){this.lineSoFar=e.w;let S=(i.x-e.x)/E,k=(i.y-e.y)/E,L=(i.z-e.z)/E,B=(i.w-e.w)/E;for(let V=1;V<E;++V){e.x+=S,e.y+=k,e.z+=L,this.lineSoFar+=B,C+=B;let N=this.evaluateElevationValue(this.prevDistance+C);this.scaledDistance=(this.prevDistance+C)/this.totalDistance,this.addHalfVertex(e,c,p,_,!1,x,D,N),this.addHalfVertex(e,u,m,_,!0,-I,D,N)}}this.lineSoFar=i.w,this.scaledDistance=w;let T=this.evaluateElevationValue(this.distance);this.addHalfVertex(i,c,p,_,!1,x,D,T),this.addHalfVertex(i,u,m,_,!0,-I,D,T)}evaluateElevationValue(e){return this.hasZOffset?this.zOffsetValue.kind==="constant"?this.zOffsetValue.value:(this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):fn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0):void 0}addCurrentVertex(e,i,c,p,u,m,x=!1){let I=i.x+i.y*c,D=i.y-i.x*c,_=i.y*p-i.x,E=-i.y-i.x*p;if(m!=null){let w=st+10,T=m,S=new RI(e.x,e.y,T,this.lineSoFar),k=lx(e,-10,w),L=this.lineSoFar,B=this.distance;if(this.currentVertex)if(k){let V=this.currentVertexIsOutside,N=this.currentVertex,G=new RI(e.x,e.y,T,this.lineSoFar);if(OI(N,G,-10,w),!lx(G,-10,w)){if(V){this.e1=this.e2=-1,this.distance-=N.dist(S),this.lineSoFar=N.w;let H=this.evaluateElevationValue(N.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(N,I,D,x,!1,c,u,H),this.addHalfVertex(N,_,E,x,!0,-p,u,H),this.prevDistance=this.distance}this.distance=this.prevDistance+N.dist(G),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(N,G,I,D,_,E,c,p,u,x),this.distance=B,this.scaledDistance=this.distance/this.totalDistance}}else{let V=this.currentVertex;if(this.currentVertexIsOutside){OI(V,S,-10,w),this.e1=this.e2=-1,this.distance-=V.dist(S),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=V.w;let N=this.evaluateElevationValue(V.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(V,I,D,x,!1,c,u,N),this.addHalfVertex(V,_,E,x,!0,-p,u,N),this.prevDistance=this.distance,this.distance=B,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(V,S,I,D,_,E,c,p,u,x)}else k||(this.addHalfVertex(e,I,D,x,!1,c,u,m),this.addHalfVertex(e,_,E,x,!0,-p,u,m));this.currentVertex=S,this.currentVertexIsOutside=k,this.lineSoFar=L}else this.addHalfVertex(e,I,D,x,!1,c,u,m),this.addHalfVertex(e,_,E,x,!0,-p,u,m)}addHalfVertex({x:e,y:i},c,p,u,m,x,I,D){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(i<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let _=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),I.primitiveLength++),m?this.e2=_:this.e1=_,D!=null&&this.zOffsetVertexArray.emplaceBack(D)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function lx(l,e,i){return l.x<e||l.x>i||l.y<e||l.y>i}let sT,aT;function lT(l,e,i){return e*(st/(l.tileSize*Math.pow(2,i-l.tileID.overscaledZ)))}ft(ax,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});let cT=(l,e,i)=>(1-i)*l+i*e;function uT(l,e){return 1/lT(l,1,e.tileZoom)}function hT(l,e,i,c){return l.translatePosMatrix(c||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let dT=l=>{let e=[];fT(l)&&e.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let i=l.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let c=l.layout.get("line-join").constantOr("miter")==="none",p=!!l.paint.get("line-pattern").constantOr(1);return c&&p&&e.push("LINE_JOIN_NONE"),e};function fT(l){let e=l.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let cx,pT=()=>cx||(cx={layout:sT||(sT=new Kn({"line-cap":new wt(Re.layout_line["line-cap"]),"line-join":new wt(Re.layout_line["line-join"]),"line-miter-limit":new tt(Re.layout_line["line-miter-limit"]),"line-round-limit":new tt(Re.layout_line["line-round-limit"]),"line-sort-key":new wt(Re.layout_line["line-sort-key"]),"line-z-offset":new wt(Re.layout_line["line-z-offset"]),"line-elevation-reference":new tt(Re.layout_line["line-elevation-reference"]),"line-cross-slope":new tt(Re.layout_line["line-cross-slope"]),visibility:new tt(Re.layout_line.visibility)})),paint:aT||(aT=new Kn({"line-opacity":new wt(Re.paint_line["line-opacity"]),"line-color":new wt(Re.paint_line["line-color"]),"line-translate":new tt(Re.paint_line["line-translate"]),"line-translate-anchor":new tt(Re.paint_line["line-translate-anchor"]),"line-width":new wt(Re.paint_line["line-width"]),"line-gap-width":new wt(Re.paint_line["line-gap-width"]),"line-offset":new wt(Re.paint_line["line-offset"]),"line-blur":new wt(Re.paint_line["line-blur"]),"line-dasharray":new wt(Re.paint_line["line-dasharray"]),"line-pattern":new wt(Re.paint_line["line-pattern"]),"line-gradient":new Sl(Re.paint_line["line-gradient"]),"line-trim-offset":new tt(Re.paint_line["line-trim-offset"]),"line-trim-fade-range":new tt(Re.paint_line["line-trim-fade-range"]),"line-trim-color":new tt(Re.paint_line["line-trim-color"]),"line-emissive-strength":new tt(Re.paint_line["line-emissive-strength"]),"line-border-width":new wt(Re.paint_line["line-border-width"]),"line-border-color":new wt(Re.paint_line["line-border-color"]),"line-occlusion-opacity":new tt(Re.paint_line["line-occlusion-opacity"])}))},cx);class YO extends wt{possiblyEvaluate(e,i){return i=new li(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,c,p){return i=ar({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,c,p)}}let wp;function mT(l,e){return e>0?e+2*l:l}let JO=wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),KO=wn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),QO=wn([{name:"a_projected_pos",components:4,type:"Float32"}],4);wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let ek=wn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),tk=wn([{name:"a_texb",components:2,type:"Uint16"}]),nk=wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),ik=wn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let gT=wn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rk=wn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);wn([{name:"triangle",components:3,type:"Uint16"}]),wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),wn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),wn([{type:"Float32",name:"offsetX"}]),wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var tr=24;let ps=128;function ux(l,e){let{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new li(l+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:c,interpolationType:p}=i,u=0;for(;u<c.length&&c[u]<=l;)u++;u=Math.max(0,u-1);let m=u;for(;m<c.length&&c[m]<l+1;)m++;m=Math.min(c.length-1,m);let x=c[u],I=c[m];return i.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:I,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:I,minSize:i.evaluate(new li(x)),maxSize:i.evaluate(new li(I)),interpolationType:p}}}function __(l,{uSize:e,uSizeT:i},{lowerSize:c,upperSize:p}){return l.kind==="source"?c/ps:l.kind==="composite"?Rt(c/ps,p/ps,i):e}function $h(l,e,i=1){let c=0,p=0;if(l.kind==="constant")p=l.layoutSize*i;else if(l.kind!=="source"){let{interpolationType:u,minZoom:m,maxZoom:x}=l,I=u?jt(kr.interpolationFactor(u,e,m,x),0,1):0;l.kind==="camera"?p=Rt(l.minSize,l.maxSize,I)*i:c=I*i}return{uSizeT:c,uSize:p}}var ok=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ps,evaluateSizeForFeature:__,evaluateSizeForZoom:$h,getSizeData:ux});function sk(l,e,i){return l.sections.forEach(c=>{c.text=function(p,u,m){let x=u.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),Fr.applyArabicShaping&&(p=Fr.applyArabicShaping(p)),p}(c.text,e,i)}),l}let Ep={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function ak(l){return l==="\uFE36"||l==="\uFE48"||l==="\uFE38"||l==="\uFE44"||l==="\uFE42"||l==="\uFE3E"||l==="\uFE3C"||l==="\uFE3A"||l==="\uFE18"||l==="\uFE40"||l==="\uFE10"||l==="\uFE13"||l==="\uFE14"||l==="\uFF40"||l==="\uFFE3"||l==="\uFE11"||l==="\uFE12"}function lk(l){return l==="\uFE35"||l==="\uFE47"||l==="\uFE37"||l==="\uFE43"||l==="\uFE41"||l==="\uFE3D"||l==="\uFE3B"||l==="\uFE39"||l==="\uFE17"||l==="\uFE3F"}var _T,hx,yT,dx={};function ck(){return _T||(_T=1,dx.read=function(l,e,i,c,p){var u,m,x=8*p-c-1,I=(1<<x)-1,D=I>>1,_=-7,E=i?p-1:0,C=i?-1:1,w=l[e+E];for(E+=C,u=w&(1<<-_)-1,w>>=-_,_+=x;_>0;u=256*u+l[e+E],E+=C,_-=8);for(m=u&(1<<-_)-1,u>>=-_,_+=c;_>0;m=256*m+l[e+E],E+=C,_-=8);if(u===0)u=1-D;else{if(u===I)return m?NaN:1/0*(w?-1:1);m+=Math.pow(2,c),u-=D}return(w?-1:1)*m*Math.pow(2,u-c)},dx.write=function(l,e,i,c,p,u){var m,x,I,D=8*u-p-1,_=(1<<D)-1,E=_>>1,C=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=c?0:u-1,T=c?1:-1,S=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,m=_):(m=Math.floor(Math.log(e)/Math.LN2),e*(I=Math.pow(2,-m))<1&&(m--,I*=2),(e+=m+E>=1?C/I:C*Math.pow(2,1-E))*I>=2&&(m++,I/=2),m+E>=_?(x=0,m=_):m+E>=1?(x=(e*I-1)*Math.pow(2,p),m+=E):(x=e*Math.pow(2,E-1)*Math.pow(2,p),m=0));p>=8;l[i+w]=255&x,w+=T,x/=256,p-=8);for(m=m<<p|x,D+=p;D>0;l[i+w]=255&m,w+=T,m/=256,D-=8);l[i+w-T]|=128*S}),dx}function vT(){if(yT)return hx;yT=1,hx=e;var l=ck();function e(N){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(N)?N:new Uint8Array(N||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,c=1/i,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function u(N){return N.type===e.Bytes?N.readVarint()+N.pos:N.pos+1}function m(N,G,H){return H?4294967296*G+(N>>>0):4294967296*(G>>>0)+(N>>>0)}function x(N,G,H){var J=G<=16383?1:G<=2097151?2:G<=268435455?3:Math.floor(Math.log(G)/(7*Math.LN2));H.realloc(J);for(var se=H.pos-1;se>=N;se--)H.buf[se+J]=H.buf[se]}function I(N,G){for(var H=0;H<N.length;H++)G.writeVarint(N[H])}function D(N,G){for(var H=0;H<N.length;H++)G.writeSVarint(N[H])}function _(N,G){for(var H=0;H<N.length;H++)G.writeFloat(N[H])}function E(N,G){for(var H=0;H<N.length;H++)G.writeDouble(N[H])}function C(N,G){for(var H=0;H<N.length;H++)G.writeBoolean(N[H])}function w(N,G){for(var H=0;H<N.length;H++)G.writeFixed32(N[H])}function T(N,G){for(var H=0;H<N.length;H++)G.writeSFixed32(N[H])}function S(N,G){for(var H=0;H<N.length;H++)G.writeFixed64(N[H])}function k(N,G){for(var H=0;H<N.length;H++)G.writeSFixed64(N[H])}function L(N,G){return(N[G]|N[G+1]<<8|N[G+2]<<16)+16777216*N[G+3]}function B(N,G,H){N[H]=G,N[H+1]=G>>>8,N[H+2]=G>>>16,N[H+3]=G>>>24}function V(N,G){return(N[G]|N[G+1]<<8|N[G+2]<<16)+(N[G+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(N,G,H){for(H=H||this.length;this.pos<H;){var J=this.readVarint(),se=J>>3,ee=this.pos;this.type=7&J,N(se,G,this),this.pos===ee&&this.skip(J)}return G},readMessage:function(N,G){return this.readFields(N,G,this.readVarint()+this.pos)},readFixed32:function(){var N=L(this.buf,this.pos);return this.pos+=4,N},readSFixed32:function(){var N=V(this.buf,this.pos);return this.pos+=4,N},readFixed64:function(){var N=L(this.buf,this.pos)+L(this.buf,this.pos+4)*i;return this.pos+=8,N},readSFixed64:function(){var N=L(this.buf,this.pos)+V(this.buf,this.pos+4)*i;return this.pos+=8,N},readFloat:function(){var N=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,N},readDouble:function(){var N=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,N},readVarint:function(N){var G,H,J=this.buf;return G=127&(H=J[this.pos++]),H<128?G:(G|=(127&(H=J[this.pos++]))<<7,H<128?G:(G|=(127&(H=J[this.pos++]))<<14,H<128?G:(G|=(127&(H=J[this.pos++]))<<21,H<128?G:function(se,ee,ne){var me,te,de=ne.buf;if(me=(112&(te=de[ne.pos++]))>>4,te<128||(me|=(127&(te=de[ne.pos++]))<<3,te<128)||(me|=(127&(te=de[ne.pos++]))<<10,te<128)||(me|=(127&(te=de[ne.pos++]))<<17,te<128)||(me|=(127&(te=de[ne.pos++]))<<24,te<128)||(me|=(1&(te=de[ne.pos++]))<<31,te<128))return m(se,me,ee);throw new Error("Expected varint not more than 10 bytes")}(G|=(15&(H=J[this.pos]))<<28,N,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var N=this.readVarint();return N%2==1?(N+1)/-2:N/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var N=this.readVarint()+this.pos,G=this.pos;return this.pos=N,N-G>=12&&p?function(H,J,se){return p.decode(H.subarray(J,se))}(this.buf,G,N):function(H,J,se){for(var ee="",ne=J;ne<se;){var me,te,de,ve=H[ne],xe=null,Ie=ve>239?4:ve>223?3:ve>191?2:1;if(ne+Ie>se)break;Ie===1?ve<128&&(xe=ve):Ie===2?(192&(me=H[ne+1]))==128&&(xe=(31&ve)<<6|63&me)<=127&&(xe=null):Ie===3?(te=H[ne+2],(192&(me=H[ne+1]))==128&&(192&te)==128&&((xe=(15&ve)<<12|(63&me)<<6|63&te)<=2047||xe>=55296&&xe<=57343)&&(xe=null)):Ie===4&&(te=H[ne+2],de=H[ne+3],(192&(me=H[ne+1]))==128&&(192&te)==128&&(192&de)==128&&((xe=(15&ve)<<18|(63&me)<<12|(63&te)<<6|63&de)<=65535||xe>=1114112)&&(xe=null)),xe===null?(xe=65533,Ie=1):xe>65535&&(xe-=65536,ee+=String.fromCharCode(xe>>>10&1023|55296),xe=56320|1023&xe),ee+=String.fromCharCode(xe),ne+=Ie}return ee}(this.buf,G,N)},readBytes:function(){var N=this.readVarint()+this.pos,G=this.buf.subarray(this.pos,N);return this.pos=N,G},readPackedVarint:function(N,G){if(this.type!==e.Bytes)return N.push(this.readVarint(G));var H=u(this);for(N=N||[];this.pos<H;)N.push(this.readVarint(G));return N},readPackedSVarint:function(N){if(this.type!==e.Bytes)return N.push(this.readSVarint());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readSVarint());return N},readPackedBoolean:function(N){if(this.type!==e.Bytes)return N.push(this.readBoolean());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readBoolean());return N},readPackedFloat:function(N){if(this.type!==e.Bytes)return N.push(this.readFloat());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readFloat());return N},readPackedDouble:function(N){if(this.type!==e.Bytes)return N.push(this.readDouble());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readDouble());return N},readPackedFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed32());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readFixed32());return N},readPackedSFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed32());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readSFixed32());return N},readPackedFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed64());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readFixed64());return N},readPackedSFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed64());var G=u(this);for(N=N||[];this.pos<G;)N.push(this.readSFixed64());return N},skip:function(N){var G=7&N;if(G===e.Varint)for(;this.buf[this.pos++]>127;);else if(G===e.Bytes)this.pos=this.readVarint()+this.pos;else if(G===e.Fixed32)this.pos+=4;else{if(G!==e.Fixed64)throw new Error("Unimplemented type: "+G);this.pos+=8}},writeTag:function(N,G){this.writeVarint(N<<3|G)},realloc:function(N){for(var G=this.length||16;G<this.pos+N;)G*=2;if(G!==this.length){var H=new Uint8Array(G);H.set(this.buf),this.buf=H,this.length=G}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(N){this.realloc(4),B(this.buf,N,this.pos),this.pos+=4},writeSFixed32:function(N){this.realloc(4),B(this.buf,N,this.pos),this.pos+=4},writeFixed64:function(N){this.realloc(8),B(this.buf,-1&N,this.pos),B(this.buf,Math.floor(N*c),this.pos+4),this.pos+=8},writeSFixed64:function(N){this.realloc(8),B(this.buf,-1&N,this.pos),B(this.buf,Math.floor(N*c),this.pos+4),this.pos+=8},writeVarint:function(N){(N=+N||0)>268435455||N<0?function(G,H){var J,se;if(G>=0?(J=G%4294967296|0,se=G/4294967296|0):(se=~(-G/4294967296),4294967295^(J=~(-G%4294967296))?J=J+1|0:(J=0,se=se+1|0)),G>=18446744073709552e3||G<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");H.realloc(10),function(ee,ne,me){me.buf[me.pos++]=127&ee|128,ee>>>=7,me.buf[me.pos++]=127&ee|128,ee>>>=7,me.buf[me.pos++]=127&ee|128,ee>>>=7,me.buf[me.pos++]=127&ee|128,me.buf[me.pos]=127&(ee>>>=7)}(J,0,H),function(ee,ne){var me=(7&ee)<<4;ne.buf[ne.pos++]|=me|((ee>>>=3)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee|((ee>>>=7)?128:0),ee&&(ne.buf[ne.pos++]=127&ee)))))}(se,H)}(N,this):(this.realloc(4),this.buf[this.pos++]=127&N|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=N>>>7&127))))},writeSVarint:function(N){this.writeVarint(N<0?2*-N-1:2*N)},writeBoolean:function(N){this.writeVarint(!!N)},writeString:function(N){N=String(N),this.realloc(4*N.length),this.pos++;var G=this.pos;this.pos=function(J,se,ee){for(var ne,me,te=0;te<se.length;te++){if((ne=se.charCodeAt(te))>55295&&ne<57344){if(!me){ne>56319||te+1===se.length?(J[ee++]=239,J[ee++]=191,J[ee++]=189):me=ne;continue}if(ne<56320){J[ee++]=239,J[ee++]=191,J[ee++]=189,me=ne;continue}ne=me-55296<<10|ne-56320|65536,me=null}else me&&(J[ee++]=239,J[ee++]=191,J[ee++]=189,me=null);ne<128?J[ee++]=ne:(ne<2048?J[ee++]=ne>>6|192:(ne<65536?J[ee++]=ne>>12|224:(J[ee++]=ne>>18|240,J[ee++]=ne>>12&63|128),J[ee++]=ne>>6&63|128),J[ee++]=63&ne|128)}return ee}(this.buf,N,this.pos);var H=this.pos-G;H>=128&&x(G,H,this),this.pos=G-1,this.writeVarint(H),this.pos+=H},writeFloat:function(N){this.realloc(4),l.write(this.buf,N,this.pos,!0,23,4),this.pos+=4},writeDouble:function(N){this.realloc(8),l.write(this.buf,N,this.pos,!0,52,8),this.pos+=8},writeBytes:function(N){var G=N.length;this.writeVarint(G),this.realloc(G);for(var H=0;H<G;H++)this.buf[this.pos++]=N[H]},writeRawMessage:function(N,G){this.pos++;var H=this.pos;N(G,this);var J=this.pos-H;J>=128&&x(H,J,this),this.pos=H-1,this.writeVarint(J),this.pos+=J},writeMessage:function(N,G,H){this.writeTag(N,e.Bytes),this.writeRawMessage(G,H)},writePackedVarint:function(N,G){G.length&&this.writeMessage(N,I,G)},writePackedSVarint:function(N,G){G.length&&this.writeMessage(N,D,G)},writePackedBoolean:function(N,G){G.length&&this.writeMessage(N,C,G)},writePackedFloat:function(N,G){G.length&&this.writeMessage(N,_,G)},writePackedDouble:function(N,G){G.length&&this.writeMessage(N,E,G)},writePackedFixed32:function(N,G){G.length&&this.writeMessage(N,w,G)},writePackedSFixed32:function(N,G){G.length&&this.writeMessage(N,T,G)},writePackedFixed64:function(N,G){G.length&&this.writeMessage(N,S,G)},writePackedSFixed64:function(N,G){G.length&&this.writeMessage(N,k,G)},writeBytesField:function(N,G){this.writeTag(N,e.Bytes),this.writeBytes(G)},writeFixed32Field:function(N,G){this.writeTag(N,e.Fixed32),this.writeFixed32(G)},writeSFixed32Field:function(N,G){this.writeTag(N,e.Fixed32),this.writeSFixed32(G)},writeFixed64Field:function(N,G){this.writeTag(N,e.Fixed64),this.writeFixed64(G)},writeSFixed64Field:function(N,G){this.writeTag(N,e.Fixed64),this.writeSFixed64(G)},writeVarintField:function(N,G){this.writeTag(N,e.Varint),this.writeVarint(G)},writeSVarintField:function(N,G){this.writeTag(N,e.Varint),this.writeSVarint(G)},writeStringField:function(N,G){this.writeTag(N,e.Bytes),this.writeString(G)},writeFloatField:function(N,G){this.writeTag(N,e.Fixed32),this.writeFloat(G)},writeDoubleField:function(N,G){this.writeTag(N,e.Fixed64),this.writeDouble(G)},writeBooleanField:function(N,G){this.writeVarintField(N,!!G)}},hx}var y_=R(vT());let fx=3;function uk(l,e,i){e.glyphs=[],l===1&&i.readMessage(hk,e)}function hk(l,e,i){if(l===3){let{id:c,bitmap:p,width:u,height:m,left:x,top:I,advance:D}=i.readMessage(dk,{});e.glyphs.push({id:c,bitmap:new jl({width:u+2*fx,height:m+2*fx},p),metrics:{width:u,height:m,left:x,top:I,advance:D}})}else l===4?e.ascender=i.readSVarint():l===5&&(e.descender=i.readSVarint())}function dk(l,e,i){l===1?e.id=i.readVarint():l===2?e.bitmap=i.readBytes():l===3?e.width=i.readVarint():l===4?e.height=i.readVarint():l===5?e.left=i.readSVarint():l===6?e.top=i.readSVarint():l===7&&(e.advance=i.readVarint())}let xT=fx,vo={horizontal:1,vertical:2,horizontalOnly:3};class Ip{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){let c=new Ip;return c.scale=e||1,c.fontStack=i,c}static forImage(e){let i=new Ip;return i.imageName=e,i}}class Gh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){let c=new Gh;for(let p=0;p<e.sections.length;p++){let u=e.sections[p];u.image?c.addImageSection(u):c.addTextSection(u,i)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,c){let p="";for(let u=0;u<i.length;u++){let m=i.charCodeAt(u+1)||null,x=i.charCodeAt(u-1)||null;p+=!c&&(m&&Vf(m)&&!Ep[i[u+1]]||x&&Vf(x)&&!Ep[i[u-1]])||!Ep[i[u]]?i[u]:Ep[i[u]]}return p}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&v_[this.text.charCodeAt(c)];c++)e++;let i=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&v_[this.text.charCodeAt(c)];c--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){let c=new Gh;return c.text=this.text.substring(e,i),c.sectionIndex=this.sectionIndex.slice(e,i),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Ip.forText(e.scale,e.fontStack||i));let c=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(c)}addImageSection(e){let i=e.image?e.image.namePrimary:"";if(i.length===0)return void fn("Can't add FormattedSection with an empty image.");let c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(Ip.forImage(i)),this.sectionIndex.push(this.sections.length-1)):fn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function px(l,e,i,c,p,u,m,x,I,D,_,E,C,w,T){let S=Gh.fromFeature(l,p);E===vo.vertical&&S.verticalizePunctuation(C);let k=[],L=function(H,J,se,ee,ne,me){if(!H)return[];let te=[],de=function(Ae,Pe,De,$e,Je,ze){let dt=0;for(let it=0;it<Ae.length();it++){let et=Ae.getSection(it);dt+=bT(Ae.getCodePoint(it),et,$e,Je,Pe,ze)}return dt/Math.max(1,Math.ceil(dt/De))}(H,J,se,ee,ne,me),ve=H.text.indexOf("\u200B")>=0,xe=0;for(let Ae=0;Ae<H.length();Ae++){let Pe=H.getSection(Ae),De=H.getCodePoint(Ae);if(v_[De]||(xe+=bT(De,Pe,ee,ne,J,me)),Ae<H.length()-1){let $e=!((Ie=De)<11904||!(xt["Bopomofo Extended"](Ie)||xt.Bopomofo(Ie)||xt["CJK Compatibility Forms"](Ie)||xt["CJK Compatibility Ideographs"](Ie)||xt["CJK Compatibility"](Ie)||xt["CJK Radicals Supplement"](Ie)||xt["CJK Strokes"](Ie)||xt["CJK Symbols and Punctuation"](Ie)||xt["CJK Unified Ideographs Extension A"](Ie)||xt["CJK Unified Ideographs"](Ie)||xt["Enclosed CJK Letters and Months"](Ie)||xt["Halfwidth and Fullwidth Forms"](Ie)||xt.Hiragana(Ie)||xt["Ideographic Description Characters"](Ie)||xt["Kangxi Radicals"](Ie)||xt["Katakana Phonetic Extensions"](Ie)||xt.Katakana(Ie)||xt["Vertical Forms"](Ie)||xt["Yi Radicals"](Ie)||xt["Yi Syllables"](Ie)));(fk[De]||$e||Pe.imageName)&&te.push(ET(Ae+1,xe,de,te,pk(De,H.getCodePoint(Ae+1),$e&&ve),!1))}}var Ie;return IT(ET(H.length(),xe,de,te,0,!0))}(S,D,u,e,c,w),{processBidirectionalText:B,processStyledBidirectionalText:V}=Fr;if(B&&S.sections.length===1){let H=B(S.toString(),L);for(let J of H){let se=new Gh;se.text=J,se.sections=S.sections;for(let ee=0;ee<J.length;ee++)se.sectionIndex.push(0);k.push(se)}}else if(V){let H=V(S.text,S.sectionIndex,L);for(let J of H){let se=new Gh;se.text=J[0],se.sectionIndex=J[1],se.sections=S.sections,k.push(se)}}else k=function(H,J){let se=[],ee=H.text,ne=0;for(let me of J)se.push(H.substring(ne,me)),ne=me;return ne<ee.length&&se.push(H.substring(ne,ee.length)),se}(S,L);let N=[],G={positionedLines:N,text:S.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(H,J,se,ee,ne,me,te,de,ve,xe,Ie,Ae){let Pe=0,De=0,$e=0,Je=de==="right"?1:de==="left"?0:.5,ze=!1;for(let ht of ne){let mt=ht.getSections();for(let Vt of mt){if(Vt.imageName)continue;let Xt=J[Vt.fontStack];if(Xt&&(ze=Xt.ascender!==void 0&&Xt.descender!==void 0,!ze))break}if(!ze)break}let dt=0;for(let ht of ne){ht.trim();let mt=ht.getMaxScale(),Vt=(mt-1)*tr,Xt={positionedGlyphs:[],lineOffset:0};H.positionedLines[dt]=Xt;let Jt=Xt.positionedGlyphs,qt=0;if(!ht.length()){De+=me,++dt;continue}let rn=0,tn=0;for(let zn=0;zn<ht.length();zn++){let Pt=ht.getSection(zn),Dn=ht.getSectionIndex(zn),Rn=ht.getCodePoint(zn),ri=Pt.scale,yi=null,Mi=null,vi=null,fi=tr,Ei=0,Pi=!(ve===vo.horizontal||!Ie&&!Cl(Rn)||Ie&&(v_[Rn]||(it=Rn,xt.Arabic(it)||xt["Arabic Supplement"](it)||xt["Arabic Extended-A"](it)||xt["Arabic Presentation Forms-A"](it)||xt["Arabic Presentation Forms-B"](it))));if(Pt.imageName){let nr=ee[Pt.imageName];if(!nr)continue;vi=Pt.imageName,H.iconsInText=H.iconsInText||!0,Mi=nr.paddedRect;let ei=nr.displaySize;ri=ri*tr/Ae,yi={width:ei[0],height:ei[1],left:0,top:-xT,advance:Pi?ei[1]:ei[0],localGlyph:!1},Ei=ze?-yi.height*ri:mt*tr-17-ei[1]*ri,fi=yi.advance;let zr=(Pi?ei[0]:ei[1])*ri-tr*mt;zr>0&&zr>qt&&(qt=zr)}else{let nr=se[Pt.fontStack];if(!nr)continue;nr[Rn]&&(Mi=nr[Rn]);let ei=J[Pt.fontStack];if(!ei)continue;let zr=ei.glyphs[Rn];if(!zr)continue;if(yi=zr.metrics,fi=Rn!==8203?tr:0,ze){let vs=ei.ascender!==void 0?Math.abs(ei.ascender):0,Vo=ei.descender!==void 0?Math.abs(ei.descender):0,jo=(vs+Vo)*ri;rn<jo&&(rn=jo,tn=(vs-Vo)/2*ri),Ei=-vs*ri}else Ei=(mt-ri)*tr-17}Pi?(H.verticalizable=!0,Jt.push({glyph:Rn,imageName:vi,x:Pe,y:De+Ei,vertical:Pi,scale:ri,localGlyph:yi.localGlyph,fontStack:Pt.fontStack,sectionIndex:Dn,metrics:yi,rect:Mi}),Pe+=fi*ri+xe):(Jt.push({glyph:Rn,imageName:vi,x:Pe,y:De+Ei,vertical:Pi,scale:ri,localGlyph:yi.localGlyph,fontStack:Pt.fontStack,sectionIndex:Dn,metrics:yi,rect:Mi}),Pe+=yi.advance*ri+xe)}Jt.length!==0&&($e=Math.max(Pe-xe,$e),ze?TT(Jt,Je,qt,tn,me*mt/2):TT(Jt,Je,qt,0,me/2)),Pe=0;let Wn=me*mt+qt;Xt.lineOffset=Math.max(qt,Vt),De+=Wn,++dt}var it;let et=De,{horizontalAlign:Ye,verticalAlign:It}=mx(te);(function(ht,mt,Vt,Xt,Jt,qt){let rn=(mt-Vt)*Jt,tn=-qt*Xt;for(let Wn of ht)for(let zn of Wn.positionedGlyphs)zn.x+=rn,zn.y+=tn})(H.positionedLines,Je,Ye,It,$e,et),H.top+=-It*et,H.bottom=H.top+et,H.left+=-Ye*$e,H.right=H.left+$e,H.hasBaseline=ze}(G,e,i,c,k,m,x,I,E,D,C,T),!function(H){for(let J of H)if(J.positionedGlyphs.length!==0)return!1;return!0}(N)&&G}let v_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},fk={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bT(l,e,i,c,p,u){if(e.imageName){let m=c[e.imageName];return m?m.displaySize[0]*e.scale*tr/u+p:0}{let m=i[e.fontStack],x=m&&m.glyphs[l];return x?x.metrics.advance*e.scale+p:0}}function wT(l,e,i,c){let p=Math.pow(l-e,2);return c?l<e?p/2:2*p:p+Math.abs(i)*i}function pk(l,e,i){let c=0;return l===10&&(c-=1e4),i&&(c+=150),l!==40&&l!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function ET(l,e,i,c,p,u){let m=null,x=wT(e,i,p,u);for(let I of c){let D=wT(e-I.x,i,p,u)+I.badness;D<=x&&(m=I,x=D)}return{index:l,x:e,priorBreak:m,badness:x}}function IT(l){return l?IT(l.priorBreak).concat(l.index):[]}function mx(l){let e=.5,i=.5;switch(l){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function TT(l,e,i,c,p){if(!(e||i||c||p))return;let u=l.length-1,m=l[u],x=(m.x+m.metrics.advance*m.scale)*e;for(let I=0;I<=u;I++)l[I].x-=x,l[I].y+=i+c+p}function mk(l,e,i,c){let{horizontalAlign:p,verticalAlign:u}=mx(c),m=i[0]-l.displaySize[0]*p,x=i[1]-l.displaySize[1]*u;return{imagePrimary:l,imageSecondary:e,top:x,bottom:x+l.displaySize[1],left:m,right:m+l.displaySize[0]}}function CT(l,e,i,c,p,u){let m=l.imagePrimary,x;if(m.content){let k=m.content,L=m.pixelRatio||1;x=[k[0]/L,k[1]/L,m.displaySize[0]-k[2]/L,m.displaySize[1]-k[3]/L]}let I=e.left*u,D=e.right*u,_,E,C,w;i==="width"||i==="both"?(w=p[0]+I-c[3],E=p[0]+D+c[1]):(w=p[0]+(I+D-m.displaySize[0])/2,E=w+m.displaySize[0]);let T=e.top*u,S=e.bottom*u;return i==="height"||i==="both"?(_=p[1]+T-c[0],C=p[1]+S+c[2]):(_=p[1]+(T+S-m.displaySize[1])/2,C=_+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:_,right:E,bottom:C,left:w,collisionPadding:x}}class Sa extends ot{constructor(e,i,c,p,u){super(e,i),this.angle=p,this.z=c,u!==void 0&&(this.segment=u)}clone(){return new Sa(this.x,this.y,this.z,this.angle,this.segment)}}function DT(l,e,i,c,p){if(e.segment===void 0)return!0;let u=e,m=e.segment+1,x=0;for(;x>-i/2;){if(m--,m<0)return!1;x-=l[m].dist(u),u=l[m]}x+=l[m].dist(l[m+1]),m++;let I=[],D=0;for(;x<i/2;){let _=l[m],E=l[m+1];if(!E)return!1;let C=l[m-1].angleTo(_)-_.angleTo(E);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:x,angleDelta:C}),D+=C;x-I[0].distance>c;)D-=I.shift().angleDelta;if(D>p)return!1;m++,x+=_.dist(E)}return!0}function MT(l){let e=0;for(let i=0;i<l.length-1;i++)e+=l[i].dist(l[i+1]);return e}function ST(l,e,i){return l?.6*e*i:0}function AT(l,e){return Math.max(l?l.right-l.left:0,e?e.right-e.left:0)}function gk(l,e,i,c,p,u){let m=ST(i,p,u),x=AT(i,c)*u,I=0,D=MT(l)/2;for(let _=0;_<l.length-1;_++){let E=l[_],C=l[_+1],w=E.dist(C);if(I+w>D){let T=(D-I)/w,S=Rt(E.x,C.x,T),k=Rt(E.y,C.y,T),L=new Sa(S,k,0,C.angleTo(E),_);return!m||DT(l,L,x,m,e)?L:void 0}I+=w}}function _k(l,e,i,c,p,u,m,x,I){let D=ST(c,u,m),_=AT(c,p),E=_*m,C=l[0].x===0||l[0].x===I||l[0].y===0||l[0].y===I;return e-E<e/4&&(e=E+e/4),RT(l,C?e/2*x%e:(_/2+2*u)*m*x%e,e,D,i,E,C,!1,I)}function RT(l,e,i,c,p,u,m,x,I){let D=u/2,_=MT(l),E=0,C=e-i,w=[];for(let T=0;T<l.length-1;T++){let S=l[T],k=l[T+1],L=S.dist(k),B=k.angleTo(S);for(;C+i<E+L;){C+=i;let V=(C-E)/L,N=Rt(S.x,k.x,V),G=Rt(S.y,k.y,V);if(N>=0&&N<I&&G>=0&&G<I&&C-D>=0&&C+D<=_){let H=new Sa(N,G,0,B,T);c&&!DT(l,H,u,c,p)||w.push(H)}}E+=L}return x||w.length||m||(w=RT(l,E/2,i,c,p,u,m,!0,I)),w}function PT(l,e,i,c,p){let u=[];for(let m=0;m<l.length;m++){let x=l[m],I;for(let D=0;D<x.length-1;D++){let _=x[D],E=x[D+1];_.x<e&&E.x<e||(_.x<e?_=new ot(e,_.y+(e-_.x)/(E.x-_.x)*(E.y-_.y))._round():E.x<e&&(E=new ot(e,_.y+(e-_.x)/(E.x-_.x)*(E.y-_.y))._round()),_.y<i&&E.y<i||(_.y<i?_=new ot(_.x+(i-_.y)/(E.y-_.y)*(E.x-_.x),i)._round():E.y<i&&(E=new ot(_.x+(i-_.y)/(E.y-_.y)*(E.x-_.x),i)._round()),_.x>=c&&E.x>=c||(_.x>=c?_=new ot(c,_.y+(c-_.x)/(E.x-_.x)*(E.y-_.y))._round():E.x>=c&&(E=new ot(c,_.y+(c-_.x)/(E.x-_.x)*(E.y-_.y))._round()),_.y>=p&&E.y>=p||(_.y>=p?_=new ot(_.x+(p-_.y)/(E.y-_.y)*(E.x-_.x),p)._round():E.y>=p&&(E=new ot(_.x+(p-_.y)/(E.y-_.y)*(E.x-_.x),p)._round()),I&&_.equals(I[I.length-1])||(I=[_],u.push(I)),I.push(E)))))}}return u}function OT(l){let e=0,i=0;for(let m of l)e+=m.w*m.h,i=Math.max(i,m.w);l.sort((m,x)=>x.h-m.h);let c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}],p=0,u=0;for(let m of l)for(let x=c.length-1;x>=0;x--){let I=c[x];if(!(m.w>I.w||m.h>I.h)){if(m.x=I.x,m.y=I.y,u=Math.max(u,m.y+m.h),p=Math.max(p,m.x+m.w),m.w===I.w&&m.h===I.h){let D=c.pop();x<c.length&&(c[x]=D)}else m.h===I.h?(I.x+=m.w,I.w-=m.w):m.w===I.w?(I.y+=m.h,I.h-=m.h):(c.push({x:I.x+m.w,y:I.y,w:I.w-m.w,h:m.h}),I.y+=m.h,I.h-=m.h);break}}return{w:p,h:u,fill:e/(p*u)||0}}ft(Sa,"Anchor");let Tp=1;class gx{constructor(e,{pixelRatio:i,version:c,stretchX:p,stretchY:u,content:m},x){this.paddedRect=e,this.pixelRatio=i,this.stretchX=p,this.stretchY=u,this.content=m,this.version=c,this.padding=x}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class kT{constructor(e,i,c){let p={},u={};this.haveRenderCallbacks=[];let m=[];this.addImages(e,p,Tp,m),this.addImages(i,u,2,m);let{w:x,h:I}=OT(m),D=new gr({width:x||1,height:I||1});for(let _ in e){let E=e[_],C=p[_].paddedRect;gr.copy(E.data,D,{x:0,y:0},{x:C.x+Tp,y:C.y+Tp},E.data,c,E.sdf)}for(let _ in i){let E=i[_],C=u[_].paddedRect,w=u[_].padding,T=C.x+w,S=C.y+w,k=E.data.width,L=E.data.height;w=w>1?w-1:w,gr.copy(E.data,D,{x:0,y:0},{x:T,y:S},E.data,c),gr.copy(E.data,D,{x:0,y:L-w},{x:T,y:S-w},{width:k,height:w},c),gr.copy(E.data,D,{x:0,y:0},{x:T,y:S+L},{width:k,height:w},c),gr.copy(E.data,D,{x:k-w,y:0},{x:T-w,y:S},{width:w,height:L},c),gr.copy(E.data,D,{x:0,y:0},{x:T+k,y:S},{width:w,height:L},c),gr.copy(E.data,D,{x:k-w,y:L-w},{x:T-w,y:S-w},{width:w,height:w},c),gr.copy(E.data,D,{x:0,y:L-w},{x:T+k,y:S-w},{width:w,height:w},c),gr.copy(E.data,D,{x:0,y:0},{x:T+k,y:S+L},{width:w,height:w},c),gr.copy(E.data,D,{x:k-w,y:0},{x:T-w,y:S+L},{width:w,height:w},c)}this.image=D,this.iconPositions=p,this.patternPositions=u}addImages(e,i,c,p){for(let u in e){let m=e[u],x={x:0,y:0,w:m.data.width+2*c,h:m.data.height+2*c};p.push(x),i[u]=new gx(x,m,c),m.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>e.hasImage(p,c)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(let p in e.getUpdatedImages(c))this.patchUpdatedImage(this.iconPositions[p],e.getImage(p,c),i),this.patchUpdatedImage(this.patternPositions[p],e.getImage(p,c),i)}patchUpdatedImage(e,i,c){if(!e||!i||e.version===i.version)return;e.version=i.version;let[p,u]=e.tl;c.update(i.data,{position:{x:p,y:u}})}}ft(gx,"ImagePosition"),ft(kT,"ImageAtlas");let Cp=1e20;function LT(l,e,i,c,p,u,m,x,I){for(let D=e;D<e+c;D++)FT(l,i*u+D,u,p,m,x,I);for(let D=i;D<i+p;D++)FT(l,D*u+e,1,c,m,x,I)}function FT(l,e,i,c,p,u,m){u[0]=0,m[0]=-Cp,m[1]=Cp,p[0]=l[e];for(let x=1,I=0,D=0;x<c;x++){p[x]=l[e+x*i];let _=x*x;do{let E=u[I];D=(p[x]-p[E]+_-E*E)/(x-E)/2}while(D<=m[I]&&--I>-1);I++,u[I]=x,m[I]=D,m[I+1]=Cp}for(let x=0,I=0;x<c;x++){for(;m[I+1]<x;)I++;let D=u[I],_=x-D;l[e+x*i]=p[D]+_*_}}let ms=2,_x={none:0,ideographs:1,all:2};class Hh{constructor(e,i,c){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,c){let p=[],u=this.urls[i]||ce.GLYPHS_URL;for(let m in e)for(let x of e[m])p.push({stack:m,id:x});ha(p,({stack:m,id:x},I)=>{let D=this.entries[m];D||(D=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=D.glyphs[x];if(_!==void 0)return void I(null,{stack:m,id:x,glyph:_});if(_=this._tinySDF(D,m,x),_)return D.glyphs[x]=_,void I(null,{stack:m,id:x,glyph:_});let E=Math.floor(x/256);if(256*E>65535)return fn("glyphs > 65535 not supported"),void I(null,{stack:m,id:x,glyph:_});if(D.ranges[E])return void I(null,{stack:m,id:x,glyph:_});let C=D.requests[E];C||(C=D.requests[E]=[],Hh.loadGlyphRange(m,E,u,this.requestManager,(w,T)=>{if(T){D.ascender=T.ascender,D.descender=T.descender;for(let S in T.glyphs)this._doesCharSupportLocalGlyph(+S)||(D.glyphs[+S]=T.glyphs[+S]);D.ranges[E]=!0}for(let S of C)S(w,T);delete D.requests[E]})),C.push((w,T)=>{w?I(w):T&&I(null,{stack:m,id:x,glyph:T.glyphs[x]||null})})},(m,x)=>{if(m)c(m);else if(x){let I={};for(let{stack:D,id:_,glyph:E}of x)I[D]===void 0&&(I[D]={}),I[D].glyphs===void 0&&(I[D].glyphs={}),I[D].glyphs[_]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},I[D].ascender=this.entries[D].ascender,I[D].descender=this.entries[D].descender;c(null,I)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==_x.none&&(this.localGlyphMode===_x.all?!!this.localFontFamily:!!this.localFontFamily&&(xt["CJK Unified Ideographs"](e)||xt["Hangul Syllables"](e)||xt.Hiragana(e)||xt.Katakana(e)||xt["CJK Symbols and Punctuation"](e)||xt["CJK Unified Ideographs Extension A"](e)||xt["CJK Unified Ideographs Extension B"](e)||xt.Osage(e)))}_tinySDF(e,i,c){let p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let u=e.tinySDF;if(!u){let S="400";/bold/i.test(i)?S="900":/medium/i.test(i)?S="500":/light/i.test(i)&&(S="200"),u=e.tinySDF=new Hh.TinySDF({fontFamily:p,fontWeight:S,fontSize:24*ms,buffer:3*ms,radius:8*ms}),u.fontWeight=S}if(this.localGlyphs[u.fontWeight][c])return this.localGlyphs[u.fontWeight][c];let m=String.fromCodePoint(c),{data:x,width:I,height:D,glyphWidth:_,glyphHeight:E,glyphLeft:C,glyphTop:w,glyphAdvance:T}=u.draw(m);return this.localGlyphs[u.fontWeight][c]={id:c,bitmap:new jl({width:I,height:D},x),metrics:{width:_/ms,height:E/ms,left:C/ms,top:w/ms-27,advance:T/ms,localGlyph:!0}}}}Hh.loadGlyphRange=function(l,e,i,c,p){let u=256*e,m=u+255,x=c.transformRequest(c.normalizeGlyphsURL(i).replace("{fontstack}",l).replace("{range}",`${u}-${m}`),qu.Glyphs);nl(x,(I,D)=>{if(I)p(I);else if(D){let _={},E=function(C){return new y_(C).readFields(uk,{})}(D);for(let C of E.glyphs)_[C.id]=C;p(null,{glyphs:_,ascender:E.ascender,descender:E.descender})}})},Hh.TinySDF=class{constructor({fontSize:l=24,buffer:e=3,radius:i=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:u="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=i;let x=this.size=l+4*e,I=this._createCanvas(x),D=this.ctx=I.getContext("2d",{willReadFrequently:!0});D.font=`${m} ${u} ${l}px ${p}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(l){let e=document.createElement("canvas");return e.width=e.height=l,e}draw(l){let{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:u}=this.ctx.measureText(l),m=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-p))),I=Math.min(this.size-this.buffer,m+Math.ceil(c)),D=x+2*this.buffer,_=I+2*this.buffer,E=Math.max(D*_,0),C=new Uint8ClampedArray(E),w={data:C,width:D,height:_,glyphWidth:x,glyphHeight:I,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(x===0||I===0)return w;let{ctx:T,buffer:S,gridInner:k,gridOuter:L}=this;T.clearRect(S,S,x,I),T.fillText(l,S,S+m);let B=T.getImageData(S,S,x,I);L.fill(Cp,0,E),k.fill(0,0,E);for(let V=0;V<I;V++)for(let N=0;N<x;N++){let G=B.data[4*(V*x+N)+3]/255;if(G===0)continue;let H=(V+S)*D+N+S;if(G===1)L[H]=0,k[H]=Cp;else{let J=.5-G;L[H]=J>0?J*J:0,k[H]=J<0?J*J:0}}LT(L,0,0,D,_,D,this.f,this.v,this.z),LT(k,S,S,x,I,D,this.f,this.v,this.z);for(let V=0;V<E;V++){let N=Math.sqrt(L[V])-Math.sqrt(k[V]);C[V]=Math.round(255-255*(N/this.radius+this.cutoff))}return w}};let $l=Tp;function NT(l,e,i,c,p=1){let u=[],m=l.imagePrimary,x=m.pixelRatio,I=m.paddedRect.w-2*$l,D=m.paddedRect.h-2*$l,_=(l.right-l.left)*p,E=(l.bottom-l.top)*p,C=m.stretchX||[[0,I]],w=m.stretchY||[[0,D]],T=(te,de)=>te+de[1]-de[0],S=C.reduce(T,0),k=w.reduce(T,0),L=I-S,B=D-k,V=0,N=S,G=0,H=k,J=0,se=L,ee=0,ne=B;if(m.content&&c){let te=m.content;V=x_(C,0,te[0]),G=x_(w,0,te[1]),N=x_(C,te[0],te[2]),H=x_(w,te[1],te[3]),J=te[0]-V,ee=te[1]-G,se=te[2]-te[0]-N,ne=te[3]-te[1]-H}let me=(te,de,ve,xe)=>{let Ie=b_(te.stretch-V,N,_,l.left*p),Ae=w_(te.fixed-J,se,te.stretch,S),Pe=b_(de.stretch-G,H,E,l.top*p),De=w_(de.fixed-ee,ne,de.stretch,k),$e=b_(ve.stretch-V,N,_,l.left*p),Je=w_(ve.fixed-J,se,ve.stretch,S),ze=b_(xe.stretch-G,H,E,l.top*p),dt=w_(xe.fixed-ee,ne,xe.stretch,k),it=new ot(Ie,Pe),et=new ot($e,Pe),Ye=new ot($e,ze),It=new ot(Ie,ze),ht=new ot(Ae/x,De/x),mt=new ot(Je/x,dt/x),Vt=e*Math.PI/180;if(Vt){let Wn=Math.sin(Vt),zn=Math.cos(Vt),Pt=[zn,-Wn,Wn,zn];it._matMult(Pt),et._matMult(Pt),It._matMult(Pt),Ye._matMult(Pt)}let Xt=te.stretch+te.fixed,Jt=ve.stretch+ve.fixed,qt=de.stretch+de.fixed,rn=xe.stretch+xe.fixed,tn=l.imageSecondary;return{tl:it,tr:et,bl:It,br:Ye,texPrimary:{x:m.paddedRect.x+$l+Xt,y:m.paddedRect.y+$l+qt,w:Jt-Xt,h:rn-qt},texSecondary:tn?{x:tn.paddedRect.x+$l+Xt,y:tn.paddedRect.y+$l+qt,w:Jt-Xt,h:rn-qt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ht,pixelOffsetBR:mt,minFontScaleX:se/x/_,minFontScaleY:ne/x/E,isSDF:i}};if(c&&(m.stretchX||m.stretchY)){let te=zT(C,L,S),de=zT(w,B,k);for(let ve=0;ve<te.length-1;ve++){let xe=te[ve],Ie=te[ve+1];for(let Ae=0;Ae<de.length-1;Ae++)u.push(me(xe,de[Ae],Ie,de[Ae+1]))}}else u.push(me({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:D+1}));return u}function x_(l,e,i){let c=0;for(let p of l)c+=Math.max(e,Math.min(i,p[1]))-Math.max(e,Math.min(i,p[0]));return c}function zT(l,e,i){let c=[{fixed:-$l,stretch:0}];for(let[p,u]of l){let m=c[c.length-1];c.push({fixed:p-m.stretch,stretch:m.stretch}),c.push({fixed:p-m.stretch,stretch:m.stretch+(u-p)})}return c.push({fixed:e+$l,stretch:i}),c}function b_(l,e,i,c){return l/e*i+c}function w_(l,e,i,c){return l-e*i/c}function yk(l,e,i,c){let p=e+l.positionedLines[c].lineOffset;return c===0?i+p/2:i+(p+(e+l.positionedLines[c-1].lineOffset))/2}function vk(l,e=1,i=!1){let c=1/0,p=1/0,u=-1/0,m=-1/0,x=l[0];for(let w=0;w<x.length;w++){let T=x[w];(!w||T.x<c)&&(c=T.x),(!w||T.y<p)&&(p=T.y),(!w||T.x>u)&&(u=T.x),(!w||T.y>m)&&(m=T.y)}let I=Math.min(u-c,m-p),D=I/2,_=new uf([],xk);if(I===0)return new ot(c,p);for(let w=c;w<u;w+=I)for(let T=p;T<m;T+=I)_.push(new qh(w+D,T+D,D,l));let E=function(w){let T=0,S=0,k=0,L=w[0];for(let B=0,V=L.length,N=V-1;B<V;N=B++){let G=L[B],H=L[N],J=G.x*H.y-H.x*G.y;S+=(G.x+H.x)*J,k+=(G.y+H.y)*J,T+=3*J}return new qh(S/T,k/T,0,w)}(l),C=_.length;for(;_.length;){let w=_.pop();(w.d>E.d||!E.d)&&(E=w,i&&console.log("found best %d after %d probes",Math.round(1e4*w.d)/1e4,C)),w.max-E.d<=e||(D=w.h/2,_.push(new qh(w.p.x-D,w.p.y-D,D,l)),_.push(new qh(w.p.x+D,w.p.y-D,D,l)),_.push(new qh(w.p.x-D,w.p.y+D,D,l)),_.push(new qh(w.p.x+D,w.p.y+D,D,l)),C+=4)}return i&&(console.log(`num probes: ${C}`),console.log(`best distance: ${E.d}`)),E.p}function xk(l,e){return e.max-l.max}class qh{constructor(e,i,c,p){this.p=new ot(e,i),this.h=c,this.d=function(u,m){let x=!1,I=1/0;for(let D=0;D<m.length;D++){let _=m[D];for(let E=0,C=_.length,w=C-1;E<C;w=E++){let T=_[E],S=_[w];T.y>u.y!=S.y>u.y&&u.x<(S.x-T.x)*(u.y-T.y)/(S.y-T.y)+T.x&&(x=!x),I=Math.min(I,Mt(u,T,S))}}return(x?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}let yx=Number.POSITIVE_INFINITY,bk=Math.sqrt(2);function BT(l,[e,i]){let c=0,p=0;if(i===yx){e<0&&(e=0);let u=e/bk;switch(l){case"top-right":case"top-left":p=u-7;break;case"bottom-right":case"bottom-left":p=7-u;break;case"bottom":p=7-e;break;case"top":p=e-7}switch(l){case"top-right":case"bottom-right":c=-u;break;case"top-left":case"bottom-left":c=u;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),l){case"top-right":case"top-left":case"top":p=i-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-i}switch(l){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,p]}function vx(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wk(l,e,i,c,p,u,m,x,I,D,_,E,C,w,T){let S=u.textMaxSize.evaluate(e,{},E);S===void 0?S=m*u.textScaleFactor:S*=u.textScaleFactor;let k=l.layers[0].layout,L=k.get("icon-offset").evaluate(e,{},E),B=jT(i.horizontal)||i.vertical,V=C.name==="globe",N=tr,G=m*u.textScaleFactor/N,H=l.tilePixelRatio*S/N,J=(xe=l.overscaling,l.zoom>18&&xe>2&&(xe>>=1),Math.max(st/(512*xe),1)*k.get("symbol-spacing")),se=k.get("text-padding")*l.tilePixelRatio,ee=k.get("icon-padding")*l.tilePixelRatio,ne=ln(k.get("text-max-angle")),me=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",te=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",de=k.get("symbol-placement"),ve=J/2;var xe;let Ie=k.get("icon-text-fit").evaluate(e,{},E),Ae=k.get("icon-text-fit-padding").evaluate(e,{},E),Pe=Ie!=="none",De;l.hasAnyIconTextFit===!1&&Pe&&(l.hasAnyIconTextFit=!0),c&&Pe&&(l.allowVerticalPlacement&&i.vertical&&(De=CT(c,i.vertical,Ie,Ae,L,G)),B&&(c=CT(c,B,Ie,Ae,L,G)));let $e=(Je,ze,dt)=>{if(ze.x<0||ze.x>=st||ze.y<0||ze.y>=st)return;let it=null;if(V){let{x:et,y:Ye,z:It}=C.projectTilePoint(ze.x,ze.y,dt);it={anchor:new Sa(et,Ye,It,0,void 0),up:C.upVector(dt,ze.x,ze.y)}}(function(et,Ye,It,ht,mt,Vt,Xt,Jt,qt,rn,tn,Wn,zn,Pt,Dn,Rn,ri,yi,Mi,vi,fi,Ei,Pi,nr,ei,zr,vs){let Vo=et.addToLineVertexArray(Ye,ht),jo,pu,Zl,mu,Hp,aD,lD,cD=0,uD=0,hD=0,dD=0,Xx=-1,Yx=-1,Gs={},fD=br(""),gu=It?It.anchor:Ye,Jx=qt.layout.get("icon-text-fit").evaluate(fi,{},ei)!=="none",Kx=0,Qx=0;if(qt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Kx,Qx]=qt.layout.get("text-offset").evaluate(fi,{},ei).map(eo=>eo*tr):(Kx=qt.layout.get("text-radial-offset").evaluate(fi,{},ei)*tr,Qx=yx),et.allowVerticalPlacement&&mt.vertical){let eo=mt.vertical;if(Dn)aD=xx(eo),Jt&&(lD=xx(Jt));else{let to=qt.layout.get("text-rotate").evaluate(fi,{},ei)+90;Zl=E_(rn,gu,Ye,tn,Wn,zn,eo,Pt,to,Rn),Jt&&(mu=E_(rn,gu,Ye,tn,Wn,zn,Jt,yi,to))}}if(Vt){let eo=qt.layout.get("icon-rotate").evaluate(fi,{},ei),to=NT(Vt,eo,Pi,Jx,Ei.iconScaleFactor),Qh=Jt?NT(Jt,eo,Pi,Jx,Ei.iconScaleFactor):void 0;pu=E_(rn,gu,Ye,tn,Wn,zn,Vt,yi,eo),cD=4*to.length;let pD=et.iconSizeData,_u=null;pD.kind==="source"?(_u=[ps*qt.layout.get("icon-size").evaluate(fi,{},ei)*Ei.iconScaleFactor],_u[0]>Gl&&fn(`${et.layerIds[0]}: Value for "icon-size" is >= ${Dp}. Reduce your "icon-size".`)):pD.kind==="composite"&&(_u=[ps*Ei.compositeIconSizes[0].evaluate(fi,{},ei)*Ei.iconScaleFactor,ps*Ei.compositeIconSizes[1].evaluate(fi,{},ei)*Ei.iconScaleFactor],(_u[0]>Gl||_u[1]>Gl)&&fn(`${et.layerIds[0]}: Value for "icon-size" is >= ${Dp}. Reduce your "icon-size".`)),et.addSymbols(et.icon,to,_u,vi,Mi,fi,!1,It,Ye,Vo.lineStartIndex,Vo.lineLength,-1,nr,ei,zr,vs),Xx=et.icon.placedSymbolArray.length-1,Qh&&(uD=4*Qh.length,et.addSymbols(et.icon,Qh,_u,vi,Mi,fi,vo.vertical,It,Ye,Vo.lineStartIndex,Vo.lineLength,-1,nr,ei,zr,vs),Yx=et.icon.placedSymbolArray.length-1)}for(let eo in mt.horizontal){let to=mt.horizontal[eo];jo||(fD=br(to.text),Dn?Hp=xx(to):jo=E_(rn,gu,Ye,tn,Wn,zn,to,Pt,qt.layout.get("text-rotate").evaluate(fi,{},ei),Rn));let Qh=to.positionedLines.length===1;if(hD+=VT(et,It,Ye,to,Xt,qt,Dn,fi,Rn,Vo,mt.vertical?vo.horizontal:vo.horizontalOnly,Qh?Object.keys(mt.horizontal):[eo],Gs,Xx,Ei,nr,ei,zr),Qh)break}mt.vertical&&(dD+=VT(et,It,Ye,mt.vertical,Xt,qt,Dn,fi,Rn,Vo,vo.vertical,["vertical"],Gs,Yx,Ei,nr,ei,zr));let Xl=-1,eb=(eo,to)=>eo?Math.max(eo,to):to;Xl=eb(Hp,Xl),Xl=eb(aD,Xl),Xl=eb(lD,Xl);let NL=Xl>-1?1:0;et.glyphOffsetArray.length>=65535&&fn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),fi.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,fi.sortKey),et.symbolInstances.emplaceBack(Ye.x,Ye.y,gu.x,gu.y,gu.z,Gs.right>=0?Gs.right:-1,Gs.center>=0?Gs.center:-1,Gs.left>=0?Gs.left:-1,Gs.vertical>=0?Gs.vertical:-1,Xx,Yx,fD,jo!==void 0?jo:et.collisionBoxArray.length,jo!==void 0?jo+1:et.collisionBoxArray.length,Zl!==void 0?Zl:et.collisionBoxArray.length,Zl!==void 0?Zl+1:et.collisionBoxArray.length,pu!==void 0?pu:et.collisionBoxArray.length,pu!==void 0?pu+1:et.collisionBoxArray.length,mu||et.collisionBoxArray.length,mu?mu+1:et.collisionBoxArray.length,tn,hD,dD,cD,uD,NL,0,Kx,Qx,Xl,0,Jx?1:0)})(l,ze,it,Je,i,c,p,De,l.layers[0],l.collisionBoxArray,e.index,e.sourceLayerIndex,l.index,se,me,I,0,ee,te,L,e,u,D,_,E,w,T)};if(de==="line")for(let Je of PT(e.geometry,0,0,st,st)){let ze=_k(Je,J,ne,i.vertical||B,c,N,H,l.overscaling,st);for(let dt of ze)B&&Ek(l,B.text,ve,dt)||$e(Je,dt,E)}else if(de==="line-center"){for(let Je of e.geometry)if(Je.length>1){let ze=gk(Je,ne,i.vertical||B,c,N,H);ze&&$e(Je,ze,E)}}else if(e.type==="Polygon")for(let Je of u_(e.geometry,0)){let ze=vk(Je,16);$e(Je[0],new Sa(ze.x,ze.y,0,0,void 0),E)}else if(e.type==="LineString")for(let Je of e.geometry)$e(Je,new Sa(Je[0].x,Je[0].y,0,0,void 0),E);else if(e.type==="Point")for(let Je of e.geometry)for(let ze of Je)$e([ze],new Sa(ze.x,ze.y,0,0,void 0),E)}let Dp=255,Gl=Dp*ps;function VT(l,e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k,L){let B=function(G,H,J,se,ee,ne,me,te){let de=[];if(H.positionedLines.length===0)return de;let ve=se.layout.get("text-rotate").evaluate(ne,{})*Math.PI/180,xe=function($e){let Je=$e[0],ze=$e[1],dt=Je*ze;return dt>0?[Je,-ze]:dt<0?[-Je,ze]:Je===0?[ze,Je]:[ze,-Je]}(J),Ie=Math.abs(H.top-H.bottom);for(let $e of H.positionedLines)Ie-=$e.lineOffset;let Ae=H.positionedLines.length,Pe=Ie/Ae,De=H.top-J[1];for(let $e=0;$e<Ae;++$e){let Je=H.positionedLines[$e];De=yk(H,Pe,De,$e);for(let ze of Je.positionedGlyphs){if(!ze.rect)continue;let dt=ze.rect||{},it=xT+1,et=!0,Ye=1,It=0;if(ze.imageName){let vi=me[ze.imageName];if(!vi)continue;if(vi.sdf){fn("SDF images are not supported in formatted text and will be ignored.");continue}et=!1,Ye=vi.pixelRatio,it=Tp/Ye}let ht=(ee||te)&&ze.vertical,mt=ze.metrics.advance*ze.scale/2,Vt=ze.metrics,Xt=ze.rect;if(Xt===null)continue;te&&H.verticalizable&&(It=ze.imageName?mt-ze.metrics.width*ze.scale/2:0);let Jt=ee?[ze.x+mt,ze.y]:[0,0],qt=[0,0],rn=[0,0],tn=!1;ee||(ht?(rn=[ze.x+mt+xe[0],ze.y+xe[1]-It],tn=!0):qt=[ze.x+mt+J[0],ze.y+J[1]-It]);let Wn=Xt.w*ze.scale/(Ye*(ze.localGlyph?ms:1)),zn=Xt.h*ze.scale/(Ye*(ze.localGlyph?ms:1)),Pt,Dn,Rn,ri;if(ht){let vi=ze.y-De,fi=new ot(-mt,mt-vi),Ei=-Math.PI/2,Pi=new ot(...rn);Pt=new ot(-mt+qt[0],qt[1]),Pt._rotateAround(Ei,fi)._add(Pi),Pt.x+=-vi+mt,Pt.y-=(Vt.left-it)*ze.scale;let nr=ze.imageName?Vt.advance*ze.scale:tr*ze.scale,ei=String.fromCodePoint(ze.glyph);ak(ei)?Pt.x+=(1-it)*ze.scale:lk(ei)?Pt.x+=nr-Vt.height*ze.scale+(-it-1)*ze.scale:Pt.x+=ze.imageName||Vt.width+2*it===Xt.w&&Vt.height+2*it===Xt.h?(nr-zn)/2:(nr-(Vt.height+2*it)*ze.scale)/2,Dn=new ot(Pt.x,Pt.y-Wn),Rn=new ot(Pt.x+zn,Pt.y),ri=new ot(Pt.x+zn,Pt.y-Wn)}else{let vi=(Vt.left-it)*ze.scale-mt+qt[0],fi=(-Vt.top-it)*ze.scale+qt[1],Ei=vi+Wn,Pi=fi+zn;Pt=new ot(vi,fi),Dn=new ot(Ei,fi),Rn=new ot(vi,Pi),ri=new ot(Ei,Pi)}if(ve){let vi;vi=ee?new ot(0,0):tn?new ot(xe[0],xe[1]):new ot(J[0],J[1]),Pt._rotateAround(ve,vi),Dn._rotateAround(ve,vi),Rn._rotateAround(ve,vi),ri._rotateAround(ve,vi)}let yi=new ot(0,0),Mi=new ot(0,0);de.push({tl:Pt,tr:Dn,bl:Rn,br:ri,texPrimary:dt,texSecondary:void 0,writingMode:H.writingMode,glyphOffset:Jt,sectionIndex:ze.sectionIndex,isSDF:et,pixelOffsetTL:yi,pixelOffsetBR:Mi,minFontScaleX:0,minFontScaleY:0})}}return de}(0,c,I,u,m,x,p,l.allowVerticalPlacement),V=l.textSizeData,N=null;V.kind==="source"?(N=[ps*u.layout.get("text-size").evaluate(x,{},k)*T.textScaleFactor],N[0]>Gl&&fn(`${l.layerIds[0]}: Value for "text-size" is >= ${Dp}. Reduce your "text-size".`)):V.kind==="composite"&&(N=[ps*T.compositeTextSizes[0].evaluate(x,{},k)*T.textScaleFactor,ps*T.compositeTextSizes[1].evaluate(x,{},k)*T.textScaleFactor],(N[0]>Gl||N[1]>Gl)&&fn(`${l.layerIds[0]}: Value for "text-size" is >= ${Dp}. Reduce your "text-size".`)),l.addSymbols(l.text,B,N,I,m,x,_,e,i,D.lineStartIndex,D.lineLength,w,S,k,L,!1);for(let G of E)C[G]=l.text.placedSymbolArray.length-1;return 4*B.length}function jT(l){for(let e in l)return l[e];return null}function E_(l,e,i,c,p,u,m,x,I,D){let _=m.top,E=m.bottom,C=m.left,w=m.right,T=m.collisionPadding;if(T&&(C-=T[0],_-=T[1],w+=T[2],E+=T[3]),I){let S=new ot(C,_),k=new ot(w,_),L=new ot(C,E),B=new ot(w,E),V=ln(I),N=new ot(0,0);D&&(N=new ot(D[0],D[1])),S._rotateAround(V,N),k._rotateAround(V,N),L._rotateAround(V,N),B._rotateAround(V,N),C=Math.min(S.x,k.x,L.x,B.x),w=Math.max(S.x,k.x,L.x,B.x),_=Math.min(S.y,k.y,L.y,B.y),E=Math.max(S.y,k.y,L.y,B.y)}return l.emplaceBack(e.x,e.y,e.z,i.x,i.y,C,_,w,E,x,c,p,u),l.length-1}function xx(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);let e=l.bottom-l.top;return e>0?Math.max(10,e):null}function Ek(l,e,i,c){let p=l.compareText;if(e in p){let u=p[e];for(let m=u.length-1;m>=0;m--)if(c.dist(u[m])<i)return!0}else p[e]=[];return p[e].push(c),!1}function UT(l,e){let i=l.fovAboveCenter,c=l.elevation?l.elevation.getMinElevationBelowMSL()*e:0,p=(l._camera.position[2]*l.worldSize-c)/Math.cos(l._pitch),u=Math.sin(i)*p/Math.sin(Math.max(Math.PI/2-l._pitch-i,.01)),m=Math.sin(l._pitch)*u+p,x=p*(1/l._horizonShift);return l.elevation&&l.elevation.exaggeration()!==0||(m*=1+Math.max(l.zoom-17,0)),Math.min(1.01*m,x)}function Mp(l,e){if(!e.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:e};let i=Math.pow(2,-l.z),c=l.x*i,p=(l.x+1)*i,u=l.y*i,m=(l.y+1)*i,x=Q(c),I=Q(p),D=re(u),_=re(m),E=e.project(x,D),C=e.project(I,D),w=e.project(I,_),T=e.project(x,_),S=Math.min(E.x,C.x,w.x,T.x),k=Math.min(E.y,C.y,w.y,T.y),L=Math.max(E.x,C.x,w.x,T.x),B=Math.max(E.y,C.y,w.y,T.y),V=i/16;function N(H,J,se,ee,ne,me){let te=(se+ne)/2,de=(ee+me)/2,ve=e.project(Q(te),re(de)),xe=Math.max(0,S-ve.x,k-ve.y,ve.x-L,ve.y-B);S=Math.min(S,ve.x),L=Math.max(L,ve.x),k=Math.min(k,ve.y),B=Math.max(B,ve.y),xe>V&&(N(H,ve,se,ee,te,de),N(ve,J,te,de,ne,me))}N(E,C,c,u,p,u),N(C,w,p,u,p,m),N(w,T,p,m,c,m),N(T,E,c,m,c,u),S-=V,k-=V,L+=V,B+=V;let G=1/Math.max(L-S,B-k);return{scale:G,x:S*G,y:k*G,x2:L*G,y2:B*G,projection:e}}function $T(l,{x:e,y:i},c=0){return new ot(((e-c)*l.scale-l.x)*st,(i*l.scale-l.y)*st)}let Ik=Ee.mat4.identity(new Float32Array(16));class Hl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new P(0,0)}projectTilePoint(e,i,c){return{x:e,y:i,z:0}}locationPoint(e,i,c=!0){return e._coordinatePoint(e.locationCoordinate(i),c)}pixelsPerMeter(e,i){return Z(1,e)*i}pixelSpaceConversion(e,i,c){return 1}farthestPixelDistance(e){return UT(e,e.pixelsPerMeter)}pointCoordinate(e,i,c,p){let u=e.horizonLineFromTop(!1),m=new ot(i,Math.max(u,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,p))}pointCoordinate3D(e,i,c){let p=new ot(i,c);if(e.elevation)return e.elevation.pointCoordinate(p);{let u=this.pointCoordinate(e,p.x,p.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);let c=e.horizonLineFromTop();return i.y<c}createInversionMatrix(e,i){return Ik}createTileMatrix(e,i,c){let p,u,m,x=c.canonical,I=Ee.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let D=Mp(x,this);p=1,u=D.x+c.wrap*D.scale,m=D.y,Ee.mat4.scale(I,I,[p/D.scale,p/D.scale,e.pixelsPerMeter/i])}else p=i/e.zoomScale(x.z),u=(x.x+Math.pow(2,x.z)*c.wrap)*p,m=x.y*p;return Ee.mat4.translate(I,I,[u,m,0]),Ee.mat4.scale(I,I,[p/st,p/st,1]),I}upVector(e,i,c){return[0,0,1]}upVectorScale(e,i,c){return{metersToTile:1}}}class Tk extends Hl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[i,c]=this.parallels=e.parallels||[29.5,45.5],p=Math.sin(ln(i));this.n=(p+Math.sin(ln(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(e,i){let{n:c,c:p,r0:u}=this,m=ln(e-this.center[0]),x=ln(i),I=Math.sqrt(p-2*c*Math.sin(x))/c;return{x:I*Math.sin(m*c),y:I*Math.cos(m*c)-u,z:0}}unproject(e,i){let{n:c,c:p,r0:u}=this,m=u+i,x=Math.atan2(e,Math.abs(m))*Math.sign(m);m*c<0&&(x-=Math.PI*Math.sign(e)*Math.sign(m));let I=ln(this.center[0])*c;x=es(x,-Math.PI-I,Math.PI-I);let D=jt($i(x/c)+this.center[0],-180,180),_=Math.asin(jt((p-(e*e+m*m)*c*c)/(2*c),-1,1)),E=jt($i(_),-ae,ae);return new P(D,E)}}let Sp=1.340264,Ap=-.081106,Rp=893e-6,Pp=.003796,I_=Math.sqrt(3)/2;class Ck extends Hl{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;let c=Math.asin(I_*Math.sin(i)),p=c*c,u=p*p*p;return{x:.5*(e*Math.cos(c)/(I_*(Sp+3*Ap*p+u*(7*Rp+9*Pp*p)))/Math.PI+.5),y:1-.5*(c*(Sp+Ap*p+u*(Rp+Pp*p))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let c=i=(2*(1-i)-1)*Math.PI,p=c*c,u=p*p*p;for(let _,E,C,w=0;w<12&&(E=c*(Sp+Ap*p+u*(Rp+Pp*p))-i,C=Sp+3*Ap*p+u*(7*Rp+9*Pp*p),_=E/C,c=jt(c-_,-Math.PI/3,Math.PI/3),p=c*c,u=p*p*p,!(Math.abs(_)<1e-12));++w);let m=I_*e*(Sp+3*Ap*p+u*(7*Rp+9*Pp*p))/Math.cos(c),x=Math.asin(Math.sin(c)/I_),I=jt(180*m/Math.PI,-180,180),D=jt(180*x/Math.PI,-ae,ae);return new P(I,D)}}class Dk extends Hl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){let c=360*(e-.5),p=jt(360*(.5-i),-ae,ae);return new P(c,p)}}let Wh=Math.PI/2;function T_(l){return Math.tan((Wh+l)/2)}class Mk extends Hl{constructor(e){super(e),this.center=e.center||[0,30];let[i,c]=this.parallels=e.parallels||[30,30],p=ln(i),u=ln(c);this.southernCenter=p+u<0,this.southernCenter&&(p=-p,u=-u);let m=Math.cos(p),x=T_(p);this.n=p===u?Math.sin(p):Math.log(m/Math.cos(u))/Math.log(T_(u)/x),this.f=m*Math.pow(T_(p),this.n)/this.n}project(e,i){i=ln(i),this.southernCenter&&(i=-i),e=ln(e-this.center[0]);let c=1e-6,{n:p,f:u}=this;u>0?i<-Wh+c&&(i=-Wh+c):i>Wh-c&&(i=Wh-c);let m=u/Math.pow(T_(i),p),x=m*Math.sin(p*e),I=u-m*Math.cos(p*e);return x=.5*(x/Math.PI+.5),I=.5*(I/Math.PI+.5),{x,y:this.southernCenter?I:1-I,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;let{n:c,f:p}=this,u=p-i,m=Math.sign(u),x=Math.sign(c)*Math.sqrt(e*e+u*u),I=Math.atan2(e,Math.abs(u))*m;u*c<0&&(I-=Math.PI*Math.sign(e)*m);let D=jt($i(I/c)+this.center[0],-180,180),_=jt($i(2*Math.atan(Math.pow(p/x,1/c))-Wh),-ae,ae);return new P(D,this.southernCenter?-_:_)}}class GT extends Hl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:q(e),y:X(i),z:0}}unproject(e,i){let c=Q(e),p=re(i);return new P(c,p)}}let HT=ln(ae);class Sk extends Hl{project(e,i){let c=(i=ln(i))*i,p=c*c;return{x:.5*((e=ln(e))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let c=i=(2*(1-i)-1)*Math.PI,p=25,u=0,m=c*c;do{m=c*c;let D=m*m;u=(c*(1.007226+m*(.015085+D*(.028874*m-.044475-.005916*D)))-i)/(1.007226+m*(.045255+D*(.259866*m-.311325-.005916*11*D))),c=jt(c-u,-HT,HT)}while(Math.abs(u)>1e-6&&--p>0);m=c*c;let x=jt($i(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),I=$i(c);return new P(x,I)}}let qT=ln(ae);class Ak extends Hl{project(e,i){i=ln(i),e=ln(e);let c=Math.cos(i),p=2/Math.PI,u=Math.acos(c*Math.cos(e/2)),m=Math.sin(u)/u,x=.5*(e*p+2*c*Math.sin(e/2)/m)||0,I=.5*(i+Math.sin(i)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(I/Math.PI+1),z:0}}unproject(e,i){let c=e=(2*e-.5)*Math.PI,p=i=(2*(1-i)-1)*Math.PI,u=25,m=1e-6,x=0,I=0;do{let D=Math.cos(p),_=Math.sin(p),E=2*_*D,C=_*_,w=D*D,T=Math.cos(c/2),S=Math.sin(c/2),k=2*T*S,L=S*S,B=1-w*T*T,V=B?1/B:0,N=B?Math.acos(D*T)*Math.sqrt(1/B):0,G=.5*(2*N*D*S+2*c/Math.PI)-e,H=.5*(N*_+p)-i,J=.5*V*(w*L+N*D*T*C)+1/Math.PI,se=V*(k*E/4-N*_*S),ee=.125*V*(E*S-N*_*w*k),ne=.5*V*(C*T+N*L*D)+.5,me=se*ee-ne*J;x=(H*se-G*ne)/me,I=(G*ee-H*J)/me,c=jt(c-x,-Math.PI,Math.PI),p=jt(p-I,-qT,qT)}while((Math.abs(x)>m||Math.abs(I)>m)&&--u>0);return new P($i(c),$i(p))}}class WT extends Hl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ln(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){let{scale:c,cosPhi:p}=this;return{x:ln(e)*p*c+.5,y:-Math.sin(ln(i))/p*c+.5,z:0}}unproject(e,i){let{scale:c,cosPhi:p}=this,u=-(i-.5)/c,m=jt($i((e-.5)/c)/p,-180,180),x=Math.asin(jt(u*p,-1,1)),I=jt($i(x),-ae,ae);return new P(m,I)}}class Rk extends GT{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,c){let p=dp(e,i,c),u=s_(Us(c));return Ee.vec3.transformMat4(p,p,u),{x:p[0],y:p[1],z:p[2]}}locationPoint(e,i){let c=M(i.lat,i.lng),p=Ee.vec3.normalize([],c),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,m=Z(1,0)*st*u;Ee.vec3.scaleAndAdd(c,c,p,m);let x=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.multiply(x,e.pixelMatrix,e.globeMatrix),Ee.vec3.transformMat4(c,c,x),new ot(c[0],c[1])}pixelsPerMeter(e,i){return Z(1,0)*i}pixelSpaceConversion(e,i,c){let p=Z(1,e)*i,u=Rt(Z(1,45)*i,p,c);return this.pixelsPerMeter(e,i)/u}createTileMatrix(e,i,c){let p=$0(Us(c.canonical));return Ee.mat4.multiply(new Float64Array(16),e.globeMatrix,p)}createInversionMatrix(e,i){let{center:c}=e,p=s_(Us(i));return Ee.mat4.rotateY(p,p,ln(c.lng)),Ee.mat4.rotateX(p,p,ln(c.lat)),Ee.mat4.scale(p,p,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(e,i,c,p){return Bl(e,i,c,!0)||new be(0,0)}pointCoordinate3D(e,i,c){let p=this.pointCoordinate(e,i,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(e,i){return!Bl(e,i.x,i.y,!1)}farthestPixelDistance(e){let i=function(p,u){let m=p.cameraToCenterDistance,x=p._centerAltitude*u,I=p._camera,D=p._camera.forward(),_=Ee.vec3.add([],Ee.vec3.scale([],D,-m),[0,0,x]),E=p.worldSize/(2*Math.PI),C=[0,0,-E],w=p.width/p.height,T=Math.tan(p.fovAboveCenter),S=Ee.vec3.scale([],I.up(),T),k=Ee.vec3.scale([],I.right(),T*w),L=Ee.vec3.normalize([],Ee.vec3.add([],Ee.vec3.add([],D,S),k)),B=[],V;if(new Ir(_,L).closestPointOnSphere(C,E,B)){let N=Ee.vec3.add([],B,C),G=Ee.vec3.sub([],N,_);V=Math.cos(p.fovAboveCenter)*Ee.vec3.length(G)}else{let N=Ee.vec3.sub([],_,C),G=Ee.vec3.sub([],C,_);Ee.vec3.normalize(G,G);let H=Ee.vec3.length(N)-E;V=Math.sqrt(H*(H+2*E));let J=Math.acos(V/(E+H))-Math.acos(Ee.vec3.dot(D,G));V*=Math.cos(J)}return 1.01*V}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=Vl(e.zoom);if(c>0){let p=UT(e,Z(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Rt(i,p+u*(1-Math.cos(m)),Math.pow(c,10))}return i}upVector(e,i,c){return dp(i,c,e,1)}upVectorScale(e){return{metersToTile:zl(o_(Us(e)))}}}function ZT(l){let e=l.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(l.name){case"mercator":return new GT(l);case"equirectangular":return new Dk(l);case"naturalEarth":return new Sk(l);case"equalEarth":return new Ck(l);case"winkelTripel":return new Ak(l);case"albers":return i?new WT(l):new Tk(l);case"lambertConformalConic":return i?new WT(l):new Mk(l);case"globe":return new Rk(l)}throw new Error(`Invalid projection name: ${l.name}`)}let Pk=Uh.VectorTileFeature.types,Ok=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function C_(l,e,i,c,p,u,m,x,I,D,_,E,C){let w=x?Math.min(Gl,Math.round(x[0])):0,T=x?Math.min(Gl,Math.round(x[1])):0;l.emplaceBack(e,i,Math.round(32*c),Math.round(32*p),u,m,(w<<1)+(I?1:0),T,16*D,16*_,256*E,256*C)}function D_(l,e,i){l.emplaceBack(e,i)}function M_(l,e,i,c,p,u,m){l.emplaceBack(e,i,c,p,u,m)}function S_(l,e,i,c,p){l.emplaceBack(e,i,c,p),l.emplaceBack(e,i,c,p),l.emplaceBack(e,i,c,p),l.emplaceBack(e,i,c,p)}function kk(l){for(let e of l.sections)if(S0(e.text))return!0;return!1}class bx{constructor(e){this.layoutVertexArray=new Rl,this.indexArray=new si,this.programConfigurations=e,this.segments=new pi,this.dynamicLayoutVertexArray=new as,this.opacityVertexArray=new Qf,this.placedSymbolArray=new rp,this.iconTransitioningVertexArray=new js,this.globeExtVertexArray=new Kf,this.zOffsetVertexArray=new Ll}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,c,p,u){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,JO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,QO.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ok,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,tk.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,KO.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,ek.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ft(bx,"SymbolBuffers");class wx{constructor(e,i,c){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new c,this.segments=new pi,this.collisionVertexArray=new Ol,this.collisionVertexArrayExt=new as}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,nk.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,ik.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ft(wx,"CollisionBuffers");class A_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ee.mat4.identity([]),this.placementViewportMatrix=Ee.mat4.identity([]);let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ux(this.zoom,i["text-size"]),this.iconSizeData=ux(this.zoom,i["icon-size"]);let c=this.layers[0].layout,p=c.get("symbol-sort-key"),u=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>vo[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new bx(new No(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new bx(new No(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Wg,this.lineVertexArray=new Nh,this.symbolInstances=new op}calculateGlyphDependencies(e,i,c,p,u){for(let m of e){let x=m.codePointAt(0);if(x===void 0)break;if(i[x]=!0,p&&u&&x<=65535){let I=Ep[m];I&&(i[I.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;let c=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!ix(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(e,i,c,p){let u=this.layers[0],m=u.layout,x=this.projection.name==="globe",I=m.get("text-font"),D=m.get("text-field"),_=m.get("icon-image"),E=(D.value.kind!=="constant"||D.value.value instanceof cr&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),C=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,w=m.get("symbol-sort-key");if(this.features=[],!E&&!C)return;let T=i.iconDependencies,S=i.glyphDependencies,k=i.availableImages,L=new li(this.zoom);for(let{feature:B,id:V,index:N,sourceLayerIndex:G}of e){let H=u._featureFilter.needGeometry,J=qe(B,H);if(!u._featureFilter.filter(L,J,c))continue;if(H||(J.geometry=Ce(B,c,p)),x&&B.type!==1&&c.z<=5){let me=J.geometry,te=.98078528056,de=(ve,xe)=>{let Ie=dp(ve.x,ve.y,c,1),Ae=dp(xe.x,xe.y,c,1);return Ee.vec3.dot(Ie,Ae)<te};for(let ve=0;ve<me.length;ve++)me[ve]=Ve(me[ve],de)}let se,ee;if(E){let me=u.getValueAndResolveTokens("text-field",J,c,k),te=cr.factory(me);kk(te)&&(this.hasRTLText=!0),(!this.hasRTLText||Gf()==="unavailable"||this.hasRTLText&&Fr.isParsed())&&(se=sk(te,u,J))}if(C){let me=u.getValueAndResolveTokens("icon-image",J,c,k);ee=me instanceof fr?me:fr.fromString(me)}if(!se&&!ee)continue;let ne=this.sortFeaturesByKey?w.evaluate(J,{},c):void 0;if(this.features.push({id:V,text:se,icon:ee,index:N,sourceLayerIndex:G,geometry:J.geometry,properties:B.properties,type:Pk[B.type],sortKey:ne}),ee&&(T[ee.namePrimary]=!0,ee.nameSecondary&&(T[ee.nameSecondary]=!0)),se){let me=I.evaluate(J,{},c).join(","),te=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(vo.vertical)>=0;for(let de of se.sections)if(de.image)T[de.image.namePrimary]=!0;else{let ve=Bf(se.toString()),xe=de.fontStack||me,Ie=S[xe]=S[xe]||{};this.calculateGlyphDependencies(de.text,Ie,te,this.allowVerticalPlacement,ve)}}}m.get("symbol-placement")==="line"&&(this.features=function(B){let V={},N={},G=[],H=0;function J(me){G.push(B[me]),H++}function se(me,te,de){let ve=N[me];return delete N[me],N[te]=ve,G[ve].geometry[0].pop(),G[ve].geometry[0]=G[ve].geometry[0].concat(de[0]),ve}function ee(me,te,de){let ve=V[te];return delete V[te],V[me]=ve,G[ve].geometry[0].shift(),G[ve].geometry[0]=de[0].concat(G[ve].geometry[0]),ve}function ne(me,te,de){let ve=de?te[0][te[0].length-1]:te[0][0];return`${me}:${ve.x}:${ve.y}`}for(let me=0;me<B.length;me++){let te=B[me],de=te.geometry,ve=te.text?te.text.toString():null;if(!ve){J(me);continue}let xe=ne(ve,de),Ie=ne(ve,de,!0);if(xe in N&&Ie in V&&N[xe]!==V[Ie]){let Ae=ee(xe,Ie,de),Pe=se(xe,Ie,G[Ae].geometry);delete V[xe],delete N[Ie],N[ne(ve,G[Pe].geometry,!0)]=Pe,G[Ae].geometry=null}else xe in N?se(xe,Ie,de):Ie in V?ee(xe,Ie,de):(J(me),V[xe]=H-1,N[Ie]=H-1)}return G.filter(me=>me.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((B,V)=>B.sortKey-V.sortKey)}update(e,i,c,p,u){let m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;let x=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,x,c,p,u),this.icon.programConfigurations.updatePaintArrays(e,i,x,c,p,u)}updateZOffset(){let e=(u,m,x)=>{c+=m,c>u.length&&u.resize(c);for(let I=-m;I<0;I++)u.emplace(I+c,x)},i=(u,m,x)=>{p+=m,p>u.length&&u.resize(p);for(let I=-m;I<0;I++)u.emplace(I+p,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,p=0;for(let u=0;u<this.symbolInstances.length;u++){let m=this.symbolInstances.get(u),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:I,numIconVertices:D}=m,_=m.zOffset,E=D>0;if((x>0||I>0)&&(e(this.text.zOffsetVertexArray,x,_),e(this.text.zOffsetVertexArray,I,_)),E){let{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:w}=m;C>=0&&i(this.icon.zOffsetVertexArray,D,_),w>=0&&i(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ZT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){let c=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:p,y:u}of i)this.lineVertexArray.emplaceBack(p,u);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,i,c,p,u,m,x,I,D,_,E,C,w,T,S,k){let L=e.indexArray,B=e.layoutVertexArray,V=e.globeExtVertexArray,N=e.segments.prepareSegment(4*i.length,B,L,this.canOverlap?m.sortKey:void 0),G=this.glyphOffsetArray.length,H=N.vertexLength,J=this.allowVerticalPlacement&&x===vo.vertical?Math.PI/2:0,se=m.text&&m.text.sections;for(let ne=0;ne<i.length;ne++){let{tl:me,tr:te,bl:de,br:ve,texPrimary:xe,texSecondary:Ie,pixelOffsetTL:Ae,pixelOffsetBR:Pe,minFontScaleX:De,minFontScaleY:$e,glyphOffset:Je,isSDF:ze,sectionIndex:dt}=i[ne],it=N.vertexLength,et=Je[1];if(C_(B,D.x,D.y,me.x,et+me.y,xe.x,xe.y,c,ze,Ae.x,Ae.y,De,$e),C_(B,D.x,D.y,te.x,et+te.y,xe.x+xe.w,xe.y,c,ze,Pe.x,Ae.y,De,$e),C_(B,D.x,D.y,de.x,et+de.y,xe.x,xe.y+xe.h,c,ze,Ae.x,Pe.y,De,$e),C_(B,D.x,D.y,ve.x,et+ve.y,xe.x+xe.w,xe.y+xe.h,c,ze,Pe.x,Pe.y,De,$e),I){let{x:Ye,y:It,z:ht}=I.anchor,[mt,Vt,Xt]=I.up;M_(V,Ye,It,ht,mt,Vt,Xt),M_(V,Ye,It,ht,mt,Vt,Xt),M_(V,Ye,It,ht,mt,Vt,Xt),M_(V,Ye,It,ht,mt,Vt,Xt),S_(e.dynamicLayoutVertexArray,Ye,It,ht,J)}else S_(e.dynamicLayoutVertexArray,D.x,D.y,D.z,J);if(k){let Ye=Ie||xe;D_(e.iconTransitioningVertexArray,Ye.x,Ye.y),D_(e.iconTransitioningVertexArray,Ye.x+Ye.w,Ye.y),D_(e.iconTransitioningVertexArray,Ye.x,Ye.y+Ye.h),D_(e.iconTransitioningVertexArray,Ye.x+Ye.w,Ye.y+Ye.h)}L.emplaceBack(it,it+1,it+2),L.emplaceBack(it+1,it+2,it+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),ne!==i.length-1&&dt===i[ne+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,m,m.index,{},w,T,S,se&&se[dt])}let ee=I?I.anchor:D;e.placedSymbolArray.emplaceBack(ee.x,ee.y,ee.z,D.x,D.y,G,this.glyphOffsetArray.length-G,H,_,E,D.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],x,0,!1,0,C,0)}_commitLayoutVertex(e,i,c,p,u,m,x){e.emplaceBack(i,c,p,u,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,c,p,u,m,x){let I=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),D=I.vertexLength,_=x.tileAnchorX,E=x.tileAnchorY;for(let w=0;w<4;w++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,i,e.padding,x.zOffset),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,_,E,new ot(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,_,E,new ot(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,_,E,new ot(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,u,m,_,E,new ot(e.x1,e.y2)),I.vertexLength+=4;let C=c.indexArray;C.emplaceBack(D,D+1),C.emplaceBack(D+1,D+2),C.emplaceBack(D+2,D+3),C.emplaceBack(D+3,D),I.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,c,p,u,m){for(let x=p;x<u;x++){let I=c.get(x),D=this.getSymbolInstanceTextSize(e,m,i,x);this._addCollisionDebugVertices(I,D,this.textCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,i,c,p,u,m){for(let x=p;x<u;x++){let I=c.get(x),D=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(I,D,this.iconCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,i,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new wx(Rh,gT.members,js),this.iconCollisionBox=new wx(Rh,gT.members,js);let p=$h(this.iconSizeData,e),u=$h(this.textSizeData,e,c);for(let m=0;m<this.symbolInstances.length;m++){let x=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(u,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(u,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(p,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(p,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,i,c,p){let u=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:p),m=__(this.textSizeData,e,u)/tr;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,i,c){let p=this.icon.placedSymbolArray.get(c),u=__(this.iconSizeData,e,p);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,i,c,p){e.emplaceBack(i,-c,-c,p),e.emplaceBack(i,c,-c,p),e.emplaceBack(i,c,c,p),e.emplaceBack(i,-c,c,p)}_updateTextDebugCollisionBoxes(e,i,c,p,u,m,x){for(let I=p;I<u;I++){let D=c.get(I),_=this.getSymbolInstanceTextSize(e,m,i,I);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,D.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,i,c,p,u,m,x){for(let I=p;I<u;I++){let D=c.get(I),_=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,D.padding,m.zOffset)}}updateCollisionDebugBuffers(e,i,c,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let u=$h(this.iconSizeData,e,p),m=$h(this.textSizeData,e,c);for(let x=0;x<this.symbolInstances.length;x++){let I=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(m,e,i,I.textBoxStartIndex,I.textBoxEndIndex,I,c),this._updateTextDebugCollisionBoxes(m,e,i,I.verticalTextBoxStartIndex,I.verticalTextBoxEndIndex,I,c),this._updateIconDebugCollisionBoxes(u,e,i,I.iconBoxStartIndex,I.iconBoxEndIndex,I,p),this._updateIconDebugCollisionBoxes(u,e,i,I.verticalIconBoxStartIndex,I.verticalIconBoxEndIndex,I,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,c,p,u,m,x,I,D){let _={};if(i<c){let{x1:E,y1:C,x2:w,y2:T,padding:S,projectedAnchorX:k,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:G}=e.get(i);_.textBox={x1:E,y1:C,x2:w,y2:T,padding:S,projectedAnchorX:k,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.textFeatureIndex=G}if(p<u){let{x1:E,y1:C,x2:w,y2:T,padding:S,projectedAnchorX:k,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:G}=e.get(p);_.verticalTextBox={x1:E,y1:C,x2:w,y2:T,padding:S,projectedAnchorX:k,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.verticalTextFeatureIndex=G}if(m<x){let{x1:E,y1:C,x2:w,y2:T,padding:S,projectedAnchorX:k,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:G}=e.get(m);_.iconBox={x1:E,y1:C,x2:w,y2:T,padding:S,projectedAnchorX:k,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.iconFeatureIndex=G}if(I<D){let{x1:E,y1:C,x2:w,y2:T,padding:S,projectedAnchorX:k,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N,featureIndex:G}=e.get(I);_.verticalIconBox={x1:E,y1:C,x2:w,y2:T,padding:S,projectedAnchorX:k,projectedAnchorY:L,projectedAnchorZ:B,tileAnchorX:V,tileAnchorY:N},_.verticalIconFeatureIndex=G}return _}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let c=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){let c=e.placedSymbolArray.get(i),p=c.vertexStartIndex+4*c.numGlyphs;for(let u=c.vertexStartIndex;u<p;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(e),c=Math.cos(e),p=[],u=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);let I=this.symbolInstances.get(x);p.push(0|Math.round(i*I.tileAnchorX+c*I.tileAnchorY)),u.push(I.featureIndex)}return m.sort((x,I)=>p[x]-p[I]||u[I]-u[x]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){let c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===i?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let c=this.symbolInstances.get(i);this.featureSortOrder.push(c.featureIndex);let{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:D}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),u>=0&&u!==p&&this.addIndicesForPlacedSymbol(this.text,u),m>=0&&m!==u&&m!==p&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let XT,YT,Ex;ft(A_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),A_.addDynamicAttributes=S_;class JT{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:fo,this.defaultValue=e}evaluate(e){if(e.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ft(JT,"FormatSectionOverride",{omit:["defaultValue"]});let Ix=()=>Ex||(Ex={layout:XT||(XT=new Kn({"symbol-placement":new tt(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new tt(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tt(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wt(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tt(Re.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new tt(Re.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new tt(Re.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new tt(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new tt(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new tt(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tt(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new wt(Re.layout_symbol["icon-size"]),"icon-size-scale-range":new tt(Re.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new wt(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new wt(Re.layout_symbol["icon-image"]),"icon-rotate":new wt(Re.layout_symbol["icon-rotate"]),"icon-padding":new tt(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new tt(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new wt(Re.layout_symbol["icon-offset"]),"icon-anchor":new wt(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tt(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tt(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tt(Re.layout_symbol["text-rotation-alignment"]),"text-field":new wt(Re.layout_symbol["text-field"]),"text-font":new wt(Re.layout_symbol["text-font"]),"text-size":new wt(Re.layout_symbol["text-size"]),"text-size-scale-range":new tt(Re.layout_symbol["text-size-scale-range"]),"text-max-width":new wt(Re.layout_symbol["text-max-width"]),"text-line-height":new wt(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new wt(Re.layout_symbol["text-letter-spacing"]),"text-justify":new wt(Re.layout_symbol["text-justify"]),"text-radial-offset":new wt(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tt(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new wt(Re.layout_symbol["text-anchor"]),"text-max-angle":new tt(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new tt(Re.layout_symbol["text-writing-mode"]),"text-rotate":new wt(Re.layout_symbol["text-rotate"]),"text-padding":new tt(Re.layout_symbol["text-padding"]),"text-keep-upright":new tt(Re.layout_symbol["text-keep-upright"]),"text-transform":new wt(Re.layout_symbol["text-transform"]),"text-offset":new wt(Re.layout_symbol["text-offset"]),"text-allow-overlap":new tt(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new tt(Re.layout_symbol["text-ignore-placement"]),"text-optional":new tt(Re.layout_symbol["text-optional"]),visibility:new tt(Re.layout_symbol.visibility)})),paint:YT||(YT=new Kn({"icon-opacity":new wt(Re.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new wt(Re.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new wt(Re.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new wt(Re.paint_symbol["text-emissive-strength"]),"icon-color":new wt(Re.paint_symbol["icon-color"]),"icon-halo-color":new wt(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new wt(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wt(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new tt(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new tt(Re.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new wt(Re.paint_symbol["icon-image-cross-fade"]),"text-opacity":new wt(Re.paint_symbol["text-opacity"]),"text-occlusion-opacity":new wt(Re.paint_symbol["text-occlusion-opacity"]),"text-color":new wt(Re.paint_symbol["text-color"],{runtimeType:wr,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new wt(Re.paint_symbol["text-halo-color"]),"text-halo-width":new wt(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new wt(Re.paint_symbol["text-halo-blur"]),"text-translate":new tt(Re.paint_symbol["text-translate"]),"text-translate-anchor":new tt(Re.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new tt(Re.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new tt(Re.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new tt(Re.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new tt(Re.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new wt(Re.paint_symbol["symbol-z-offset"])}))},Ex);class R_ extends mr{constructor(e,i,c,p){super(e,Ix(),i,c,p),this._colorAdjustmentMatrix=Ee.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let c=this.layout.get("text-writing-mode");if(c){let p=[];for(let u of c)p.indexOf(u)<0&&p.push(u);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,c,p){return this._saturation===e&&this._contrast===i&&this._brightnessMin===c&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(u,m,x,I){u=K(u),m=Y(m);let D=Ee.mat4.create(),_=u/3,E=1-2*_,C=[E,_,_,0,_,E,_,0,_,_,E,0,0,0,0,1],w=.5-.5*m,T=I-x;return Ee.mat4.multiply(D,[T,0,0,0,0,T,0,0,0,0,T,0,x,x,x,1],[m,0,0,0,0,m,0,0,0,0,m,0,w,w,w,1]),Ee.mat4.multiply(D,D,C),D}(e,i,c,p),this._saturation=e,this._contrast=i,this._brightnessMin=c,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,c,p){let u=this.layout.get(e).evaluate(i,{},c,p),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||yh(m.value)||!u?u:function(x,I){return I.replace(/{([^{}]+)}/g,(D,_)=>_ in x?String(x[_]):"")}(i.properties,u)}createBucket(e){return new A_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Ix().paint.overridableProperties){if(!R_.hasPaintOverride(this.layout,e))continue;let i=this.paint.get(e),c=new JT(i),p=new Lf(c,i.property.specification,this.scope,this.options),u=null;u=i.value.kind==="constant"||i.value.kind==="source"?new vh("source",p):new qc("composite",p,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Dl(i.property,u,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,c){return!(!this.layout||i.isDataDriven()||c.isDataDriven())&&R_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){let c=e.get("text-field"),p=Ix().paint.properties[i],u=!1,m=x=>{for(let I of x)if(p.overrides&&p.overrides.hasOverride(I))return void(u=!0)};if(c.value.kind==="constant"&&c.value.value instanceof cr)m(c.value.value.sections);else if(c.value.kind==="source"){let x=D=>{u||(D instanceof po&&Ci(D.value)===sl?m(D.value.sections):D instanceof ul?m(D.sections):D.eachChild(x))},I=c.value;I._styleExpression&&x(I._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,c){return{config:new ds(this,{zoom:i,lut:c}),overrideFog:!1}}}let KT,QT,eC,tC;var Tx=wn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Cx(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Dx(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Mx{constructor(e,i,c,p){this.context=e,this.format=c,this.useMipmap=p&&p.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:p&&p.premultiply})}update(e,i){let c=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,p=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:u}=this,{gl:m}=u,{x,y:I}=i&&i.position?i.position:{x:0,y:0},D=Math.max(x+c,this.size?this.size[0]:0),_=Math.max(I+p,this.size?this.size[1]:0);!this.size||this.size[0]===D&&this.size[1]===_||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!i||i.premultiply!==!1));let E=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&D>0&&_>0){let C=this.useMipmap?Math.floor(Math.log2(Math.max(D,_)))+1:1;m.texStorage2D(m.TEXTURE_2D,C,this.format,D,_),this.size=[D,_]}if(this.size)if(E)m.texSubImage2D(m.TEXTURE_2D,0,x,I,Cx(this.format),Dx(this.format),e);else{let C=e.data;C&&m.texSubImage2D(m.TEXTURE_2D,0,x,I,c,p,Cx(this.format),Dx(this.format),C)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,i,c=!1){let{context:p}=this,{gl:u}=p;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!c?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,c,p){let{context:u}=this,{gl:m}=u;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),c!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,c),this.wrapS=c),p!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class P_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){let{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}}function O_(l,e,i,c,p,u,m,x){let I=[l,e,1,i,c,1,p,u,1],D=[m,x,1],_=Ee.mat3.adjoint([],I),[E,C,w]=Ee.vec3.transformMat3(D,D,_);return Ee.mat3.multiply(I,I,[E,0,0,0,C,0,0,0,w])}function nC(l,e,i,c,p,u,m,x){let I=function(D,_,E,C,w,T,S,k){let L=O_(0,0,1,0,1,1,0,1),B=O_(D,_,E,C,w,T,S,k),V=Ee.mat3.adjoint([],L);return Ee.mat3.multiply(B,B,V)}(l,e,i,c,p,u,m,x);return[I[2]/I[8]/st,I[5]/I[8]/st]}function k_(l){return[l[0],Math.min(Math.max(l[1],-ae),ae)]}class iC extends rl{constructor(e,i,c,p){super(),this.id=e,this.dispatcher=c,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Os("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Po(this.map._requestManager.transformRequest(this.url,qu.Image),(c,p)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new Rc(c)):p&&(this.image=p instanceof HTMLImageElement?ct.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new P_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Os("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof P_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],c=e[0][1];for(let u of e)u[1]>c&&(c=u[1]),u[1]<i&&(i=u[1]);let p=(c+i)/2;if(p>ae?this.onNorthPole=!0:p<-ae&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=e.map(be.fromLngLat);this.tileID=function(m){let x=1/0,I=1/0,D=-1/0,_=-1/0;for(let S of m)x=Math.min(x,S.x),I=Math.min(I,S.y),D=Math.max(D,S.x),_=Math.max(_,S.y);let E=Math.max(D-x,_-I),C=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),w=Math.pow(2,C),T=Math.floor((x+D)/2*w);return T>1&&(T-=1),new Li(C,T,Math.floor((I+_)/2*w))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Os("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let L in this.tiles){let B=this.tiles[L];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let i=Mp(new Li(0,0,0),this.map.transform.projection),c=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(L){let B=L[1].x-L[0].x,V=L[1].y-L[0].y,N=L[2].x-L[1].x,G=L[2].y-L[1].y,H=L[3].x-L[2].x,J=L[3].y-L[2].y,se=L[0].x-L[3].x,ee=L[0].y-L[3].y,ne=B*G-N*V,me=N*J-H*G,te=H*ee-se*J,de=se*V-B*ee;return ne>0&&me>0&&te>0&&de>0||ne<0&&me<0&&te<0&&de<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let p=Mp(this.tileID,this.map.transform.projection),[u,m,x,I]=this.coordinates.map(L=>{let B=p.projection.project(L[0],L[1]);return $T(p,B)._round()});this.perspectiveTransform=nC(u.x,u.y,m.x,m.y,x.x,x.y,I.x,I.y);let D=this._boundsArray=new Al;D.emplaceBack(u.x,u.y,0,0),D.emplaceBack(m.x,m.y,st,0),D.emplaceBack(I.x,I.y,0,st),D.emplaceBack(x.x,x.y,st,st),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(D,Tx.members),this.boundsSegments=pi.simpleSegment(0,0,4,2);let _=[],E=[k_((C=this.coordinates)[0]),k_(C[1]),k_(C[2]),k_(C[3])];var C;let[w,T,S,k]=function(L){let B=L[0][0],V=B,N=L[0][1],G=N;for(let H=1;H<L.length;H++)L[H][0]<B?B=L[H][0]:L[H][0]>V&&(V=L[H][0]),L[H][1]<N?N=L[H][1]:L[H][1]>G&&(G=L[H][1]);return[B,N,V-B,G-N]}(E);{let L=new Al,[B,V,N,G]=function(Ae){let Pe=Ae[0].x,De=Pe,$e=Ae[0].y,Je=$e;for(let ze=1;ze<Ae.length;ze++)Ae[ze].x<Pe?Pe=Ae[ze].x:Ae[ze].x>De&&(De=Ae[ze].x),Ae[ze].y<$e?$e=Ae[ze].y:Ae[ze].y>Je&&(Je=Ae[ze].y);return[Pe,$e,De-Pe,Je-$e]}(c),H=Ae=>[(Ae.x-B)/N,(Ae.y-V)/G],[J,se,ee,ne]=c.map(H),me=function(Ae,Pe,De,$e,Je,ze,dt,it){let et=O_(0,0,1,0,1,1,0,1),Ye=O_(Ae,Pe,De,$e,Je,ze,dt,it),It=Ee.mat3.adjoint([],Ye);return Ee.mat3.multiply(et,et,It)}(J[0],J[1],se[0],se[1],ee[0],ee[1],ne[0],ne[1]);this.elevatedGlobePerspectiveTransform=nC(J[0],J[1],se[0],se[1],ee[0],ee[1],ne[0],ne[1]);let te=(Ae,Pe)=>{_.push(Ae.lng);let De=Math.round((Ae.lng-w)/S*st),$e=Math.round((Ae.lat-T)/k*st),Je=H(Pe),ze=Ee.vec3.transformMat3([],[Je[0],Je[1],1],me),dt=Math.round(ze[0]/ze[2]*st),it=Math.round(ze[1]/ze[2]*st);L.emplaceBack(De,$e,dt,it)},de=c[3].x-c[0].x,ve=c[3].y-c[0].y,xe=c[2].x-c[1].x,Ie=c[2].y-c[1].y;for(let Ae=0;Ae<65;Ae++){let Pe=Ae/64,De=[c[0].x+Pe*de,c[0].y+Pe*ve],$e=[c[1].x+Pe*xe,c[1].y+Pe*Ie],Je=$e[0]-De[0],ze=$e[1]-De[1];for(let dt=0;dt<65;dt++){let it=dt/64,et={x:De[0]+Je*it,y:De[1]+ze*it,z:0};te(i.projection.unproject(et.x,et.y),et)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(L,Tx.members)}{this.maxLongitudeTriangleSize=0;let L=[],B=new si,V=(N,G,H)=>{B.emplaceBack(N,G,H);let J=_[N],se=_[G],ee=_[H],ne=Math.min(Math.min(J,se),ee),me=Math.max(Math.max(J,se),ee)-ne;me>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=me),L.push(ne+me/2)};for(let N=0;N<64;N++)for(let G=0;G<64;G++){let H=65*N+G,J=H+1,se=H+65,ee=se+1;V(H,se,J),V(J,se,ee)}[L,B]=function(N,G){let H=Array.from({length:N.length},(ee,ne)=>ne);H.sort((ee,ne)=>N[ee]-N[ne]);let J=[],se=new si;for(let ee=0;ee<H.length;ee++){let ne=H[ee];J.push(N[ne]);let me=3*ne,te=me+1;se.emplaceBack(G.uint16[me],G.uint16[te],G.uint16[te+1])}return[J,se]}(L,B),this.elevatedGlobeTrianglesCenterLongitudes=L,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(B)}this.elevatedGlobeSegments=pi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,S/st,0,k/st,0,0,T,w,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let i=this.map.painter.context,c=i.gl;!this._dirty||this.texture instanceof P_||(this.texture?this.texture.update(this.image):(this.texture=new Mx(i,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;let c=this.elevatedGlobeTrianglesCenterLongitudes,p=(u=e+180)+360*Math.round((c[0]-u)/360);var u;let m=new pi,x=(E,C)=>{m.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:i.segments[0].vertexLength,primitiveLength:C,sortKey:void 0,vaos:{}})},I=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-p)<=I){let E=Ne(c,0,c.length,p+I);return E===c.length||x(E,Sc(c,E+1,c.length,p+360-I)-E),m}p<c[0]&&(p+=360);let D=Sc(c,0,c.length,p-I);if(D===c.length)return x(0,c.length),m;x(0,D-0);let _=Ne(c,D+1,c.length,p+I);return _!==c.length&&x(_,c.length-_),m}}let Lk=(Math.pow(256,2)-1)/16907520;class rC extends mr{constructor(e,i,c,p){super(e,{layout:eC||(eC=new Kn({visibility:new tt(Re.layout_raster.visibility)})),paint:tC||(tC=new Kn({"raster-opacity":new tt(Re.paint_raster["raster-opacity"]),"raster-color":new Sl(Re.paint_raster["raster-color"]),"raster-color-mix":new tt(Re.paint_raster["raster-color-mix"]),"raster-color-range":new tt(Re.paint_raster["raster-color-range"]),"raster-hue-rotate":new tt(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tt(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tt(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new tt(Re.paint_raster["raster-saturation"]),"raster-contrast":new tt(Re.paint_raster["raster-contrast"]),"raster-resampling":new tt(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new tt(Re.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new tt(Re.paint_raster["raster-emissive-strength"]),"raster-array-band":new tt(Re.paint_raster["raster-array-band"]),"raster-elevation":new tt(Re.paint_raster["raster-elevation"])}))},i,c,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof iC&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let i=this._transitionablePaint._values["raster-color"].value.expression,[c,p]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(p)||c===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=fp({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,p])}}let oC,sC,aC,lC,cC;class uC extends mr{constructor(e,i,c,p){super(e,{layout:oC||(oC=new Kn({visibility:new tt(Re["layout_raster-particle"].visibility)})),paint:sC||(sC=new Kn({"raster-particle-array-band":new tt(Re["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new tt(Re["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Sl(Re["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new tt(Re["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new tt(Re["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new tt(Re["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new tt(Re["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new tt(Re["paint_raster-particle"]["raster-particle-elevation"])}))},i,c,p),this._updateColorRamp(),this.lastInvalidatedAt=ct.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=fp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ct.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Fk extends mr{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Sx(l,e,i){let c=[0,0,1],p=Ee.quat.identity([]);return Ee.quat.rotateY(p,p,i?-ln(l)+Math.PI:ln(l)),Ee.quat.rotateX(p,p,-ln(e)),Ee.vec3.transformQuat(c,c,p),Ee.vec3.normalize(c,c)}function hC(l,e){let i=L_(l.projection,l.zoom,l.width,l.height),c=function(u,m,x,I,D){let _=new P(x.lng-180*ql,x.lat),E=new P(x.lng+180*ql,x.lat),C=u.project(_.lng,_.lat),w=u.project(E.lng,E.lat),T=-Math.atan2(w.y-C.y,w.x-C.x),S=be.fromLngLat(x);S.y=jt(S.y,-1+ql,1-ql);let k=S.toLngLat(),L=u.project(k.lng,k.lat),B=be.fromLngLat(k);B.x+=ql;let V=B.toLngLat(),N=u.project(V.lng,V.lat),G=fC(N.x-L.x,N.y-L.y,T),H=be.fromLngLat(k);H.y+=ql;let J=H.toLngLat(),se=u.project(J.lng,J.lat),ee=fC(se.x-L.x,se.y-L.y,T),ne=Math.abs(G.x)/Math.abs(ee.y),me=Ee.mat4.identity([]);Ee.mat4.rotateZ(me,me,-T*(1-(D?0:I)));let te=Ee.mat4.identity([]);return Ee.mat4.scale(te,te,[1,1-(1-ne)*I,1]),te[4]=-ee.x/ee.y*I,Ee.mat4.rotateZ(te,te,T),Ee.mat4.multiply(te,me,te),te}(l.projection,0,l.center,i,e),p=dC(l);return Ee.mat4.scale(c,c,[p,p,1]),c}function dC(l){let e=l.projection,i=L_(l.projection,l.zoom,l.width,l.height),c=Ax(e,l.center),p=Ax(e,P.convert(e.center));return Math.pow(2,c*i+(1-i)*p)}function L_(l,e,i,c,p=1/0){let u=l.range;if(!u)return 0;let m=Math.min(p,Math.max(i,c)),x=Math.log(m/1024)/Math.LN2;return Ja(u[0]+x,u[1]+x,e)}let ql=1/4e4;function Ax(l,e){let i=jt(e.lat,-ae,ae),c=new P(e.lng-180*ql,i),p=new P(e.lng+180*ql,i),u=l.project(c.lng,i),m=l.project(p.lng,i),x=be.fromLngLat(c),I=be.fromLngLat(p),D=m.x-u.x,_=m.y-u.y,E=I.x-x.x,C=I.y-x.y,w=Math.sqrt((E*E+C*C)/(D*D+_*_));return Math.log(w)/Math.LN2}function fC(l,e,i){let c=Math.cos(i),p=Math.sin(i);return{x:l*c-e*p,y:l*p+e*c}}function pC(l,e,i){Ee.mat4.identity(l),Ee.mat4.rotateZ(l,l,ln(e[2])),Ee.mat4.rotateX(l,l,ln(e[0])),Ee.mat4.rotateY(l,l,ln(e[1])),Ee.mat4.scale(l,l,i),Ee.mat4.multiply(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function F_(l,e,i,c,p,u,m,x){let I=[i[0]-e[0],i[1]-e[1],0],D=[c[0]-e[0],c[1]-e[1],0];if(Ee.vec3.length(I)<1e-12||Ee.vec3.length(D)<1e-12)return Ee.quat.identity(l);let _=Ee.vec3.cross([],I,D);Ee.vec3.normalize(_,_),Ee.vec3.subtract(D,c,e),I[2]=(u-p)*x,D[2]=(m-p)*x;let E=I;return Ee.vec3.cross(E,I,D),Ee.vec3.normalize(E,E),Ee.quat.rotationTo(l,_,E)}function Rx(l,e,i=!1){let c=Vl(e.zoom),p=function(u,m,x){let I=m.worldSize,D=[u[12],u[13],u[14]],_=re(D[1]/I),E=Q(D[0]/I),C=Ee.mat4.identity([]),w=Z(1,_)*I,T=Z(1,0)*I*le(_,m.zoom),S=1/G0(I),k=T*S;if(x){let N=L_(m.projection,m.zoom,m.width,m.height,1024);k=S*m.projection.pixelSpaceConversion(m.center.lat,I,N)}let L=M(_,E);Ee.vec3.add(L,L,Ee.vec3.scale([],Ee.vec3.normalize([],L),w*k*D[2]));let B=function(N){let G=[N[0],N[1],N[2]],H=[0,1,0],J=Ee.vec3.cross([],H,G);return Ee.vec3.cross(H,G,J),Ee.vec3.squaredLength(H)===0&&(H=[0,1,0],Ee.vec3.cross(J,G,H)),Ee.vec3.normalize(J,J),Ee.vec3.normalize(H,H),Ee.vec3.normalize(G,G),[J[0],J[1],J[2],0,H[0],H[1],H[2],0,G[0],G[1],G[2],0,N[0],N[1],N[2],1]}(L);Ee.mat4.scale(C,C,[k,k,k*w]),Ee.mat4.translate(C,C,[-D[0],-D[1],-D[2]]);let V=Ee.mat4.multiply([],m.globeMatrix,B);return Ee.mat4.multiply(V,V,C),Ee.mat4.multiply(V,V,u),V}(l,e,i);if(c>0){let u=function(m,x){let I=x.worldSize,D=Z(1,0)*I*le(x.center.lat,x.zoom)/G0(I),_=Z(1,x.center.lat)*I,E=Ee.mat4.identity([]);return Ee.mat4.rotateY(E,E,ln(x.center.lng)),Ee.mat4.rotateX(E,E,ln(x.center.lat)),Ee.mat4.translate(E,E,[0,0,er]),Ee.mat4.scale(E,E,[D,D,D*_]),Ee.mat4.translate(E,E,[x.point.x-.5*I,x.point.y-.5*I,0]),Ee.mat4.multiply(E,E,m),Ee.mat4.multiply(E,x.globeMatrix,E)}(l,e);return function(m,x,I){let D=(T,S,k)=>{let L=Ee.vec3.length(T),B=Ee.vec3.length(S),V=Ma(T,S,k);return Ee.vec3.scale(V,V,1/Ee.vec3.length(V)*Rt(L,B,k))},_=D([m[0],m[1],m[2]],[x[0],x[1],x[2]],I),E=D([m[4],m[5],m[6]],[x[4],x[5],x[6]],I),C=D([m[8],m[9],m[10]],[x[8],x[9],x[10]],I),w=Ma([m[12],m[13],m[14]],[x[12],x[13],x[14]],I);return[_[0],_[1],_[2],0,E[0],E[1],E[2],0,C[0],C[1],C[2],0,w[0],w[1],w[2],1]}(p,u,c)}return p}function mC(l,e,i,c){let p=An.projectAabbCorners(c,i),u=Number.MAX_VALUE,m=-1;for(let D=0;D<p.length;++D){let _=p[D];_[0]=(.5*_[0]+.5)*e.width,_[1]=(.5-.5*_[1])*e.height,_[2]<u&&(m=D,u=_[2])}let x=D=>new ot(p[D][0],p[D][1]),I;switch(m){case 0:case 6:I=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:I=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:I=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:I=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(Ge(l,I))return u}let Nk=wn([{name:"a_pos_3f",components:3,type:"Float32"}]),zk=wn([{name:"a_color_3f",components:3,type:"Float32"}]),Bk=wn([{name:"a_color_4f",components:4,type:"Float32"}]),Vk=wn([{name:"a_uv_2f",components:2,type:"Float32"}]),jk=wn([{name:"a_normal_3f",components:3,type:"Float32"}]),Uk=wn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),$k=wn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),gC={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class N_{constructor(e,i,c,p){this.message=(e?`${e}: `:"")+c,p&&(this.identifier=p),i!=null&&i.__line__&&(this.line=i.__line__)}}function _C(l,e){let i=l.indexOf("://")===-1;try{return new URL(l,i&&e?"http://example.com":void 0),!0}catch{return!1}}class yC{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class vC{constructor(){this.instancedDataArray=new iu,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Px{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,i){}populate(e,i,c,p){this.tileToMeter=ge(c);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:m,id:x,index:I,sourceLayerIndex:D}of e){let _=x??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),E=qe(m,u);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),E,c))continue;let C={id:_,sourceLayerIndex:D,index:I,geometry:u?E.geometry:Ce(m,c,p),properties:m.properties,type:m.type,patterns:{}},w=this.addFeature(C,C.geometry,E);w&&i.featureIndex.insert(m,C.geometry,I,D,this.index,this.instancesPerModel[w].instancedDataArray.length,st/32)}this.lookup=null}update(e,i,c,p){for(let u in this.instancesPerModel){let m=this.instancesPerModel[u];for(let x in e)m.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(m.features[m.idToFeaturesIndex[x]],e[x],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let i in this.instancesPerModel){let c=this.instancesPerModel[i];for(let p of c.features){let u=this.layers[0],m=p.feature,x=this.canonical,I=u.paint.get("model-rotation").evaluate(m,{},x),D=u.paint.get("model-scale").evaluate(m,{},x),_=u.paint.get("model-translation").evaluate(m,{},x);Ee.vec3.exactEquals(p.rotation,I)&&Ee.vec3.exactEquals(p.scale,D)&&Ee.vec3.exactEquals(p.translation,_)||(this.evaluate(p,p.featureStates,c,!0),e=!0)}}return e}updateReplacement(e,i,c,p){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;let u=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(ix(this.activeReplacements,u))return!1;this.activeReplacements=u;let m=!1;for(let x in this.instancesPerModel){let I=this.instancesPerModel[x],D=I.instancedDataArray;for(let _ of I.features){let E=_.instancedDataOffset,C=_.instancedDataCount;for(let w=0;w<C;w++){let T=16*(w+E),S=D.float32[T+0],k=S>st;S=k?S-st:S;let L=Math.floor(S),B=D.float32[T+1],V=!1;for(let N of this.activeReplacements)if(!kI(N,c,gC.Model,p)&&!(N.min.x>L||L>N.max.x||N.min.y>B||B>N.max.y)&&(V=VI(BI(L,B,e.canonical,N.footprintTileId.canonical),N.footprint),V))break;D.float32[T]=V?S+st:S,m=m||V!==k}}}return m}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let i in this.instancesPerModel){let c=this.instancesPerModel[i];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=e.createVertexBuffer(c.instancedDataArray,Uk.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let i in this.instancesPerModel){let c=this.instancesPerModel[i];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let i of this.modelUris)e.removeModel(i,"")}addFeature(e,i,c){let p=this.layers[0],u=p.layout.get("model-id").evaluate(c,{},this.canonical);if(!u)return fn(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),u;_C(u,!1)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new vC);let m=this.instancesPerModel[u],x=m.instancedDataArray,I=new yC(c,x.length);for(let D of i)for(let _ of D){if(_.x<0||_.x>=st||_.y<0||_.y>=st)continue;let E=(this.lookupDim-1)/st,C=this.lookupDim*(_.y*E|0)+_.x*E|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;let w=x.length;x.resize(w+1),m.instancesEvaluatedElevation.push(0),x.float32[16*w]=_.x,x.float32[16*w+1]=_.y}return I.instancedDataCount=m.instancedDataArray.length-I.instancedDataOffset,I.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(I),this.evaluate(I,{},m,!1)),u}getModelUris(){return this.modelUris}evaluate(e,i,c,p){let u=this.layers[0],m=e.feature,x=this.canonical,I=e.rotation=u.paint.get("model-rotation").evaluate(m,i,x),D=e.scale=u.paint.get("model-scale").evaluate(m,i,x),_=e.translation=u.paint.get("model-translation").evaluate(m,i,x),E=u.paint.get("model-color").evaluate(m,i,x);E.a=u.paint.get("model-color-mix-intensity").evaluate(m,i,x);let C=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,D[0]),Math.max(D[1],D[2])),pC(C,I,D);let w=Math.round(100*E.a)+E.b/1.05;for(let T=0;T<e.instancedDataCount;++T){let S=e.instancedDataOffset+T,k=16*S,L=c.instancedDataArray.float32,B=0;p&&(B=L[k+6]-c.instancesEvaluatedElevation[S]);let V=0|L[k+1];L[k]=(0|L[k])+E.r/1.05,L[k+1]=V+E.g/1.05,L[k+2]=w,L[k+3]=1/(x.z>10?this.tileToMeter:ge(x,V)),L[k+4]=_[0],L[k+5]=_[1],L[k+6]=_[2]+B,L[k+7]=C[0],L[k+8]=C[1],L[k+9]=C[2],L[k+10]=C[4],L[k+11]=C[5],L[k+12]=C[6],L[k+13]=C[8],L[k+14]=C[9],L[k+15]=C[10],c.instancesEvaluatedElevation[S]=_[2]}}}let xC,bC;ft(Px,"ModelBucket",{omit:["layers"]}),ft(vC,"PerModelAttributes"),ft(yC,"ModelFeature");let hu=64,Zh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function wC(l,e,i,c,p,u,m,x,I,D=!1){let _=i.zoom,E=i.project(c),C=le(c.lat,_),w=1/C;Ee.mat4.identity(l),Ee.mat4.translate(l,l,[E.x+m[0]*w,E.y+m[1]*w,m[2]]);let T=1,S=1,k=i.worldSize;if(D){if(i.projection.name==="mercator"){let N=0;i.elevation&&(N=i.elevation.getAtPointOrZero(new be(E.x/k,E.y/k),0));let G=Ee.vec4.transformMat4([],[E.x,E.y,N,1],i.projMatrix)[3]/i.cameraToCenterDistance;T=G,S=G*le(i.center.lat,_)}else if(i.projection.name==="globe"){let N=Rx(l,i),G=Ee.mat4.multiply([],i.projMatrix,N),H=[0,0,0,1];Ee.vec4.transformMat4(H,H,G);let J=H[3]/i.cameraToCenterDistance,se=Vl(_),ee=i.projection.pixelsPerMeter(c.lat,k)*le(c.lat,_),ne=i.projection.pixelsPerMeter(i.center.lat,k)*le(i.center.lat,_);T=J/Rt(ee,ue(i.center.lat),se),S=J*C/ee,T*=ne,S*=ne}}else T=w;Ee.mat4.scale(l,l,[T,T,S]);let L=[...l],B=e.orientation,V=[];if(pC(V,[B[0]+p[0],B[1]+p[1],B[2]+p[2]],u),Ee.mat4.multiply(l,L,V),x&&i.elevation){let N=0,G=[];if(I&&i.elevation){N=function(se,ee,ne,me,te){let de=ee.elevation;if(!de)return 0;let ve=An.projectAabbCorners(ne,me),xe=Z(1,te.lat)*ee.worldSize,Ie=function(It,ht){let mt=[0,0,1],Vt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Xt of Vt){let Jt=It[Xt.corners[0]],qt=It[Xt.corners[1]],rn=It[Xt.corners[2]],tn=[qt[0]-Jt[0],qt[1]-Jt[1],ht*(qt[2]-Jt[2])],Wn=Ee.vec3.cross(tn,tn,[rn[0]-Jt[0],rn[1]-Jt[1],ht*(rn[2]-Jt[2])]);Ee.vec3.normalize(Wn,Wn),Xt.dotProductWithUp=Ee.vec3.dot(Wn,mt)}return Vt.sort((Xt,Jt)=>Xt.dotProductWithUp-Jt.dotProductWithUp),Vt[0].corners}(ve,xe),Ae=ve[Ie[0]],Pe=ve[Ie[1]],De=ve[Ie[2]],$e=ve[Ie[3]],Je=de.getAtPointOrZero(new be(Ae[0]/ee.worldSize,Ae[1]/ee.worldSize),0),ze=de.getAtPointOrZero(new be(Pe[0]/ee.worldSize,Pe[1]/ee.worldSize),0),dt=de.getAtPointOrZero(new be(De[0]/ee.worldSize,De[1]/ee.worldSize),0),it=de.getAtPointOrZero(new be($e[0]/ee.worldSize,$e[1]/ee.worldSize),0),et=(Je+it)/2,Ye=(ze+dt)/2;return et>Ye?ze<dt?F_(se,Pe,$e,Ae,ze,it,Je,xe):F_(se,De,Ae,$e,dt,Je,it,xe):Je<it?F_(se,Ae,Pe,De,Je,ze,dt,xe):F_(se,$e,De,Pe,it,dt,ze,xe),Math.max(et,Ye)}(G,i,e.aabb,l,c);let H=Ee.mat4.fromQuat([],G),J=Ee.mat4.multiply([],H,V);Ee.mat4.multiply(l,L,J)}else N=i.elevation.getAtPointOrZero(new be(E.x/k,E.y/k),0);N!==0&&(l[14]+=N)}}function Op(l,e,i=!1){l.uploaded||(l.gfxTexture=new Mx(e,l.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:l.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function Gk(l,e,i){l.indexBuffer=e.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=e.createVertexBuffer(l.vertexArray,Nk.members,!1,!0),l.normalArray&&(l.normalBuffer=e.createVertexBuffer(l.normalArray,jk.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=e.createVertexBuffer(l.texcoordArray,Vk.members,!1,!0)),l.colorArray&&(l.colorBuffer=e.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?zk:Bk).members,!1,!0)),l.featureArray&&(l.pbrBuffer=e.createVertexBuffer(l.featureArray,$k.members,!0)),l.segments=pi.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);let c=l.material;c.pbrMetallicRoughness.baseColorTexture&&Op(c.pbrMetallicRoughness.baseColorTexture,e),c.pbrMetallicRoughness.metallicRoughnessTexture&&Op(c.pbrMetallicRoughness.metallicRoughnessTexture,e),c.normalTexture&&Op(c.normalTexture,e),c.occlusionTexture&&Op(c.occlusionTexture,e,i),c.emissionTexture&&Op(c.emissionTexture,e)}function Ox(l,e,i){if(l.meshes)for(let c of l.meshes)Gk(c,e,i);if(l.children)for(let c of l.children)Ox(c,e,i)}function z_(l){if(l.meshes)for(let e of l.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(l.children)for(let e of l.children)z_(e)}function kx(l){if(l.meshes)for(let i of l.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(l.children)for(let i of l.children)kx(i)}class Xh{constructor(e,i,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=c}static create(e,i,c){let p=c||e.findDEMTileFor(i);if(!p||!p.dem)return;let u=p.dem,m=p.tileID,x=1<<i.canonical.z-m.canonical.z;return new Xh(p,u.dim/st/x,[(i.canonical.x/x-m.canonical.x)*u.dim,(i.canonical.y/x-m.canonical.y)*u.dim])}tileCoordToPixel(e,i){let c=i*this._scale+this._offset[1],p=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(c);return new ot(p,u)}getElevationAt(e,i,c,p){let u=e*this._scale+this._offset[0],m=i*this._scale+this._offset[1],x=Math.floor(u),I=Math.floor(m),D=this._dem;return p=!!p,c?Rt(Rt(D.get(x,I,p),D.get(x,I+1,p),m-I),Rt(D.get(x+1,I,p),D.get(x+1,I+1,p),m-I),u-x):D.get(x,I,p)}getElevationAtPixel(e,i,c){return this._dem.get(e,i,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Z(1,e)*this._dem.stride}}let Lx=new Float32Array(262144),du=new Uint8Array(262144);function EC(l){let e=0;if(l.meshes)for(let i of l.meshes)e=Math.max(e,i.aabb.max[2]);if(l.children)for(let i of l.children)e=Math.max(e,EC(i));return e}function IC(l,e,i){if(l.meshes)for(let c of l.meshes){if(c.aabb.min[0]===1/0)continue;let p=An.applyTransform(c.aabb,l.matrix);i.insert(e,p.min[0],p.min[1],p.max[0],p.max[1])}if(l.children)for(let c of l.children)IC(c,e,i)}let TC=["","wall","door","roof","window","lamp","logo"];class CC{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:EC(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,i=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let c of this.node.meshes)this.node.lightMeshIndex!==e&&(c.transformedAabb=An.applyTransformFast(c.aabb,this.node.matrix),i.encapsulate(c.transformedAabb)),e++;this.aabb=i}return this.aabb}}class B_{constructor(e,i,c,p,u,m,x){this.id=c,this.layers=e,this.layerIds=this.layers.map(I=>I.fqid),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.modelTraits|=Zh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=Zh.HasMapboxMeshFeatures),u&&(this.modelTraits|=Zh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let I of i)this.nodesInfo.push(new CC(I)),IC(I,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0)}updateFootprints(e,i){for(let c of this.getNodesInfo()){let p=c.node;p.footprint&&i.push({footprint:p.footprint,id:e})}}update(e){let i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;let c=i?this.stateDependentLayers:this.layers;for(let p of c)this.evaluate(p,e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let c of i){let p=c.node;this.uploaded?this.updatePbrBuffer(p):Ox(p,e,!0)}for(let c of i)z_(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(let c of e.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),i=!0);return i}needsReEvaluation(e,i,c){let p=e.transform.projectionOptions,u=e.style.getBrightness(),m=this.brightness!==u;return!!(!this.uploaded||this.dirty||p.name!==this.projection.name||kp(c.paint.get("model-color").value,m)||kp(c.paint.get("model-color-mix-intensity").value,m)||kp(c.paint.get("model-roughness").value,m)||kp(c.paint.get("model-emissive-strength").value,m)||kp(c.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=p,this.brightness=u,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let c=this.getNodesInfo(),p=this.id.canonical;for(let u of c){let m=u.feature;u.evaluatedScale=i.paint.get("model-scale").evaluate(m,{},p)}}evaluate(e,i){let c=this.getNodesInfo();for(let p of c){if(!p.node.meshes)continue;let u=p.feature,m=i&&i[u.id],x=p.node.meshes&&p.node.meshes[0].featureData,I=p.evaluatedColor[2],D=p.evaluatedRMEA[2],_=this.id.canonical;if(p.hasTranslucentParts=!1,x){for(let E=0;E<TC.length;E++){let C=TC[E];C.length&&(u.properties.part=C);let w=e.paint.get("model-color").evaluate(u,m,_).toRenderColor(null),T=e.paint.get("model-color-mix-intensity").evaluate(u,m,_);p.evaluatedColor[E]=[w.r,w.g,w.b,T],p.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(u,m,_),p.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(u,m,_),p.evaluatedRMEA[E][3]=w.a,p.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,m,_),!p.hasTranslucentParts&&w.a<1&&(p.hasTranslucentParts=!0)}delete u.properties.part,qk(p,I!==p.evaluatedColor[2]||D!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,m,_);p.evaluatedScale=e.paint.get("model-scale").evaluate(u,m,_),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,c,p){let u=e.findDEMTileFor(c);if(u&&(u.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let m=Xh.create(e,c,u);if(!m)return;this.modelTraits&Zh.HasMapboxMeshFeatures&&this.updateDEM(e,m,c,p);for(let x of this.getNodesInfo()){let I=x.node;if(!I.footprint||!I.footprint.vertices||!I.footprint.vertices.length)continue;let D=I.footprint.vertices,_=m.getElevationAt(D[0].x,D[0].y,!0,!0);for(let E=1;E<D.length;E++)_=Math.min(_,m.getElevationAt(D[E].x,D[E].y,!0,!0));I.elevation=_}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,c,p){let u=i._dem._modifiedForSources[p];if(u===void 0&&(i._dem._modifiedForSources[p]=[],u=i._dem._modifiedForSources[p]),u.includes(c.canonical))return;let m=i._dem.dim;u.push(c.canonical);let x=!1;for(let I of this.getNodesInfo()){let D=I.node;if(!D.footprint||!D.footprint.grid)continue;let _=D.footprint.grid,E=i.tileCoordToPixel(_.min.x,_.min.y),C=i.tileCoordToPixel(_.max.x,_.max.y),w=Math.min(Math.min(m-C.y,E.x),Math.min(E.y,m-C.x));if(w<0)continue;let T=jt(w,2,5),S=Math.max(0,E.x-T),k=Math.max(0,E.y-T),L=Math.min(C.x+T,m-1),B=Math.min(C.y+T,m-1);for(let H=k;H<=B;++H)for(let J=S;J<=L;++J)du[H*m+J]=255;let V=0,N=0;for(let H=0;H<_.cellsY;++H)for(let J=0;J<_.cellsX;++J){if(!_.cells[H*_.cellsX+J])continue;let se=i.tileCoordToPixel(_.min.x+J/_.xScale,_.min.y+H/_.yScale),ee=i.tileCoordToPixel(_.min.x+(J+1)/_.xScale,_.min.y+(H+1)/_.yScale);for(let ne=se.y;ne<=Math.min(ee.y+1,m-1);++ne)for(let me=se.x;me<=Math.min(ee.x+1,m-1);++me)du[ne*m+me]===255&&(du[ne*m+me]=0,V+=i.getElevationAtPixel(me,ne),N++)}let G=V/N;S=Math.max(1,E.x-T),k=Math.max(1,E.y-T),L=Math.min(C.x+T,m-2),B=Math.min(C.y+T,m-2),x=!0;for(let H=k;H<=B;++H)for(let J=S;J<=L;++J)du[H*m+J]===0&&(Lx[H*m+J]=i._dem.set(J,H,G));for(let H=1;H<T;++H){S=Math.max(1,E.x-H),k=Math.max(1,E.y-H),L=Math.min(C.x+H,m-2),B=Math.min(C.y+H,m-2);for(let J=k;J<=B;++J)for(let se=S;se<=L;++se){let ee=J*m+se;if(du[ee]===255){let ne=0,me=0,te=-1,de=-1;for(let ve=-1;ve<=1;++ve)for(let xe=-1;xe<=1;++xe){let Ie=(J+ve)*m+se+xe;if(du[Ie]>=H)continue;let Ae=Lx[Ie],Pe=Math.abs(Ae);Pe>me&&(ne=Ae,me=Pe,te=xe,de=ve)}if(me>.1){let ve=1-(H+.5*Math.abs(te*de))/T,xe=i._dem.get(se,J)+ne*ve,Ie=i._dem.get(se+te,J+de),Ae=i._dem.get(se-te,J-de,!0);(xe-Ie)*(xe-Ae)>0&&(xe=(Ie+Ae)/2),Lx[ee]=i._dem.set(se,J,xe),du[ee]=H}}}}}x&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ct.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let i of e)z_(i.node),kx(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let c=i.getReplacementRegionsForTile(e.toUnwrapped()),p=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){let m=p[u].node;p[u].hiddenByReplacement=!!m.footprint&&!c.find(x=>x.footprint===m.footprint)}}getHeightAtTileCoord(e,i){let c=this.getNodesInfo(),p=[],u=[0,0,0],m=Ee.mat4.identity([]);for(let x=0;x<this.nodesInfo.length;x++){let I=c[x],D=I.node.meshes[0],_=D.transformedAabb;if(e<_.min[0]||i<_.min[1]||e>_.max[0]||i>_.max[1])continue;if(I.node.hidden===!0)return{height:1/0,maxHeight:I.feature.properties.height,hidden:!1,verticalScale:I.evaluatedScale[2]};Ee.mat4.invert(m,I.node.matrix),u[0]=e,u[1]=i,Ee.vec3.transformMat4(u,u,m);let E=(u[0]-D.aabb.min[0])/(D.aabb.max[0]-D.aabb.min[0])*hu|0,C=Math.min(63,(u[1]-D.aabb.min[1])/(D.aabb.max[1]-D.aabb.min[1])*hu|0)*hu+Math.min(63,E),w=D.heightmap[C];if(!(w<0&&I.node.footprint))return I.hiddenByReplacement?void 0:{height:w,maxHeight:I.feature.properties.height,hidden:!1,verticalScale:I.evaluatedScale[2]};if(I.node.footprint.grid.query(new ot(e,i),new ot(e,i),p),p.length>0)return{height:void 0,maxHeight:I.feature.properties.height,hidden:I.hiddenByReplacement,verticalScale:I.evaluatedScale[2]}}}}function kp(l,e){return!l.isLightConstant&&e}function Hk(l,e,i,c,p,u,m,x){let I=(61440&e|(61440&e)>>4)>>8,D=(3840&e|(3840&e)>>4)>>4,_=240&e|(240&e)>>4;i[3]>0&&(I=Rt(I,255*i[0],i[3]),D=Rt(D,255*i[1],i[3]),_=Rt(_,255*i[2],i[3]));let E=I<<8|D,C=_<<8|Math.floor(255*c[3]),w=function(H){let J=jt(H,0,2);return Math.min(Math.round(.5*J*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],T=jt(p[0],0,1),S=jt(p[1],0,1),k=jt(p[2],0,1),L=jt(p[3],0,1),B,V,N,G;if(T!==S&&m!==u&&S!==T){let H=m-u;V=1/(H*(S-T)),N=-(u+H*T)/(H*(S-T));let J=jt(p[4],-1,1);G=Math.pow(10,J),B=255*k<<8|255*L}else B=65535,V=0,N=1,G=1;if(l.emplaceBack(E,C,w,B,V,N,G),x){let H=x.length;x.clear();for(let J=0;J<H;J++)x.emplaceBack(E,C,w,B,V,N,G)}}function qk(l,e,i){let c=l.node,p=0,u=i&Zh.HasMeshoptCompression;for(let m of c.meshes){if(c.lights&&c.lightMeshIndex===p||!m.featureData)continue;m.featureArray=new Oh,m.featureArray.reserve(m.featureData.length);let x=e;for(let I of m.featureData){let D=u?65535&I:I>>16&65535,_=u?I>>16&65535:65535&I,E=(15&_)<8?15&_:0,C=l.evaluatedRMEA[E],w=l.evaluatedColor[E],T=l.emissionHeightBasedParams[E],S;if(x&&E===2&&c.lights&&(S=new Oh,S.resize(10*c.lights.length)),Hk(m.featureArray,D,w,C,T,m.aabb.min[2],m.aabb.max[2],S),S&&x){x=!1;let k=c.meshes[c.lightMeshIndex];k.featureArray=S,k.featureArray._trim()}}m.featureArray._trim(),p++}}ft(B_,"Tiled3dModelBucket",{omit:["layers"]}),ft(CC,"Tiled3dModelFeature");let Wk=["id","tile","layer","source","sourceLayer","state"];class Lp{constructor(e,i,c,p,u){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=c,this._y=p,this.properties=e.properties,this.id=u}clone(){let e=new Lp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=bt({},this.state)),this.layer&&(e.layer=bt({},this.layer)),this.namespace&&(e.namespace=this.namespace),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let i of Wk)this[i]!==void 0&&(e[i]=this[i]);return e}}function DC(l,e,i,c){let p=1<<l.z;e.lat=re((c/st+l.y)/p),e.lng=Q((i/st+l.x)/p)}let Zk={circle:class extends mr{constructor(l,e,i,c){super(l,{layout:Cn||(Cn=new Kn({"circle-sort-key":new wt(Re.layout_circle["circle-sort-key"]),visibility:new tt(Re.layout_circle.visibility)})),paint:ni||(ni=new Kn({"circle-radius":new wt(Re.paint_circle["circle-radius"]),"circle-color":new wt(Re.paint_circle["circle-color"]),"circle-blur":new wt(Re.paint_circle["circle-blur"]),"circle-opacity":new wt(Re.paint_circle["circle-opacity"]),"circle-translate":new tt(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new tt(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tt(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tt(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wt(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wt(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wt(Re.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new tt(Re.paint_circle["circle-emissive-strength"])}))},e,i,c)}createBucket(l){return new Xe(l)}queryRadius(l){let e=l;return jn("circle-radius",this,e)+jn("circle-stroke-width",this,e)+nn(this.paint.get("circle-translate"))}queryIntersectsFeature(l,e,i,c,p,u,m,x){let I=Ln(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,l.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return oI(l,c,u,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",I,D)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,e,i){let c=rI(this);return{config:new ds(this,{zoom:e,lut:i}),defines:c,overrideFog:!1}}},heatmap:class extends mr{createBucket(l){return new aI(l)}constructor(l,e,i,c){super(l,{layout:lI||(lI=new Kn({visibility:new tt(Re.layout_heatmap.visibility)})),paint:cI||(cI=new Kn({"heatmap-radius":new wt(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wt(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tt(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Sl(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tt(Re.paint_heatmap["heatmap-opacity"])}))},e,i,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return jn("heatmap-radius",this,l)}queryIntersectsFeature(l,e,i,c,p,u,m,x){let I=this.paint.get("heatmap-radius").evaluate(e,i);return oI(l,c,u,m,x,!0,!0,new ot(0,0),I)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,e,i){return l==="heatmap"?{config:new ds(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends mr{constructor(l,e,i,c){super(l,{layout:uI||(uI=new Kn({visibility:new tt(Re.layout_hillshade.visibility)})),paint:hI||(hI=new Kn({"hillshade-illumination-direction":new tt(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tt(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tt(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tt(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tt(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tt(Re.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new tt(Re.paint_hillshade["hillshade-emissive-strength"])}))},e,i,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,e,i){return{overrideFog:!1}}},fill:class extends mr{constructor(l,e,i,c){super(l,{layout:vI||(vI=new Kn({"fill-sort-key":new wt(Re.layout_fill["fill-sort-key"]),visibility:new tt(Re.layout_fill.visibility),"fill-elevation-reference":new tt(Re.layout_fill["fill-elevation-reference"])})),paint:xI||(xI=new Kn({"fill-antialias":new tt(Re.paint_fill["fill-antialias"]),"fill-opacity":new wt(Re.paint_fill["fill-opacity"]),"fill-color":new wt(Re.paint_fill["fill-color"]),"fill-outline-color":new wt(Re.paint_fill["fill-outline-color"]),"fill-translate":new tt(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new tt(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new wt(Re.paint_fill["fill-pattern"]),"fill-emissive-strength":new tt(Re.paint_fill["fill-emissive-strength"]),"fill-z-offset":new wt(Re.paint_fill["fill-z-offset"])}))},e,i,c)}getProgramIds(){let l=this.paint.get("fill-pattern"),e=l&&l.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(l,e,i){return{config:new ds(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(l,e){super.recalculate(l,e);let i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new J0(l)}queryRadius(){return nn(this.paint.get("fill-translate"))}queryIntersectsFeature(l,e,i,c,p,u){return!l.queryGeometry.isAboveHorizon&&vt(Nn(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,l.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends mr{constructor(l,e,i,c){super(l,{layout:tT||(tT=new Kn({visibility:new tt(Re["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new tt(Re["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:nT||(nT=new Kn({"fill-extrusion-opacity":new tt(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wt(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tt(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tt(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wt(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wt(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wt(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new tt(Re["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new tt(Re["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new tt(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new tt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new tt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new tt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new tt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new tt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new tt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new tt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new wt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new wt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new tt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new tt(Re["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new tt(Re["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new tt(Re["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new wt(Re["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new wt(Re["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new tt(Re["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},e,i,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new g_(l)}queryRadius(){return nn(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,e,i,c,p,u,m,x,I){let D=Ln(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,l.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),C=[0,0],w=x&&u.elevation,T=u.elevation?u.elevation.exaggeration():1,S=l.tile.getBucket(this);if(w&&S instanceof g_){let N=S.centroidVertexArray,G=I+1;G<N.length&&(C[0]=N.geta_centroid_pos0(G),C[1]=N.geta_centroid_pos1(G))}if(C[0]===0&&C[1]===1)return!1;u.projection.name==="globe"&&(c=eT([c],[new ot(0,0),new ot(st,st)],l.tileID.canonical).map(N=>N.polygon).flat());let k=w?x:null,[L,B]=function(N,G,H,J,se,ee,ne,me,te,de,ve){return N.projection.name==="globe"?function(xe,Ie,Ae,Pe,De,$e,Je,ze,dt,it,et){let Ye=[],It=[],ht=xe.projection.upVectorScale(et,xe.center.lat,xe.worldSize).metersToTile,mt=[0,0,0,1],Vt=[0,0,0,1],Xt=(qt,rn,tn,Wn)=>{qt[0]=rn,qt[1]=tn,qt[2]=Wn,qt[3]=1},Jt=QI();Ae>0&&(Ae+=Jt),Pe+=Jt;for(let qt of Ie){let rn=[],tn=[];for(let Wn of qt){let zn=Wn.x+De.x,Pt=Wn.y+De.y,Dn=xe.projection.projectTilePoint(zn,Pt,et),Rn=xe.projection.upVector(et,Wn.x,Wn.y),ri=Ae,yi=Pe;if(Je){let Mi=rT(zn,Pt,Ae,Pe,Je,ze,dt,it);ri+=Mi.base,yi+=Mi.top}Ae!==0?Xt(mt,Dn.x+Rn[0]*ht*ri,Dn.y+Rn[1]*ht*ri,Dn.z+Rn[2]*ht*ri):Xt(mt,Dn.x,Dn.y,Dn.z),Xt(Vt,Dn.x+Rn[0]*ht*yi,Dn.y+Rn[1]*ht*yi,Dn.z+Rn[2]*ht*yi),Ee.vec3.transformMat4(mt,mt,$e),Ee.vec3.transformMat4(Vt,Vt,$e),rn.push(new uu(mt[0],mt[1],mt[2])),tn.push(new uu(Vt[0],Vt[1],Vt[2]))}Ye.push(rn),It.push(tn)}return[Ye,It]}(N,G,H,J,se,ee,ne,me,te,de,ve):ne?function(xe,Ie,Ae,Pe,De,$e,Je,ze,dt){let it=[],et=[],Ye=[0,0,0,1];for(let It of xe){let ht=[],mt=[];for(let Vt of It){let Xt=Vt.x+Pe.x,Jt=Vt.y+Pe.y,qt=rT(Xt,Jt,Ie,Ae,$e,Je,ze,dt);Ye[0]=Xt,Ye[1]=Jt,Ye[2]=qt.base,Ye[3]=1,Ee.vec4.transformMat4(Ye,Ye,De),Ye[3]=Math.max(Ye[3],1e-5);let rn=new uu(Ye[0]/Ye[3],Ye[1]/Ye[3],Ye[2]/Ye[3]);Ye[0]=Xt,Ye[1]=Jt,Ye[2]=qt.top,Ye[3]=1,Ee.vec4.transformMat4(Ye,Ye,De),Ye[3]=Math.max(Ye[3],1e-5);let tn=new uu(Ye[0]/Ye[3],Ye[1]/Ye[3],Ye[2]/Ye[3]);ht.push(rn),mt.push(tn)}it.push(ht),et.push(mt)}return[it,et]}(G,H,J,se,ee,ne,me,te,de):function(xe,Ie,Ae,Pe,De){let $e=[],Je=[],ze=De[8]*Ie,dt=De[9]*Ie,it=De[10]*Ie,et=De[11]*Ie,Ye=De[8]*Ae,It=De[9]*Ae,ht=De[10]*Ae,mt=De[11]*Ae;for(let Vt of xe){let Xt=[],Jt=[];for(let qt of Vt){let rn=qt.x+Pe.x,tn=qt.y+Pe.y,Wn=De[0]*rn+De[4]*tn+De[12],zn=De[1]*rn+De[5]*tn+De[13],Pt=De[2]*rn+De[6]*tn+De[14],Dn=De[3]*rn+De[7]*tn+De[15],Rn=Wn+ze,ri=zn+dt,yi=Pt+it,Mi=Math.max(Dn+et,1e-5),vi=Wn+Ye,fi=zn+It,Ei=Pt+ht,Pi=Math.max(Dn+mt,1e-5);Xt.push(new uu(Rn/Mi,ri/Mi,yi/Mi)),Jt.push(new uu(vi/Pi,fi/Pi,Ei/Pi))}$e.push(Xt),Je.push(Jt)}return[$e,Je]}(G,H,J,se,ee)}(u,c,E,_,D,m,k,C,T,u.center.lat,l.tileID.canonical),V=l.queryGeometry;return function(N,G,H){let J=1/0;vt(H,G)&&(J=iT(H,G[0]));for(let se=0;se<G.length;se++){let ee=G[se],ne=N[se];for(let me=0;me<ee.length-1;me++){let te=ee[me],de=[te,ee[me+1],ne[me+1],ne[me],te];Ge(H,de)&&(J=Math.min(J,iT(H,de)))}}return J!==1/0&&J}(L,B,V.isPointQuery()?V.screenBounds:V.screenGeometry)}},line:class extends mr{constructor(l,e,i,c){let p=pT();super(l,p,e,i,c),p.layout&&(this.layout=new Ml(p.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Vc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,e){super.recalculate(l,e),this.paint._values["line-floorwidth"]=(()=>{if(wp)return wp;let i=pT();return wp=new YO(i.paint.properties["line-width"].specification),wp.useIntegerZoom=!0,wp})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new ax(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,e,i){let c=dT(this);return{config:new ds(this,{zoom:e,lut:i}),defines:c,overrideFog:!1}}queryRadius(l){let e=l,i=mT(jn("line-width",this,e),jn("line-gap-width",this,e)),c=jn("line-offset",this,e);return i/2+Math.abs(c)+nn(this.paint.get("line-translate"))}queryIntersectsFeature(l,e,i,c,p,u){if(l.queryGeometry.isAboveHorizon)return!1;let m=Nn(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,l.pixelToTileUnitsFactor),x=l.pixelToTileUnitsFactor/2*mT(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),I=this.paint.get("line-offset").evaluate(e,i);return I&&(c=function(D,_){let E=[],C=new ot(0,0);for(let w=0;w<D.length;w++){let T=D[w],S=[];for(let k=0;k<T.length;k++){let L=T[k],B=T[k+1],V=k===0?C:L.sub(T[k-1])._unit()._perp(),N=k===T.length-1?C:B.sub(L)._unit()._perp(),G=V._add(N)._unit();G._mult(1/(G.x*N.x+G.y*N.y)),S.push(G._mult(_)._add(L))}E.push(S)}return E}(c,I*l.pixelToTileUnitsFactor)),function(D,_,E){for(let C=0;C<_.length;C++){let w=_[C];if(D.length>=3){for(let T=0;T<w.length;T++)if(cn(D,w[T]))return!0}if(Et(D,w,E))return!0}return!1}(m,c,x)}isTileClipped(){return!0}isDraped(l){let e=this.layout.get("line-z-offset"),i=e.isConstant()&&!e.constantOr(0),c=this.layout.get("line-elevation-reference");return!(c==="sea"||c==="ground")&&(i||c!=="none")}},symbol:R_,background:class extends mr{constructor(l,e,i,c){super(l,{layout:KT||(KT=new Kn({visibility:new tt(Re.layout_background.visibility)})),paint:QT||(QT=new Kn({"background-pitch-alignment":new tt(Re.paint_background["background-pitch-alignment"]),"background-color":new tt(Re.paint_background["background-color"]),"background-pattern":new tt(Re.paint_background["background-pattern"]),"background-opacity":new tt(Re.paint_background["background-opacity"]),"background-emissive-strength":new tt(Re.paint_background["background-emissive-strength"])}))},e,i,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,e,i){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:rC,"raster-particle":uC,sky:class extends mr{constructor(l,e,i,c){super(l,{layout:aC||(aC=new Kn({visibility:new tt(Re.layout_sky.visibility)})),paint:lC||(lC=new Kn({"sky-type":new tt(Re.paint_sky["sky-type"]),"sky-atmosphere-sun":new tt(Re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new tt(Re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new tt(Re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new tt(Re.paint_sky["sky-gradient-radius"]),"sky-gradient":new Sl(Re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new tt(Re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new tt(Re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new tt(Re.paint_sky["sky-opacity"])}))},e,i,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=fp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(l,e){if(this.paint.get("sky-type")==="atmosphere"){let c=this.paint.get("sky-atmosphere-sun"),p=!c,u=l.style.light,m=u.properties.get("position");return p&&u.properties.get("anchor")==="viewport"&&fn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?Sx(m.azimuthal,90-m.polar,e):Sx(c[0],90-c[1],e)}let i=this.paint.get("sky-gradient-center");return Sx(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends mr{constructor(l,e,i,c){super(l,{paint:cC||(cC=new Kn({}))},e,null)}},model:class extends mr{constructor(l,e,i,c){super(l,{layout:xC||(xC=new Kn({visibility:new tt(Re.layout_model.visibility),"model-id":new wt(Re.layout_model["model-id"])})),paint:bC||(bC=new Kn({"model-opacity":new tt(Re.paint_model["model-opacity"]),"model-rotation":new wt(Re.paint_model["model-rotation"]),"model-scale":new wt(Re.paint_model["model-scale"]),"model-translation":new wt(Re.paint_model["model-translation"]),"model-color":new wt(Re.paint_model["model-color"]),"model-color-mix-intensity":new wt(Re.paint_model["model-color-mix-intensity"]),"model-type":new tt(Re.paint_model["model-type"]),"model-cast-shadows":new tt(Re.paint_model["model-cast-shadows"]),"model-receive-shadows":new tt(Re.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new tt(Re.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new wt(Re.paint_model["model-emissive-strength"]),"model-roughness":new wt(Re.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new wt(Re.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new tt(Re.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new tt(Re.paint_model["model-front-cutoff"])}))},e,i,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new Px(l)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof B_?st-1:0}queryIntersectsFeature(l,e,i,c,p,u){if(!this.modelManager)return!1;let m=this.modelManager,x=l.tile.getBucket(this);if(!(x&&x instanceof Px))return!1;let I=x;for(let D in I.instancesPerModel){let _=I.instancesPerModel[D],E=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(_.idToFeaturesIndex.hasOwnProperty(E)){let C=_.features[_.idToFeaturesIndex[E]],w=m.getModel(D,this.scope);if(!w)return!1;let T=Ee.mat4.create(),S=new P(0,0),k=I.canonical,L=Number.MAX_VALUE;for(let B=0;B<C.instancedDataCount;++B){let V=16*(C.instancedDataOffset+B),N=_.instancedDataArray.float32,G=[N[V+4],N[V+5],N[V+6]];DC(k,S,N[V],0|N[V+1]),wC(T,w,u,S,C.rotation,C.scale,G,!1,!1,!1),u.projection.name==="globe"&&(T=Rx(T,u));let H=Ee.mat4.multiply([],u.projMatrix,T),J=l.queryGeometry,se=mC(J.isPointQuery()?J.screenBounds:J.screenGeometry,u,H,w.aabb);se!=null&&(L=Math.min(se,L))}return L!==Number.MAX_VALUE&&L}}return!1}_handleOverridablePaintPropertyUpdate(l,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){let e=this._transitionablePaint._values[l];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof qc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(l,e,i,c){let p=l.tile,u=p.getBucket(this),m=null,x=Number.MAX_VALUE;if(!(u&&u instanceof B_))return{queryFeature:m,intersectionZ:x};let I=u.getNodesInfo()[e];if(I.hiddenByReplacement||!I.node.meshes||!i.filter(new li(p.tileID.overscaledZ),I.feature,p.tileID.canonical))return{queryFeature:m,intersectionZ:x};let D=I.node,_=c.calculatePosMatrix(p.tileID.toUnwrapped(),c.worldSize),E=I.evaluatedScale,C=0;c.elevation&&D.elevation&&(C=D.elevation*c.elevation.exaggeration()),Ee.mat4.translate(_,_,[(D.anchor?D.anchor[0]:0)*(E[0]-1),(D.anchor?D.anchor[1]:0)*(E[1]-1),C]),Ee.mat4.scale(_,_,E);let w=l.queryGeometry,T=w.isPointQuery()?w.screenBounds:w.screenGeometry,S=function(N){let G=Ee.mat4.multiply([],_,N.matrix);Ee.mat4.multiply(G,c.expandedFarZProjMatrix,G);for(let H=0;H<N.meshes.length;++H){let J=N.meshes[H];if(H===N.lightMeshIndex)continue;let se=mC(T,c,G,J.aabb);se!=null&&(x=Math.min(se,x))}if(N.children)for(let H of N.children)S(H)};if(S(D),x===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:x};let k=new P(0,0);DC(p.tileID.canonical,k,I.node.anchor[0],I.node.anchor[1]);let{z:L,x:B,y:V}=p.tileID.canonical;return m=new Lp({},L,B,V,I.feature.id),m.properties=I.feature.properties,m.geometry={type:"Point",coordinates:[k.lng,k.lat]},m.layer=Un(bt({},this.serialize()),{id:this.fqid}),m.state={},m.tile=p.tileID.canonical,{queryFeature:m,intersectionZ:x}}},clip:class extends mr{constructor(l,e,i,c){super(l,{layout:bI||(bI=new Kn({"clip-layer-types":new tt(Re.layout_clip["clip-layer-types"]),"clip-layer-scope":new tt(Re.layout_clip["clip-layer-scope"])})),paint:wI||(wI=new Kn({}))},e,i,c)}recalculate(l,e){super.recalculate(l,e)}createBucket(l){return new EI(l)}isTileClipped(){return!0}is3D(){return!0}}};class Xk{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Yk{constructor(){this.tasks={},this.taskQueue=[],Ka(["process"],this),this.invoker=new Xk(this.process),this.nextId=0}add(e,i){let c=this.nextId++,p=function({type:u,isSymbolTile:m,zoom:x}){return x=x||0,u==="message"?0:u!=="maybePrepare"||m?u!=="parseTile"||m?u==="parseTile"&&m?300-x:u==="maybePrepare"&&m?400-x:500:200-x:100-x}(i);if(p===0){try{e()}finally{}return null}return this.tasks[c]={fn:e,metadata:i,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let p=0;p<this.taskQueue.length;p++){let u=this.tasks[this.taskQueue[p]];u.priority<i&&(i=u.priority,e=p)}if(e===null)return null;let c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class MC{constructor(e,i,c){this.target=e,this.parent=i,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Ka(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Yk}send(e,i,c,p,u=!1,m){let x=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[x]=c);let I=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!c,targetMapId:p,mustQueue:u,sourceMapId:this.mapId,data:Ea(i,I)},I),{cancel:()=>{c&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(e){let i=e.data,c=i.id;if(c&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){let p=this.cancelCallbacks[c];delete this.cancelCallbacks[c],p&&p.cancel()}else if(i.mustQueue||fa()){let p=this.callbacks[c],u=this.scheduler.add(()=>this.processTask(c,i),p&&p.metadata||{type:"message"});u&&(this.cancelCallbacks[c]=u)}else this.processTask(c,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){let c=this.callbacks[e];delete this.callbacks[e],c&&(i.error?c(zs(i.error)):c(null,zs(i.data)))}else{let c=new Set,p=i.hasCallback?(m,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?Ea(m):null,data:Ea(x,c)},c)}:()=>{},u=zs(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,u,p);else if(this.parent.getWorkerSource){let m=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,m[0],u.source,u.scope)[m[1]](u,p)}else p(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let Fx=(()=>{class l{constructor(i,c){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=Ic();let p=this.workerPool.acquire(this.id);for(let u=0;u<p.length;u++){let m=new l.Actor(p[u],c,this.id);m.name=`Worker ${u}`,this.actors.push(m)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,c,p){ha(this.actors,(u,m)=>{u.send(i,c,m)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}return l.Actor=MC,l})();class SC{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){let c=this.toIdx(e,i);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function AC(l,e,i,c){let p=0,u=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(i[m]<l[m]||i[m]>e[m])return null}else{let x=1/c[m],I=(l[m]-i[m])*x,D=(e[m]-i[m])*x;if(I>D){let _=I;I=D,D=_}if(I>p&&(p=I),D<u&&(u=D),p>u)return null}return p}function RC(l,e,i,c,p,u,m,x,I,D,_){let E=c-l,C=p-e,w=u-i,T=m-l,S=x-e,k=I-i,L=_[1]*k-_[2]*S,B=_[2]*T-_[0]*k,V=_[0]*S-_[1]*T,N=E*L+C*B+w*V;if(Math.abs(N)<1e-15)return null;let G=1/N,H=D[0]-l,J=D[1]-e,se=D[2]-i,ee=(H*L+J*B+se*V)*G;if(ee<0||ee>1)return null;let ne=J*w-se*C,me=se*E-H*w,te=H*C-J*E,de=(_[0]*ne+_[1]*me+_[2]*te)*G;return de<0||ee+de>1?null:(T*ne+S*me+k*te)*G}function PC(l,e,i){return(l-e)/(i-e)}function OC(l,e,i,c,p,u,m,x,I){let D=1<<i,_=u-c,E=m-p,C=(l+1)/D*_+c,w=(e+0)/D*E+p,T=(e+1)/D*E+p;x[0]=(l+0)/D*_+c,x[1]=w,I[0]=C,I[1]=T}class kC{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=function(u){let m=Math.ceil(Math.log2(u.dim/8)),x=[],I=Math.ceil(Math.pow(2,m)),D=1/I,_=(w,T,S,k,L)=>{let B=k?1:0,V=(w+1)*S-B,N=T*S,G=(T+1)*S-B;L[0]=w*S,L[1]=N,L[2]=V,L[3]=G},E=new SC(I),C=[];for(let w=0;w<I*I;w++){_(w%I,Math.floor(w/I),D,!1,C);let T=Wl(C[0],C[1],u),S=Wl(C[2],C[1],u),k=Wl(C[2],C[3],u),L=Wl(C[0],C[3],u);E.minimums.push(Math.min(T,S,k,L)),E.maximums.push(Math.max(T,S,k,L)),E.leaves.push(1)}for(x.push(E),I/=2;I>=1;I/=2){let w=x[x.length-1];E=new SC(I);for(let T=0;T<I*I;T++){_(T%I,Math.floor(T/I),2,!0,C);let S=w.getElevation(C[0],C[1]),k=w.getElevation(C[2],C[1]),L=w.getElevation(C[2],C[3]),B=w.getElevation(C[0],C[3]),V=w.isLeaf(C[0],C[1]),N=w.isLeaf(C[2],C[1]),G=w.isLeaf(C[2],C[3]),H=w.isLeaf(C[0],C[3]),J=Math.min(S.min,k.min,L.min,B.min),se=Math.max(S.max,k.max,L.max,B.max),ee=V&&N&&G&&H;E.maximums.push(se),E.minimums.push(J),E.leaves.push(se-J<=5&&ee?1:0)}x.push(E)}return x}(this.dem),c=i.length-1,p=i[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(i,0,0,c,0)}raycastRoot(e,i,c,p,u,m,x=1){return AC([e,i,-100],[c,p,this.maximums[0]*x],u,m)}raycast(e,i,c,p,u,m,x=1){if(!this.nodeCount)return null;let I=this.raycastRoot(e,i,c,p,u,m,x);if(I==null)return null;let D=[],_=[],E=[],C=[],w=[{idx:0,t:I,nodex:0,nodey:0,depth:0}];for(;w.length>0;){let{idx:T,t:S,nodex:k,nodey:L,depth:B}=w.pop();if(this.leaves[T]){OC(k,L,B,e,i,c,p,E,C);let N=1<<B,G=(k+0)/N,H=(k+1)/N,J=(L+0)/N,se=(L+1)/N,ee=Wl(G,J,this.dem)*x,ne=Wl(H,J,this.dem)*x,me=Wl(H,se,this.dem)*x,te=Wl(G,se,this.dem)*x,de=RC(E[0],E[1],ee,C[0],E[1],ne,C[0],C[1],me,u,m),ve=RC(C[0],C[1],me,E[0],C[1],te,E[0],E[1],ee,u,m),xe=Math.min(de!==null?de:Number.MAX_VALUE,ve!==null?ve:Number.MAX_VALUE);if(xe!==Number.MAX_VALUE)return xe;{let Ie=Ee.vec3.scaleAndAdd([],u,m,S);if(LC(ee,ne,te,me,PC(Ie[0],E[0],C[0]),PC(Ie[1],E[1],C[1]))>=Ie[2])return S}continue}let V=0;for(let N=0;N<this._siblingOffset.length;N++){OC((k<<1)+this._siblingOffset[N][0],(L<<1)+this._siblingOffset[N][1],B+1,e,i,c,p,E,C),E[2]=-100,C[2]=this.maximums[this.childOffsets[T]+N]*x;let G=AC(E,C,u,m);if(G!=null){let H=G;D[N]=H;let J=!1;for(let se=0;se<V&&!J;se++)H>=D[_[se]]&&(_.splice(se,0,N),J=!0);J||(_[V]=N),V++}}for(let N=0;N<V;N++){let G=_[N];w.push({idx:this.childOffsets[T]+G,t:D[G],nodex:(k<<1)+this._siblingOffset[G][0],nodey:(L<<1)+this._siblingOffset[G][1],depth:B+1})}}return null}_addNode(e,i,c){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,c,p,u){if(e[p].isLeaf(i,c)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let m=p-1,x=e[m],I=0,D=0;for(let _=0;_<this._siblingOffset.length;_++){let E=2*i+this._siblingOffset[_][0],C=2*c+this._siblingOffset[_][1],w=x.getElevation(E,C),T=x.isLeaf(E,C),S=this._addNode(w.min,w.max,T);T&&(I|=1<<_),D||(D=S)}for(let _=0;_<this._siblingOffset.length;_++)I&1<<_||this._construct(e,2*i+this._siblingOffset[_][0],2*c+this._siblingOffset[_][1],m,D+_)}}function LC(l,e,i,c,p,u){return Rt(Rt(l,i,u),Rt(e,c,u),p)}function Wl(l,e,i){let c=i.dim,p=jt(l*c-.5,0,c-1),u=jt(e*c-.5,0,c-1),m=Math.floor(p),x=Math.floor(u),I=Math.min(m+1,c-1),D=Math.min(x+1,c-1);return LC(i.get(m,x),i.get(I,x),i.get(m,D),i.get(I,D),p-m,u-x)}let Jk={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Kk(l,e,i){return(256*l*256+256*e+i)/10-1e4}function Qk(l,e,i){return 256*l+e+i/256-32768}class V_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,c,p=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void fn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;let u=this.dim=i.height-2,m=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let I=0;I<u;I++)m[this._idx(-1,I)]=m[this._idx(0,I)],m[this._idx(u,I)]=m[this._idx(u-1,I)],m[this._idx(I,-1)]=m[this._idx(I,0)],m[this._idx(I,u)]=m[this._idx(I,u-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(u,-1)]=m[this._idx(u-1,0)],m[this._idx(-1,u)]=m[this._idx(0,u-1)],m[this._idx(u,u)]=m[this._idx(u-1,u-1)]}let x=c==="terrarium"?Qk:Kk;for(let I=0;I<m.length;++I){let D=4*I;this.floatView[I]=x(this.pixels[D],this.pixels[D+1],this.pixels[D+2])}this._timestamp=ct.now()}_buildQuadTree(){this._tree=new kC(this)}get(e,i,c=!1){c&&(e=jt(e,-1,this.dim),i=jt(i,-1,this.dim));let p=this._idx(e,i);return this.floatView[p]}set(e,i,c){let p=this._idx(e,i),u=this.floatView[p];return this.floatView[p]=c,c-u}static getUnpackVector(e){return Jk[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){let c=[0,0,0,0],p=V_.getUnpackVector(i),u=Math.floor((e+p[3])/p[2]);return c[2]=u%256,u=Math.floor(u/256),c[1]=u%256,u=Math.floor(u/256),c[0]=u,c}getPixels(){return new pI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=i*this.dim,u=i*this.dim+this.dim,m=c*this.dim,x=c*this.dim+this.dim;switch(i){case-1:p=u-1;break;case 1:u=p+1}switch(c){case-1:m=x-1;break;case 1:x=m+1}let I=-i*this.dim,D=-c*this.dim;for(let _=m;_<x;_++)for(let E=p;E<u;E++){let C=4*this._idx(E,_),w=4*this._idx(E+I,_+D);this.pixels[C+0]=e.pixels[w+0],this.pixels[C+1]=e.pixels[w+1],this.pixels[C+2]=e.pixels[w+2],this.pixels[C+3]=e.pixels[w+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function eL(l,e,i){l===1?e.headerLength=i.readFixed32():l===2?e.x=i.readVarint():l===3?e.y=i.readVarint():l===4?e.z=i.readVarint():l===5&&e.layers.push(function(c,p){return c.readFields(oL,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(i,i.readVarint()+i.pos))}function tL(l,e,i){l===1?(e.delta_filter=function(c,p){return c.readFields(nL,{blockSize:0},p)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):l===2?(i.readVarint(),e.filter="zigzag_filter"):l===3?(i.readVarint(),e.filter="bitshuffle_filter"):l===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function nL(l,e,i){l===1&&(e.blockSize=i.readVarint())}function iL(l,e,i){l===1?(i.readVarint(),e.codec="gzip_data"):l===2?(i.readVarint(),e.codec="jpeg_image"):l===3?(i.readVarint(),e.codec="webp_image"):l===4&&(i.readVarint(),e.codec="png_image")}function rL(l,e,i){let c=0,p=0;l===1?e.firstByte=i.readFixed64():l===2?e.lastByte=i.readFixed64():l===3?e.filters.push(function(u,m){return u.readFields(tL,{},m)}(i,i.readVarint()+i.pos)):l===4?e.codec=function(u,m){return u.readFields(iL,{},m)}(i,i.readVarint()+i.pos):l===5?p=i.readFloat():l===6?c=i.readFloat():l===7?e.bands.push(i.readString()):l===8?e.offset=i.readDouble():l===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=p),e.scale===0&&(e.scale=c)}function oL(l,e,i){l===1?e.version=i.readVarint():l===2?e.name=i.readString():l===3?e.units=i.readString():l===4?e.tileSize=i.readVarint():l===5?e.buffer=i.readVarint():l===6?e.pixelFormat=i.readVarint():l===7&&e.dataIndex.push(function(c,p){return c.readFields(rL,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(i,i.readVarint()+i.pos))}function sL(l,e,i){if(l===2)(function(c,p,u){c.readFields(aL,u,p)})(i,i.readVarint()+i.pos,e);else if(l===3)throw new Error("Not implemented")}function aL(l,e,i){if(l===1){let c=0,p=i.readVarint()+i.pos;for(;i.pos<p;)e[c++]=i.readVarint()}}ft(V_,"DEMData"),ft(kC,"DemMinMaxQuadTree",{omit:["dem"]});class lL{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;let i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}}function cL(l,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let c=2;c>=1;c--){let p=c===1?1:0,u=c===2?1:0;for(let m=0;m<e[0];m++){let x=e[1]*m;for(let I=p;I<e[1];I++){let D=e[2]*(I+x);for(let _=u;_<e[2];_++){let E=e[3]*(_+D);for(let C=0;C<e[3];C++){let w=E+C;l[w]+=l[w-i]}}}}i*=e[c]}return l}function uL(l){for(let e=0,i=l.length;e<i;e++)l[e]=l[e]>>>1^-(1&l[e]);return l}function hL(l,e){switch(e){case"uint32":return l;case"uint16":for(let i=0;i<l.length;i+=2){let c=l[i],p=l[i+1];l[i]=(240&c)>>4|(61440&c)>>8|(240&p)<<4|61440&p,l[i+1]=15&c|(3840&c)>>4|(15&p)<<8|(3840&p)<<4}return l;case"uint8":for(let i=0;i<l.length;i+=4){let c=l[i],p=l[i+1],u=l[i+2],m=l[i+3];l[i+0]=(192&c)>>6|(192&p)>>4|(192&u)>>2|192&m,l[i+1]=(48&c)>>4|(48&p)>>2|48&u|(48&m)<<2,l[i+2]=(12&c)>>2|12&p|(12&u)<<2|(12&m)<<4,l[i+3]=3&c|(3&p)<<2|(3&u)<<4|(3&m)<<6}return l;default:throw new Error(`Invalid pixel format, "${e}"`)}}var xo=Uint8Array,Fp=Uint16Array,dL=Int32Array,FC=new xo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),NC=new xo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fL=new xo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zC=function(l,e){for(var i=new Fp(31),c=0;c<31;++c)i[c]=e+=1<<l[c-1];var p=new dL(i[30]);for(c=1;c<30;++c)for(var u=i[c];u<i[c+1];++u)p[u]=u-i[c]<<5|c;return{b:i,r:p}},BC=zC(FC,2),VC=BC.b,pL=BC.r;VC[28]=258,pL[258]=28;for(var mL=zC(NC,0).b,jC=new Fp(32768),Di=0;Di<32768;++Di){var Yh=(43690&Di)>>1|(21845&Di)<<1;jC[Di]=((65280&(Yh=(61680&(Yh=(52428&Yh)>>2|(13107&Yh)<<2))>>4|(3855&Yh)<<4))>>8|(255&Yh)<<8)>>1}var Np=function(l,e,i){for(var c=l.length,p=0,u=new Fp(e);p<c;++p)l[p]&&++u[l[p]-1];var m,x=new Fp(e);for(p=1;p<e;++p)x[p]=x[p-1]+u[p-1]<<1;m=new Fp(1<<e);var I=15-e;for(p=0;p<c;++p)if(l[p])for(var D=p<<4|l[p],_=e-l[p],E=x[l[p]-1]++<<_,C=E|(1<<_)-1;E<=C;++E)m[jC[E]>>I]=D;return m},zp=new xo(288);for(Di=0;Di<144;++Di)zp[Di]=8;for(Di=144;Di<256;++Di)zp[Di]=9;for(Di=256;Di<280;++Di)zp[Di]=7;for(Di=280;Di<288;++Di)zp[Di]=8;var UC=new xo(32);for(Di=0;Di<32;++Di)UC[Di]=5;var gL=Np(zp,9),_L=Np(UC,5),Nx=function(l){for(var e=l[0],i=1;i<l.length;++i)l[i]>e&&(e=l[i]);return e},gs=function(l,e,i){var c=e/8|0;return(l[c]|l[c+1]<<8)>>(7&e)&i},zx=function(l,e){var i=e/8|0;return(l[i]|l[i+1]<<8|l[i+2]<<16)>>(7&e)},yL=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_s=function(l,e,i){var c=new Error(e||yL[l]);if(c.code=l,Error.captureStackTrace&&Error.captureStackTrace(c,_s),!i)throw c;return c},vL=new xo(0),xL=typeof TextDecoder<"u"&&new TextDecoder;try{xL.decode(vL,{stream:!0})}catch{}let bL={gzip_data:"gzip"};class Bo extends Error{constructor(e){super(e),this.name="MRTError"}}let wL={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},$C={uint32:1,uint16:2,uint8:4},EL={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array},Bx;class Vx{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){let i=this.layers[e];if(!i)throw new Bo(`Layer '${e}' not found`);return i}getHeaderLength(e){let i=new Uint8Array(e),c=new DataView(e);if(i[0]!==13)throw new Bo("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(e){let i=new Uint8Array(e),c=this.getHeaderLength(e);if(i.length<c)throw new Bo(`Expected header with length >= ${c} but got buffer of length ${i.length}`);let p=function(u,m){return u.readFields(eL,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Bx(i.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new Bo(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(let u of p.layers)this.layers[u.name]=new IL(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let i=[],c=this.getLayer(e.layerName);for(let p of e.blockIndices){let u=c.dataIndex[p],m=u.firstByte-e.firstByte,x=u.lastByte-e.firstByte;if(c._blocksInProgress.has(p))continue;let I={layerName:c.name,firstByte:m,lastByte:x,pixelFormat:c.pixelFormat,blockIndex:p,blockShape:[u.bands.length].concat(c.bandShape),buffer:c.buffer,codec:u.codec.codec,filters:u.filters.map(D=>D.filter)};c._blocksInProgress.add(p),i.push(I)}return new GC(i,()=>{i.forEach(p=>c._blocksInProgress.delete(p.blockIndex))},(p,u)=>{if(i.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),p)throw p;u.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class IL{constructor({version:e,name:i,units:c,tileSize:p,pixelFormat:u,buffer:m,dataIndex:x},I){if(this.version=e,this.version!==1)throw new Bo(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=c,this.tileSize=p,this.buffer=m,this.pixelFormat=wL[u],this.dataIndex=x,this.bandShape=[p+2*m,p+2*m,$C[this.pixelFormat]],this._decodedBlocks=new lL(I?I.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return $C[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){let i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(let[c,p]of this.dataIndex.entries()){for(let[u,m]of p.bands.entries())if(m===e)return{bandIndex:i+u,blockIndex:c,blockBandIndex:u};i+=p.bands.length}break;case"number":for(let[c,p]of this.dataIndex.entries()){if(e>=i&&e<i+p.bands.length)return{bandIndex:e,blockIndex:c,blockBandIndex:e-i};i+=p.bands.length}break;default:throw new Bo(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Bo(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,c=-1/0,p=[],u=new Set;for(let m of e){let{blockIndex:x}=this.getBlockForBand(m);if(x<0)throw new Bo(`Invalid band: ${JSON.stringify(m)}`);let I=this.dataIndex[x];p.includes(x)||p.push(x),u.add(x),i=Math.min(i,I.firstByte),c=Math.max(c,I.lastByte)}if(u.size>this.cacheSize)throw new Bo(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:c,blockIndices:p}}hasBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){let{blockIndex:i,blockBandIndex:c}=this.getBlockForBand(e),p=this._decodedBlocks.get(i.toString());if(!p)throw new Bo(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let u=this.dataIndex[i],m=this.bandShape.reduce((D,_)=>D*_,1),x=c*m,I=p.subarray(x,x+m);return{data:I,bytes:new Uint8Array(I.buffer).subarray(I.byteOffset,I.byteOffset+I.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}Vx.setPbf=function(l){Bx=l};class GC{constructor(e,i,c){this.tasks=e,this._onCancel=i,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Vx.performDecoding=function(l,e){let i=new Uint8Array(l);return Promise.all(e.tasks.map(c=>{let{layerName:p,firstByte:u,lastByte:m,pixelFormat:x,blockShape:I,blockIndex:D,filters:_,codec:E}=c,C=i.subarray(u,m+1),w=new Uint32Array(I[0]*I[1]*I[2]),T;if(E!=="gzip_data")throw new Bo(`Unhandled codec: ${E}`);return T=function(S,k){if(!globalThis.DecompressionStream&&k==="gzip_data")return Promise.resolve(((N=function(J){J[0]==31&&J[1]==139&&J[2]==8||_s(6,"invalid gzip data");var se=J[3],ee=10;4&se&&(ee+=2+(J[10]|J[11]<<8));for(var ne=(se>>3&1)+(se>>4&1);ne>0;ne-=!J[ee++]);return ee+(2&se)}(V=S))+8>V.length&&_s(6,"invalid gzip data"),function(J,se,ee,ne){var me=J.length;if(!me||se.f&&!se.l)return ee||new xo(0);var te=!ee,de=te||se.i!=2,ve=se.i;te&&(ee=new xo(3*me));var xe,Ie,Ae=function(Zl){var mu=ee.length;if(Zl>mu){var Hp=new xo(Math.max(2*mu,Zl));Hp.set(ee),ee=Hp}},Pe=se.f||0,De=se.p||0,$e=se.b||0,Je=se.l,ze=se.d,dt=se.m,it=se.n,et=8*me;do{if(!Je){Pe=gs(J,De,1);var Ye=gs(J,De+1,3);if(De+=3,!Ye){var It=J[(Pt=4+((De+7)/8|0))-4]|J[Pt-3]<<8,ht=Pt+It;if(ht>me){ve&&_s(0);break}de&&Ae($e+It),ee.set(J.subarray(Pt,ht),$e),se.b=$e+=It,se.p=De=8*ht,se.f=Pe;continue}if(Ye==1)Je=gL,ze=_L,dt=9,it=5;else if(Ye==2){var mt=gs(J,De,31)+257,Vt=gs(J,De+10,15)+4,Xt=mt+gs(J,De+5,31)+1;De+=14;for(var Jt=new xo(Xt),qt=new xo(19),rn=0;rn<Vt;++rn)qt[fL[rn]]=gs(J,De+3*rn,7);De+=3*Vt;var tn=Nx(qt),Wn=(1<<tn)-1,zn=Np(qt,tn);for(rn=0;rn<Xt;){var Pt,Dn=zn[gs(J,De,Wn)];if(De+=15&Dn,(Pt=Dn>>4)<16)Jt[rn++]=Pt;else{var Rn=0,ri=0;for(Pt==16?(ri=3+gs(J,De,3),De+=2,Rn=Jt[rn-1]):Pt==17?(ri=3+gs(J,De,7),De+=3):Pt==18&&(ri=11+gs(J,De,127),De+=7);ri--;)Jt[rn++]=Rn}}var yi=Jt.subarray(0,mt),Mi=Jt.subarray(mt);dt=Nx(yi),it=Nx(Mi),Je=Np(yi,dt),ze=Np(Mi,it)}else _s(1);if(De>et){ve&&_s(0);break}}de&&Ae($e+131072);for(var vi=(1<<dt)-1,fi=(1<<it)-1,Ei=De;;Ei=De){var Pi=(Rn=Je[zx(J,De)&vi])>>4;if((De+=15&Rn)>et){ve&&_s(0);break}if(Rn||_s(2),Pi<256)ee[$e++]=Pi;else{if(Pi==256){Ei=De,Je=null;break}var nr=Pi-254;Pi>264&&(nr=gs(J,De,(1<<(vs=FC[rn=Pi-257]))-1)+VC[rn],De+=vs);var ei=ze[zx(J,De)&fi],zr=ei>>4;if(ei||_s(3),De+=15&ei,Mi=mL[zr],zr>3){var vs=NC[zr];Mi+=zx(J,De)&(1<<vs)-1,De+=vs}if(De>et){ve&&_s(0);break}de&&Ae($e+131072);var Vo=$e+nr;if($e<Mi){var jo=0-Mi,pu=Math.min(Mi,Vo);for(jo+$e<0&&_s(3);$e<pu;++$e)ee[$e]=(void 0)[jo+$e]}for(;$e<Vo;++$e)ee[$e]=ee[$e-Mi]}}se.l=Je,se.p=Ei,se.b=$e,se.f=Pe,Je&&(Pe=1,se.m=dt,se.d=ze,se.n=it)}while(!Pe);return $e!=ee.length&&te?(xe=ee,((Ie=$e)==null||Ie>xe.length)&&(Ie=xe.length),new xo(xe.subarray(0,Ie))):ee.subarray(0,$e)}(V.subarray(N,-8),{i:2},new xo(((L=V)[(B=L.length)-4]|L[B-3]<<8|L[B-2]<<16|L[B-1]<<24)>>>0))));var L,B,V,N;let G=bL[k];if(!G)throw new Error(`Unhandled codec: ${k}`);let H=new globalThis.DecompressionStream(G);return new Response(new Blob([S]).stream().pipeThrough(H)).arrayBuffer().then(J=>new Uint8Array(J))}(C,E).then(S=>(function(k,L){k.readFields(sL,L)}(new Bx(S),w),new EL[x](w.buffer))),T.then(S=>{for(let k=_.length-1;k>=0;k--)switch(_[k]){case"delta_filter":cL(S,I);break;case"zigzag_filter":uL(S);break;case"bitshuffle_filter":hL(S,x);break;default:throw new Bo(`Unhandled filter "${_[k]}"`)}return{layerName:p,blockIndex:D,data:S}}).catch(S=>{throw S})}))},ft(GC,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var Bp={workerUrl:"",workerClass:null,workerParams:void 0};let jx="mapboxgl_preloaded_worker_pool";class Vp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Vp.workerCount;)this.workers.push(Bp.workerClass!=null?new Bp.workerClass:new self.Worker(Bp.workerUrl,Bp.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jx]}numActive(){return Object.keys(this.active).length}}let jp;function j_(){return jp||(jp=new Vp),jp}Vp.workerCount=2;let Up,Ux,ys,Jh,$x,Kh=null;function HC(){return fa()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Ux||ce.DRACO_URL}function qC(){if(fa()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Jh)return Jh;let l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Jh=WebAssembly.validate(l)?ce.MESHOPT_SIMD_URL:ce.MESHOPT_URL,Jh}let U_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},TL={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},$p={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function WC(l,e,i){let c=i.json.bufferViews.length,p=i.buffers.length;e.bufferView=c,i.json.bufferViews[c]={buffer:p,byteLength:l.byteLength},i.buffers[p]=l}let Gx="KHR_draco_mesh_compression";function CL(l,e){let i=l.extensions&&l.extensions[Gx];if(!i)return;let c=new ys.Decoder,p=JC(e,i.bufferView),u=new ys.Mesh;if(!c.DecodeArrayToMesh(p,p.byteLength,u))throw new Error("Failed to decode Draco mesh");let m=e.json.accessors[l.indices],x=U_[m.componentType],I=m.count*x.BYTES_PER_ELEMENT,D=ys._malloc(I);x===Uint16Array?c.GetTrianglesUInt16Array(u,I,D):c.GetTrianglesUInt32Array(u,I,D),WC(ys.memory.buffer.slice(D,D+I),m,e),ys._free(D);for(let _ of Object.keys(i.attributes)){let E=c.GetAttributeByUniqueId(u,i.attributes[_]),C=e.json.accessors[l.attributes[_]],w=TL[C.componentType],T=C.count*$p[C.type]*U_[C.componentType].BYTES_PER_ELEMENT,S=ys._malloc(T);c.GetAttributeDataArrayForAllPoints(u,E,ys[w],T,S),WC(ys.memory.buffer.slice(S,S+T),C,e),ys._free(S)}c.destroy(),u.destroy(),delete l.extensions[Gx]}let $_="EXT_meshopt_compression";function DL(l,e){if(!l.extensions||!l.extensions[$_])return;let i=l.extensions[$_],c=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),p=new Uint8Array(i.count*i.byteStride);$x.decodeGltfBuffer(p,i.count,i.byteStride,c,i.mode,i.filter),l.buffer=e.buffers.length,l.byteOffset=0,e.buffers[l.buffer]=p.buffer,delete l.extensions[$_]}let ZC=1179937895,XC=new TextDecoder("utf8");function YC(l,e){return new URL(l,e).href}function ML(l,e,i,c){return fetch(YC(l.uri,c)).then(p=>p.arrayBuffer()).then(p=>{e.buffers[i]=p})}function JC(l,e){let i=l.json.bufferViews[e];return new Uint8Array(l.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function SL(l,e,i,c){if(l.uri){let p=YC(l.uri,c);return fetch(p).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[i]=u})}if(l.bufferView!==void 0){let p=JC(e,l.bufferView),u=new Blob([p],{type:l.mimeType});return createImageBitmap(u).then(m=>{e.images[i]=m})}}function KC(l,e=0,i){let c={json:null,images:[],buffers:[]};if(new Uint32Array(l,e,1)[0]===ZC){let _=new Uint32Array(l,e),E=2,C=(_[E++]>>2)-3,w=_[E++]>>2;if(E++,c.json=JSON.parse(XC.decode(_.subarray(E,E+w))),E+=w,E<C){let T=_[E++];E++;let S=e+(E<<2);c.buffers[0]=l.slice(S,S+T)}}else c.json=JSON.parse(XC.decode(new Uint8Array(l,e)));let{buffers:p,images:u,meshes:m,extensionsUsed:x,bufferViews:I}=c.json,D=Promise.resolve();if(p){let _=[];for(let E=0;E<p.length;E++){let C=p[E];C.uri?_.push(ML(C,c,E,i)):c.buffers[E]||(c.buffers[E]=null)}D=Promise.all(_)}return D.then(()=>{let _=[],E=x&&x.includes(Gx),C=x&&x.includes($_);if(E&&_.push(function(){if(!ys)return Up??(Up=function(w){let T,S=null;function k(){T=new Uint8Array(S.buffer)}function L(){throw new Error("Unexpected Draco error.")}let B={a:{a:L,d:function(V,N,G){return T.copyWithin(V,N,N+G)},c:function(V){let N=T.length,G=Math.max(V>>>0,Math.ceil(1.2*N)),H=Math.ceil((G-N)/65536);try{return S.grow(H),k(),!0}catch{return!1}},b:L}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(w,B):w.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,B))).then(V=>{let{Rb:N,Qb:G,P:H,T:J,X:se,Ja:ee,La:ne,Qa:me,Va:te,Wa:de,eb:ve,jb:xe,f:Ie,e:Ae,yb:Pe,zb:De,Ab:$e,Bb:Je,Db:ze,Gb:dt}=V.instance.exports;S=Ae;let it=(()=>{let et=0,Ye=0,It=0,ht=0;return mt=>{It&&(N(ht),N(et),Ye+=It,It=et=0),et||(Ye+=128,et=G(Ye));let Vt=mt.length+7&-8,Xt=et;Vt>=Ye&&(It=Vt,Xt=ht=G(Vt));for(let Jt=0;Jt<mt.length;Jt++)T[Xt+Jt]=mt[Jt];return Xt}})();return k(),Ie(),{memory:Ae,_free:N,_malloc:G,Mesh:class{constructor(){this.ptr=H()}destroy(){J(this.ptr)}},Decoder:class{constructor(){this.ptr=ee()}destroy(){xe(this.ptr)}DecodeArrayToMesh(et,Ye,It){let ht=it(et),mt=ne(this.ptr,ht,Ye,It.ptr);return!!se(mt)}GetAttributeByUniqueId(et,Ye){return{ptr:me(this.ptr,et.ptr,Ye)}}GetTrianglesUInt16Array(et,Ye,It){te(this.ptr,et.ptr,Ye,It)}GetTrianglesUInt32Array(et,Ye,It){de(this.ptr,et.ptr,Ye,It)}GetAttributeDataArrayForAllPoints(et,Ye,It,ht,mt){ve(this.ptr,et.ptr,Ye.ptr,It,ht,mt)}},DT_INT8:Pe(),DT_UINT8:De(),DT_INT16:$e(),DT_UINT16:Je(),DT_UINT32:ze(),DT_FLOAT32:dt()}})}(fetch(HC())),Up.then(w=>{ys=w,Up=void 0}))}()),C&&_.push(function(){if($x)return;let w=function(T){let S,k=WebAssembly.instantiateStreaming(T,{}).then(V=>{S=V.instance,S.exports.__wasm_call_ctors()}),L={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},B={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:k,supported:!0,decodeGltfBuffer(V,N,G,H,J,se){(function(ee,ne,me,te,de,ve,xe){let Ie=ee.exports.sbrk,Ae=te+3&-4,Pe=Ie(Ae*de),De=Ie(ve.length),$e=new Uint8Array(ee.exports.memory.buffer);$e.set(ve,De);let Je=ne(Pe,te,de,De,ve.length);if(Je===0&&xe&&xe(Pe,Ae,de),me.set($e.subarray(Pe,Pe+te*de)),Ie(Pe-Ie(0)),Je!==0)throw new Error(`Malformed buffer data: ${Je}`)})(S,S.exports[B[J]],V,N,G,H,S.exports[L[se]])}}}(fetch(qC()));return w.ready.then(()=>{$x=w})}()),u)for(let w=0;w<u.length;w++)_.push(SL(u[w],c,w,i));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(E&&m)for(let{primitives:w}of m)for(let T of w)CL(T,c);if(C&&m&&I)for(let w of I)DL(w,c);return c})})}function fu(l,e){let i=l.json.bufferViews[e.bufferView],c=U_[e.componentType];return new c(l.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==$p[e.type]*c.BYTES_PER_ELEMENT?i.byteStride/c.BYTES_PER_ELEMENT:$p[e.type]))}function Hx(l,e,i,c){let p=U_[e.componentType],u=function(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),m=l.json.bufferViews[e.bufferView],x=m.byteStride?m.byteStride/p.BYTES_PER_ELEMENT:$p[e.type],I=i.float32,D=I.length/i.capacity;for(let _=0,E=0;_<e.count*x;_+=x,E+=D)for(let C=0;C<D;C++)I[E+C]=c[_+C]*u;i._trim()}function AL(l,e,i){let c=l.indices,p=l.attributes,u={};u.indexArray=new si;let m=e.json.accessors[c],x=m.count/3;u.indexArray.reserve(x);let I=fu(e,m);for(let C=0;C<x;C++)u.indexArray.emplaceBack(I[3*C],I[3*C+1],I[3*C+2]);u.indexArray._trim(),u.vertexArray=new Vs;let D=e.json.accessors[p.POSITION];u.vertexArray.reserve(D.count);let _=fu(e,D);for(let C=0;C<D.count;C++)u.vertexArray.emplaceBack(_[3*C],_[3*C+1],_[3*C+2]);if(u.vertexArray._trim(),u.aabb=new An(D.min,D.max),u.centroid=function(C,w){let T=[0,0,0],S=C.length;if(S>0){for(let k=0;k<S;k++){let L=3*C[k];T[0]+=w[L],T[1]+=w[L+1],T[2]+=w[L+2]}T[0]/=S,T[1]/=S,T[2]/=S}return T}(I,_),p.COLOR_0!==void 0){let C=e.json.accessors[p.COLOR_0],w=$p[C.type],T=fu(e,C);u.colorArray=w===3?new Vs:new as,u.colorArray.resize(C.count),Hx(e,C,u.colorArray,T)}if(p.NORMAL!==void 0){u.normalArray=new Vs;let C=e.json.accessors[p.NORMAL];u.normalArray.resize(C.count);let w=fu(e,C);Hx(e,C,u.normalArray,w)}if(p.TEXCOORD_0!==void 0&&i.length>0){u.texcoordArray=new nu;let C=e.json.accessors[p.TEXCOORD_0];u.texcoordArray.resize(C.count);let w=fu(e,C);Hx(e,C,u.texcoordArray,w)}if(p._FEATURE_ID_RGBA4444!==void 0){let C=e.json.accessors[p._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=fu(e,C))}p._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(fu(e,e.json.accessors[p._FEATURE_RGBA4444]).buffer));let E=l.material;return u.material=function(C,w){let{emissiveFactor:T=[0,0,0],alphaMode:S="OPAQUE",alphaCutoff:k=.5,normalTexture:L,occlusionTexture:B,emissiveTexture:V,doubleSided:N}=C,{baseColorFactor:G=[1,1,1,1],metallicFactor:H=1,roughnessFactor:J=1,baseColorTexture:se,metallicRoughnessTexture:ee}=C.pbrMetallicRoughness||{},ne=B?w[B.index]:void 0;if(B&&B.extensions&&B.extensions.KHR_texture_transform&&ne){let me=B.extensions.KHR_texture_transform;ne.offsetScale=[me.offset[0],me.offset[1],me.scale[0],me.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new On(...G),metallicFactor:H,roughnessFactor:J,baseColorTexture:se?w[se.index]:void 0,metallicRoughnessTexture:ee?w[ee.index]:void 0},doubleSided:N,emissiveFactor:T,alphaMode:S,alphaCutoff:k,normalTexture:L?w[L.index]:void 0,occlusionTexture:ne,emissionTexture:V?w[V.index]:void 0,defined:C.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},i),u}function QC(l,e,i){let{matrix:c,rotation:p,translation:u,scale:m,mesh:x,extras:I,children:D}=l,_={};if(_.matrix=c||Ee.mat4.fromRotationTranslationScale([],p||[0,0,0,1],u||[0,0,0],m||[1,1,1]),x!==void 0){_.meshes=i[x];let E=_.anchor=[0,0];for(let C of _.meshes){let{min:w,max:T}=C.aabb;E[0]+=w[0]+T[0],E[1]+=w[1]+T[1]}E[0]=Math.floor(E[0]/_.meshes.length/2),E[1]=Math.floor(E[1]/_.meshes.length/2)}if(I&&(I.id&&(_.id=I.id),I.lights&&(_.lights=function(E){if(!E.length)return[];let C=function(L){let B=atob(L),V=new Uint8Array(B.length);for(let N=0;N<B.length;N++)V[N]=B.codePointAt(N);return V}(E),w=[],T=C.length/24,S=new Uint16Array(C.buffer),k=new Float32Array(C.buffer);for(let L=0;L<T;L++){let B=S[2*L*6]/30,V=S[2*L*6+1]/30,N=S[2*L*6+10]/100,G=k[6*L+1],H=k[6*L+2],J=k[6*L+3],se=k[6*L+4],ee=J-G,ne=se-H,me=Math.hypot(ee,ne);w.push({pos:[G+.5*ee,H+.5*ne,V],normal:[ne/me,-ee/me,0],width:me,height:B,depth:N,points:[G,H,J,se]})}return w}(I.lights))),D){let E=[];for(let C of D)E.push(QC(e.json.nodes[C],e,i));_.children=E}return _}function RL(l){if(l.vertices.length===0||l.indices.length===0)return null;let e=new K0(l.vertices,l.indices,8,256),[i,c]=[e.min.clone(),e.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:e,min:i,max:c}}function PL(l){if(!l.extras||!l.extras.ground)return null;let e=l.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;let c=[];for(let m of i){if(!Array.isArray(m)||m.length!==2)continue;let x=m[0],I=m[1];typeof x=="number"&&typeof I=="number"&&c.push(new ot(x,I))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let p=0;for(let m=0;m<c.length;m++){let x=c[m],I=c[(m+1)%c.length],D=c[(m+2)%c.length];p+=(x.x-I.x)*(D.y-I.y)-(D.x-I.x)*(x.y-I.y)}p>0&&c.reverse();let u=pp(c.flatMap(m=>[m.x,m.y]),[]);return u.length===0?null:{vertices:c,indices:u}}function OL(l,e){let i=[],c=[],p=0,u=[];for(let m of l){p=i.length;let x=m.vertexArray.float32,I=m.indexArray.uint16;for(let D=0;D<m.vertexArray.length;D++)u[0]=x[3*D+0],u[1]=x[3*D+1],u[2]=x[3*D+2],Ee.vec3.transformMat4(u,u,e),i.push(new ot(u[0],u[1]));for(let D=0;D<3*m.indexArray.length;D++)c.push(I[D]+p)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){let x=i[c[m+0]],I=i[c[m+1]],D=i[c[m+2]];(x.x-I.x)*(D.y-I.y)-(D.x-I.x)*(x.y-I.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:i,indices:c}}function eD(l){let e=function(I,D){let _=[],E=WebGL2RenderingContext;if(I.json.textures)for(let C of I.json.textures){let w={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};C.sampler!==void 0&&Object.assign(w,I.json.samplers[C.sampler]),_.push({image:D[C.source],sampler:w,uploaded:!1})}return _}(l,l.images),i=function(I,D){let _=[];for(let E of I.json.meshes){let C=[];for(let w of E.primitives)C.push(AL(w,I,D));_.push(C)}return _}(l,e),{scenes:c,scene:p,nodes:u}=l.json,m=c?c[p||0].nodes:u,x=[];for(let I of m)x.push(QC(u[I],l,i));return function(I,D,_){let E={},C=new Set;for(let w=0;w<I.length;w++){let T=_[D[w]];if(!T.extras)continue;let S=T.extras["mapbox:footprint:version"],k=T.extras["mapbox:footprint:id"];(S||k)&&C.add(w),S==="1.0.0"&&k&&(E[k]=w)}for(let w=0;w<I.length;w++){if(C.has(w))continue;let T=I[w],S=_[D[w]];if(!S.extras)continue;let k=null;T.id in E&&(k=OL(I[E[T.id]].meshes,T.matrix)),k||(k=PL(S)),k&&(T.footprint=RL(k))}if(C.size>0){let w=Array.from(C.values()).sort((T,S)=>T-S);for(let T=w.length-1;T>=0;T--)I.splice(w[T],1)}}(x,m,l.json.nodes),x}function kL(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);let e=l.vertexArray.float32,i=l.aabb.min[0]-1,c=l.aabb.min[1]-1,p=hu/(l.aabb.max[0]-i+2),u=hu/(l.aabb.max[1]-c+2);for(let m=0;m<e.length;m+=3){let x=e[m+2],I=(e[m+0]-i)*p|0,D=(e[m+1]-c)*u|0;x>l.heightmap[D*hu+I]&&(l.heightmap[D*hu+I]=x)}}function LL(l,e){let i={};i.indexArray=new si,i.indexArray.reserve(4*l.length),i.vertexArray=new Vs,i.vertexArray.reserve(10*l.length),i.colorArray=new as,i.vertexArray.reserve(10*l.length);let c=0;for(let m of l){let x=Math.min(10,Math.max(4,1.3*m.height))*e,I=[-m.normal[1],m.normal[0],0],D=Math.min(.29,.1*m.width/m.depth),_=m.width-2*m.depth*e*(D+.01),E=Ee.vec3.scaleAndAdd([],m.pos,I,_/2),C=Ee.vec3.scaleAndAdd([],m.pos,I,-_/2),w=[E[0],E[1],E[2]+m.height],T=[C[0],C[1],C[2]+m.height],S=Ee.vec3.scaleAndAdd([],m.normal,I,D);Ee.vec3.scale(S,S,x);let k=Ee.vec3.scaleAndAdd([],m.normal,I,-D);Ee.vec3.scale(k,k,x),Ee.vec3.add(S,E,S),Ee.vec3.add(k,C,k),E[2]+=.1,C[2]+=.1,i.vertexArray.emplaceBack(S[0],S[1],S[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(w[0],w[1],w[2]),i.vertexArray.emplaceBack(T[0],T[1],T[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(S[0],S[1],S[2]),i.vertexArray.emplaceBack(k[0],k[1],k[2]);let L=_/x/2;i.colorArray.emplaceBack(-L-D,-1,L,.8),i.colorArray.emplaceBack(L+D,-1,L,.8),i.colorArray.emplaceBack(-L,0,L,1.3),i.colorArray.emplaceBack(L,0,L,1.3),i.colorArray.emplaceBack(L+D,-.8,L,.7),i.colorArray.emplaceBack(L+D,-.8,L,.7),i.colorArray.emplaceBack(0,0,L,1.3),i.colorArray.emplaceBack(0,0,L,1.3),i.colorArray.emplaceBack(L+D,-1.2,L,.8),i.colorArray.emplaceBack(L+D,-1.2,L,.8),i.indexArray.emplaceBack(6+c,4+c,8+c),i.indexArray.emplaceBack(7+c,9+c,5+c),i.indexArray.emplaceBack(0+c,1+c,2+c),i.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}let p={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=On.white,p.pbrMetallicRoughness=u,i.material=p,i.aabb=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class tD{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){let c=e[i];this._stringToNumber[c]=i,this._numberToString[i]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class nD{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new wa(st,16,0),this.featureIndexArray=new Xg,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,c,p,u,m=0,x=0){let I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,u,m);let D=this.grid;for(let _=0;_<i.length;_++){let E=i[_],C=[1/0,1/0,-1/0,-1/0];for(let w=0;w<E.length;w++){let T=E[w];C[0]=Math.min(C[0],T.x),C[1]=Math.min(C[1],T.y),C[2]=Math.max(C[2],T.x),C[3]=Math.max(C[3],T.y)}x!==0&&(C[0]-=x,C[1]-=x,C[2]+=x,C[3]+=x),C[0]<st&&C[1]<st&&C[2]>=0&&C[3]>=0&&D.insert(I,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Uh.VectorTile(new y_(this.rawTileData)).layers,this.sourceLayerCoder=new tD(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,c){this.loadVTLayers(),this.serializedLayersCache.clear();let p=Th(e.filter),u=e.tileResult,m=e.transform,x=u.bufferedTilespaceBounds,I=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(C,w,T,S)=>Vn(u.bufferedTilespaceGeometry,C,w,T,S));I.sort(FL);let D=null;m.elevation&&I.length>0&&(D=Xh.create(m.elevation,this.tileID));let _={},E;for(let C=0;C<I.length;C++){let w=I[C];if(w===E)continue;E=w;let T=this.featureIndexArray.get(w),S=null;if(this.is3DTile){let k=this.bucketLayerIDs[0][0],L=i[k];if(L.type!=="model")continue;let{queryFeature:B,intersectionZ:V}=L.queryIntersectsMatchingFeature(u,T.featureIndex,p,m);B&&this.appendToResult(_,k,T.featureIndex,B,V)}else this.loadMatchingFeature(_,T,p,e.layers,e.availableImages,i,c,(k,L,B,V=0)=>(S||(S=Ce(k,this.tileID.canonical,e.tileTransform)),L.queryIntersectsFeature(u,k,B,S,this.z,e.transform,e.pixelPosMatrix,D,V)))}return _}loadMatchingFeature(e,i,c,p,u,m,x,I){let{featureIndex:D,bucketIndex:_,sourceLayerIndex:E,layoutVertexArrayOffset:C}=i,w=this.bucketLayerIDs[_];if(p.length&&!function(L,B){for(let V=0;V<L.length;V++)if(B.indexOf(L[V])>=0)return!0;return!1}(p,w))return;let T=this.sourceLayerCoder.decode(E),S=this.vtLayers[T].feature(D);if(c.needGeometry){let L=qe(S,!0);if(!c.filter(new li(this.tileID.overscaledZ),L,this.tileID.canonical))return}else if(!c.filter(new li(this.tileID.overscaledZ),S))return;let k=this.getId(S,T);for(let L=0;L<w.length;L++){let B=w[L];if(p.length&&p.indexOf(B)<0)continue;let V=m[B];if(!V)continue;let N={};k!==void 0&&x&&(N=x.getState(V.sourceLayer||"_geojsonTileLayer",k));let G=!I||I(S,V,N,C);if(!G)continue;let H=new Lp(S,this.z,this.x,this.y,k),J=this.serializedLayersCache.get(B);J||(J=V.serialize(),J.id=B,this.serializedLayersCache.set(B,J)),H.layer=ar({},J),H.tile=this.tileID.canonical,H.layer.paint=iD(J.paint,V.paint,S,N,u),H.layer.layout=iD(J.layout,V.layout,S,N,u),this.appendToResult(e,B,D,H,G)}}appendToResult(e,i,c,p,u){let m=e[i];m===void 0&&(m=e[i]=[]),m.push({featureIndex:c,feature:p,intersectionZ:u})}lookupSymbolFeatures(e,i,c,p,u,m,x){let I={};this.loadVTLayers();let D=Th(p);for(let _ of e)this.loadMatchingFeature(I,{bucketIndex:i,sourceLayerIndex:c,featureIndex:_,layoutVertexArrayOffset:0},D,u,m,x);return I}loadFeature(e){let{featureIndex:i,sourceLayerIndex:c}=e;this.loadVTLayers();let p=this.sourceLayerCoder.decode(c),u=this.vtFeatures[p];if(u[i])return u[i];let m=this.vtLayers[p].feature(i);return u[i]=m,m}hasLayer(e){for(let i of this.bucketLayerIDs)for(let c of i)if(e===c)return!0;return!1}getId(e,i){let c=e.id;if(this.promoteId){let p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];p!=null&&(c=e.properties[p]),typeof c=="boolean"&&(c=Number(c))}return c}}function iD(l,e,i,c,p){return da(l,(u,m)=>{let x=e instanceof Ml?e.get(m):null;return x&&x.evaluate?x.evaluate(i,c,p):x})}function FL(l,e){return e-l}ft(nD,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let rD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,c]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);let u=rD[15&c];if(!u)throw new Error("Unrecognized array type.");let[m]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new qx(x,m,u,e)}constructor(e,i=64,c=Float64Array,p){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let u=rD.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-x%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+I,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+I),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+I,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){let c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=i,c}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Wx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:m,nodeSize:x}=this,I=[0,u.length-1,0],D=[];for(;I.length;){let _=I.pop()||0,E=I.pop()||0,C=I.pop()||0;if(E-C<=x){for(let k=C;k<=E;k++){let L=m[2*k],B=m[2*k+1];L>=e&&L<=c&&B>=i&&B<=p&&D.push(u[k])}continue}let w=C+E>>1,T=m[2*w],S=m[2*w+1];T>=e&&T<=c&&S>=i&&S<=p&&D.push(u[w]),(_===0?e<=T:i<=S)&&(I.push(C),I.push(w-1),I.push(1-_)),(_===0?c>=T:p>=S)&&(I.push(w+1),I.push(E),I.push(1-_))}return D}within(e,i,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:p,coords:u,nodeSize:m}=this,x=[0,p.length-1,0],I=[],D=c*c;for(;x.length;){let _=x.pop()||0,E=x.pop()||0,C=x.pop()||0;if(E-C<=m){for(let k=C;k<=E;k++)sD(u[2*k],u[2*k+1],e,i)<=D&&I.push(p[k]);continue}let w=C+E>>1,T=u[2*w],S=u[2*w+1];sD(T,S,e,i)<=D&&I.push(p[w]),(_===0?e-c<=T:i-c<=S)&&(x.push(C),x.push(w-1),x.push(1-_)),(_===0?e+c>=T:i+c>=S)&&(x.push(w+1),x.push(E),x.push(1-_))}return I}}function Wx(l,e,i,c,p,u){if(p-c<=i)return;let m=c+p>>1;oD(l,e,m,c,p,u),Wx(l,e,i,c,m-1,1-u),Wx(l,e,i,m+1,p,1-u)}function oD(l,e,i,c,p,u){for(;p>c;){if(p-c>600){let D=p-c+1,_=i-c+1,E=Math.log(D),C=.5*Math.exp(2*E/3),w=.5*Math.sqrt(E*C*(D-C)/D)*(_-D/2<0?-1:1);oD(l,e,i,Math.max(c,Math.floor(i-_*C/D+w)),Math.min(p,Math.floor(i+(D-_)*C/D+w)),u)}let m=e[2*i+u],x=c,I=p;for(Gp(l,e,c,i),e[2*p+u]>m&&Gp(l,e,c,p);x<I;){for(Gp(l,e,x,I),x++,I--;e[2*x+u]<m;)x++;for(;e[2*I+u]>m;)I--}e[2*c+u]===m?Gp(l,e,c,I):(I++,Gp(l,e,I,p)),I<=i&&(c=I+1),i<=I&&(p=I-1)}}function Gp(l,e,i,c){Zx(l,i,c),Zx(e,2*i,2*c),Zx(e,2*i+1,2*c+1)}function Zx(l,e,i){let c=l[e];l[e]=l[i],l[i]=c}function sD(l,e,i,c){let p=l-i,u=e-c;return p*p+u*u}n.$=Ng,n.A=class extends N_{},n.B=ga,n.C=ol,n.D=qf,n.E=rl,n.F=Rf,n.G=xa,n.H=Af,n.I=gx,n.J=yh,n.K=Ia,n.L=ba,n.M=Tl,n.N=uh,n.O=xl,n.P=ot,n.Q=zc,n.R=qu,n.S=Er,n.T=Mx,n.U=rf,n.V=N_,n.W=Wf,n.X=Pf,n.Y=Ag,n.Z=function(l){let e=l.value,i=[];if(!e)return i;let c=ga(e);return c!=="string"?(i=i.concat([new N_(l.key,e,`string expected, "${c}" found`)]),i):(_C(e,!0)||(i=i.concat([new N_(l.key,e,`invalid url "${e}"`)])),i)},n._=Re,n.a=function(l){return ce.API_CDN_URL_REGEX.test(l)},n.a$=Bs,n.a0=Kn,n.a1=tt,n.a2=class{constructor(l){this.specification=l}possiblyEvaluate(l,e){return Sr(l.expression.evaluate(e))}interpolate(l,e,i){return{x:Rt(l.x,e.x,i),y:Rt(l.y,e.y,i),z:Rt(l.z,e.z,i),azimuthal:Rt(l.azimuthal,e.azimuthal,i),polar:Rt(l.polar,e.polar,i)}}},n.a3=li,n.a4=qc,n.a5=be,n.a6=Ee,n.a7=Ja,n.a8=Ml,n.a9=Vl,n.aA=un,n.aB=rC,n.aC=uC,n.aD=iC,n.aE=function(l,e){let i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let c=0;c<l.length;c++){let p=document.createElement("source");Yr(l[c])||(i.crossOrigin="Anonymous"),p.src=l[c],i.appendChild(p)}return{cancel:()=>{}}},n.aF=P_,n.aG=function(l){return fetch(l).then(e=>e.arrayBuffer()).then(e=>KC(e,0,l))},n.aH=eD,n.aI=class{constructor(l,e,i,c){this.id=l,this.position=e!=null?new P(e[0],e[1]):new P(0,0),this.orientation=i??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new An([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,e){if(Ee.mat4.multiply(l.matrix,e,l.matrix),l.meshes)for(let i of l.meshes){let c=An.applyTransformFast(i.aabb,l.matrix);this.aabb.encapsulate(c)}if(l.children)for(let i of l.children)this._applyTransformations(i,l.matrix)}computeBoundsAndApplyParent(){let l=Ee.mat4.identity([]);for(let e of this.nodes)this._applyTransformations(e,l)}computeModelMatrix(l,e,i,c,p,u,m=!1){wC(this.matrix,this,l.transform,this.position,e,i,c,p,u,m)}upload(l){if(!this.uploaded){for(let e of this.nodes)Ox(e,l);for(let e of this.nodes)z_(e);this.uploaded=!0}}destroy(){for(let l of this.nodes)kx(l)}},n.aJ=Ka,n.aK=function(l){return l.indexOf(Jc)>=0},n.aL=Mp,n.aM=Q,n.aN=re,n.aO=Al,n.aP=si,n.aQ=Ic,n.aR=Fh,n.aS=A_,n.aT=function(){Fr.isLoading()||Fr.isLoaded()||Gf()!=="deferred"||Fg()},n.aU=Th,n.aV=qe,n.aW=Lp,n.aX=Dc,n.aY=ax,n.aZ=J0,n.a_=Ce,n.aa=Rt,n.ab=st,n.ac=Pc,n.ad=class{constructor(l){this.specification=l}possiblyEvaluate(l,e){return function([i,c]){let p=Sr([1,i,c]);return{x:p.x,y:p.y,z:p.z}}(l.expression.evaluate(e))}interpolate(l,e,i){return{x:Rt(l.x,e.x,i),y:Rt(l.y,e.y,i),z:Rt(l.z,e.z,i)}}},n.ae=function(l,e,i=0,c=!0){let p=new ot(i,i),u=l.sub(p),m=e.add(p),x=[u,new ot(m.x,u.y),m,new ot(u.x,m.y)];return c&&x.push(u.clone()),x},n.af=function(l,e){let i=[];for(let c=0;c<l.length;c++){let p=es(c-1,-1,l.length-1),u=es(c+1,-1,l.length-1),m=l[c],x=l[u],I=l[p].sub(m).unit(),D=x.sub(m).unit(),_=D.angleWithSep(I.x,I.y),E=I.add(D).unit().mult(-1*e/Math.sin(_/2));i.push(m.add(E))}return i},n.ag=$T,n.ah=Vn,n.ai=function(l,e,i=0){return Ee.vec3.fromValues(((e.x-i)*l.scale-l.x)*st,(e.y*l.scale-l.y)*st,oe(e.z,e.y))},n.aj=Ir,n.ak=lT,n.al=function(l){let e=1/0,i=1/0,c=-1/0,p=-1/0;for(let u of l)e=Math.min(e,u.x),i=Math.min(i,u.y),c=Math.max(c,u.x),p=Math.max(p,u.y);return{min:new ot(e,i),max:new ot(c,p)}},n.am=q,n.an=cn,n.ao=_e,n.ap=jt,n.aq=er,n.ar=function(l,e){let i={};for(let c=0;c<e.length;c++){let p=e[c];p in l&&(i[p]=l[p])}return i},n.as=F,n.at=X,n.au=class{constructor(l){this.entries={},this.scheduler=l}request(l,e,i,c){let p=this.entries[l]=this.entries[l]||{callbacks:[]};if(p.result){let[u,m]=p.result;return this.scheduler?this.scheduler.add(()=>{c(u,m)},e):c(u,m),()=>{}}return p.callbacks.push(c),p.cancel||(p.cancel=i((u,m)=>{p.result=[u,m];for(let x of p.callbacks)this.scheduler?this.scheduler.add(()=>{x(u,m)},e):x(u,m);setTimeout(()=>delete this.entries[l],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(u=>u!==c),p.callbacks.length||(p.cancel(),delete this.entries[l]))}}},n.av=Mh,n.aw=function(l,e,i){let c=JSON.stringify(l.request);return l.data&&(this.deduped.entries[c]={result:[null,l.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},p=>{let u=nl(l.request,(m,x,I,D)=>{m?p(m):x&&p(null,{vectorTile:i?void 0:new Uh.VectorTile(new y_(x)),rawData:x,cacheControl:I,expires:D})});return()=>{u.cancel(),p()}},e)},n.ax=function(l){Bi++,Bi>Nt&&(l.getActor().send("enforceCacheSizeLimit",$t),Bi=0)},n.ay=Qe,n.az=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},n.b=function(l){return ce.API_FONTS_REGEX.test(l)},n.b$=Tr,n.b0=ip,n.b1=zo,n.b2=pi,n.b3=pp,n.b4=Tx,n.b5=function(l,e){let i=Vl(e.zoom);if(i===0)return Us(l);let c=r_(l),p=U0(c),u=q(c.getWest())*e.worldSize,m=q(c.getEast())*e.worldSize,x=X(c.getNorth())*e.worldSize,I=X(c.getSouth())*e.worldSize,D=[u,x,0],_=[m,x,0],E=[u,I,0],C=[m,I,0],w=Ee.mat4.invert([],e.globeMatrix);return Ee.vec3.transformMat4(D,D,w),Ee.vec3.transformMat4(_,_,w),Ee.vec3.transformMat4(E,E,w),Ee.vec3.transformMat4(C,C,w),p[0]=Ma(p[0],E,i),p[1]=Ma(p[1],C,i),p[2]=Ma(p[2],_,i),p[3]=Ma(p[3],D,i),An.fromPoints(p)},n.b6=s_,n.b7=dp,n.b8=Ma,n.b9=Sh,n.bA=On,n.bB=es,n.bC=ln,n.bD=el,n.bE=Z,n.bF=function(l,e,i){l[4*e+0]=i[0],l[4*e+1]=i[1],l[4*e+2]=i[2],l[4*e+3]=i[3]},n.bG=su,n.bH=Fo,n.bI=ap,n.bJ=ki,n.bK=Da,n.bL=P,n.bM=ZT,n.bN=gn,n.bO=Qr,n.bP=dC,n.bQ=Li,n.bR=KE,n.bS=function(l,e,i,c,p,u,m,x,I){if(I.name==="globe")return KE(l,e,new Li(i,c,p),!1);let D=Mp({z:i,x:c,y:p},I);return new An([(u+D.x/D.scale)*e,e*(D.y/D.scale),m],[(u+D.x2/D.scale)*e,e*(D.y2/D.scale),x])},n.bT=function(l,e,i){let c=0;for(let p=0;p<2;++p)l[p]>0&&(c+=(l[p]-0)*(l[p]-0)),e[p]<0&&(c+=(0-e[p])*(0-e[p]));return c},n.bU=ae,n.bV=h,n.bW=function(l){let e=Ee.mat4.identity(new Float64Array(16));Ee.mat4.multiply(e,l.pixelMatrix,l.globeMatrix);let i=[0,g,0],c=[0,v,0];return Ee.vec3.transformMat4(i,i,e),Ee.vec3.transformMat4(c,c,e),[i[0]>0&&i[0]<=l.width&&i[1]>0&&i[1]<=l.height&&!H0(l,new P(l.center.lat,90)),c[0]>0&&c[0]<=l.width&&c[1]>0&&c[1]<=l.height&&!H0(l,new P(l.center.lat,-90))]},n.bX=function(l,e){let{scale:i}=l.tileTransform,c=i*st/(l.tileSize*Math.pow(2,e.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return Ee.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[c,c])},n.bY=L_,n.bZ=hC,n.b_=function(l){let e=hC(l,!0);return Ee.mat2.invert([],[e[0],e[1],e[4],e[5]])},n.ba=ji,n.bb=Vx,n.bc=y_,n.bd=nl,n.be=function(l){let e=[];for(let i in l)e.push(l[i]);return e},n.bf=function(l,e){let i=[];for(let c in l)c in e||i.push(c);return i},n.bg=ha,n.bh=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bi=ca,n.bj=function(l,e){let{x:i,y:c}=l.point,p=tI(i,c,l.worldSize/l._pixelsPerMercatorPixel,0,0);return Ee.mat4.multiply(p,p,$0(Us(e)))},n.bk=$h,n.bl=vo,n.bm=__,n.bn=function(l,e,i,c,p){let u=5*e+2;l.float32[u+0]=i,l.float32[u+1]=c,l.float32[u+2]=p},n.bo=S_,n.bp=PT,n.bq=Ge,n.br=tr,n.bs=kI,n.bt=gC,n.bu=BI,n.bv=VI,n.bw=vx,n.bx=BT,n.by=mx,n.bz=qx,n.c=fe,n.c$=qn,n.c0=function(l){let{x:e,y:i}=l.point,{lng:c,lat:p}=l._center;return tI(e,i,l.worldSize,c,p)},n.c1=$i,n.c2=Tn,n.c3=i_,n.c4=function(l){let e=Math.round((l+45+360)%360/90)%4;return lo[e]},n.c5=45,n.c6=W,n.c7=Bh,n.c8=function(l,e,i){let c=Math.sqrt(l*l+e*e+i*i),p=c>0?Math.acos(i/c)*Qo:0,u=l!==0||e!==0?Math.atan2(-e,-l)*Qo+90:0;return u<0&&(u+=360),[c,u,p]},n.c9=ge,n.cA=function(l){let e=ae-5;l=jt(l,-e,e)/e*90;let i=Math.pow(Math.abs(Math.sin(ln(l))),3);return Math.round(i*(f.length-1))},n.cB=function(l,e,i,c){let p=e.getNorth(),u=e.getSouth(),m=e.getWest(),x=e.getEast(),I=1<<l.z,D=x-m,_=p-u,E=D/o,C=-_/f[i],w=[0,E,0,C,0,0,p,m,0];if(l.z>0){let T=180/c;Ee.mat3.multiply(w,w,[T/D+1,0,0,0,T/_+1,0,-.5*T/E,.5*T/C,1])}return w[2]=I,w[5]=l.x,w[8]=l.y,w},n.cC=Us,n.cD=function(l,e,i){let c=Ee.mat4.identity(new Float64Array(16)),p=(e/(1<<l)-.5)*Math.PI*2;return Ee.mat4.rotateY(c,i.globeMatrix,p),Float32Array.from(c)},n.cE=class{isDataAvailableAtPoint(l){let e=this._source();if(this.isUsingMockSource()||!e||l.y<0||l.y>1)return!1;let i=e.getSource().maxzoom,c=1<<i,p=Math.floor(l.x),u=Math.floor((l.x-p)*c),m=Math.floor(l.y*c),x=this.findDEMTileFor(new un(i,p,i,u,m));return!(!x||!x.dem)}getAtPointOrZero(l,e=0){return this.getAtPoint(l,e)||0}getAtPoint(l,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let c=this._source();if(!c||l.y<0||l.y>1)return e;let p=c.getSource().maxzoom,u=1<<p,m=Math.floor(l.x),x=l.x-m,I=new un(p,m,p,Math.floor(x*u),Math.floor(l.y*u)),D=this.findDEMTileFor(I);if(!D||!D.dem)return e;let _=D.dem,E=1<<D.tileID.canonical.z,C=(x*E-D.tileID.canonical.x)*_.dim,w=(l.y*E-D.tileID.canonical.y)*_.dim,T=Math.floor(C),S=Math.floor(w);return(i?this.exaggeration():1)*Rt(Rt(_.get(T,S),_.get(T,S+1),w-S),Rt(_.get(T+1,S),_.get(T+1,S+1),w-S),C-T)}getAtTileOffset(l,e,i){let c=1<<l.canonical.z;return this.getAtPointOrZero(new be(l.wrap+(l.canonical.x+e/st)/c,(l.canonical.y+i/st)/c))}getAtTileOffsetFunc(l,e,i,c){return p=>{let u=this.getAtTileOffset(l,p.x,p.y),m=c.upVector(l.canonical,p.x,p.y),x=c.upVectorScale(l.canonical,e,i).metersToTile;return Ee.vec3.scale(m,m,u*x),m}}getForTilePoints(l,e,i,c){if(this.isUsingMockSource())return!1;let p=Xh.create(this,l,c);return!!p&&(e.forEach(u=>{u[2]=this.exaggeration()*p.getElevationAt(u[0],u[1],i)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(l);if(!e||!e.dem)return null;let i=e.dem.tree,c=e.tileID,p=1<<l.canonical.z-c.canonical.z,u=l.canonical.x/p-c.canonical.x,m=l.canonical.y/p-c.canonical.y,x=0;for(let I=0;I<l.canonical.z-c.canonical.z&&!i.leaves[x];I++){u*=2,m*=2;let D=2*Math.floor(m)+Math.floor(u);x=i.childOffsets[x]+D,u%=1,m%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let l=this.visibleDemTiles;if(l.length===0)return null;let e=!1,i=Number.MAX_VALUE,c=Number.MIN_VALUE;for(let p of l){let u=this.getMinMaxForTile(p.tileID);u&&(i=Math.min(i,u.min),c=Math.max(c,u.max),e=!0)}return e?{min:i,max:c}:null}},n.cF=pI,n.cG=zl,n.cH=function(l,e){return[Math.pow(l[0],2.2)*e,Math.pow(l[1],2.2)*e,Math.pow(l[2],2.2)*e]},n.cI=eI,n.cJ=K,n.cK=Y,n.cL=256,n.cM=function(l,e){let i=[0,0,0],c=s_(Us(e.canonical));return Ee.vec3.transformMat4(i,i,c),Ee.vec3.transformMat4(i,i,l),i},n.cN=l=>({u_camera_to_center_distance:new ki(l),u_extrude_scale:new Vh(l),u_device_pixel_ratio:new ki(l),u_matrix:new su(l),u_inv_rot_matrix:new su(l),u_merc_center:new Fo(l),u_tile_id:new ap(l),u_zoom_transition:new ki(l),u_up_dir:new ap(l),u_emissive_strength:new ki(l)}),n.cO=l=>({u_matrix:new su(l),u_pixels_to_tile_units:new Vh(l),u_device_pixel_ratio:new ki(l),u_units_to_pixels:new Fo(l),u_dash_image:new Da(l),u_gradient_image:new Da(l),u_image_height:new ki(l),u_texsize:new Fo(l),u_tile_units_to_pixels:new ki(l),u_alpha_discard_threshold:new ki(l),u_trim_offset:new Fo(l),u_trim_fade_range:new Fo(l),u_trim_color:new Bh(l),u_emissive_strength:new ki(l),u_zbias_factor:new ki(l),u_tile_to_meter:new ki(l)}),n.cP=l=>({u_matrix:new su(l),u_texsize:new Fo(l),u_pixels_to_tile_units:new Vh(l),u_device_pixel_ratio:new ki(l),u_image:new Da(l),u_units_to_pixels:new Fo(l),u_tile_units_to_pixels:new ki(l),u_alpha_discard_threshold:new ki(l),u_trim_offset:new Fo(l),u_emissive_strength:new ki(l),u_zbias_factor:new ki(l),u_tile_to_meter:new ki(l)}),n.cQ=Pl,n.cR=rk,n.cS=ok,n.cT=rI,n.cU=(l,e,i,c,p,u)=>{let m=l.transform,x=m.projection.name==="globe",I;if(u.paint.get("circle-pitch-alignment")==="map")if(x){let _=eI(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;I=Float32Array.from([_,0,0,_])}else I=m.calculatePixelsToTileUnitsMatrix(i);else I=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);let D={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(m.projection),u_matrix:l.translatePosMatrix(e.projMatrix,i,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ct.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:lO,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(x){D.u_inv_rot_matrix=c,D.u_merc_center=p,D.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],D.u_zoom_transition=Vl(m.zoom);let _=p[0]*st,E=p[1]*st;D.u_up_dir=m.projection.upVector(new Li(0,0,0),_,E)}return D},n.cV=dT,n.cW=(l,e,i,c,p,u)=>{let m=l.transform,x=m.pitch<15?cT(.07,.7,jt((14-m.zoom)/5,0,1)):.07;return{u_matrix:hT(l,e,i,c),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:p,u_image:0,u_tile_units_to_pixels:uT(e,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:u,u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:x,u_tile_to_meter:ge(e.tileID.canonical,0)}},n.cX=(l,e,i,c,p,u,m)=>{let x=l.transform,I=x.calculatePixelsToTileUnitsMatrix(e),D=x.pitch<15?cT(.07,.7,jt((14-x.zoom)/5,0,1)):.07;return{u_matrix:hT(l,e,i,c),u_pixels_to_tile_units:I,u_device_pixel_ratio:u,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:fT(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:uT(e,l.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:ge(e.tileID.canonical,0)}},n.cY=Tc,n.cZ=fp,n.c_=QI,n.ca=An,n.cb=Sr,n.cc=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},n.cd=function(l){return l({pluginStatus:Qi,pluginURL:Lr}),$f.on("pluginStateChange",l),l},n.ce=Fx,n.cf=j_,n.cg=Hh,n.ch=_x,n.ci=Kd,n.cj=Lg,n.ck=Lt,n.cl=br,n.cm=Xr,n.cn=function(l){let e=l.indexOf(Jc);return e>=0?l.slice(0,e):l},n.co=function(l){let e=l.indexOf(Jc);return e>=0?l.slice(e+1):""},n.cp=function(l){let e=[],i=l.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),l.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},n.cq=function(l,e,i,c){return l.type==="custom"?new Fk(l,e):new Zk[l.type](l,e,i,c)},n.cr=Qa,n.cs=$f,n.ct=tl,n.cu=lp,n.cv=class extends cs{constructor(l){super(l),this.current=N0}set(l,e,i){if(this.fetchUniformLocation(l,e)){for(let c=0;c<9;c++)if(i[c]!==this.current[c]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},n.cw=ua,n.cx=function(l,e,i){let c=Vl(i.zoom),p=l.style.map._antialias,u=e.options.extStandardDerivativesForceOff||l.terrain&&l.terrain.exaggeration()>0;return c===0&&!p&&!u},n.cy=function(l){let e=l.pixelsPerMeter,i=e/Z(1,l.center.lat),c=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.translate(c,c,[l.point.x,l.point.y,0]),Ee.mat4.scale(c,c,[i,i,e]),Float32Array.from(c)},n.cz=r_,n.d=function(l){return ce.API_TILEJSON_REGEX.test(l)},n.d$=R,n.d0=g_,n.d1=Ul,n.d2=450,n.d3=7,n.d4=Lk,n.d5=wn,n.d6=kh,n.d7=256,n.d8=$0,n.d9=Vs,n.dA=nI,n.dB=function(l){let e=[0,0,0],i=Ee.mat4.identity(new Float64Array(16));return Ee.mat4.multiply(i,l.pixelMatrix,l.globeMatrix),Ee.vec3.transformMat4(e,e,i),new ot(e[0],e[1])},n.dC=function(l,e,i=!1){if(Qi===jf||Qi===Xc||Qi===Yc)throw new Error("setRTLTextPlugin cannot be called multiple times.");Lr=ct.resolveURL(l),Qi=jf,Eh=e,Uf(),i||Fg()},n.dD=Gf,n.dE=function(){j_().acquire(jx)},n.dF=function(){let l=jp;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(jx),jp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.dG=Vp,n.dH=function(l){let e=Fn();if(!e)return;let i=e.delete(Ut);l&&i.catch(l).then(()=>l())},n.dI=Bp,n.dJ=HC,n.dK=function(l){Ux=ct.resolveURL(l),Kh||(Kh=new Fx(j_(),new rl)),Kh.broadcast("setDracoUrl",Ux)},n.dL=qC,n.dM=function(l){Jh=ct.resolveURL(l),Kh||(Kh=new Fx(j_(),new rl)),Kh.broadcast("setMeshoptUrl",Jh)},n.dN=ft,n.dO=jl,n.dP=ms,n.dQ=tD,n.dR=nD,n.dS=oT,n.dT=da,n.dU=kT,n.dV=function(l,e,i,c,p,u,m,x,I,D,_=1,E){l.createArrays(),l.tilePixelRatio=st/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;let C=l.layers[0].layout,w=l.layers[0]._unevaluatedLayout._values,T={};if(T.scaleFactor=_,T.textSizeScaleRange=C.get("text-size-scale-range"),T.iconSizeScaleRange=C.get("icon-size-scale-range"),T.textScaleFactor=jt(T.scaleFactor,T.textSizeScaleRange[0],T.textSizeScaleRange[1]),T.iconScaleFactor=jt(T.scaleFactor,T.iconSizeScaleRange[0],T.iconSizeScaleRange[1]),l.textSizeData.kind==="composite"){let{minZoom:B,maxZoom:V}=l.textSizeData;T.compositeTextSizes=[w["text-size"].possiblyEvaluate(new li(B),x),w["text-size"].possiblyEvaluate(new li(V),x)]}if(l.iconSizeData.kind==="composite"){let{minZoom:B,maxZoom:V}=l.iconSizeData;T.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new li(B),x),w["icon-size"].possiblyEvaluate(new li(V),x)]}T.layoutTextSize=w["text-size"].possiblyEvaluate(new li(I+1),x),T.layoutIconSize=w["icon-size"].possiblyEvaluate(new li(I+1),x),T.textMaxSize=w["text-size"].possiblyEvaluate(new li(18),x);let S=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",k=C.get("text-size"),L=!1;for(let B of l.features)if(B.icon&&B.icon.nameSecondary){L=!0;break}for(let B of l.features){let V=C.get("text-font").evaluate(B,{},x).join(","),N=k.evaluate(B,{},x)*T.textScaleFactor,G=T.layoutTextSize.evaluate(B,{},x)*T.textScaleFactor,H=(T.layoutIconSize.evaluate(B,{},x),{horizontal:{},vertical:void 0}),J=B.text,se,ee=[0,0];if(J){let te=J.toString(),de=C.get("text-letter-spacing").evaluate(B,{},x)*tr,ve=C.get("text-line-height").evaluate(B,{},x)*tr,xe=Og(te)?de:0,Ie=C.get("text-anchor").evaluate(B,{},x),Ae=C.get("text-variable-anchor");if(!Ae){let ze=C.get("text-radial-offset").evaluate(B,{},x);ee=ze?BT(Ie,[ze*tr,yx]):C.get("text-offset").evaluate(B,{},x).map(dt=>dt*tr)}let Pe=S?"center":C.get("text-justify").evaluate(B,{},x),De=C.get("symbol-placement")==="point",$e=De?C.get("text-max-width").evaluate(B,{},x)*tr:1/0,Je=ze=>{l.allowVerticalPlacement&&Bf(te)&&(H.vertical=px(J,e,i,p,V,$e,ve,Ie,ze,xe,ee,vo.vertical,!0,G,N))};if(!S&&Ae){let ze=Pe==="auto"?Ae.map(it=>vx(it)):[Pe],dt=!1;for(let it=0;it<ze.length;it++){let et=ze[it];if(!H.horizontal[et])if(dt)H.horizontal[et]=H.horizontal[0];else{let Ye=px(J,e,i,p,V,$e,ve,"center",et,xe,ee,vo.horizontal,!1,G,N);Ye&&(H.horizontal[et]=Ye,dt=Ye.positionedLines.length===1)}}Je("left")}else{if(Pe==="auto"&&(Pe=vx(Ie)),De||C.get("text-writing-mode").indexOf("horizontal")>=0||!Bf(te)){let ze=px(J,e,i,p,V,$e,ve,Ie,Pe,xe,ee,vo.horizontal,!1,G,N);ze&&(H.horizontal[Pe]=ze)}Je(De?"left":Pe)}}let ne=!1;if(B.icon&&B.icon.namePrimary){let te=c[B.icon.namePrimary];te&&(se=mk(p[B.icon.namePrimary],B.icon.nameSecondary?p[B.icon.nameSecondary]:void 0,C.get("icon-offset").evaluate(B,{},x),C.get("icon-anchor").evaluate(B,{},x)),ne=te.sdf,l.sdfIcons===void 0?l.sdfIcons=te.sdf:l.sdfIcons!==te.sdf&&fn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(te.pixelRatio!==l.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0))}let me=jT(H.horizontal)||H.vertical;l.iconsInText||(l.iconsInText=!!me&&me.iconsInText),(me||se)&&wk(l,B,H,se,c,T,G,0,ee,ne,m,x,D,E,L)}u&&l.generateCollisionDebugBuffers(I,l.collisionBoxArray,T.textScaleFactor)},n.dW=Uh,n.dX=V_,n.dY=Ec,n.dZ=AI,n.d_=vT,n.da=Ca,n.db=np,n.dc=function(l,e,i,c,p){return jt((l-e)/(i-e)*(p-c)+c,c,p)},n.dd=gh,n.de=le,n.df=class{constructor(l,e,i,c){this.context=l,this.format=c,this.size=i,this.texture=l.gl.createTexture();let[p,u,m]=this.size,{gl:x}=l;x.bindTexture(x.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,p,u,m,0,Cx(this.format),Dx(this.format),e.data)}bind(l,e){let{context:i}=this,{gl:c}=i;c.bindTexture(c.TEXTURE_3D,this.texture),l!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,l),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,l),this.minFilter=l),e!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,e),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){let{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},n.dg=Rx,n.dh=[1,1,1],n.di=Xh,n.dj=Zh,n.dk=js,n.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ot(1/0,1/0),max:new ot(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,e=!1){let i=FI(new ot(0,0),new ot(st,st),l),c=[];if(e&&!nx(i,this._globalClipBounds))return c;for(let p of this._activeRegions){if(p.hiddenByOverlap||!nx(i,p))continue;let u=RO(p.min,p.max,l);c.push({min:u.min,max:u.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return c}setSources(l){this._setSources(l.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let i=[];for(let c of e.cache.getVisibleCoordinates()){let p=e.cache.getTile(c).buckets[e.layer];p&&p.updateFootprints(c.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(l){let e=l.getFootprints();if(e.length===0)return;let i=l.getOrder(),c=l.getClipMask(),p=l.getClipScope();for(let u of e){if(!u.footprint)continue;let m=FI(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:i,clipMask:c,clipScope:p})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||p_(e.min,i.min)||p_(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(c,p){let u=(m,x)=>m+x;return c.length-p.length||c.reduce(u,"").localeCompare(p.reduce(u,""))}(e.clipScope,i.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let e=0;for(;!l&&e!==this._activeRegions.length;){let i=this._activeRegions[e],c=this._prevRegions[e];l=i.priority!==c.priority||!LI(i,c)||i.order!==c.order||i.clipMask!==c.clipMask||!ca(i.clipScope,c.clipScope),++e}}if(l){++this._updateTime;for(let i of this._activeRegions)i.order!==f_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));let e=i=>{let c=this._activeRegions;if(i>=c.length)return i;let p=c[i].priority;for(;i<c.length&&c[i].priority===p;)++i;return i};if(this._sourceIds.length>1){let i=0,c=e(i);for(;i!==c;){let p=i,u=i;for(;p!==c;){let m=this._activeRegions[p];m.hiddenByOverlap=!1;for(let x=0;x<u;x++){let I=this._activeRegions[x];if(!I.hiddenByOverlap&&m.order===f_&&nx(m,I)&&(m.hiddenByOverlap=zI(m.footprint,m.tileId,I.footprint,I.tileId),m.hiddenByOverlap))break}++p}i=c,c=e(i)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=l.length-1;e>=0;e--)this._addSource(l[e]);this._computeReplacement()}},n.dm=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let l of this._poleSegments)l.destroy();for(let l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,e){let i=new Bs,c=new si,p=[],u=l+1+2,m=e[0]+1,x=e[0]+1+(1+e.length),I=(D,_,E)=>{let C=D===u-1?D-2:D===0?D:D-1;return C+=E?24575:0,[C,_]};for(let D=0;D<u;++D)i.emplaceBack(...I(D,0,!0));for(let D=0;D<m;++D)for(let _=0;_<u;++_)i.emplaceBack(...I(_,D,(_===0||_===u-1)&&!0));for(let D=0;D<e.length;++D){let _=e[D];for(let E=0;E<u;++E)i.emplaceBack(...I(E,_,!0))}for(let D=0;D<e.length;++D){let _=c.length,E=e[D]+1+2,C=new si;for(let S=0;S<E-1;S++){let k=S===E-2,L=k?u*(x-e.length+D-S):u;for(let B=0;B<u-1;B++){let V=S*u+B;S===0||k||B===0||B===u-2?(C.emplaceBack(V+1,V,V+L),C.emplaceBack(V+L,V+L+1,V+1)):(c.emplaceBack(V+1,V,V+L),c.emplaceBack(V+L,V+L+1,V+1))}}let w=pi.simpleSegment(0,_,i.length,c.length-_);for(let S=0;S<C.uint16.length;S+=3)c.emplaceBack(C.uint16[S],C.uint16[S+1],C.uint16[S+2]);let T=pi.simpleSegment(0,_,i.length,c.length-_);p.push({withoutSkirts:w,withSkirts:T})}return{vertices:i,indices:c,segments:p}}_createGrid(l){let e=this._fillGridMeshWithLods(o,f);this._gridSegments=e.segments,this._gridBuffer=l.createVertexBuffer(e.vertices,zo.members),this._gridIndexBuffer=l.createIndexBuffer(e.indices,!0)}_createPoles(l){let e=new si;for(let m=0;m<=o;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=l.createIndexBuffer(e,!0);let i=new Ca,c=new Ca,p=new Ca,u=new Ca;this._poleSegments=[];for(let m=0,x=0;m<i_;m++){let I=360/(1<<m);i.emplaceBack(0,-er,0,.5,0),c.emplaceBack(0,-er,0,.5,1),p.emplaceBack(0,-er,0,.5,.5),u.emplaceBack(0,-er,0,.5,.5);for(let D=0;D<=o;D++){let _=D/o,E=0,C=Rt(0,I,_),[w,T,S]=b(sO,aO,C,er);i.emplaceBack(w,T,S,_,E),c.emplaceBack(w,T,S,_,1-E);let k=ln(C);_=.5+.5*Math.sin(k),E=.5+.5*Math.cos(k),p.emplaceBack(w,T,S,_,E),u.emplaceBack(w,T,S,_,1-E)}this._poleSegments.push(pi.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(i,ii,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(c,ii,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(p,ii,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(u,ii,!1)}getGridBuffers(l,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},n.dn=f_,n.dp=Rs,n.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.dr=Ya,n.ds=he,n.dt=M,n.du=function([l,e,i]){let c=Math.hypot(l,e,i),p=Math.atan2(l,i),u=.5*Math.PI-Math.acos(-e/c);return new P($i(p),$i(u))},n.dv=Ax,n.dw=A,n.dx=function(l){let e=l.navigator?l.navigator.userAgent:null;return!!function(i){if(Mc==null){let c=i.navigator?i.navigator.userAgent:null;Mc=!!i.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Mc}(l)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},n.dy=function(l,e){$t=l,Nt=e},n.dz=H0,n.e=ce,n.e0=function(l){let e=0;if(new Uint32Array(l,0,1)[0]!==ZC){let i=new Uint32Array(l,0,7),[,,c,p,u,m]=i;e=i.byteLength+p+u+m+u,(c!==l.byteLength||e>=l.byteLength)&&fn("Invalid b3dm header information.")}return KC(l,e)},n.e1=function(l,e){let i=eD(l);for(let c of i){for(let p of c.meshes)kL(p);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(LL(c.lights,e)))}return i},n.e2=B_,n.e3=MC,n.e4=Fr,n.e5=function(l){ti(),xn?.then(e=>{e.keys().then(i=>{for(let c=0;c<i.length-l;c++)e.delete(i[c])})})},n.f=function(l){return l.indexOf("mapbox:")===0},n.g=function(l,e){return tl(ar(l,{method:"GET"}),e)},n.h=we,n.i=function(l){return ce.API_STYLE_REGEX.test(l)&&!fe(l)},n.j=function(l){return decodeURIComponent(atob(l).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.k=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},n.l=ar,n.m=Yi,n.n=function(l,e){return tl(ar(l,{type:"json"}),e)},n.o=Po,n.p=function(l,e){return tl(ar(l,{method:"POST"}),e)},n.q=ct,n.r=gr,n.s=function(l){try{let e=self[l];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=Rc,n.u=function(){return function l(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},n.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},n.w=fn,n.x=Os,n.y=2,n.z=OT}),d(["./shared"],function(n){function R(Ne){let Y=Ne?Ne.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function j(Ne){if(typeof Ne=="number"||typeof Ne=="boolean"||typeof Ne=="string"||Ne==null)return JSON.stringify(Ne);if(Array.isArray(Ne)){let K="[";for(let ce of Ne)K+=`${j(ce)},`;return`${K}]`}let Y="{";for(let K of Object.keys(Ne).sort())Y+=`${K}:${j(Ne[K])},`;return`${Y}}`}function $(Ne){let Y="";for(let K of n.bh)Y+=`/${j(Ne[K])}`;return Y}class ie{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,K){this._layerConfigs={},this._layers={},this.update(Y,[],K)}update(Y,K,ce){this._options=ce;for(let fe of Y)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=n.cq(fe,this.scope,null,this._options)).compileFilter(ce),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(let fe of K)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};let we=function(fe,Te){let Le={};for(let Fe=0;Fe<fe.length;Fe++){let je=Te&&Te[fe[Fe].id]||$(fe[Fe]);Te&&(Te[fe[Fe].id]=je);let Ue=Le[je];Ue||(Ue=Le[je]=[]),Ue.push(fe[Fe])}let Se=[];for(let Fe in Le)Se.push(Le[Fe]);return Se}(n.be(this._layerConfigs),this.keyCache);for(let fe of we){let Te=fe.map(Qe=>this._layers[Qe.id]),Le=Te[0];if(Le.visibility==="none")continue;let Se=Le.source||"",Fe=this.familiesBySource[Se];Fe||(Fe=this.familiesBySource[Se]={});let je=Le.sourceLayer||"_geojsonTileLayer",Ue=Fe[je];Ue||(Ue=Fe[je]=[]),Ue.push(Te)}}}let pe=1*n.dP;class Me{constructor(Y){let K={},ce=[];for(let Le in Y){let Se=Y[Le],Fe=K[Le]={};for(let je in Se.glyphs){let Ue=Se.glyphs[+je];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;let Qe=Ue.metrics.localGlyph?pe:1,ct={x:0,y:0,w:Ue.bitmap.width+2*Qe,h:Ue.bitmap.height+2*Qe};ce.push(ct),Fe[je]=ct}}let{w:we,h:fe}=n.z(ce),Te=new n.dO({width:we||1,height:fe||1});for(let Le in Y){let Se=Y[Le];for(let Fe in Se.glyphs){let je=Se.glyphs[+Fe];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;let Ue=K[Le][Fe],Qe=je.metrics.localGlyph?pe:1;n.dO.copy(je.bitmap,Te,{x:0,y:0},{x:Ue.x+Qe,y:Ue.y+Qe},je.bitmap)}}this.image=Te,this.positions=K}}n.dN(Me,"GlyphAtlas");class He{constructor(Y){this.tileID=new n.aA(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=n.aL(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor}parse(Y,K,ce,we,fe){this.status="parsing",this.data=Y,this.collisionBoxArray=new n.aR;let Te=new n.dQ(Object.keys(Y.layers).sort()),Le=new n.dR(this.tileID,this.promoteId);Le.bucketLayerIDs=[];let Se={},Fe=new n.dS(256,256),je={featureIndex:Le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Fe,availableImages:ce,brightness:this.brightness},Ue=K.familiesBySource[this.source];for(let Nt in Ue){let Sn=Y.layers[Nt];if(!Sn)continue;let xn=!1,en=!1,Fn=!1;for(let Yi of Ue[Nt])Yi[0].type==="symbol"?xn=!0:en=!0,Yi[0].is3D()&&Yi[0].type!=="model"&&(Fn=!0);if(this.extraShadowCaster&&!Fn||this.isSymbolTile===!0&&!xn||this.isSymbolTile===!1&&!en)continue;Sn.version===1&&n.w(`Vector tile source "${this.source}" layer "${Nt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ti=Te.encode(Nt),Bi=[];for(let Yi=0,Ai=0;Yi<Sn.length;Yi++){let Ji=Sn.feature(Yi),Ps=Le.getId(Ji,Nt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Nt)){let Ro=Ji.properties?Ji.properties.worldview:null;if(this.worldview&&typeof Ro=="string")if(Ro==="all")Ji.properties.$localized=!0;else{if(!Ro.split(",").includes(this.worldview))continue;Ji.properties.$localized=!0,Ji.properties.worldview=this.worldview}}Bi.push({feature:Ji,id:Ps,index:Ai,sourceLayerIndex:ti}),Ai++}for(let Yi of Ue[Nt]){let Ai=Yi[0];(!this.extraShadowCaster||Ai.is3D()&&Ai.type!=="model")&&(this.isSymbolTile!==void 0&&Ai.type==="symbol"!==this.isSymbolTile||Ai.minzoom&&this.zoom<Math.floor(Ai.minzoom)||Ai.maxzoom&&this.zoom>=Ai.maxzoom||Ai.visibility!=="none"&&(Be(Yi,this.zoom,je.brightness,ce),(Se[Ai.id]=Ai.createBucket({index:Le.bucketLayerIDs.length,layers:Yi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ti,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Bi,je,this.tileID.canonical,this.tileTransform),Le.bucketLayerIDs.push(Yi.map(Ji=>n.av(Ji.id,Ji.scope)))))}}let Qe,ct,_t,Lt;Fe.trim();let Ut={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},$t=()=>{if(Qe)return this.status="done",fe(Qe);if(this.extraShadowCaster)this.status="done",fe(null,{buckets:n.be(Se).filter(Nt=>!Nt.isEmpty()),featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:je.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ct&&_t&&Lt){let Nt=new Me(ct),Sn=new n.dU(_t,Lt,this.lut);for(let xn in Se){let en=Se[xn];en instanceof n.aS?(Be(en.layers,this.zoom,je.brightness,ce),n.dV(en,ct,Nt.positions,_t,Sn.iconPositions,this.showCollisionBoxes,ce,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.brightness)):en.hasPattern&&(en instanceof n.aY||en instanceof n.aZ||en instanceof n.d0)&&(Be(en.layers,this.zoom,je.brightness,ce),en.addFeatures(je,this.tileID.canonical,Sn.patternPositions,ce,this.tileTransform,this.brightness))}this.status="done",fe(null,{buckets:n.be(Se).filter(xn=>!xn.isEmpty()),featureIndex:Le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Nt.image,lineAtlas:Fe,imageAtlas:Sn,brightness:je.brightness})}};if(!this.extraShadowCaster){let Nt=n.dT(je.glyphDependencies,en=>Object.keys(en).map(Number));Object.keys(Nt).length?we.send("getGlyphs",{uid:this.uid,stacks:Nt,scope:this.scope},(en,Fn)=>{Qe||(Qe=en,ct=Fn,$t())},void 0,!1,Ut):ct={};let Sn=Object.keys(je.iconDependencies);Sn.length?we.send("getImages",{icons:Sn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(en,Fn)=>{Qe||(Qe=en,_t=Fn,$t())},void 0,!1,Ut):_t={};let xn=Object.keys(je.patternDependencies);xn.length?we.send("getImages",{icons:xn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(en,Fn)=>{Qe||(Qe=en,Lt=Fn,$t())},void 0,!1,Ut):Lt={}}$t()}}function Be(Ne,Y,K,ce){let we=new n.a3(Y,{brightness:K});for(let fe of Ne)fe.recalculate(we,ce)}class lt extends n.E{constructor(Y,K,ce,we,fe,Te){super(),this.actor=Y,this.layerIndex=K,this.availableImages=ce,this.loadVectorData=fe||n.aw,this.loading={},this.loaded={},this.deduped=new n.au(Y.scheduler),this.isSpriteLoaded=we,this.scheduler=Y.scheduler,this.brightness=Te}loadTile(Y,K){let ce=Y.uid,we=Y&&Y.request,fe=we&&we.collectResourceTiming,Te=this.loading[ce]=new He(Y);Te.abort=this.loadVectorData(Y,(Le,Se)=>{let Fe=!this.loading[ce];if(delete this.loading[ce],Fe||Le||!Se)return Te.status="done",Fe||(this.loaded[ce]=Te),K(Le);let je=Se.rawData,Ue={};Se.expires&&(Ue.expires=Se.expires),Se.cacheControl&&(Ue.cacheControl=Se.cacheControl),Te.vectorTile=Se.vectorTile||new n.dW.VectorTile(new n.bc(je));let Qe=()=>{Te.parse(Te.vectorTile,this.layerIndex,this.availableImages,this.actor,(ct,_t)=>{if(ct||!_t)return K(ct);let Lt={};if(fe){let Ut=R(we);Ut.length>0&&(Lt.resourceTiming=JSON.parse(JSON.stringify(Ut)))}K(null,n.l({rawTileData:je.slice(0)},_t,Ue,Lt))})};this.isSpriteLoaded?Qe():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Qe,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):Qe()}),this.loaded=this.loaded||{},this.loaded[ce]=Te})}reloadTile(Y,K){let ce=this.loaded,we=Y.uid;if(ce&&ce[we]){let fe=ce[we];fe.scaleFactor=Y.scaleFactor,fe.showCollisionBoxes=Y.showCollisionBoxes,fe.projection=Y.projection,fe.brightness=Y.brightness,fe.tileTransform=n.aL(Y.tileID.canonical,Y.projection),fe.extraShadowCaster=Y.extraShadowCaster,fe.lut=Y.lut;let Te=(Le,Se)=>{let Fe=fe.reloadCallback;Fe&&(delete fe.reloadCallback,fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,Fe)),K(Le,Se)};fe.status==="parsing"?fe.reloadCallback=Te:fe.status==="done"&&(fe.vectorTile?fe.parse(fe.vectorTile,this.layerIndex,this.availableImages,this.actor,Te):Te())}else K(null,void 0)}abortTile(Y,K){let ce=Y.uid,we=this.loading[ce];we&&(we.abort&&we.abort(),delete this.loading[ce]),K()}removeTile(Y,K){let ce=this.loaded,we=Y.uid;ce&&ce[we]&&delete ce[we],K()}}class rt{loadTile(Y,K){let{uid:ce,encoding:we,rawImageData:fe,padding:Te}=Y,Le=ImageBitmap&&fe instanceof ImageBitmap?this.getImageData(fe,Te):fe;K(null,new n.dX(ce,Le,we,Te<1))}getImageData(Y,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);let ce=this.offscreenCanvasContext.getImageData(-K,-K,Y.width+2*K,Y.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}n.bb.setPbf(n.bc);class At{decodeRasterArray({task:Y,buffer:K},ce){n.bb.performDecoding(K,Y).then(we=>{ce(null,we)},we=>{ce(we)})}}let Kt=n.dW.VectorTileFeature.prototype.toGeoJSON;class St{constructor(Y){this._feature=Y,this.extent=n.ab,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){let Y=[];for(let K of this._feature.geometry)Y.push([new n.P(K[0],K[1])]);return Y}{let Y=[];for(let K of this._feature.geometry){let ce=[];for(let we of K)ce.push(new n.P(we[0],we[1]));Y.push(ce)}return Y}}toGeoJSON(Y,K,ce){return Kt.call(this,Y,K,ce)}}class _n{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.ab,this.length=Y.length,this._features=Y}feature(Y){return new St(this._features[Y])}}let hi=64/4096,Dt=128;class ai{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],K){for(let ce of Y){let we=ce.id;if(we==null)continue;let fe=this.features.get(we);fe&&this.updateCache(fe,K),ce.geometry?(fe=kt(ce),this.updateCache(fe,K),this.features.set(we,fe)):this.features.delete(we),this.updateCache(fe,K)}}updateCache(Y,K){for(let{canonical:ce,uid:we}of Object.values(K)){let{z:fe,x:Te,y:Le}=ce;Zi(Y,Math.pow(2,fe),Te,Le)&&delete K[we]}}getTile(Y,K,ce){let we=Math.pow(2,Y),fe=[];for(let Te of this.features.values())Zi(Te,we,K,ce)&&fe.push(Uu(Te,we,K,ce));return{features:fe}}getFeatures(){return[...this.features.values()]}}function Zi({minX:Ne,minY:Y,maxX:K,maxY:ce},we,fe,Te){return Ne<(fe+1+hi)/we&&Y<(Te+1+hi)/we&&K>(fe-hi)/we&&ce>(Te-hi)/we}function kt(Ne){let{id:Y,geometry:K,properties:ce}=Ne;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");let{type:we,coordinates:fe}=K,Te={id:Y,type:1,geometry:[],tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Le=Te.geometry;if(we==="Point")Bt(fe,Le,Te);else if(we==="MultiPoint")for(let Se of fe)Bt(Se,Le,Te);else if(we==="LineString")Te.type=2,sa(fe,Le,Te);else if(we==="MultiLineString")Te.type=2,Ss(fe,Le,Te);else if(we==="Polygon")Te.type=3,Ss(fe,Le,Te,!0);else{if(we!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Te.type=3;for(let Se of fe)Ss(Se,Le,Te,!0)}return Te}function Bt([Ne,Y],K,ce){let we=n.am(Ne),fe=n.at(Y);fe=fe<0?0:fe>1?1:fe,K.push(we,fe),ce.minX=Math.min(ce.minX,we),ce.minY=Math.min(ce.minY,fe),ce.maxX=Math.max(ce.maxX,we),ce.maxY=Math.max(ce.maxY,fe)}function sa(Ne,Y,K,ce=!1,we=!1){let fe=[];for(let Te of Ne)Bt(Te,fe,K);Y.push(fe),ce&&function(Te,Le){let Se=0;for(let Fe=0,je=Te.length,Ue=je-2;Fe<je;Ue=Fe,Fe+=2)Se+=(Te[Fe]-Te[Ue])*(Te[Fe+1]+Te[Ue+1]);if(Se>0===Le)for(let Fe=0,je=Te.length;Fe<je/2;Fe+=2){let Ue=Te[Fe],Qe=Te[Fe+1];Te[Fe]=Te[je-2-Fe],Te[Fe+1]=Te[je-1-Fe],Te[je-2-Fe]=Ue,Te[je-1-Fe]=Qe}}(fe,we)}function Ss(Ne,Y,K,ce=!1){for(let we=0;we<Ne.length;we++)sa(Ne[we],Y,K,ce,we===0)}function Uu(Ne,Y,K,ce){let{id:we,type:fe,geometry:Te,tags:Le}=Ne,Se=[];if(fe===1)(function(Fe,je,Ue,Qe,ct){for(let _t=0;_t<Fe.length;_t+=2){let Lt=Math.round(n.ab*(Fe[_t+0]*je-Ue)),Ut=Math.round(n.ab*(Fe[_t+1]*je-Qe));ct.push([Lt,Ut])}})(Te,Y,K,ce,Se);else for(let Fe of Te)Qt(Fe,Y,K,ce,Se);return{id:we,type:fe,geometry:Se,tags:Le}}function Qt(Ne,Y,K,ce,we){let fe=-Dt,Te=n.ab+Dt,Le;for(let Se=0;Se<Ne.length-2;Se+=2){let Fe=Math.round(n.ab*(Ne[Se+0]*Y-K)),je=Math.round(n.ab*(Ne[Se+1]*Y-ce)),Ue=Math.round(n.ab*(Ne[Se+2]*Y-K)),Qe=Math.round(n.ab*(Ne[Se+3]*Y-ce)),ct=Ue-Fe,_t=Qe-je;Fe<fe&&Ue<fe||(Fe<fe?(je+=Math.round(_t*((fe-Fe)/ct)),Fe=fe):Ue<fe&&(Qe=je+Math.round(_t*((fe-Fe)/ct)),Ue=fe),je<fe&&Qe<fe||(je<fe?(Fe+=Math.round(ct*((fe-je)/_t)),je=fe):Qe<fe&&(Ue=Fe+Math.round(ct*((fe-je)/_t)),Qe=fe),Fe>=Te&&Ue>=Te||(Fe>=Te?(je+=Math.round(_t*((Te-Fe)/ct)),Fe=Te):Ue>=Te&&(Qe=je+Math.round(_t*((Te-Fe)/ct)),Ue=Te),je>=Te&&Qe>=Te||(je>=Te?(Fe+=Math.round(ct*((Te-je)/_t)),je=Te):Qe>=Te&&(Ue=Fe+Math.round(ct*((Te-je)/_t)),Qe=Te),Le&&Fe===Le[Le.length-1][0]&&je===Le[Le.length-1][1]||(Le=[[Fe,je]],we.push(Le)),Le.push([Ue,Qe])))))}}var hr,Jo,Wa,Yt={exports:{}},aa=function(){if(Wa)return Yt.exports;Wa=1;var Ne=n.d_(),Y=function(){if(Jo)return hr;Jo=1;var je=n.dY(),Ue=n.dZ().VectorTileFeature;function Qe(_t,Lt){this.options=Lt||{},this.features=_t,this.length=_t.length}function ct(_t,Lt){this.id=typeof _t.id=="number"?_t.id:void 0,this.type=_t.type,this.rawGeometry=_t.type===1?[_t.geometry]:_t.geometry,this.properties=_t.tags,this.extent=Lt||4096}return hr=Qe,Qe.prototype.feature=function(_t){return new ct(this.features[_t],this.options.extent)},ct.prototype.loadGeometry=function(){var _t=this.rawGeometry;this.geometry=[];for(var Lt=0;Lt<_t.length;Lt++){for(var Ut=_t[Lt],$t=[],Nt=0;Nt<Ut.length;Nt++)$t.push(new je(Ut[Nt][0],Ut[Nt][1]));this.geometry.push($t)}return this.geometry},ct.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _t=this.geometry,Lt=1/0,Ut=-1/0,$t=1/0,Nt=-1/0,Sn=0;Sn<_t.length;Sn++)for(var xn=_t[Sn],en=0;en<xn.length;en++){var Fn=xn[en];Lt=Math.min(Lt,Fn.x),Ut=Math.max(Ut,Fn.x),$t=Math.min($t,Fn.y),Nt=Math.max(Nt,Fn.y)}return[Lt,$t,Ut,Nt]},ct.prototype.toGeoJSON=Ue.prototype.toGeoJSON,hr}();function K(je){var Ue=new Ne;return function(Qe,ct){for(var _t in Qe.layers)ct.writeMessage(3,ce,Qe.layers[_t])}(je,Ue),Ue.finish()}function ce(je,Ue){var Qe;Ue.writeVarintField(15,je.version||1),Ue.writeStringField(1,je.name||""),Ue.writeVarintField(5,je.extent||4096);var ct={keys:[],values:[],keycache:{},valuecache:{}};for(Qe=0;Qe<je.length;Qe++)ct.feature=je.feature(Qe),Ue.writeMessage(2,we,ct);var _t=ct.keys;for(Qe=0;Qe<_t.length;Qe++)Ue.writeStringField(3,_t[Qe]);var Lt=ct.values;for(Qe=0;Qe<Lt.length;Qe++)Ue.writeMessage(4,Fe,Lt[Qe])}function we(je,Ue){var Qe=je.feature;Qe.id!==void 0&&Ue.writeVarintField(1,Qe.id),Ue.writeMessage(2,fe,je),Ue.writeVarintField(3,Qe.type),Ue.writeMessage(4,Se,Qe)}function fe(je,Ue){var Qe=je.feature,ct=je.keys,_t=je.values,Lt=je.keycache,Ut=je.valuecache;for(var $t in Qe.properties){var Nt=Qe.properties[$t],Sn=Lt[$t];if(Nt!==null){Sn===void 0&&(ct.push($t),Lt[$t]=Sn=ct.length-1),Ue.writeVarint(Sn);var xn=typeof Nt;xn!=="string"&&xn!=="boolean"&&xn!=="number"&&(Nt=JSON.stringify(Nt));var en=xn+":"+Nt,Fn=Ut[en];Fn===void 0&&(_t.push(Nt),Ut[en]=Fn=_t.length-1),Ue.writeVarint(Fn)}}}function Te(je,Ue){return(Ue<<3)+(7&je)}function Le(je){return je<<1^je>>31}function Se(je,Ue){for(var Qe=je.loadGeometry(),ct=je.type,_t=0,Lt=0,Ut=Qe.length,$t=0;$t<Ut;$t++){var Nt=Qe[$t],Sn=1;ct===1&&(Sn=Nt.length),Ue.writeVarint(Te(1,Sn));for(var xn=ct===3?Nt.length-1:Nt.length,en=0;en<xn;en++){en===1&&ct!==1&&Ue.writeVarint(Te(2,xn-1));var Fn=Nt[en].x-_t,ti=Nt[en].y-Lt;Ue.writeVarint(Le(Fn)),Ue.writeVarint(Le(ti)),_t+=Fn,Lt+=ti}ct===3&&Ue.writeVarint(Te(7,1))}}function Fe(je,Ue){var Qe=typeof je;Qe==="string"?Ue.writeStringField(1,je):Qe==="boolean"?Ue.writeBooleanField(7,je):Qe==="number"&&(je%1!=0?Ue.writeDoubleField(3,je):je<0?Ue.writeSVarintField(6,je):Ue.writeVarintField(5,je))}return Yt.exports=K,Yt.exports.fromVectorTileJs=K,Yt.exports.fromGeojsonVt=function(je,Ue){Ue=Ue||{};var Qe={};for(var ct in je)Qe[ct]=new Y(je[ct].features,Ue),Qe[ct].name=ct,Qe[ct].version=Ue.version,Qe[ct].extent=Ue.extent;return K({layers:Qe})},Yt.exports.GeoJSONWrapper=Y,Yt.exports}(),xc=n.d$(aa);let Za={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ne=>Ne},Wt=Math.fround||(bc=new Float32Array(1),Ne=>(bc[0]=+Ne,bc[0]));var bc;let ao=3,Zr=5,Xa=6;class wc{constructor(Y){this.options=Object.assign(Object.create(Za),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){let{log:K,minZoom:ce,maxZoom:we}=this.options;K&&console.time("total time");let fe=`prepare ${Y.length} points`;K&&console.time(fe),this.points=Y;let Te=[];for(let Se=0;Se<Y.length;Se++){let Fe=Y[Se];if(!Fe.geometry)continue;let[je,Ue]=Fe.geometry.coordinates,Qe=Wt(Ko(je)),ct=Wt(As(Ue));Te.push(Qe,ct,1/0,Se,-1,1),this.options.reduce&&Te.push(0)}let Le=this.trees[we+1]=this._createTree(Te);K&&console.timeEnd(fe);for(let Se=we;Se>=ce;Se--){let Fe=+Date.now();Le=this.trees[Se]=this._createTree(this._cluster(Le,Se)),K&&console.log("z%d: %d clusters in %dms",Se,Le.numItems,+Date.now()-Fe)}return K&&console.timeEnd("total time"),this}getClusters(Y,K){let ce=((Y[0]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,Y[1])),fe=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,Te=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ce=-180,fe=180;else if(ce>fe){let Ue=this.getClusters([ce,we,180,Te],K),Qe=this.getClusters([-180,we,fe,Te],K);return Ue.concat(Qe)}let Le=this.trees[this._limitZoom(K)],Se=Le.range(Ko(ce),As(Te),Ko(fe),As(we)),Fe=Le.data,je=[];for(let Ue of Se){let Qe=this.stride*Ue;je.push(Fe[Qe+Zr]>1?la(Fe,Qe,this.clusterProps):this.points[Fe[Qe+ao]])}return je}getChildren(Y){let K=this._getOriginId(Y),ce=this._getOriginZoom(Y),we="No cluster with the specified id.",fe=this.trees[ce];if(!fe)throw new Error(we);let Te=fe.data;if(K*this.stride>=Te.length)throw new Error(we);let Le=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Se=fe.within(Te[K*this.stride],Te[K*this.stride+1],Le),Fe=[];for(let je of Se){let Ue=je*this.stride;Te[Ue+4]===Y&&Fe.push(Te[Ue+Zr]>1?la(Te,Ue,this.clusterProps):this.points[Te[Ue+ao]])}if(Fe.length===0)throw new Error(we);return Fe}getLeaves(Y,K,ce){let we=[];return this._appendLeaves(we,Y,K=K||10,ce=ce||0,0),we}getTile(Y,K,ce){let we=this.trees[this._limitZoom(Y)],fe=Math.pow(2,Y),{extent:Te,radius:Le}=this.options,Se=Le/Te,Fe=(ce-Se)/fe,je=(ce+1+Se)/fe,Ue={features:[]};return this._addTileFeatures(we.range((K-Se)/fe,Fe,(K+1+Se)/fe,je),we.data,K,ce,fe,Ue),K===0&&this._addTileFeatures(we.range(1-Se/fe,Fe,1,je),we.data,fe,ce,fe,Ue),K===fe-1&&this._addTileFeatures(we.range(0,Fe,Se/fe,je),we.data,-1,ce,fe,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(Y){let K=this._getOriginZoom(Y)-1;for(;K<=this.options.maxZoom;){let ce=this.getChildren(Y);if(K++,ce.length!==1)break;Y=ce[0].properties.cluster_id}return K}_appendLeaves(Y,K,ce,we,fe){let Te=this.getChildren(K);for(let Le of Te){let Se=Le.properties;if(Se&&Se.cluster?fe+Se.point_count<=we?fe+=Se.point_count:fe=this._appendLeaves(Y,Se.cluster_id,ce,we,fe):fe<we?fe++:Y.push(Le),Y.length===ce)break}return fe}_createTree(Y){let K=new n.bz(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<Y.length;ce+=this.stride)K.add(Y[ce],Y[ce+1]);return K.finish(),K.data=Y,K}_addTileFeatures(Y,K,ce,we,fe,Te){for(let Le of Y){let Se=Le*this.stride,Fe=K[Se+Zr]>1,je,Ue,Qe;if(Fe)je=Ee(K,Se,this.clusterProps),Ue=K[Se],Qe=K[Se+1];else{let Lt=this.points[K[Se+ao]];je=Lt.properties;let[Ut,$t]=Lt.geometry.coordinates;Ue=Ko(Ut),Qe=As($t)}let ct={type:1,geometry:[[Math.round(this.options.extent*(Ue*fe-ce)),Math.round(this.options.extent*(Qe*fe-we))]],tags:je},_t;_t=Fe||this.options.generateId?K[Se+ao]:this.points[K[Se+ao]].id,_t!==void 0&&(ct.id=_t),Te.features.push(ct)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,K){let{radius:ce,extent:we,reduce:fe,minPoints:Te}=this.options,Le=ce/(we*Math.pow(2,K)),Se=Y.data,Fe=[],je=this.stride;for(let Ue=0;Ue<Se.length;Ue+=je){if(Se[Ue+2]<=K)continue;Se[Ue+2]=K;let Qe=Se[Ue],ct=Se[Ue+1],_t=Y.within(Se[Ue],Se[Ue+1],Le),Lt=Se[Ue+Zr],Ut=Lt;for(let $t of _t){let Nt=$t*je;Se[Nt+2]>K&&(Ut+=Se[Nt+Zr])}if(Ut>Lt&&Ut>=Te){let $t,Nt=Qe*Lt,Sn=ct*Lt,xn=-1,en=(Ue/je<<5)+(K+1)+this.points.length;for(let Fn of _t){let ti=Fn*je;if(Se[ti+2]<=K)continue;Se[ti+2]=K;let Bi=Se[ti+Zr];Nt+=Se[ti]*Bi,Sn+=Se[ti+1]*Bi,Se[ti+4]=en,fe&&($t||($t=this._map(Se,Ue,!0),xn=this.clusterProps.length,this.clusterProps.push($t)),fe($t,this._map(Se,ti)))}Se[Ue+4]=en,Fe.push(Nt/Ut,Sn/Ut,1/0,en,-1,Ut),fe&&Fe.push(xn)}else{for(let $t=0;$t<je;$t++)Fe.push(Se[Ue+$t]);if(Ut>1)for(let $t of _t){let Nt=$t*je;if(!(Se[Nt+2]<=K)){Se[Nt+2]=K;for(let Sn=0;Sn<je;Sn++)Fe.push(Se[Nt+Sn])}}}}return Fe}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,K,ce){if(Y[K+Zr]>1){let Te=this.clusterProps[Y[K+Xa]];return ce?Object.assign({},Te):Te}let we=this.points[Y[K+ao]].properties,fe=this.options.map(we);return ce&&fe===we?Object.assign({},fe):fe}}function la(Ne,Y,K){return{type:"Feature",id:Ne[Y+ao],properties:Ee(Ne,Y,K),geometry:{type:"Point",coordinates:[(ce=Ne[Y],360*(ce-.5)),Ec(Ne[Y+1])]}};var ce}function Ee(Ne,Y,K){let ce=Ne[Y+Zr],we=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,fe=Ne[Y+Xa],Te=fe===-1?{}:Object.assign({},K[fe]);return Object.assign(Te,{cluster:!0,cluster_id:Ne[Y+ao],point_count:ce,point_count_abbreviated:we})}function Ko(Ne){return Ne/360+.5}function As(Ne){let Y=Math.sin(Ne*Math.PI/180),K=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return K<0?0:K>1?1:K}function Ec(Ne){let Y=(180-360*Ne)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function ot(Ne,Y,K,ce){let we=ce,fe=Y+(K-Y>>1),Te,Le=K-Y,Se=Ne[Y],Fe=Ne[Y+1],je=Ne[K],Ue=Ne[K+1];for(let Qe=Y+3;Qe<K;Qe+=3){let ct=ca(Ne[Qe],Ne[Qe+1],Se,Fe,je,Ue);if(ct>we)Te=Qe,we=ct;else if(ct===we){let _t=Math.abs(Qe-fe);_t<Le&&(Te=Qe,Le=_t)}}we>ce&&(Te-Y>3&&ot(Ne,Y,Te,ce),Ne[Te+2]=we,K-Te>3&&ot(Ne,Te,K,ce))}function ca(Ne,Y,K,ce,we,fe){let Te=we-K,Le=fe-ce;if(Te!==0||Le!==0){let Se=((Ne-K)*Te+(Y-ce)*Le)/(Te*Te+Le*Le);Se>1?(K=we,ce=fe):Se>0&&(K+=Te*Se,ce+=Le*Se)}return Te=Ne-K,Le=Y-ce,Te*Te+Le*Le}function Xi(Ne,Y,K,ce){let we={id:Ne??null,type:Y,geometry:K,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")Qo(we,K);else if(Y==="Polygon")Qo(we,K[0]);else if(Y==="MultiLineString")for(let fe of K)Qo(we,fe);else if(Y==="MultiPolygon")for(let fe of K)Qo(we,fe[0]);return we}function Qo(Ne,Y){for(let K=0;K<Y.length;K+=3)Ne.minX=Math.min(Ne.minX,Y[K]),Ne.minY=Math.min(Ne.minY,Y[K+1]),Ne.maxX=Math.max(Ne.maxX,Y[K]),Ne.maxY=Math.max(Ne.maxY,Y[K+1])}function ln(Ne,Y,K,ce){if(!Y.geometry)return;let we=Y.geometry.coordinates;if(we&&we.length===0)return;let fe=Y.geometry.type,Te=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),Le=[],Se=Y.id;if(K.promoteId?Se=Y.properties[K.promoteId]:K.generateId&&(Se=ce||0),fe==="Point")$i(we,Le);else if(fe==="MultiPoint")for(let Fe of we)$i(Fe,Le);else if(fe==="LineString")lo(we,Le,Te,!1);else if(fe==="MultiLineString"){if(K.lineMetrics){for(let Fe of we)Le=[],lo(Fe,Le,Te,!1),Ne.push(Xi(Se,"LineString",Le,Y.properties));return}ua(we,Le,Te,!1)}else if(fe==="Polygon")ua(we,Le,Te,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(let Fe of Y.geometry.geometries)ln(Ne,{id:Se,geometry:Fe,properties:Y.properties},K,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Fe of we){let je=[];ua(Fe,je,Te,!0),Le.push(je)}}Ne.push(Xi(Se,fe,Le,Y.properties))}function $i(Ne,Y){Y.push(Rs(Ne[0]),Ya(Ne[1]),0)}function lo(Ne,Y,K,ce){let we,fe,Te=0;for(let Se=0;Se<Ne.length;Se++){let Fe=Rs(Ne[Se][0]),je=Ya(Ne[Se][1]);Y.push(Fe,je,0),Se>0&&(Te+=ce?(we*je-Fe*fe)/2:Math.sqrt(Math.pow(Fe-we,2)+Math.pow(je-fe,2))),we=Fe,fe=je}let Le=Y.length-3;Y[2]=1,ot(Y,0,Le,K),Y[Le+2]=1,Y.size=Math.abs(Te),Y.start=0,Y.end=Y.size}function ua(Ne,Y,K,ce){for(let we=0;we<Ne.length;we++){let fe=[];lo(Ne[we],fe,K,ce),Y.push(fe)}}function Rs(Ne){return Ne/360+.5}function Ya(Ne){let Y=Math.sin(Ne*Math.PI/180),K=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return K<0?0:K>1?1:K}function jt(Ne,Y,K,ce,we,fe,Te,Le){if(ce/=Y,fe>=(K/=Y)&&Te<ce)return Ne;if(Te<K||fe>=ce)return null;let Se=[];for(let Fe of Ne){let je=Fe.geometry,Ue=Fe.type,Qe=we===0?Fe.minX:Fe.minY,ct=we===0?Fe.maxX:Fe.maxY;if(Qe>=K&&ct<ce){Se.push(Fe);continue}if(ct<K||Qe>=ce)continue;let _t=[];if(Ue==="Point"||Ue==="MultiPoint")Ja(je,_t,K,ce,we);else if(Ue==="LineString")es(je,_t,K,ce,we,!1,Le.lineMetrics);else if(Ue==="MultiLineString")ar(je,_t,K,ce,we,!1);else if(Ue==="Polygon")ar(je,_t,K,ce,we,!0);else if(Ue==="MultiPolygon")for(let Lt of je){let Ut=[];ar(Lt,Ut,K,ce,we,!0),Ut.length&&_t.push(Ut)}if(_t.length){if(Le.lineMetrics&&Ue==="LineString"){for(let Lt of _t)Se.push(Xi(Fe.id,Ue,Lt,Fe.tags));continue}Ue!=="LineString"&&Ue!=="MultiLineString"||(_t.length===1?(Ue="LineString",_t=_t[0]):Ue="MultiLineString"),Ue!=="Point"&&Ue!=="MultiPoint"||(Ue=_t.length===3?"Point":"MultiPoint"),Se.push(Xi(Fe.id,Ue,_t,Fe.tags))}}return Se.length?Se:null}function Ja(Ne,Y,K,ce,we){for(let fe=0;fe<Ne.length;fe+=3){let Te=Ne[fe+we];Te>=K&&Te<=ce&&Mr(Y,Ne[fe],Ne[fe+1],Ne[fe+2])}}function es(Ne,Y,K,ce,we,fe,Te){let Le=ha(Ne),Se=we===0?Ic:Tc,Fe,je,Ue=Ne.start;for(let Ut=0;Ut<Ne.length-3;Ut+=3){let $t=Ne[Ut],Nt=Ne[Ut+1],Sn=Ne[Ut+2],xn=Ne[Ut+3],en=Ne[Ut+4],Fn=we===0?$t:Nt,ti=we===0?xn:en,Bi=!1;Te&&(Fe=Math.sqrt(Math.pow($t-xn,2)+Math.pow(Nt-en,2))),Fn<K?ti>K&&(je=Se(Le,$t,Nt,xn,en,K),Te&&(Le.start=Ue+Fe*je)):Fn>ce?ti<ce&&(je=Se(Le,$t,Nt,xn,en,ce),Te&&(Le.start=Ue+Fe*je)):Mr(Le,$t,Nt,Sn),ti<K&&Fn>=K&&(je=Se(Le,$t,Nt,xn,en,K),Bi=!0),ti>ce&&Fn<=ce&&(je=Se(Le,$t,Nt,xn,en,ce),Bi=!0),!fe&&Bi&&(Te&&(Le.end=Ue+Fe*je),Y.push(Le),Le=ha(Ne)),Te&&(Ue+=Fe)}let Qe=Ne.length-3,ct=Ne[Qe],_t=Ne[Qe+1],Lt=we===0?ct:_t;Lt>=K&&Lt<=ce&&Mr(Le,ct,_t,Ne[Qe+2]),Qe=Le.length-3,fe&&Qe>=3&&(Le[Qe]!==Le[0]||Le[Qe+1]!==Le[1])&&Mr(Le,Le[0],Le[1],Le[2]),Le.length&&Y.push(Le)}function ha(Ne){let Y=[];return Y.size=Ne.size,Y.start=Ne.start,Y.end=Ne.end,Y}function ar(Ne,Y,K,ce,we,fe){for(let Te of Ne)es(Te,Y,K,ce,we,fe,!1)}function Mr(Ne,Y,K,ce){Ne.push(Y,K,ce)}function Ic(Ne,Y,K,ce,we,fe){let Te=(fe-Y)/(ce-Y);return Mr(Ne,fe,K+(we-K)*Te,1),Te}function Tc(Ne,Y,K,ce,we,fe){let Te=(fe-K)/(we-K);return Mr(Ne,Y+(ce-Y)*Te,fe,1),Te}function Ka(Ne,Y){let K=[];for(let ce=0;ce<Ne.length;ce++){let we=Ne[ce],fe=we.type,Te;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")Te=ts(we.geometry,Y);else if(fe==="MultiLineString"||fe==="Polygon"){Te=[];for(let Le of we.geometry)Te.push(ts(Le,Y))}else if(fe==="MultiPolygon"){Te=[];for(let Le of we.geometry){let Se=[];for(let Fe of Le)Se.push(ts(Fe,Y));Te.push(Se)}}K.push(Xi(we.id,fe,Te,we.tags))}return K}function ts(Ne,Y){let K=[];K.size=Ne.size,Ne.start!==void 0&&(K.start=Ne.start,K.end=Ne.end);for(let ce=0;ce<Ne.length;ce+=3)K.push(Ne[ce]+Y,Ne[ce+1],Ne[ce+2]);return K}function da(Ne,Y){if(Ne.transformed)return Ne;let K=1<<Ne.z,ce=Ne.x,we=Ne.y;for(let fe of Ne.features){let Te=fe.geometry,Le=fe.type;if(fe.geometry=[],Le===1)for(let Se=0;Se<Te.length;Se+=2)fe.geometry.push(Qa(Te[Se],Te[Se+1],Y,K,ce,we));else for(let Se=0;Se<Te.length;Se++){let Fe=[];for(let je=0;je<Te[Se].length;je+=2)Fe.push(Qa(Te[Se][je],Te[Se][je+1],Y,K,ce,we));fe.geometry.push(Fe)}}return Ne.transformed=!0,Ne}function Qa(Ne,Y,K,ce,we,fe){return[Math.round(K*(Ne*ce-we)),Math.round(K*(Y*ce-fe))]}function Xr(Ne,Y,K,ce,we){let fe=Y===we.maxZoom?0:we.tolerance/((1<<Y)*we.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:Ne.length,source:null,x:K,y:ce,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let Le of Ne)Cc(Te,Le,fe,we);return Te}function Cc(Ne,Y,K,ce){let we=Y.geometry,fe=Y.type,Te=[];if(Ne.minX=Math.min(Ne.minX,Y.minX),Ne.minY=Math.min(Ne.minY,Y.minY),Ne.maxX=Math.max(Ne.maxX,Y.maxX),Ne.maxY=Math.max(Ne.maxY,Y.maxY),fe==="Point"||fe==="MultiPoint")for(let Le=0;Le<we.length;Le+=3)Te.push(we[Le],we[Le+1]),Ne.numPoints++,Ne.numSimplified++;else if(fe==="LineString")fn(Te,we,Ne,K,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let Le=0;Le<we.length;Le++)fn(Te,we[Le],Ne,K,fe==="Polygon",Le===0);else if(fe==="MultiPolygon")for(let Le=0;Le<we.length;Le++){let Se=we[Le];for(let Fe=0;Fe<Se.length;Fe++)fn(Te,Se[Fe],Ne,K,!0,Fe===0)}if(Te.length){let Le=Y.tags||null;if(fe==="LineString"&&ce.lineMetrics){Le={};for(let Fe in Y.tags)Le[Fe]=Y.tags[Fe];Le.mapbox_clip_start=we.start/we.size,Le.mapbox_clip_end=we.end/we.size}let Se={geometry:Te,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:Le};Y.id!==null&&(Se.id=Y.id),Ne.features.push(Se)}}function fn(Ne,Y,K,ce,we,fe){let Te=ce*ce;if(ce>0&&Y.size<(we?Te:ce))return void(K.numPoints+=Y.length/3);let Le=[];for(let Se=0;Se<Y.length;Se+=3)(ce===0||Y[Se+2]>Te)&&(K.numSimplified++,Le.push(Y[Se],Y[Se+1])),K.numPoints++;we&&function(Se,Fe){let je=0;for(let Ue=0,Qe=Se.length,ct=Qe-2;Ue<Qe;ct=Ue,Ue+=2)je+=(Se[Ue]-Se[ct])*(Se[Ue+1]+Se[ct+1]);if(je>0===Fe)for(let Ue=0,Qe=Se.length;Ue<Qe/2;Ue+=2){let ct=Se[Ue],_t=Se[Ue+1];Se[Ue]=Se[Qe-2-Ue],Se[Ue+1]=Se[Qe-1-Ue],Se[Qe-2-Ue]=ct,Se[Qe-1-Ue]=_t}}(Le,fe),Ne.push(Le)}let Ao={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class $u{constructor(Y,K){let ce=(K=this.options=function(fe,Te){for(let Le in Te)fe[Le]=Te[Le];return fe}(Object.create(Ao),K)).debug;if(ce&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let we=function(fe,Te){let Le=[];if(fe.type==="FeatureCollection")for(let Se=0;Se<fe.features.length;Se++)ln(Le,fe.features[Se],Te,Se);else ln(Le,fe.type==="Feature"?fe:{geometry:fe},Te);return Le}(Y,K);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),we=function(fe,Te){let Le=Te.buffer/Te.extent,Se=fe,Fe=jt(fe,1,-1-Le,Le,0,-1,2,Te),je=jt(fe,1,1-Le,2+Le,0,-1,2,Te);return(Fe||je)&&(Se=jt(fe,1,-Le,1+Le,0,-1,2,Te)||[],Fe&&(Se=Ka(Fe,1).concat(Se)),je&&(Se=Se.concat(Ka(je,-1)))),Se}(we,K),we.length&&this.splitTile(we,0,0,0),ce&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,K,ce,we,fe,Te,Le){let Se=[Y,K,ce,we],Fe=this.options,je=Fe.debug;for(;Se.length;){we=Se.pop(),ce=Se.pop(),K=Se.pop(),Y=Se.pop();let Ue=1<<K,Qe=Sr(K,ce,we),ct=this.tiles[Qe];if(!ct&&(je>1&&console.time("creation"),ct=this.tiles[Qe]=Xr(Y,K,ce,we,Fe),this.tileCoords.push({z:K,x:ce,y:we}),je)){je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ce,we,ct.numFeatures,ct.numPoints,ct.numSimplified),console.timeEnd("creation"));let Bi=`z${K}`;this.stats[Bi]=(this.stats[Bi]||0)+1,this.total++}if(ct.source=Y,fe==null){if(K===Fe.indexMaxZoom||ct.numPoints<=Fe.indexMaxPoints)continue}else{if(K===Fe.maxZoom||K===fe)continue;if(fe!=null){let Bi=fe-K;if(ce!==Te>>Bi||we!==Le>>Bi)continue}}if(ct.source=null,Y.length===0)continue;je>1&&console.time("clipping");let _t=.5*Fe.buffer/Fe.extent,Lt=.5-_t,Ut=.5+_t,$t=1+_t,Nt=null,Sn=null,xn=null,en=null,Fn=jt(Y,Ue,ce-_t,ce+Ut,0,ct.minX,ct.maxX,Fe),ti=jt(Y,Ue,ce+Lt,ce+$t,0,ct.minX,ct.maxX,Fe);Y=null,Fn&&(Nt=jt(Fn,Ue,we-_t,we+Ut,1,ct.minY,ct.maxY,Fe),Sn=jt(Fn,Ue,we+Lt,we+$t,1,ct.minY,ct.maxY,Fe),Fn=null),ti&&(xn=jt(ti,Ue,we-_t,we+Ut,1,ct.minY,ct.maxY,Fe),en=jt(ti,Ue,we+Lt,we+$t,1,ct.minY,ct.maxY,Fe),ti=null),je>1&&console.timeEnd("clipping"),Se.push(Nt||[],K+1,2*ce,2*we),Se.push(Sn||[],K+1,2*ce,2*we+1),Se.push(xn||[],K+1,2*ce+1,2*we),Se.push(en||[],K+1,2*ce+1,2*we+1)}}getTile(Y,K,ce){Y=+Y,K=+K,ce=+ce;let we=this.options,{extent:fe,debug:Te}=we;if(Y<0||Y>24)return null;let Le=1<<Y,Se=Sr(Y,K=K+Le&Le-1,ce);if(this.tiles[Se])return da(this.tiles[Se],fe);Te>1&&console.log("drilling down to z%d-%d-%d",Y,K,ce);let Fe,je=Y,Ue=K,Qe=ce;for(;!Fe&&je>0;)je--,Ue>>=1,Qe>>=1,Fe=this.tiles[Sr(je,Ue,Qe)];return Fe&&Fe.source?(Te>1&&(console.log("found parent tile z%d-%d-%d",je,Ue,Qe),console.time("drilling down")),this.splitTile(Fe.source,je,Ue,Qe,Y,K,ce),Te>1&&console.timeEnd("drilling down"),this.tiles[Se]?da(this.tiles[Se],fe):null):null}}function Sr(Ne,Y,K){return 32*((1<<Ne)*K+Y)+Ne}function fa(Ne,Y){let K=Ne.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);let ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return void Y(null,null);let we=new _n(ce.features),fe=xc(we);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),Y(null,{vectorTile:we,rawData:fe.buffer})}class Dc extends lt{constructor(Y,K,ce,we,fe,Te){super(Y,K,ce,we,fa,Te),fe&&(this.loadGeoJSON=fe),this._dynamicIndex=new ai}loadData(Y,K){let ce=Y&&Y.request,we=ce&&ce.collectResourceTiming;this.loadGeoJSON(Y,(fe,Te)=>{if(fe||!Te)return K(fe);if(typeof Te!="object")return K(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){let Se=n.M(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(Fe=>`${Fe.key}: ${Fe.message}`).join(", "));Te.features=Te.features.filter(Fe=>Se.value.evaluate({zoom:0},Fe))}Y.dynamic?(Te.type==="Feature"&&(Te={type:"FeatureCollection",features:[Te]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Te.features,this.loaded),Y.cluster&&(Te.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new wc(function({superclusterOptions:Se,clusterProperties:Fe}){if(!Fe||!Se)return Se;let je={},Ue={},Qe={accumulated:null,zoom:0},ct={properties:null},_t=Object.keys(Fe);for(let Lt of _t){let[Ut,$t]=Fe[Lt],Nt=n.M($t),Sn=n.M(typeof Ut=="string"?[Ut,["accumulated"],["get",Lt]]:Ut);je[Lt]=Nt.value,Ue[Lt]=Sn.value}return Se.map=Lt=>{ct.properties=Lt;let Ut={};for(let $t of _t)Ut[$t]=je[$t].evaluate(Qe,ct);return Ut},Se.reduce=(Lt,Ut)=>{ct.properties=Ut;for(let $t of _t)Qe.accumulated=Lt[$t],Lt[$t]=Ue[$t].evaluate(Qe,ct)},Se}(Y)).load(Te.features):Y.dynamic?this._dynamicIndex:function(Se,Fe){return new $u(Se,Fe)}(Te,Y.geojsonVtOptions)}catch(Se){return K(Se)}let Le={};if(we){let Se=R(ce);Se&&(Le.resourceTiming={},Le.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Se)))}K(null,Le)}})}reloadTile(Y,K){let ce=this.loaded;return ce&&ce[Y.uid]?Y.partial?K(null,void 0):super.reloadTile(Y,K):this.loadTile(Y,K)}loadGeoJSON(Y,K){if(Y.request)n.n(Y.request,K);else{if(typeof Y.data!="string")return K(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(Y.data))}catch{return K(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(ce){K(ce)}}getClusterChildren(Y,K){try{K(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(ce){K(ce)}}getClusterLeaves(Y,K){try{K(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(ce){K(ce)}}}class Mc{constructor(Y,K){this.tileID=new n.aA(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=K}parse(Y,K,ce,we){this.status="parsing";let fe=new n.aA(ce.tileID.overscaledZ,ce.tileID.wrap,ce.tileID.canonical.z,ce.tileID.canonical.x,ce.tileID.canonical.y),Te=[],Le=K.familiesBySource[ce.source],Se=new n.dR(fe,ce.promoteId);return Se.bucketLayerIDs=[],Se.is3DTile=!0,n.e0(Y).then(Fe=>{if(!Fe)return we(new Error("Could not parse tile"));let je=n.e1(Fe,1/n.c9(ce.tileID.canonical)),Ue=Fe.json.extensionsUsed&&Fe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Fe.json.asset.extras&&Fe.json.asset.extras.MAPBOX_mesh_features,Qe=Fe.json.extensionsUsed&&Fe.json.extensionsUsed.includes("EXT_meshopt_compression"),ct=new n.a3(this.zoom,{brightness:this.brightness});for(let _t in Le)for(let Lt of Le[_t]){let Ut=Lt[0];Se.bucketLayerIDs.push(Lt.map(Nt=>n.av(Nt.id,Nt.scope))),Ut.recalculate(ct,[]);let $t=new n.e2(Lt,je,fe,Ue,Qe,this.brightness,Se);Ue||($t.needsUpload=!0),Te.push($t),$t.evaluate(Ut)}this.status="done",we(null,{buckets:Te,featureIndex:Se,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Fe=>we(new Error(Fe.message)))}}class el{constructor(Y,K,ce,we,fe,Te){this.actor=Y,this.layerIndex=K,this.availableImages=ce,this.brightness=Te,this.loading={},this.loaded={}}loadTile(Y,K){let ce=Y.uid,we=this.loading[ce]=new Mc(Y,this.brightness);n.bd(Y.request,(fe,Te)=>{let Le=!this.loading[ce];return delete this.loading[ce],Le||fe?(we.status="done",Le||(this.loaded[ce]=we),K(fe)):Te&&Te.byteLength!==0?void we.parse(Te,this.layerIndex,Y,(Se,Fe)=>{we.status="done",this.loaded=this.loaded||{},this.loaded[ce]=we,Se||!Fe?K(Se):K(null,Fe)}):(we.status="done",this.loaded[ce]=we,K())})}reloadTile(Y,K){let ce=this.loaded,we=Y.uid;if(ce&&ce[we]){let fe=ce[we];fe.projection=Y.projection,fe.brightness=Y.brightness;let Te=(Le,Se)=>{fe.reloadCallback&&(delete fe.reloadCallback,this.loadTile(Y,K)),K(Le,Se)};fe.status==="parsing"?fe.reloadCallback=Te:fe.status==="done"&&this.loadTile(Y,K)}}abortTile(Y,K){let ce=Y.uid;this.loading[ce]&&delete this.loading[ce],K()}removeTile(Y,K){let ce=this.loaded,we=Y.uid;ce&&ce[we]&&delete ce[we],K()}}class Sc{constructor(Y){this.self=Y,this.actor=new n.e3(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=n.bM({name:"mercator"}),this.workerSourceTypes={vector:lt,geojson:Dc,"batched-model":el},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(n.e4.isParsed())throw new Error("RTL text plugin already registered.");n.e4.applyArabicShaping=K.applyArabicShaping,n.e4.processBidirectionalText=K.processBidirectionalText,n.e4.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(Y,K,ce){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],delete this.rasterArrayWorkerSource,ce()}checkIfReady(Y,K,ce){ce()}setReferrer(Y,K){this.referrer=K}spriteLoaded(Y,{scope:K,isLoaded:ce}){if(this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.isSpriteLoaded[Y][K]=ce,this.workerSources[Y]&&this.workerSources[Y][K])for(let we in this.workerSources[Y][K]){let fe=this.workerSources[Y][K][we];for(let Te in fe){let Le=fe[Te];Le instanceof lt&&(Le.isSpriteLoaded=ce,Le.fire(new n.x("isSpriteLoaded")))}}}setImages(Y,{scope:K,images:ce},we){if(this.availableImages[Y]||(this.availableImages[Y]={}),this.availableImages[Y][K]=ce,this.workerSources[Y]&&this.workerSources[Y][K]){for(let fe in this.workerSources[Y][K]){let Te=this.workerSources[Y][K][fe];for(let Le in Te)Te[Le].availableImages=ce}we()}else we()}setProjection(Y,K){this.projections[Y]=n.bM(K)}setBrightness(Y,K,ce){this.brightness=K,ce()}setLayers(Y,K,ce){this.getLayerIndex(Y,K.scope).replace(K.layers,K.options),ce()}updateLayers(Y,K,ce){this.getLayerIndex(Y,K.scope).update(K.layers,K.removedIds,K.options),ce()}loadTile(Y,K,ce){K.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,K.type,K.source,K.scope).loadTile(K,ce)}loadDEMTile(Y,K,ce){this.getDEMWorkerSource(Y,K.source,K.scope).loadTile(K,ce)}decodeRasterArray(Y,K,ce){this.getRasterArrayWorkerSource().decodeRasterArray(K,ce)}reloadTile(Y,K,ce){K.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,K.type,K.source,K.scope).reloadTile(K,ce)}abortTile(Y,K,ce){this.getWorkerSource(Y,K.type,K.source,K.scope).abortTile(K,ce)}removeTile(Y,K,ce){this.getWorkerSource(Y,K.type,K.source,K.scope).removeTile(K,ce)}removeSource(Y,K,ce){if(!(this.workerSources[Y]&&this.workerSources[Y][K.scope]&&this.workerSources[Y][K.scope][K.type]&&this.workerSources[Y][K.scope][K.type][K.source]))return;let we=this.workerSources[Y][K.scope][K.type][K.source];delete this.workerSources[Y][K.scope][K.type][K.source],we.removeSource!==void 0?we.removeSource(K,ce):ce()}loadWorkerSource(Y,K,ce){try{this.self.importScripts(K.url),ce()}catch(we){ce(we.toString())}}syncRTLPluginState(Y,K,ce){try{n.e4.setState(K);let we=n.e4.getPluginURL();if(n.e4.isLoaded()&&!n.e4.isParsed()&&we!=null){this.self.importScripts(we);let fe=n.e4.isParsed();ce(fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${we}`),fe)}}catch(we){ce(we.toString())}}setDracoUrl(Y,K){this.dracoUrl=K}getAvailableImages(Y,K){this.availableImages[Y]||(this.availableImages[Y]={});let ce=this.availableImages[Y][K];return ce||(ce=[]),ce}getLayerIndex(Y,K){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let ce=this.layerIndexes[Y][K];return ce||(ce=this.layerIndexes[Y][K]=new ie,ce.scope=K),ce}getWorkerSource(Y,K,ce,we){return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][we]||(this.workerSources[Y][we]={}),this.workerSources[Y][we][K]||(this.workerSources[Y][we][K]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.workerSources[Y][we][K][ce]||(this.workerSources[Y][we][K][ce]=new this.workerSourceTypes[K]({send:(fe,Te,Le,Se,Fe,je)=>{this.actor.send(fe,Te,Le,Y,Fe,je)},scheduler:this.actor.scheduler},this.getLayerIndex(Y,we),this.getAvailableImages(Y,we),this.isSpriteLoaded[Y][we],void 0,this.brightness)),this.workerSources[Y][we][K][ce]}getDEMWorkerSource(Y,K,ce){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][ce]||(this.demWorkerSources[Y][ce]={}),this.demWorkerSources[Y][ce][K]||(this.demWorkerSources[Y][ce][K]=new rt),this.demWorkerSources[Y][ce][K]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new At),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Y,K){n.e5(K)}getWorkerPerformanceMetrics(Y,K,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Sc(self)),Sc}),d(["./shared"],function(n){var R="3.8.0";let j={create:"create",load:"load",fullLoad:"fullLoad"},$={mark(h){performance.mark(h)},measure(h,t,o){performance.measure(h,t,o)}};function ie(h){let t=h.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var pe,Me={},He=function(){if(pe)return Me;function h(f){return!t(f)}function t(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,b,M=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(M);try{b=new Worker(A),v=!0}catch{v=!1}return b&&b.terminate(),URL.revokeObjectURL(A),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var b=v.getContext("2d");if(!b)return!1;var M=b.getImageData(0,0,1,1);return M&&M.width===v.width}()?(o[g=f&&f.failIfMajorPerformanceCaveat]===void 0&&(o[g]=function(v){var b,M=function(A){var O=document.createElement("canvas"),P=Object.create(h.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=A,O.getContext("webgl2",P)}(v);if(!M)return!1;try{b=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!b||M.isContextLost())&&(M.shaderSource(b,"void main() {}"),M.compileShader(b),M.getShaderParameter(b,M.COMPILE_STATUS)===!0)}(g)),o[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}pe=1,Me.supported=h,Me.notSupportedReason=t;var o={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Me}();function Be(h,t,o){let f=document.createElement(h);return t!=null&&(f.className=t),o&&o.appendChild(f),f}function lt(h,t,o){let f=document.createElementNS("http://www.w3.org/2000/svg",h);for(let g of Object.keys(t))f.setAttributeNS(null,g,String(t[g]));return o&&o.appendChild(f),f}let rt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,At=rt&&rt.userSelect!==void 0?"userSelect":"WebkitUserSelect",Kt;function St(){rt&&At&&(Kt=rt[At],rt[At]="none")}function _n(){rt&&At&&(rt[At]=Kt)}function hi(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",hi,!0)}function Dt(){window.addEventListener("click",hi,!0),window.setTimeout(()=>{window.removeEventListener("click",hi,!0)},0)}function ai(h,t){let o=h.getBoundingClientRect();return Bt(h,o,t)}function Zi(h,t){let o=h.getBoundingClientRect(),f=[];for(let g=0;g<t.length;g++)f.push(Bt(h,o,t[g]));return f}function kt(h){return window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Bt(h,t,o){let f=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new n.P((o.clientX-t.left)*f,(o.clientY-t.top)*f)}let sa="01",Ss="NO_ACCESS_TOKEN";class Uu{constructor(t,o,f){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){let t=function(){let o="";for(let f=0;f<10;f++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",sa,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!n.f(t))return t;let f=hr(t);return f.params.push(`sdk=js-${R}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!n.f(t))return t;let f=hr(t);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||o)}normalizeModelURL(t,o){if(!n.f(t))return t;let f=hr(t);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||o)}normalizeSourceURL(t,o,f,g){if(!n.f(t))return t;let v=hr(t);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),f&&v.params.push(`language=${f}`),g&&v.params.push(`worldview=${g}`),this._makeAPIURL(v,this._customAccessToken||o)}normalizeSpriteURL(t,o,f,g){let v=hr(t);return n.f(t)?(v.path=`/styles/v1${v.path}/sprite${o}${f}`,this._makeAPIURL(v,this._customAccessToken||g)):(v.path+=`${o}${f}`,Jo(v))}normalizeTileURL(t,o,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.f(t))return t;let g=hr(t);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||f&&g.authority!=="raster"&&f===512?"@2x":""}${n.m.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${n.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${n.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${n.e.TILE_URL_VERSION}${g.path}`);let v=this._customAccessToken||function(b){for(let M of b){let A=M.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(g.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,v)}canonicalizeTileURL(t,o){let f=hr(t);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return t;let g="mapbox://";f.path.match(/^\/raster\/v1\//)?g+=`raster/${f.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${f.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${f.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let v=f.params;return o&&(v=v.filter(b=>!b.match(/^access_token=/))),v.length&&(g+=`?${v.join("&")}`),g}canonicalizeTileset(t,o){let f=!!o&&n.f(o),g=[];for(let v of t.tiles||[])n.h(v)?g.push(this.canonicalizeTileURL(v,f)):g.push(v);return g}_makeAPIURL(t,o){let f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=hr(n.e.API_URL);if(t.protocol=g.protocol,t.authority=g.authority,t.protocol==="http"){let v=t.params.indexOf("secure");v>=0&&t.params.splice(v,1)}if(g.path!=="/"&&(t.path=`${g.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return Jo(t);if(o=o||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return t.params=t.params.filter(v=>v.indexOf("access_token")===-1),t.params.push(`access_token=${o||""}`),Jo(t)}}let Qt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function hr(h){let t=h.match(Qt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Jo(h){let t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}let Wa="mapbox.eventData";function Yt(h){if(!h)return null;let t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.j(t[1]))}catch{return null}}class aa{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){let o=Yt(n.e.ACCESS_TOKEN),f="";return f=o&&o.u?n.k(o.u):n.e.ACCESS_TOKEN||"",t?`${Wa}.${t}:${f}`:`${Wa}:${f}`}fetchEventData(){let t=n.s("localStorage"),o=this.getStorageKey(),f=this.getStorageKey("uuid");if(t)try{let g=localStorage.getItem(o);g&&(this.eventData=JSON.parse(g));let v=localStorage.getItem(f);v&&(this.anonId=v)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){let t=n.s("localStorage"),o=this.getStorageKey(),f=this.getStorageKey("uuid"),g=this.anonId;if(t&&g)try{localStorage.setItem(f,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,f,g){if(!n.e.EVENTS_URL)return;let v=hr(n.e.EVENTS_URL);v.params.push(`access_token=${g||n.e.ACCESS_TOKEN||""}`);let b={event:this.type,created:new Date(t).toISOString()},M=o?n.l(b,o):b,A={url:Jo(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=n.p(A,O=>{this.pendingRequest=null,f(O),this.saveEventData(),this.processRequests(g)})}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}let xc=new class extends aa{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(o=>n.f(o)||n.h(o))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let t=Yt(n.e.ACCESS_TOKEN),o=t?t.u:n.e.ACCESS_TOKEN,f=o!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),f=!0);let g=this.queue.shift();if(this.eventData.lastSuccess){let v=new Date(this.eventData.lastSuccess),b=new Date(g),M=(g-this.eventData.lastSuccess)/864e5;f=f||M>=1||M<-1||v.getDate()!==b.getDate()}else f=!0;f?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:sa,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=g,this.eventData.tokenU=o)},h):this.processRequests()}},Za=xc.postTurnstileEvent.bind(xc),Wt=new class extends aa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,o,f){this.skuToken=t,this.errorCb=f,n.e.EVENTS_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},o):this.errorCb(new Error(Ss)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:sa,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):t&&(this.success[t]=!0)},h))}remove(){this.errorCb=null}},bc=Wt.postMapLoadEvent.bind(Wt),ao=new class extends aa{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=n.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){let t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){let{map:o,style:f,importedStyles:g}=t;if(!n.e.EVENTS_URL||!h&&!n.e.ACCESS_TOKEN)return;let v=this.getMapInstanceId(o),b={mapInstanceId:v,eventId:this.getEventId(v),style:f};g.length&&(b.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:b},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,()=>{},h)}},Zr=ao.postStyleLoadEvent.bind(ao),Xa=new class extends aa{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){n.e.EVENTS_URL&&(h||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:t,performanceData:o}=this.queue.shift(),f=function(g){let v=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),M=function(U){let W={};if(U){for(let q in U)if(q!=="other")for(let X of U[q]){let Z=`${q}ResolveRangeMin`,Q=`${q}ResolveRangeMax`,re=`${q}RequestCount`,oe=`${q}RequestCachedCount`;W[Z]=Math.min(W[Z]||1/0,X.startTime),W[Q]=Math.max(W[Q]||-1/0,X.responseEnd);let ae=ue=>{W[ue]===void 0&&(W[ue]=0),++W[ue]};X.transferSize!==void 0&&X.transferSize===0&&ae(oe),ae(re)}}return W}(function(U,W){let q={};if(U)for(let X of U){let Z=W(X);q[Z]===void 0&&(q[Z]=[]),q[Z].push(X)}return q}(v,ie)),A=window.devicePixelRatio,O=navigator.connection||navigator.mozConnection||navigator.webkitConnection,P=O?O.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},z=(U,W,q)=>{q!=null&&U.push({name:W,value:q.toString()})};for(let U in M)z(F.counters,U,M[U]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(z(F.counters,"interactionRangeMin",g.interactionRange[0]),z(F.counters,"interactionRangeMax",g.interactionRange[1])),b)for(let U of Object.keys(j)){let W=j[U],q=b.find(X=>X.name===W);q&&z(F.counters,W,q.startTime)}return z(F.counters,"visibilityHidden",g.visibilityHidden),z(F.attributes,"style",function(U){if(U)for(let W of U){let q=W.name.split("?")[0];if(n.i(q)){let X=q.split("/").slice(-2);if(X.length===2)return`mapbox://styles/${X[0]}/${X[1]}`}}}(v)),z(F.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),z(F.attributes,"fogEnabled",g.fogEnabled?"true":"false"),z(F.attributes,"projection",g.projection),z(F.attributes,"zoom",g.zoom),z(F.metadata,"devicePixelRatio",A),z(F.metadata,"connectionEffectiveType",P),z(F.metadata,"navigatorUserAgent",navigator.userAgent),z(F.metadata,"screenWidth",window.screen.width),z(F.metadata,"screenHeight",window.screen.height),z(F.metadata,"windowWidth",window.innerWidth),z(F.metadata,"windowHeight",window.innerHeight),z(F.metadata,"mapWidth",g.width/A),z(F.metadata,"mapHeight",g.height/A),z(F.metadata,"webglRenderer",g.renderer),z(F.metadata,"webglVendor",g.vendor),z(F.metadata,"sdkVersion",R),z(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(o);for(let g of f.metadata);for(let g of f.counters);for(let g of f.attributes);this.postEvent(t,f,()=>{},h)}},wc=Xa.postPerformanceEvent.bind(Xa),la=new class extends aa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,o,f){if(!n.e.API_URL||!n.e.SESSION_PATH)return;let g=hr(n.e.API_URL+n.e.SESSION_PATH);g.params.push(`sku=${t||""}`),g.params.push(`access_token=${f||n.e.ACCESS_TOKEN||""}`);let v={url:Jo(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(v,b=>{this.pendingRequest=null,o(b),this.saveEventData(),this.processRequests(f)})}getSessionAPI(h,t,o,f){this.skuToken=t,this.errorCb=f,n.e.SESSION_PATH&&n.e.API_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},o):this.errorCb(new Error(Ss)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;let{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,f=>{f?this.errorCb(f):t&&(this.success[t]=!0)},h)}remove(){this.errorCb=null}},Ee=la.getSessionAPI.bind(la),Ko=new Set;function As(h,t){t?Ko.add(h):Ko.delete(h)}class Ec{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){let o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){let o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){let t={};for(let o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(let o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function ot(h){let{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class ca extends n.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new n.r({width:1,height:1})}isLoaded(){for(let t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,o){if(this.loaded[o]!==t&&(this.loaded[o]=t,t)){for(let{ids:f,callback:g}of this.requestors)this._notify(f,o,g);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images[o][t]}addImage(t,o,f){this._validate(t,f)&&(this.images[o][t]=f)}_validate(t,o){let f=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "stretchX" value`))),f=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "stretchY" value`))),f=!1),this._validateContent(o.content,o)||(this.fire(new n.t(new Error(`Image "${t}" has invalid "content" value`))),f=!1),f}_validateStretch(t,o){if(!t)return!0;let f=0;for(let g of t){if(g[0]<f||g[1]<g[0]||o<g[1])return!1;f=g[1]}return!0}_validateContent(t,o){return!(t&&(t.length!==4||t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,o,f){f.version=this.images[o][t].version+1,this.images[o][t]=f,this.updatedImages[o][t]=!0}removeImage(t,o){let f=this.images[o][t];delete this.images[o][t],delete this.patterns[o][t],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,o,f){let g=!0,v=!!this.loaded[o];if(!v)for(let b of t)this.images[o][b]||(g=!1);v||g?this._notify(t,o,f):this.requestors.push({ids:t,scope:o,callback:f})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,o,f){let g={};for(let v of t){this.images[o][v]||this.fire(new n.x("styleimagemissing",{id:v}));let b=this.images[o][v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:n.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,g)}getPixelSize(t){let{width:o,height:f}=this.atlasImage[t];return{width:o,height:f}}getPattern(t,o,f){let g=this.patterns[o][t],v=this.getImage(t,o);if(!v)return null;if(g&&g.position.version===v.version)return g.position;if(g)g.position.version=v.version;else{let b={w:v.data.width+2*n.y,h:v.data.height+2*n.y,x:0,y:0},M=new n.I(b,v,n.y);this.patterns[o][t]={bin:b,position:M}}return this._updatePatternAtlas(o,f),this.patterns[o][t].position}bind(t,o){let f=t.gl,g=this.atlasTexture[o];g?this.dirty&&(g.update(this.atlasImage[o]),this.dirty=!1):(g=new n.T(t,this.atlasImage[o],f.RGBA8),this.atlasTexture[o]=g),g.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){let f=[];for(let M in this.patterns[t])f.push(this.patterns[t][M].bin);let{w:g,h:v}=n.z(f),b=this.atlasImage[t];b.resize({width:g||1,height:v||1});for(let M in this.patterns[t]){let{bin:A,position:O}=this.patterns[t][M],P=O.padding,F=A.x+P,z=A.y+P,U=this.images[t][M].data,W=U.width,q=U.height;P=P>1?P-1:P,n.r.copy(U,b,{x:0,y:0},{x:F,y:z},{width:W,height:q},o),n.r.copy(U,b,{x:0,y:q-P},{x:F,y:z-P},{width:W,height:P},o),n.r.copy(U,b,{x:0,y:0},{x:F,y:z+q},{width:W,height:P},o),n.r.copy(U,b,{x:W-P,y:0},{x:F-P,y:z},{width:P,height:q},o),n.r.copy(U,b,{x:0,y:0},{x:F+W,y:z},{width:P,height:q},o),n.r.copy(U,b,{x:W-P,y:q-P},{x:F-P,y:z-P},{width:P,height:P},o),n.r.copy(U,b,{x:0,y:q-P},{x:F+W,y:z-P},{width:P,height:P},o),n.r.copy(U,b,{x:0,y:0},{x:F+W,y:z+q},{width:P,height:P},o),n.r.copy(U,b,{x:W-P,y:0},{x:F-P,y:z+q},{width:P,height:P},o)}this.dirty=!0}beginFrame(){for(let t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,o){for(let f of t){if(this.callbackDispatchedThisFrame[o][f])continue;this.callbackDispatchedThisFrame[o][f]=!0;let g=this.images[o][f];ot(g)&&this.updateImage(f,o,g)}}}function Xi(h){let t=h.key,o=h.value,f=h.valueSpec||{},g=h.objectElementValidators||{},v=h.style,b=h.styleSpec,M=[],A=n.B(o);if(A!=="object")return[new n.V(t,o,`object expected, ${A} found`)];for(let O in o){let P=O.split(".")[0],F;g[P]?F=g[P]:f[P]?F=fn:g["*"]?F=g["*"]:f["*"]&&(F=fn),F?M=M.concat(F({key:(t&&`${t}.`)+O,value:o[O],valueSpec:f[P]||f["*"],style:v,styleSpec:b,object:o,objectKey:O},o)):M.push(new n.A(t,o[O],`unknown property "${O}"`))}for(let O in f)g[O]||f[O].required&&f[O].default===void 0&&o[O]===void 0&&M.push(new n.V(t,o,`missing required property "${O}"`));return M}function Qo(h){let t=h.value,o=h.valueSpec,f=h.style,g=h.styleSpec,v=h.key,b=h.arrayElementValidator||fn;if(n.B(t)!=="array")return[new n.V(v,t,`array expected, ${n.B(t)} found`)];if(o.length&&t.length!==o.length)return[new n.V(v,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new n.V(v,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let M={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};g.$version<7&&(M.function=o.function),n.B(o.value)==="object"&&(M=o.value);let A=[];for(let O=0;O<t.length;O++)A=A.concat(b({array:t,arrayIndex:O,value:t[O],valueSpec:M,style:f,styleSpec:g,key:`${v}[${O}]`},!0));return A}function ln(h){let t=h.key,o=h.value,f=h.valueSpec,g=n.B(o);if(g==="number"&&o!=o&&(g="NaN"),g!=="number")return[new n.V(t,o,`number expected, ${g} found`)];if("minimum"in f){let v=f.minimum;if(n.B(f.minimum)==="array"&&(v=f.minimum[h.arrayIndex]),o<v)return[new n.V(t,o,`${o} is less than the minimum value ${v}`)]}if("maximum"in f){let v=f.maximum;if(n.B(f.maximum)==="array"&&(v=f.maximum[h.arrayIndex]),o>v)return[new n.V(t,o,`${o} is greater than the maximum value ${v}`)]}return[]}function $i(h){let t=h.valueSpec,o=n.D(h.value.type),f,g,v,b={},M=o!=="categorical"&&h.value.property===void 0,A=!M,O=n.B(h.value.stops)==="array"&&n.B(h.value.stops[0])==="array"&&n.B(h.value.stops[0][0])==="object",P=Xi({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(U){if(o==="identity")return[new n.V(U.key,U.value,'identity function may not have a "stops" property')];let W=[],q=U.value;return W=W.concat(Qo({key:U.key,value:q,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:F})),n.B(q)==="array"&&q.length===0&&W.push(new n.V(U.key,q,"array must have at least one stop")),W},default:function(U){return fn({key:U.key,value:U.value,valueSpec:t,style:U.style,styleSpec:U.styleSpec})}}});return o==="identity"&&M&&P.push(new n.V(h.key,h.value,'missing required property "property"')),o==="identity"||h.value.stops||P.push(new n.V(h.key,h.value,'missing required property "stops"')),o==="exponential"&&h.valueSpec.expression&&!n.F(h.valueSpec)&&P.push(new n.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(A&&!n.G(h.valueSpec)?P.push(new n.V(h.key,h.value,"property functions not supported")):M&&!n.H(h.valueSpec)&&P.push(new n.V(h.key,h.value,"zoom functions not supported"))),o!=="categorical"&&!O||h.value.property!==void 0||P.push(new n.V(h.key,h.value,'"property" property is required')),P;function F(U){let W=[],q=U.value,X=U.key;if(n.B(q)!=="array")return[new n.V(X,q,`array expected, ${n.B(q)} found`)];if(q.length!==2)return[new n.V(X,q,`array length 2 expected, length ${q.length} found`)];if(O){if(n.B(q[0])!=="object")return[new n.V(X,q,`object expected, ${n.B(q[0])} found`)];if(q[0].zoom===void 0)return[new n.V(X,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new n.V(X,q,"object stop key must have value")];let Z=n.D(q[0].zoom);if(typeof Z!="number")return[new n.V(X,q[0].zoom,"stop zoom values must be numbers")];if(v&&v>Z)return[new n.V(X,q[0].zoom,"stop zoom values must appear in ascending order")];Z!==v&&(v=Z,g=void 0,b={}),W=W.concat(Xi({key:`${X}[0]`,value:q[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:ln,value:z}}))}else W=W.concat(z({key:`${X}[0]`,value:q[0],valueSpec:{},style:U.style,styleSpec:U.styleSpec},q));return n.J(n.K(q[1]))?W.concat([new n.V(`${X}[1]`,q[1],"expressions are not allowed in function stops.")]):W.concat(fn({key:`${X}[1]`,value:q[1],valueSpec:t,style:U.style,styleSpec:U.styleSpec}))}function z(U,W){let q=n.B(U.value),X=n.D(U.value),Z=U.value!==null?U.value:W;if(f){if(q!==f)return[new n.V(U.key,Z,`${q} stop domain type must match previous stop domain type ${f}`)]}else f=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new n.V(U.key,Z,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&o!=="categorical"){let Q=`number expected, ${q} found`;return n.G(t)&&o===void 0&&(Q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(U.key,Z,Q)]}return o!=="categorical"||q!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?o!=="categorical"&&q==="number"&&typeof X=="number"&&typeof g=="number"&&g!==void 0&&X<g?[new n.V(U.key,Z,"stop domain values must appear in ascending order")]:(g=X,o==="categorical"&&X in b?[new n.V(U.key,Z,"stop domain values must be unique")]:(b[X]=!0,[])):[new n.V(U.key,Z,`integer expected, found ${String(X)}`)]}}function lo(h){let t=(h.expressionContext==="property"?n.L:n.M)(n.K(h.value),h.valueSpec);if(t.result==="error")return t.value.map(f=>new n.V(`${h.key}${f.key}`,h.value,f.message));let o=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!o.outputDefined())return[new n.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!n.N(o))return[new n.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return ua(o,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!n.O(o,["zoom","feature-state"]))return[new n.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!n.Q(o))return[new n.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ua(h,t){let o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(let g of t.valueSpec.expression.parameters)o.delete(g);if(o.size===0)return[];let f=[];return h instanceof n.S&&o.has(h.name)?[new n.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild(g=>{f.push(...ua(g,t))}),f)}function Rs(h){let t=h.key,o=h.value,f=h.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(n.D(o))===-1&&g.push(new n.V(t,o,`expected one of [${f.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(f.values).indexOf(n.D(o))===-1&&g.push(new n.V(t,o,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(o)} found`)),g}function Ya(h){return n.W(n.K(h.value))?lo(n.C({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):jt(h)}function jt(h){let t=h.value,o=h.key;if(n.B(t)!=="array")return[new n.V(o,t,`array expected, ${n.B(t)} found`)];let f=h.styleSpec,g,v=[];if(t.length<1)return[new n.V(o,t,"filter array must have at least 1 element")];switch(v=v.concat(Rs({key:`${o}[0]`,value:t[0],valueSpec:f.filter_operator,style:h.style,styleSpec:h.styleSpec})),n.D(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.D(t[1])==="$type"&&v.push(new n.V(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new n.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(g=n.B(t[1]),g!=="string"&&v.push(new n.V(`${o}[1]`,t[1],`string expected, ${g} found`)));for(let b=2;b<t.length;b++)g=n.B(t[b]),n.D(t[1])==="$type"?v=v.concat(Rs({key:`${o}[${b}]`,value:t[b],valueSpec:f.geometry_type,style:h.style,styleSpec:h.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new n.V(`${o}[${b}]`,t[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)v=v.concat(jt({key:`${o}[${b}]`,value:t[b],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":g=n.B(t[1]),t.length!==2?v.push(new n.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new n.V(`${o}[1]`,t[1],`string expected, ${g} found`))}return v}function Ja(h,t){let o=h.key,f=h.style,g=h.layer,v=h.styleSpec,b=h.value,M=h.objectKey,A=v[`${t}_${h.layerType}`];if(!A)return[];let O=M.match(/^(.*)-transition$/);if(t==="paint"&&O&&A[O[1]]&&A[O[1]].transition)return fn({key:o,value:b,valueSpec:v.transition,style:f,styleSpec:v});let P=h.valueSpec||A[M];if(!P)return[new n.A(o,b,`unknown property "${M}"`)];let F;if(n.B(b)==="string"&&n.G(P)&&!P.tokens&&(F=/^{([^}]+)}$/.exec(b))){let U=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new n.V(o,b,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${U}.`)]}let z=[];if(h.layerType==="symbol")M!=="text-field"||!f||f.glyphs||f.imports||z.push(new n.V(o,b,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&n.X(n.K(b))&&n.D(b.type)==="identity"&&z.push(new n.V(o,b,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&n.G(P)&&(n.Y(P)||n.H(P))){let U=n.L(n.K(b),P),W=U.value.expression||U.value._styleExpression.expression;W&&!n.O(W,["measure-light"])&&(M==="model-emissive-strength"&&n.Q(W)&&n.N(W)||z.push(new n.V(o,b,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(fn({key:h.key,value:b,valueSpec:P,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:M}))}function es(h){return Ja(h,"paint")}function ha(h){return Ja(h,"layout")}function ar(h){let t=[],o=h.value,f=h.key,g=h.style,v=h.styleSpec;o.type||o.ref||t.push(new n.V(f,o,'either "type" or "ref" is required'));let b=n.D(o.type),M=n.D(o.ref);if(o.id){let A=n.D(o.id);for(let O=0;O<h.arrayIndex;O++){let P=g.layers[O];n.D(P.id)===A&&t.push(new n.V(f,o.id,`duplicate layer id "${o.id}", previously used at line ${P.id.__line__}`))}}if("ref"in o){let A;["type","source","source-layer","filter","layout"].forEach(O=>{O in o&&t.push(new n.V(f,o[O],`"${O}" is prohibited for ref layers`))}),g.layers.forEach(O=>{n.D(O.id)===M&&(A=O)}),A?A.ref?t.push(new n.V(f,o.ref,"ref cannot reference another ref layer")):b=n.D(A.type):typeof M=="string"&&t.push(new n.V(f,o.ref,`ref layer "${M}" not found`))}else if(b!=="background"&&b!=="sky"&&b!=="slot")if(o.source){let A=g.sources&&g.sources[o.source],O=A&&n.D(A.type);A?O==="vector"&&b==="raster"?t.push(new n.V(f,o.source,`layer "${o.id}" requires a raster source`)):O==="raster"&&b!=="raster"?t.push(new n.V(f,o.source,`layer "${o.id}" requires a vector source`)):O!=="vector"||o["source-layer"]?O==="raster-dem"&&b!=="hillshade"?t.push(new n.V(f,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="raster-array"||["raster","raster-particle"].includes(b)?b!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||O==="geojson"&&A.lineMetrics?b==="raster-particle"&&O!=="raster-array"&&t.push(new n.V(f,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new n.V(f,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new n.V(f,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(f,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new n.V(f,o.source,`source "${o.source}" not found`))}else t.push(new n.V(f,o,'missing required property "source"'));return t=t.concat(Xi({key:f,value:o,valueSpec:v.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>fn({key:`${f}.type`,value:o.type,valueSpec:v.layer.type,style:h.style,styleSpec:h.styleSpec,object:o,objectKey:"type"}),filter:A=>Ya(n.C({layerType:b},A)),layout:A=>Xi({layer:o,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":O=>ha(n.C({layerType:b},O))}}),paint:A=>Xi({layer:o,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":O=>es(n.C({layerType:b,layer:o},O))}})}})),t}function Mr(h){let t=h.value,o=h.key,f=n.B(t);return f!=="string"?[new n.V(o,t,`string expected, ${f} found`)]:[]}let Ic={promoteId:function({key:h,value:t}){if(n.B(t)==="string")return Mr({key:h,value:t});{let o=[];for(let f in t)o.push(...Mr({key:`${h}.${f}`,value:t[f]}));return o}}};function Tc(h){let t=h.value,o=h.key,f=h.styleSpec,g=h.style;if(!t.type)return[new n.V(o,t,'"type" is required')];let v=n.D(t.type),b=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(t.url||t.tiles||b.push(new n.A(o,t,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(Xi({key:o,value:t,valueSpec:f[`source_${v.replace("-","_")}`],style:h.style,styleSpec:f,objectElementValidators:Ic})),b;case"geojson":if(b=Xi({key:o,value:t,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:Ic}),t.cluster)for(let M in t.clusterProperties){let[A,O]=t.clusterProperties[M],P=typeof A=="string"?[A,["accumulated"],["get",M]]:A;b.push(...lo({key:`${o}.${M}.map`,value:O,expressionContext:"cluster-map"})),b.push(...lo({key:`${o}.${M}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return b;case"video":return Xi({key:o,value:t,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return Xi({key:o,value:t,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new n.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rs({key:`${o}.type`,value:t.type,valueSpec:{values:Ka(f)},style:g,styleSpec:f})}}function Ka(h){return h.source.reduce((t,o)=>{let f=h[o];return f.type.type==="enum"&&(t=t.concat(Object.keys(f.type.values))),t},[])}function ts(h){let t=h.value,o=h.styleSpec,f=o.light,g=h.style,v=[],b=n.B(t);if(t===void 0)return v;if(b!=="object")return v=v.concat([new n.V("light",t,`object expected, ${b} found`)]),v;for(let M in t){let A=M.match(/^(.*)-transition$/);v=v.concat(A&&f[A[1]]&&f[A[1]].transition?fn({key:M,value:t[M],valueSpec:o.transition,style:g,styleSpec:o}):f[M]?fn({key:M,value:t[M],valueSpec:f[M],style:g,styleSpec:o}):[new n.V(M,t[M],`unknown property "${M}"`)])}return v}function da(h){let t=h.value,o=[];if(!t)return o;let f=n.B(t);if(f!=="object")return o=o.concat([new n.V("light-3d",t,`object expected, ${f} found`)]),o;let g=h.styleSpec,v=g["light-3d"],b=h.key,M=h.style,A=h.style.lights;for(let F of["type","id"])if(!(F in t))return o=o.concat([new n.V("light-3d",t,`missing property ${F} on light`)]),o;if(t.type&&A)for(let F=0;F<h.arrayIndex;F++){let z=n.D(t.type),U=A[F];n.D(U.type)===z&&o.push(new n.V(b,t.id,`duplicate light type "${t.type}", previously defined at line ${U.id.__line__}`))}let O=`properties_light_${t.type}`;if(!(O in g))return o=o.concat([new n.V("light-3d",t,`Invalid light type ${t.type}`)]),o;let P=g[O];for(let F in t)if(F==="properties"){let z=t[F],U=n.B(z);if(U!=="object")return o=o.concat([new n.V("properties",z,`object expected, ${U} found`)]),o;for(let W in z)o=o.concat(P[W]?fn({key:W,value:z[W],valueSpec:P[W],style:M,styleSpec:g}):[new n.A(h.key,z[W],`unknown property "${W}"`)])}else{let z=F.match(/^(.*)-transition$/);o=o.concat(z&&v[z[1]]&&v[z[1]].transition?fn({key:F,value:t[F],valueSpec:g.transition,style:M,styleSpec:g}):v[F]?fn({key:F,value:t[F],valueSpec:v[F],style:M,styleSpec:g}):[new n.A(F,t[F],`unknown property "${F}"`)])}return o}function Qa(h){let t=h.value,o=h.key,f=h.style,g=h.styleSpec,v=g.terrain,b=[],M=n.B(t);if(t===void 0||M==="null")return b;if(M!=="object")return b=b.concat([new n.V("terrain",t,`object expected, ${M} found`)]),b;for(let A in t){let O=A.match(/^(.*)-transition$/);b=b.concat(O&&v[O[1]]&&v[O[1]].transition?fn({key:A,value:t[A],valueSpec:g.transition,style:f,styleSpec:g}):v[A]?fn({key:A,value:t[A],valueSpec:v[A],style:f,styleSpec:g}):[new n.A(A,t[A],`unknown property "${A}"`)])}if(t.source){let A=f.sources&&f.sources[t.source],O=A&&n.D(A.type);A?O!=="raster-dem"&&b.push(new n.V(o,t.source,`terrain cannot be used with a source of type ${String(O)}, it only be used with a "raster-dem" source type`)):b.push(new n.V(o,t.source,`source "${t.source}" not found`))}else b.push(new n.V(o,t,'terrain is missing required property "source"'));return b}function Xr(h){let t=h.value,o=h.style,f=h.styleSpec,g=f.fog,v=[],b=n.B(t);if(t===void 0)return v;if(b!=="object")return v=v.concat([new n.V("fog",t,`object expected, ${b} found`)]),v;for(let M in t){let A=M.match(/^(.*)-transition$/);v=v.concat(A&&g[A[1]]&&g[A[1]].transition?fn({key:M,value:t[M],valueSpec:f.transition,style:o,styleSpec:f}):g[M]?fn({key:M,value:t[M],valueSpec:g[M],style:o,styleSpec:f}):[new n.A(M,t[M],`unknown property "${M}"`)])}return v}let Cc={"*":()=>[],array:Qo,boolean:function(h){let t=h.value,o=h.key,f=n.B(t);return f!=="boolean"?[new n.V(o,t,`boolean expected, ${f} found`)]:[]},number:ln,color:function(h){let t=h.key,o=h.value,f=n.B(o);return f!=="string"?[new n.V(t,o,`color expected, ${f} found`)]:n.U.parseCSSColor(o)===null?[new n.V(t,o,`color expected, "${o}" found`)]:[]},enum:Rs,filter:Ya,function:$i,layer:ar,object:Xi,source:Tc,model:n.Z,light:ts,"light-3d":da,terrain:Qa,fog:Xr,string:Mr,formatted:function(h){return Mr(h).length===0?[]:lo(h)},resolvedImage:function(h){return Mr(h).length===0?[]:lo(h)},projection:function(h){let t=h.value,o=h.styleSpec,f=o.projection,g=h.style,v=[],b=n.B(t);if(b==="object")for(let M in t)v=v.concat(fn({key:M,value:t[M],valueSpec:f[M],style:g,styleSpec:o}));else b!=="string"&&(v=v.concat([new n.V("projection",t,`object or string expected, ${b} found`)]));return v},import:function(h){let{value:t,styleSpec:o}=h,b=t,{data:f}=b,g=H_(b,["data"]);Object.defineProperty(g,"__line__",{value:t.__line__,enumerable:!1});let v=Xi(n.C({},h,{value:g,valueSpec:o.import}));return n.D(g.id)===""&&v.push(new n.V(`${h.key}.id`,g,"import id can't be an empty string")),f&&(v=v.concat($u(f,o,{key:`${h.key}.data`}))),v}};function fn(h,t=!1){let o=h.value,f=h.valueSpec,g=h.styleSpec;if(f.expression&&n.X(n.D(o)))return $i(h);if(f.expression&&n.J(n.K(o)))return lo(h);if(f.type&&Cc[f.type]){let v=Cc[f.type](h);return t===!0&&v.length>0&&n.B(h.value)==="array"?lo(h):v}return Xi(n.C({},h,{valueSpec:f.type?g[f.type]:f}))}function Ao(h){let t=h.value,o=h.key,f=Mr(h);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new n.V(o,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new n.V(o,t,'"glyphs" url must include a "{range}" token'))),f}function $u(h,t=n._,o={}){return fn({key:o.key||"",value:h,valueSpec:t.$root,styleSpec:t,style:h,objectElementValidators:{glyphs:Ao,"*":()=>[]}})}function Sr(h,t=n._){return fe($u(h,t))}let fa=h=>fe(Tc(h)),Dc=h=>fe(ts(h)),Mc=h=>fe(da(h)),el=h=>fe(Qa(h)),Sc=h=>fe(Xr(h)),Ne=h=>fe(ar(h)),Y=h=>fe(Ya(h)),K=h=>fe(es(h)),ce=h=>fe(ha(h)),we=h=>fe(n.Z(h));function fe(h){return h.slice().sort((t,o)=>t.line&&o.line?t.line-o.line:0)}function Te(h,t){let o=!1;if(t&&t.length)for(let f of t)f instanceof n.A?n.w(f.message):(h.fire(new n.t(new Error(f.message))),o=!0);return o}let Le;class Se extends n.E{constructor(t,o="flat"){super(),this._transitionable=new n.$(Le||(Le=new n.a0({anchor:new n.a1(n._.light.anchor),position:new n.a2(n._.light.position),color:new n.a1(n._.light.color),intensity:new n.a1(n._.light.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,f={}){this._validate(Dc,t,f)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,f){return(!f||f.validate!==!1)&&Te(this,t.call(Sr,n.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}let Fe=class extends n.E{constructor(h,t,o,f){super(),this.scope=o,this._transitionable=new n.$(new n.a0({source:new n.a1(n._.terrain.source),exaggeration:new n.a1(n._.terrain.exaggeration)}),o,f),this._transitionable.setTransitionOrValue(h,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new n.a3(h)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;let h=this._transitionable._values.exaggeration;if(!h)return null;let t=h.value.expression;if(!t)return null;let o=-1,f=-1,g=1;for(let v of t.zoomStops)g=t.evaluate(new n.a3(v)),g>.01?(o=v,f=-1):f=v;return g<.01&&o>0&&f>o?[o,f]:null}isZoomDependent(){let h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof n.a4}},je=45,Ue=65,Qe=.05;function ct(h,t,o,f){let g=n.a7(je,Ue,o),[v,b]=_t(h,f),M=1-Math.min(1,Math.exp((t-v)/(b-v)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*g*h.alpha}function _t(h,t){let o=.5/Math.tan(.5*t);return[h.range[0]+o,h.range[1]+o]}function Lt(h,t,o,f,g){let v=n.a6.vec3.transformMat4([],[t,o,f],g.mercatorFogMatrix);return ct(h,n.a6.vec3.length(v),g.pitch,g._fov)}function Ut(h,t,o,f,g,v,b){let M=[[o,f,0],[g,f,0],[g,v,0],[o,v,0]],A=Number.MAX_VALUE,O=-Number.MAX_VALUE;for(let P of M){let F=n.a6.vec3.transformMat4([],P,t),z=n.a6.vec3.length(F);A=Math.min(A,z),O=Math.max(O,z)}return[ct(h,A,b.pitch,b._fov),ct(h,O,b.pitch,b._fov)]}class $t extends n.E{constructor(t,o,f,g){super();let v=new n.a0({range:new n.a1(n._.fog.range),color:new n.a1(n._.fog.color),"high-color":new n.a1(n._.fog["high-color"]),"space-color":new n.a1(n._.fog["space-color"]),"horizon-blend":new n.a1(n._.fog["horizon-blend"]),"star-intensity":new n.a1(n._.fog["star-intensity"]),"vertical-range":new n.a1(n._.fog["vertical-range"])});this._transitionable=new n.$(v,f,new Map(g)),this.set(t,g),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new n.a8(v),this.scope=f}get state(){let t=this._transform,o=t.projection.name==="globe",f=n.a9(t.zoom),g=this.properties.get("range"),v=[.5,3];return{range:o?[n.aa(v[0],g[0],f),n.aa(v[1],g[1],f)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,f={}){if(this._validate(Sc,t,f))return;let g=n.l({},t);for(let v of Object.keys(n._.fog))g[v]===void 0&&(g[v]=n._.fog[v].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;let o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.a7(je,Ue,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?function(f,g,v){let b=n.a5.fromLngLat(g),M=v.elevation?v.elevation.getAtPointOrZero(b):0;return Lt(f,b.x,b.y,M,v)}(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];let o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ut(this.state,o,0,0,n.ab,n.ab,this._transform)}getOpacityForBounds(t,o,f,g,v){return this._transform.projection.supportsFog?Ut(this.state,t,o,f,g,v,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?_t(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;let o=[4,5,6,7];for(let f of o){let g=t.points[f],v;if(g[2]>=0)v=g;else{let b=t.points[f-4];v=n.ac(b,g,b[2]/(b[2]-g[2]))}if(Lt(this.state,v[0],v[1],0,this._transform)>=Qe)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,f){return(!f||f.validate!==!1)&&Te(this,t.call(Sr,n.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n._})))}}class Nt extends n.E{constructor(t,o,f,g){super(),this.scope=f,this._options=t,this.properties=new n.a8(o),this._transitionable=new n.$(o,f,new Map(g)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Sn,xn;class en{constructor(t,o,f,g){this.screenBounds=t,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(t,o){let f,g;if(t instanceof n.P||typeof t[0]=="number"){let v=n.P.convert(t);f=[v],g=o.isPointAboveHorizon(v)}else{let v=n.P.convert(t[0]),b=n.P.convert(t[1]);f=[v,b],g=n.ae(v,b).every(M=>o.isPointAboveHorizon(M))}return new en(f,o.getCameraPoint(),g,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){let o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],g=n.ae(o,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<f.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?g[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(g[3]=this.cameraPoint)),n.af(g,t)}bufferedCameraGeometryGlobe(t){let o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],g=n.ae(o,f,t),v=this.cameraPoint.clone();switch(3*((v.y>o.y)+(v.y>f.y))+((v.x>o.x)+(v.x>f.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(t,o,f,g=0){let v=t.queryPadding/o._pixelsPerMercatorPixel+1,b=f?this._bufferedCameraMercator(v,o):this._bufferedScreenMercator(v,o),M=t.tileID.wrap+(b.unwrapped?g:0),A=b.polygon.map(X=>n.ag(t.tileTransform,X,M));if(!n.ah(A,0,0,n.ab,n.ab))return;M=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);let O=this.screenGeometryMercator.polygon.map(X=>n.ai(t.tileTransform,X,M)),P=O.map(X=>new n.P(X[0],X[1])),F=o.getFreeCameraOptions().position||new n.a5(0,0,0),z=n.ai(t.tileTransform,F,M),U=O.map(X=>{let Z=n.a6.vec3.sub(X,X,z);return n.a6.vec3.normalize(Z,Z),new n.aj(z,Z)}),W=n.ak(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:U,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(q=n.al(A),q.min.x=n.ap(q.min.x,0,n.ab),q.min.y=n.ap(q.min.y,0,n.ab),q.max.x=n.ap(q.max.x,0,n.ab),q.max.y=n.ap(q.max.y,0,n.ab),q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:W};var q}_bufferedScreenMercator(t,o){let f=Bi(t);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[f]=g,g}}_bufferedCameraMercator(t,o){let f=Bi(t);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[f]=g,g}}_projectAndResample(t,o){let f=function(v,b){let M=n.a6.mat4.multiply([],b.pixelMatrix,b.globeMatrix),A=[0,-n.aq,0,1],O=[0,n.aq,0,1],P=[0,0,0,1];n.a6.vec4.transformMat4(A,A,M),n.a6.vec4.transformMat4(O,O,M),n.a6.vec4.transformMat4(P,P,M);let F=new n.P(A[0]/A[3],A[1]/A[3]),z=new n.P(O[0]/O[3],O[1]/O[3]),U=n.an(v,F)&&A[3]<P[3],W=n.an(v,z)&&O[3]<P[3];if(!U&&!W)return null;let q=function(le,he,ge){for(let be=1;be<le.length;be++){let ye=ti(he.pointCoordinate3D(le[be-1]).x),_e=ti(he.pointCoordinate3D(le[be]).x);if(ge<0){if(ye<_e)return{idx:be,t:-ye/(_e-1-ye)}}else if(_e<ye)return{idx:be,t:(1-ye)/(_e+1-ye)}}return null}(v,b,U?-1:1);if(!q)return null;let{idx:X,t:Z}=q,Q=X>1?Fn(v.slice(0,X),b):[],re=X<v.length?Fn(v.slice(X),b):[];Q=Q.map(le=>new n.P(ti(le.x),le.y)),re=re.map(le=>new n.P(ti(le.x),le.y));let oe=[...Q];oe.length===0&&oe.push(re[re.length-1]);let ae=n.aa(oe[oe.length-1].y,(re.length===0?Q[0]:re[0]).y,Z),ue;return ue=U?[new n.P(0,ae),new n.P(0,0),new n.P(1,0),new n.P(1,ae)]:[new n.P(1,ae),new n.P(1,1),new n.P(0,1),new n.P(0,ae)],oe.push(...ue),re.length===0?oe.push(Q[0]):oe.push(...re),{polygon:oe.map(le=>new n.a5(le.x,le.y)),unwrapped:!1}}(t,o);if(f)return f;let g=function(v,b){let M=!1,A=-1/0,O=0;for(let F=0;F<v.length-1;F++)v[F].x>A&&(A=v[F].x,O=F);for(let F=0;F<v.length-1;F++){let z=(O+F)%(v.length-1),U=v[z],W=v[z+1];Math.abs(U.x-W.x)>.5&&(U.x<W.x?(U.x+=1,z===0&&(v[v.length-1].x+=1)):(W.x+=1,z+1===v.length-1&&(v[0].x+=1)),M=!0)}let P=n.am(b.center.lng);return M&&P<Math.abs(P-1)&&v.forEach(F=>{F.x-=1}),{polygon:v,unwrapped:M}}(Fn(t,o).map(v=>new n.P(ti(v.x),v.y)),o);return{polygon:g.polygon.map(v=>new n.a5(v.x,v.y)),unwrapped:g.unwrapped}}}function Fn(h,t){return n.ao(h,o=>{let f=t.pointCoordinate3D(o);o.x=f.x,o.y=f.y},1/256)}function ti(h){return h<0?1+h%1:h%1}function Bi(h){return 100*h|0}function Yi(h,t,o,f,g){let v=function(M,A){if(M)return g(M);if(A){if(h.url&&A.tiles&&h.tiles&&delete h.tiles,A.variants){if(!Array.isArray(A.variants))return g(new Error("variants must be an array"));for(let P of A.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return g(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){A=n.l(A,P);break}}}let O=n.ar(n.l({},A,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);O.tiles=t.canonicalizeTileset(O,h.url),g(null,O)}},b=function(M,A,O){if(!M)return null;if(!A&&!O)return M;O=O||M.worldview_default;let P=Object.values(M.language||{});if(P.length===0)return null;let F=Object.values(M.worldview||{});if(F.length===0)return null;let z=P.every(W=>W===A),U=F.every(W=>W===O);return z&&U?M:A in(M.language_options||{})||O in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null}(h.data,o,f);return b?n.q.frame(()=>v(null,b)):h.url?n.n(t.transformRequest(t.normalizeSourceURL(h.url,null,o,f),n.R.Source),v):n.q.frame(()=>{let O=h,{data:M}=O,A=H_(O,["data"]);v(null,A)})}class Ai{constructor(t,o,f){this.bounds=n.as.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=f||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){let o=Math.pow(2,t.z),f=Math.floor(n.am(this.bounds.getWest())*o),g=Math.floor(n.at(this.bounds.getNorth())*o),v=Math.ceil(n.am(this.bounds.getEast())*o),b=Math.ceil(n.at(this.bounds.getSouth())*o);return t.x>=f&&t.x<v&&t.y>=g&&t.y<b}}class Ji extends n.E{constructor(t,o,f,g){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.l(this,n.ar(o,["url","scheme","tileSize","promoteId"])),this._options=n.l({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new n.au}load(t){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=Yi(this._options,this.map._requestManager,o,f,(g,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new n.t(g));else if(v){if(n.l(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(let b of v.vector_layers)this.vectorLayerIds.push(b.id),v.worldview&&v.worldview[b.source]&&this.localizableLayerIds.add(b.id)}v.bounds&&(this.tileBounds=new Ai(v.bounds,this.minzoom,this.maxzoom)),Za(v.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}t&&t(g)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}loadTile(t,o){let f=t.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(f),v=this.map._requestManager.transformRequest(g,n.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,M=b?{image:b.image.clone()}:null,A={request:v,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:M,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&n.f(f)&&(A.worldview=this.map.getWorldview()||this.worldviewDefault,A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",A,O.bind(this));else if(t.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",A,O.bind(this),void 0,!0);else{let P=n.aw.call({deduped:this._deduped},A,(F,z)=>{F||!z?O.call(this,F):(A.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},t.actor&&t.actor.send("loadTile",A,O.bind(this),void 0,!0))},!0);t.request={cancel:P}}function O(P,F){return delete t.request,t.aborted?o(null):P&&P.status!==404?o(P):(F&&F.resourceTiming&&(t.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&t.setExpiryData(F),t.loadVectorData(F,this.map.painter),n.ax(this.dispatcher),o(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ps extends n.E{constructor(t,o,f,g){super(),this.id=t,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.l({type:"raster"},o),n.l(this,n.ar(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._tileJSONRequest=Yi(this._options,this.map._requestManager,null,null,(o,f)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new n.t(o)):f&&(n.l(this,f),f.raster_layers&&(this.rasterLayers=f.raster_layers,this.rasterLayerIds=this.rasterLayers.map(g=>g.id)),f.bounds&&(this.tileBounds=new Ai(f.bounds,this.minzoom,this.maxzoom)),Za(f.tiles),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),t&&t(o)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();let t=n.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){let f=n.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);t.request=n.o(this.map._requestManager.transformRequest(g,n.R.Tile),(v,b,M,A)=>(delete t.request,t.aborted?(t.state="unloaded",o(null)):v?(t.state="errored",o(v)):b?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:M,expires:A}),t.setTexture(b,this.map.painter),t.state="loaded",n.ax(this.dispatcher),void o(null)):o(null)))}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof n.T?(t.destroy(!0),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ro extends Ps{constructor(t,o,f,g){super(t,o,f,g),this.type="raster-array",this.maxzoom=22,this._options=n.l({type:"raster-array"},o)}triggerRepaint(t){let o=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);o&&o.enabled&&f&&o._clearRenderCacheForTile(f.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){let f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(f,n.R.Tile);t.requestParams=g,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(v,b,M,A)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(v)return v.code===20?void 0:(t.state="errored",o(v));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:M,expires:A}),t.state="empty",o(null)})}unloadTile(t,o){let f=t.texture;f&&f instanceof n.T?(t.destroy(!0),this.map.painter.saveTileTexture(f)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,o,f){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(o,f,(g,v)=>{if(g)return t.state="errored",this.fire(new n.t(g)),void this.triggerRepaint(t);v&&(t.setTexture(v,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;let o=this.rasterLayers.find(({id:v})=>v===t),f=o&&o.fields,g=f&&f.bands&&f.bands;return g?g[0]:0}getTextureDescriptor(t,o,f){if(!t)return;let g=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let v=null;o instanceof n.aB?v=o.paint.get("raster-array-band"):o instanceof n.aC&&(v=o.paint.get("raster-particle-array-band"));let b=v||this.getInitialBand(g);if(b!=null)if(t.textureDescriptor){if(!t.updateNeeded(g,b)||f)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,g,b)}}let Gu={vector:Ji,raster:Ps,"raster-dem":class extends Ps{constructor(h,t,o,f){super(h,t,o,f),this.type="raster-dem",this.maxzoom=22,this._options=n.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){let o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(g,v){g&&(h.state="errored",t(g)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=n.o(this.map._requestManager.transformRequest(o,n.R.Tile),function(g,v,b,M){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(g)h.state="errored",t(g);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:b,expires:M});let A=ImageBitmap&&v instanceof ImageBitmap&&n.ay(),O=1-(v.width-n.az(v.width))/2;O<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));let P=A?v:n.q.getImageData(v,O),F={uid:h.uid,coord:h.tileID,source:this.id,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:O};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",F,f.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){let t=h.canonical,o=Math.pow(2,t.z),f=(t.x-1+o)%o,g=t.x===0?h.wrap-1:h.wrap,v=(t.x+1+o)%o,b=t.x+1===o?h.wrap+1:h.wrap,M={};return M[new n.aA(h.overscaledZ,g,t.z,f,t.y).key]={backfilled:!1},M[new n.aA(h.overscaledZ,b,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(M[new n.aA(h.overscaledZ,g,t.z,f,t.y-1).key]={backfilled:!1},M[new n.aA(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},M[new n.aA(h.overscaledZ,b,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<o&&(M[new n.aA(h.overscaledZ,g,t.z,f,t.y+1).key]={backfilled:!1},M[new n.aA(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},M[new n.aA(h.overscaledZ,b,t.z,v,t.y+1).key]={backfilled:!1}),M}},"raster-array":Ro,geojson:class extends n.E{constructor(h,t,o,f){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(f),this._data=t.data,this._options=n.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;let g=n.ab/this.tileSize;this.workerOptions=n.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*g,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*g,extent:n.ab,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.ab,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new n.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new n.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){let t=new Map;for(let o of this._data.features)t.set(o.id,o);for(let o of h.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,o,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:o},f),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.x("dataloading",{dataType:"source"})),this._loaded=!1;let t=n.l({append:h},this.workerOptions);t.scope=this.scope;let o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(n.q.resolveURL(o),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(f,g)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new n.t(f));else{let v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new n.x("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,t){let o=h.actor?"reloadTile":"loadTile";h.actor=this.actor;let f=this.map.style?this.map.style.getLut(this.scope):null,g=f?{image:f.image.clone()}:null,v=this._partialReload,b={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:v};h.request=this.actor.send(o,b,(M,A)=>v&&!A?(h.state="loaded",t(null)):(delete h.request,h.destroy(),h.aborted?t(null):M?t(M):(h.loadVectorData(A,this.map.painter,o==="reloadTile"),t(null))),void 0,o==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aD{constructor(h,t,o,f){super(h,t,o,f),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;let h=this.options;this.urls=[];for(let t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aE(this.urls,(t,o)=>{this._loaded=!0,t?this.fire(new n.t(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){let t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new n.t(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aD,model:class extends n.E{constructor(h,t,o,f){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){let h=[];for(let t in this._options.models){let o=this._options.models[t],f=n.aG(this.map._requestManager.transformRequest(o.uri,n.R.Model).url).then(g=>{if(!g)return;let v=n.aH(g),b=new n.aI(t,o.position,o.orientation,v);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(g=>{this.fire(new n.t(new Error(`Could not load model ${t} from ${o.uri}: ${g.message}`)))});h.push(f)}return Promise.allSettled(h).then(()=>{this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new n.t(new Error(`Could not load models: ${t.message}`)))})}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,t){}serialize(){return{type:"model"}}},"batched-model":class extends n.E{constructor(h,t,o,f){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(h){this.map=h,this.load()}load(h){this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"}));let t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=Yi(this._options,this.map._requestManager,t,o,(f,g)=>{this._tileJSONRequest=null,this._loaded=!0,f?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new n.t(f))):g&&(n.l(this,g),g.bounds&&(this.tileBounds=new Ai(g.bounds,this.minzoom,this.maxzoom)),Za(g.tiles,this.map._requestManager._customAccessToken),this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))),h&&h(f)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){let o=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(o,n.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){let v=Object.values(h.buckets);for(let b of v)b.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",f,g.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",f,g.bind(this),void 0,!0);function g(v,b){return h.aborted?t(null):v&&v.status!==404?t(v):(this.map._refreshExpiredTiles&&b&&h.setExpiryData(b),h.loadModelData(b,this.map.painter),h.state="loaded",void t(null))}}serialize(){return n.l({},this._options)}},canvas:class extends n.aD{constructor(h,t,o,f){super(h,t,o,f),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new n.t(new n.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.t(new n.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.t(new n.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.t(new n.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.t(new n.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof n.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends n.E{constructor(h,t,o,f){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ai(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),n.l(this,n.ar(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new n.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){let{x:t,y:o,z:f}=h.canonical;return this._implementation.hasTile({x:t,y:o,z:f})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){let{x:o,y:f,z:g}=h.tileID.canonical,v=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:o,y:f,z:g},{signal:v.signal})).then(function(b){return delete h.request,h.aborted?(h.state="unloaded",t(null)):b===void 0?(h.state="errored",t(null)):b===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement}(b)?(this.loadTileData(h,b),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(b=>{b.code!==20&&(h.state="errored",t(b))}),h.request.cancel=()=>v.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof n.T?(h.destroy(!0),h.texture&&h.texture instanceof n.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){let{x:o,y:f,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:o,y:f,z:g})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){let h=n.av(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new n.x("data",{dataType:"source",sourceDataType:"content"}))}}},Hu=function(h,t,o,f){let g=new Gu[t.type](h,t,o,f);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return n.aJ(["load","abort","unload","serialize","prepare"],g),g};function qu(h,t){let o=n.a6.mat4.identity([]);return n.a6.mat4.scale(o,o,[.5*h.width,.5*-h.height,1]),n.a6.mat4.translate(o,o,[1,-1,0]),n.a6.mat4.multiply(o,o,h.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(o)}function Jd(h,t,o,f,g,v,b,M,A=!1){let O=h.tilesIn(o,M,A);O.sort(tl);let P=[];for(let z of O)P.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,h._state,z,f,g,v,b,qu(h.transform,z.tile.tileID),A)});let F=function(z){let U={},W={};for(let q of z){let X=q.queryResults,Z=q.wrappedTileID,Q=W[Z]=W[Z]||{};for(let re in X){let oe=X[re],ae=Q[re]=Q[re]||{},ue=U[re]=U[re]||[];for(let le of oe)ae[le.featureIndex]||(ae[le.featureIndex]=!0,ue.push(le))}}return U}(P);for(let z in F)F[z].forEach(U=>{let W=U.feature,q=W.layer;q&&q.type!=="background"&&q.type!=="sky"&&q.type!=="slot"&&(n.aK(z)||(W.source=q.source,q["source-layer"]&&(W.sourceLayer=q["source-layer"])),W.state=W.id!==void 0?h.getFeatureState(q["source-layer"],W.id):{})});return F}function Kd(h,t){let o=h.getRenderableIds().map(v=>h.getTileByID(v)),f=[],g={};for(let v=0;v<o.length;v++){let b=o[v],M=b.tileID.canonical.key;g[M]||(g[M]=!0,b.querySourceFeatures(f,t))}return f}function tl(h,t){let o=h.tileID,f=t.tileID;return o.overscaledZ-f.overscaledZ||o.canonical.y-f.canonical.y||o.wrap-f.wrap||o.canonical.x-f.canonical.x}function nl(h,t){let o={};if(!t)return o;for(let f of h){let g=f.layerIds.map(v=>t.getLayer(v)).filter(Boolean);if(g.length!==0){f.layers=g,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(v=>g.filter(b=>b.id===v)[0]));for(let v of g)o[v.fqid]=f}}return o}let Yr=32,co=33,uo=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,o=0,f=0,g=0,v=0,b=0,M=0;for(1&t?g=v=b=Yr:o=f=M=Yr;(t>>=1)>1;){let O=o+g>>1,P=f+v>>1;1&t?(g=o,v=f,o=b,f=M):(o=g,f=v,g=b,v=M),b=O,M=P}let A=4*h;uo[A+0]=o,uo[A+1]=f,uo[A+2]=g,uo[A+3]=v}let xr=new Uint16Array(2178),Po=new Uint8Array(1089),Ac=new Uint16Array(1089);function Qd(h){return h===0?-.03125:h===32?.03125:0}let ef={type:2,extent:n.ab,loadGeometry:()=>[[new n.P(0,0),new n.P(n.ab+1,0),new n.P(n.ab+1,n.ab+1),new n.P(0,n.ab+1),new n.P(0,0)]]};class Oo{constructor(t,o,f,g,v){this.tileID=t,this.uid=n.aQ(),this.uses=0,this.tileSize=o,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(t){let o=t+this.timeAdded;o<n.q.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aL(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,f){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=nl(t.buckets,o.style),this.hasSymbolBuckets=!1;for(let g in this.buckets){let v=this.buckets[g];if(v instanceof n.aS){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let g in this.buckets){let v=this.buckets[g];if(v instanceof n.aS&&v.hasRTLText){this.hasRTLText=!0,n.aT();break}}this.queryPadding=0;for(let g in this.buckets){let v=this.buckets[g],b=o.style.getOwnLayer(g);if(!b)continue;let M=b.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,M)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.aR}unloadVectorData(){if(this.hasData()){for(let t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,f){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=bt(bt({},this.buckets),nl(t.buckets,o.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(let g in this.buckets){let v=this.buckets[g];v.uploadPending()&&v.upload(t)}let o=t.gl,f=this.imageAtlas;if(f&&!f.uploaded){let g=!!Object.keys(f.patternPositions).length;this.imageAtlasTexture=new n.T(t,f.image,o.RGBA8,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,f),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let g=o.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this._lastUpdatedBrightness=g,this.updateBuckets(o)))}queryRenderedFeatures(t,o,f,g,v,b,M,A,O){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:A,transform:M,filter:g,layers:v,availableImages:b,tileTransform:this.tileTransform},t,o):{}}querySourceFeatures(t,o){let f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;let g=f.loadVTLayers(),v=o?o.sourceLayer:"",b=g._geojsonTileLayer||g[v];if(!b)return;let M=n.aU(o&&o.filter),{z:A,x:O,y:P}=this.tileID.canonical,F={z:A,x:O,y:P};for(let z=0;z<b.length;z++){let U=b.feature(z);if(M.needGeometry){let X=n.aV(U,!0);if(!M.filter(new n.a3(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!M.filter(new n.a3(this.tileID.overscaledZ),U))continue;let W=f.getId(U,v),q=new n.aW(U,A,O,P,W);q.tile=F,t.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){let o=this.expirationTime;if(t.cacheControl){let f=n.aX(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){let f=Date.now(),g=!1;if(this.expirationTime>f)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{let v=this.expirationTime-o;v?this.expirationTime=f+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t){if(!this.latestFeatureIndex)return;let o=this.latestFeatureIndex.loadVTLayers(),f=t.style.listImages(),g=t.style.getBrightness();for(let v in this.buckets){if(!t.style.hasLayer(v))continue;let b=this.buckets[v],M=b.layers[0],A=M.sourceLayer||"_geojsonTileLayer",O=o[A],P=t.style.getSourceCache(M.source,M.scope),F={};P&&(F=P._state.getState(A,void 0)),b.update(F,O,f,this.imageAtlas&&this.imageAtlas.patternPositions||{},g),(b instanceof n.aY||b instanceof n.aZ)&&t._terrain&&t._terrain.enabled&&P&&b.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(P.id,this.tileID);let z=t&&t.style&&t.style.getOwnLayer(v);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.q.now()+t}setTexture(t,o){let f=o.context,g=f.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(f,t,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(t,o){let f={};for(let g of o)f[g]=!0;this.dependencies[t]=f}hasDependency(t,o){for(let f of t){let g=this.dependencies[f];if(g){for(let v of o)if(g[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;let f=n.a_(ef,this.tileID.canonical,this.tileTransform)[0],g=new n.a$,v=new n.b0;for(let b=0;b<f.length;b++){let{x:M,y:A}=f[b];g.emplaceBack(M,A),v.emplaceBack(b)}v.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(v),this._tileDebugBuffer=t.createVertexBuffer(g,n.b1.members),this._tileDebugSegments=n.b2.simpleSegment(0,0,g.length,v.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;let f=n.a_(ef,this.tileID.canonical,this.tileTransform)[0],g,v;if(this.isRaster){let b=function(M,A){let O=n.aL(M,A),P=Math.pow(2,M.z);for(let X=0;X<co;X++)for(let Z=0;Z<co;Z++){let Q=n.aM((M.x+(Z+Qd(Z))/Yr)/P),re=n.aN((M.y+(X+Qd(X))/Yr)/P),oe=A.project(Q,re),ae=X*co+Z;xr[2*ae+0]=Math.round((oe.x*O.scale-O.x)*n.ab),xr[2*ae+1]=Math.round((oe.y*O.scale-O.y)*n.ab)}Po.fill(0),Ac.fill(0);for(let X=2045;X>=0;X--){let Z=4*X,Q=uo[Z+0],re=uo[Z+1],oe=uo[Z+2],ae=uo[Z+3],ue=Q+oe>>1,le=re+ae>>1,he=ue+le-re,ge=le+Q-ue,be=re*co+Q,ye=ae*co+oe,_e=le*co+ue,Oe=Math.hypot((xr[2*be+0]+xr[2*ye+0])/2-xr[2*_e+0],(xr[2*be+1]+xr[2*ye+1])/2-xr[2*_e+1])>=16;Po[_e]=Po[_e]||(Oe?1:0),X<1022&&(Po[_e]=Po[_e]||Po[(re+ge>>1)*co+(Q+he>>1)]||Po[(ae+ge>>1)*co+(oe+he>>1)])}let F=new n.aO,z=new n.aP,U=0;function W(X,Z){let Q=Z*co+X;return Ac[Q]===0&&(F.emplaceBack(xr[2*Q+0],xr[2*Q+1],X*n.ab/Yr,Z*n.ab/Yr),Ac[Q]=++U),Ac[Q]-1}function q(X,Z,Q,re,oe,ae){let ue=X+Q>>1,le=Z+re>>1;if(Math.abs(X-oe)+Math.abs(Z-ae)>1&&Po[le*co+ue])q(oe,ae,X,Z,ue,le),q(Q,re,oe,ae,ue,le);else{let he=W(X,Z),ge=W(Q,re),be=W(oe,ae);z.emplaceBack(he,ge,be)}}return q(0,0,Yr,Yr,Yr,0),q(Yr,Yr,0,0,0,Yr),{vertices:F,indices:z}}(this.tileID.canonical,o);g=b.vertices,v=b.indices}else{g=new n.aO,v=new n.aP;for(let{x:M,y:A}of f)g.emplaceBack(M,A,0,0);let b=n.b3(g.int16,void 0,4);for(let M=0;M<b.length;M+=3)v.emplaceBack(b[M],b[M+1],b[M+2])}this._tileBoundsBuffer=t.createVertexBuffer(g,n.b4.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(v),this._tileBoundsSegments=n.b2.simpleSegment(0,0,g.length,v.length)}_makeGlobeTileDebugBuffers(t,o){let f=o.projection;if(!f||f.name!=="globe"||o.freezeTileCoverage)return;let g=this.tileID.canonical,v=n.b5(g,o),b=n.b6(v),M=n.a9(o.zoom),A;M>0&&(A=n.a6.mat4.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,g,o,b,A,M),this._makeGlobeTileDebugTextBuffer(t,g,o,b,A,M)}_globePoint(t,o,f,g,v,b,M){let A=n.b7(t,o,f);if(b){let O=1<<f.z,P=n.am(g.center.lng),F=n.at(g.center.lat),z=(f.x+.5)/O-P,U=0;z>.5?U=-1:z<-.5&&(U=1);let W=(t/n.ab+f.x)/O+U,q=(o/n.ab+f.y)/O;W=(W-P)*g._pixelsPerMercatorPixel+P,q=(q-F)*g._pixelsPerMercatorPixel+F;let X=[W*g.worldSize,q*g.worldSize,0];n.a6.vec3.transformMat4(X,X,b),A=n.b8(A,X,M)}return n.a6.vec3.transformMat4(A,A,v)}_makeGlobeTileDebugBorderBuffer(t,o,f,g,v,b){let M=new n.a$,A=new n.b0,O=new n.b9,P=(z,U,W,q,X)=>{let Z=(W-z)/(X-1),Q=(q-U)/(X-1),re=M.length;for(let oe=0;oe<X;oe++){let ae=z+oe*Z,ue=U+oe*Q;M.emplaceBack(ae,ue);let le=this._globePoint(ae,ue,o,f,g,v,b);O.emplaceBack(le[0],le[1],le[2]),A.emplaceBack(re+oe)}},F=n.ab;P(0,0,F,0,16),P(F,0,F,F,16),P(F,F,0,F,16),P(0,F,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(M,n.b1.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(O,n.ba.members),this._tileDebugSegments=n.b2.simpleSegment(0,0,M.length,A.length)}_makeGlobeTileDebugTextBuffer(t,o,f,g,v,b){let M=n.ab/4,A=new n.a$,O=new n.aP,P=new n.b9,F=25;O.reserve(32),A.reserve(F),P.reserve(F);let z=(U,W)=>F*U+W;for(let U=0;U<F;U++){let W=U*M;for(let q=0;q<F;q++){let X=q*M;A.emplaceBack(X,W);let Z=this._globePoint(X,W,o,f,g,v,b);P.emplaceBack(Z[0],Z[1],Z[2])}}for(let U=0;U<4;U++)for(let W=0;W<4;W++){let q=z(U,W),X=z(U,W+1),Z=z(U+1,W),Q=z(U+1,W+1);O.emplaceBack(q,X,Z),O.emplaceBack(Z,X,Q)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(O),this._tileDebugTextBuffer=t.createVertexBuffer(A,n.b1.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(P,n.ba.members),this._tileDebugTextSegments=n.b2.simpleSegment(0,0,F,32)}destroy(t=!1){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bb.setPbf(n.bc);class Wu extends Oo{constructor(t,o,f,g,v){super(t,o,f,g,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,o){let f=o.context,g=f.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t,{premultiply:!1}):this.texture=new n.T(f,t,g.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,o){let f=this._mrt=new n.bb(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.bd(g,(v,b,M,A)=>{if(v)o(v);else try{let O=f.getHeaderLength(b);if(O>t)return void(this.request=this.fetchHeader(O,o));f.parseHeader(b),this._isHeaderLoaded=!0;let P=0;for(let F of Object.values(f.layers))P=Math.max(P,F.dataIndex[F.dataIndex.length-1].last_byte);b.byteLength>=P&&(this.entireBuffer=b),o(null,this.entireBuffer||b,M,A)}catch(O){o(O)}}),this.request}fetchBand(t,o,f){let g=this._mrt;if(!this._isHeaderLoaded||!g)return void f(new Error("Tile header is not ready"));let v=this.actor;if(!v)return void f(new Error("Can't fetch tile band without an actor"));let b,M=(F,z)=>{b.complete(F,z),F?f(F):(this.updateTextureDescriptor(t,o),f(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(F,z)=>{if(F)return f(F);let U=v.send("decodeRasterArray",{buffer:z,task:b},M,void 0,!0);this._workQueue.push(()=>{U&&U.cancel(),b.cancel()})},O=g.getLayer(t);if(!O)return void f(new Error(`Unknown sourceLayer "${t}"`));if(O.hasDataForBand(o))return this.updateTextureDescriptor(t,o),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);let P=O.getDataRange([o]);if(b=g.createDecodingTask(P),!b||b.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(P.firstByte,P.lastByte+1));else{let F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${P.firstByte}-${P.lastByte}`}}),z=n.bd(F,A);this._fetchQueue.push(()=>{z.cancel(),b.cancel()})}else f(null)}updateNeeded(t,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,o){if(!this._mrt)return;let f=this._mrt.getLayer(t);if(!f||!f.hasBand(o)||!f.hasDataForBand(o))return;let{bytes:g,tileSize:v,buffer:b,offset:M,scale:A}=f.getBandView(o),O=v+2*b,P={data:g,width:O,height:O},F=this.texture;F&&F instanceof n.T&&F.update(P,{premultiply:!1}),this.textureDescriptor={layer:t,band:o,img:P,buffer:b,offset:M,tileSize:v,format:f.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class eg{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(let t in this.data)for(let o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,f){let g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);let v={value:o,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(t,v)},f)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){let b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){let o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){let o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;let f=t.wrapped().key,g=o===void 0?0:this.data[f].indexOf(o),v=this.data[f][g];return this.data[f].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){let o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){let o=[];for(let f in this.data)for(let g of this.data[f])t(g.value)||o.push(g);for(let f of o)this.remove(f.value.tileID,f)}}class p0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,f){let g=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},n.l(this.stateChanges[t][g],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(let v in this.state[t])v!==g&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(let v in this.state[t][g])f[v]||(this.deletedStates[t][g][v]=null)}else for(let v in f)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][v]===null&&delete this.deletedStates[t][g][v]}removeFeatureState(t,o,f){if(this.deletedStates[t]===null)return;let g=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&o!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][f]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(f in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][f]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,o){let f=this.state[t]||{},g=this.stateChanges[t]||{},v=this.deletedStates[t];if(v===null)return{};if(o!==void 0){let M=String(o),A=n.l({},f[M],g[M]);if(v){let O=v[o];if(O===null)return{};for(let P in O)delete A[P]}return A}let b=n.l({},f,g);if(v)for(let M in v)delete b[M];return b}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){let f={};for(let g in this.stateChanges){this.state[g]=this.state[g]||{};let v={};for(let b in this.stateChanges[g])this.state[g][b]||(this.state[g][b]={}),n.l(this.state[g][b],this.stateChanges[g][b]),v[b]=this.state[g][b];f[g]=v}for(let g in this.deletedStates){this.state[g]=this.state[g]||{};let v={};if(this.deletedStates[g]===null)for(let b in this.state[g])v[b]={},this.state[g][b]={};else for(let b in this.deletedStates[g]){if(this.deletedStates[g][b]===null)this.state[g][b]={};else if(this.state[g][b])for(let M of Object.keys(this.deletedStates[g][b]))delete this.state[g][b][M];v[b]=this.state[g][b]}f[g]=f[g]||{},n.l(f[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(let g in t)t[g].refreshFeatureState(o)}}class br extends n.E{constructor(t,o,f){super(),this.id=t,this._onlySymbols=f,o.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new eg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new p0,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let t in this._tiles){let o=this._tiles[t];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let o in this._tiles){let f=this._tiles[o];f.upload(t),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return n.be(this._tiles).map(t=>t.tileID).sort(Os).map(t=>t.key)}getRenderableIds(t,o){let f=[];for(let g in this._tiles)this._isIdRenderable(+g,t,o)&&f.push(this._tiles[g]);return t?f.sort((g,v)=>{let b=g.tileID,M=v.tileID,A=new n.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),O=new n.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-M.overscaledZ||O.y-A.y||O.x-A.x}).map(g=>g.tileID.key):f.map(g=>g.tileID).sort(Os).map(g=>g.key)}hasRenderableParent(t){let o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,f){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(f||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){let f=this._tiles[t];f&&(f.state!=="loading"&&(f.state=o),this._loadTile(f,this._tileLoaded.bind(this,f,t,o)))}_tileLoaded(t,o,f,g){if(g)if(t.state="errored",g.status!==404)this._source.fire(new n.t(g,{tile:t}));else{if(this._source.fire(new n.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=n.q.now(),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new n.x("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){let o=this.getRenderableIds();for(let g=0;g<o.length;g++){let v=o[g];if(t.neighboringTiles&&t.neighboringTiles[v]){let b=this.getTileByID(v);f(t,b),f(b,t)}}function f(g,v){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let b=v.tileID.canonical.x-g.tileID.canonical.x,M=v.tileID.canonical.y-g.tileID.canonical.y,A=Math.pow(2,g.tileID.canonical.z),O=v.tileID.key;b===0&&M===0||Math.abs(M)>1||(Math.abs(b)>1&&(Math.abs(b+A)===1?b+=A:Math.abs(b-A)===1&&(b-=A)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,b,M),g.neighboringTiles&&g.neighboringTiles[O]&&(g.neighboringTiles[O].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,f,g){for(let v in this._tiles){let b=this._tiles[v];if(g[v]||!b.hasData()||b.tileID.overscaledZ<=o||b.tileID.overscaledZ>f)continue;let M=b.tileID;for(;b&&b.tileID.overscaledZ>o+1;){let O=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[O.key],b&&b.hasData()&&(M=O)}let A=M;for(;A.overscaledZ>o;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){g[M.key]=M;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){let f=this._loadedParentTiles[t.key];return f&&f.tileID.overscaledZ>=o?f:null}for(let f=t.overscaledZ-1;f>=o;f--){let g=t.scaledTo(f),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(t){let o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;let f=Math.ceil(t.width/o)+1,g=Math.ceil(t.height/o)+1,v=Math.floor(f*g*5),b=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(M)}handleWrapJump(t){let o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){let f={};for(let g in this._tiles){let v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+o),f[v.tileID.key]=v}this._tiles=f;for(let g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(let g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(t,o,f,g){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};let v=this._source.type==="batched-model",b,M=this._source.maxzoom,A=this.map&&this.map.painter?this.map.painter._terrain:null;if(A&&A.sourceCache===this&&A.attenuationRange()){let F=A.attenuationRange()[0],z=Math.floor(F)-Math.log2(A.getDemUpscale());M>z&&(M=z)}if(this.used||this.usedForTerrain){if(this._source.tileID)b=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new n.aA(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y));else if(this.tileCoverLift!==0){let F=t.clone();F.tileCoverLift=this.tileCoverLift,b=F.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(b.push(new n.aA(1,0,1,0,0)),b.push(new n.aA(1,0,1,1,0)),b.push(new n.aA(1,0,1,0,1)),b.push(new n.aA(1,0,1,1,1)))}else if(b=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){let F=this._source.hasTile.bind(this._source);b=b.filter(z=>F(z))}}else b=[];if(b.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Rc(this._source.type)){let F=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),z=Math.min(F,this._source.maxzoom);if(v){let U=t.extendTileCover(b,z);for(let W of U)b.push(W)}else{let U=t.extendTileCover(b,z,g);for(let W of U)this._shadowCasterTiles[W.key]=!0,b.push(W)}}let O=this._updateRetainedTiles(b);if(Rc(this._source.type)&&b.length!==0){let F={},z={},U=Object.keys(O);for(let q of U){let X=O[q],Z=this._tiles[q];if(!Z||Z.fadeEndTime&&Z.fadeEndTime<=n.q.now())continue;let Q=this.findLoadedParent(X,Math.max(X.overscaledZ-br.maxOverzooming,this._source.minzoom));Q&&(this._addTile(Q.tileID),F[Q.tileID.key]=Q.tileID),z[q]=X}let W=b[b.length-1].overscaledZ;for(let q in this._tiles){let X=this._tiles[q];if(O[q]||!X.hasData())continue;let Z=X.tileID;for(;Z.overscaledZ>W;){Z=Z.scaledTo(Z.overscaledZ-1);let Q=this._tiles[Z.key];if(Q&&Q.hasData()&&z[Z.key]){O[q]=X.tileID;break}}}for(let q in F)O[q]||(this._coveredTiles[q]=!0,O[q]=F[q])}for(let F in O)this._tiles[F].clearFadeHold();let P=n.bf(this._tiles,O);for(let F of P){let z=this._tiles[F];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){let o={};if(t.length===0)return o;let f={},g=t.reduce((O,P)=>Math.min(O,P.overscaledZ),1/0),v=t[0].overscaledZ,b=Math.max(v-br.maxOverzooming,this._source.minzoom),M=Math.max(v+br.maxUnderzooming,this._source.minzoom),A={};for(let O of t){let P=this._addTile(O);o[O.key]=O,P.hasData()||g<this._source.maxzoom&&(A[O.key]=O)}this._retainLoadedChildren(A,g,M,o);for(let O of t){let P=this._tiles[O.key];if(P.hasData())continue;if(O.canonical.z>=this._source.maxzoom){let z=O.children(this._source.maxzoom)[0],U=this.getTile(z);if(U&&U.hasData()){o[z.key]=z;continue}}else{let z=O.children(this._source.maxzoom);if(o[z[0].key]&&o[z[1].key]&&o[z[2].key]&&o[z[3].key])continue}let F=P.wasRequested();for(let z=O.overscaledZ-1;z>=b;--z){let U=O.scaledTo(z);if(f[U.key]||(f[U.key]=!0,P=this.getTile(U),!P&&F&&(P=this._addTile(U)),P&&(o[U.key]=U,F=P.wasRequested(),P.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let t in this._tiles){let o=[],f,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){f=this._loadedParentTiles[g.key];break}o.push(g.key);let v=g.scaledTo(g.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;g=v}for(let v of o)this._loadedParentTiles[v]=f}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));let f=!!o;if(!f){let g=this.map?this.map.painter:null,v=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new Wu(t,v,this.transform.tileZoom,g,this._isRaster):new Oo(t,v,this.transform.tileZoom,g,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o?(o.uses++,this._tiles[t.key]=o,f||this._source.fire(new n.x("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);let f=o.getExpiryTimeout();f&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},f))}_removeTile(t){let o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,f){let g=[],v=this.transform;if(!v)return g;let b=v.projection.name==="globe",M=n.am(v.center.lng);for(let A in this._tiles){let O=this._tiles[A];if(f&&O.clearQueryDebugViz(),O.holdingForFade())continue;let P;if(b){let F=O.tileID.canonical;if(F.z===0){let z=[Math.abs(n.ap(M,...il(F,-1))-M),Math.abs(n.ap(M,...il(F,1))-M)];P=[0,2*z.indexOf(Math.min(...z))-1]}else{let z=[Math.abs(n.ap(M,...il(F,-1))-M),Math.abs(n.ap(M,...il(F,0))-M),Math.abs(n.ap(M,...il(F,1))-M)];P=[z.indexOf(Math.min(...z))-1]}}else P=[0];for(let F of P){let z=t.containsTile(O,v,o,F);z&&g.push(z)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){let f=this.getRenderableIds(t,o).map(v=>this._tiles[v].tileID),g=this.transform.projection.name==="globe";for(let v of f)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=g?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return f}sortCoordinatesByDistance(t){let o=t.slice(),f=this.transform._camera.position,g=this.transform._camera.forward(),v={};for(let b of o){let M=1/(1<<b.canonical.z);v[b.key]=((b.canonical.x+.5)*M+b.wrap-f[0])*g[0]+((b.canonical.y+.5)*M-f[1])*g[1]-f[2]*g[2]}return o.sort((b,M)=>v[b.key]-v[M.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(Rc(this._source.type))for(let t in this._tiles){let o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(t,o,f){this._state.updateState(t=t||"_geojsonTileLayer",o,f)}removeFeatureState(t,o,f){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,f)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,f){let g=this._tiles[t];g&&g.setDependencies(o,f)}reloadTilesForDependencies(t,o){for(let f in this._tiles)this._tiles[f].hasDependency(t,o)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(t,o))}_preloadTiles(t,o){if(!this._sourceLoaded){let A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,o))};return void this._source.on("data",A)}let f=new Map,g=Array.isArray(t)?t:[t],v=this.map.painter.terrain,b=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(let A of g){let O=A.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let P of O)f.set(P.key,P);this.usedForTerrain&&A.updateElevation(!1)}let M=Array.from(f.values());n.bg(M,(A,O)=>{let P=new Oo(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(P,F=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),O(F,P)})},o)}}function Os(h,t){let o=Math.abs(2*h.wrap)-+(h.wrap<0),f=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||f-o||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function Rc(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function il(h,t){let o=1<<h.z;return[h.x/o+t,(h.x+1)/o+t]}br.maxOverzooming=10,br.maxUnderzooming=3;class tf{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let t=!1,o=!1;for(let f in this.style._mergedLayers){let g=this.style._mergedLayers[f];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:t,visibilityChanged:o});else if(g.type==="model"){let v=this.style.getLayerSource(g);v&&v.type==="batched-model"&&this.layers.push({layer:g,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(let o of this.layers){let f=o.layer,g=!1;f.type==="fill-extrusion"?g=!f.isHidden(t)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(g=!f.isHidden(t)&&f.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!g&&o.visible,o.visible=g}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(let g of this.layers){let v=g.layer,b=this.style.getLayerSourceCache(v),M=1;v.type==="fill-extrusion"&&(M=g.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let A=b?b.getTile(o):null;if(!A&&b&&o.canonical.z>b.getSource().minzoom){let O=o.scaledTo(Math.min(b.getSource().maxzoom,o.overscaledZ-1));for(;O.overscaledZ>=b.getSource().minzoom&&(A=b.getTile(O),!A&&O.overscaledZ!==0);)O=O.scaledTo(O.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(v):null,tileID:A?A.tileID:o,verticalScale:M})}t.hasAnyZOffset=!1;let f=!1;for(let g=0;g<t.symbolInstances.length;g++){let v=t.symbolInstances.get(g),b=v.zOffset,M=this._getHeightAtTileOffset(o,v.tileAnchorX,v.tileAnchorY);v.zOffset=M!==Number.NEGATIVE_INFINITY?M:b,f||b===v.zOffset||(f=!0),t.hasAnyZOffset||v.zOffset===0||(t.hasAnyZOffset=!0)}f&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,f,g){let v=o,b=f;if(t.canonical.z!==g.canonical.z){let M=g.canonical,A=1/(1<<t.canonical.z-M.z);v=(o+t.canonical.x*n.ab)*A-M.x*n.ab|0,b=(f+t.canonical.y*n.ab)*A-M.y*n.ab|0}return{tileX:v,tileY:b}}_getHeightAtTileOffset(t,o,f){let g,v;for(let b=0;b<this.layers.length;++b){if(this.layers[b].layer.type!=="fill-extrusion")continue;let{bucket:M,tileID:A,verticalScale:O}=this.currentBuildingBuckets[b];if(!M)continue;let{tileX:P,tileY:F}=this._mapCoordToOverlappingTile(t,o,f,A),z=M.getHeightAtTileCoord(P,F);z&&z.height!==void 0&&(z.hidden?g=z.height:v=Math.max(z.height*O,v||0))}if(v!==void 0)return v;for(let b=0;b<this.layers.length;++b){let M=this.layers[b];if(M.layer.type!=="model"||!M.visible)continue;let{bucket:A,tileID:O}=this.currentBuildingBuckets[b];if(!A)continue;let{tileX:P,tileY:F}=this._mapCoordToOverlappingTile(t,o,f,O),z=A.getHeightAtTileCoord(P,F);if(z&&!z.hidden)return z.height===void 0&&g!==void 0?Math.min(z.maxHeight,g)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function rl(h,t){let o={};for(let f in h)f!=="ref"&&(o[f]=h[f]);return n.bh.forEach(f=>{f in t&&(o[f]=t[f])}),o}function nf(h){h=h.slice();let t=Object.create(null);for(let o=0;o<h.length;o++)t[h[o].id]=h[o];for(let o=0;o<h.length;o++)"ref"in h[o]&&(h[o]=rl(h[o],t[h[o].ref]));return h}let bn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function rf(h,t,o){o.push({command:bn.addSource,args:[h,t[h]]})}function On(h,t,o){t.push({command:bn.removeSource,args:[h]}),o[h]=!0}function m0(h,t,o,f){On(h,o,f),rf(h,t,o)}function Rt(h,t,o){let f;for(f in h[o])if(h[o].hasOwnProperty(f)&&f!=="data"&&!n.bi(h[o][f],t[o][f]))return!1;for(f in t[o])if(t[o].hasOwnProperty(f)&&f!=="data"&&!n.bi(h[o][f],t[o][f]))return!1;return!0}function Pc(h,t,o,f,g,v){let b;for(b in t=t||{},h=h||{})h.hasOwnProperty(b)&&(n.bi(h[b],t[b])||o.push({command:v,args:[f,b,t[b],g]}));for(b in t)t.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(n.bi(h[b],t[b])||o.push({command:v,args:[f,b,t[b],g]}))}function pa(h){return h.id}function ol(h,t){return h[t.id]=t,h}class ho{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.ap(t,0,1);let o=1,f=this._distances[o],g=t*this.paddedLength+this.padding;for(;f<g&&o<this._distances.length;)f=this._distances[++o];let v=o-1,b=this._distances[v],M=f-b,A=M>0?(g-b)/M:0;return this.points[v].mult(1-A).add(this.points[o].mult(A))}}class Zu{constructor(t,o,f){let g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(o/f);for(let b=0;b<this.xCellCount*this.yCellCount;b++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,f,g,v){this._forEachCell(o,f,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(t,o,f,g){this._forEachCell(o-g,f-g,o+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(f),this.circles.push(g)}_insertBoxCell(t,o,f,g,v,b){this.boxCells[v].push(b)}_insertCircleCell(t,o,f,g,v,b){this.circleCells[v].push(b)}_query(t,o,f,g,v,b){if(f<0||t>this.width||g<0||o>this.height)return!v&&[];let M=[];if(t<=0&&o<=0&&this.width<=f&&this.height<=g){if(v)return!0;for(let A=0;A<this.boxKeys.length;A++)M.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){let O=this.circles[3*A],P=this.circles[3*A+1],F=this.circles[3*A+2];M.push({key:this.circleKeys[A],x1:O-F,y1:P-F,x2:O+F,y2:P+F})}return b?M.filter(b):M}return this._forEachCell(t,o,f,g,this._queryCell,M,{hitTest:v,seenUids:{box:{},circle:{}}},b),v?M.length>0:M}_queryCircle(t,o,f,g,v){let b=t-f,M=t+f,A=o-f,O=o+f;if(M<0||b>this.width||O<0||A>this.height)return!g&&[];let P=[];return this._forEachCell(b,A,M,O,this._queryCellCircle,P,{hitTest:g,circle:{x:t,y:o,radius:f},seenUids:{box:{},circle:{}}},v),g?P.length>0:P}query(t,o,f,g,v){return this._query(t,o,f,g,!1,v)}hitTest(t,o,f,g,v){return this._query(t,o,f,g,!0,v)}hitTestCircle(t,o,f,g){return this._queryCircle(t,o,f,!0,g)}_queryCell(t,o,f,g,v,b,M,A){let O=M.seenUids,P=this.boxCells[v];if(P!==null){let z=this.bboxes;for(let U of P)if(!O.box[U]){O.box[U]=!0;let W=4*U;if(t<=z[W+2]&&o<=z[W+3]&&f>=z[W+0]&&g>=z[W+1]&&(!A||A(this.boxKeys[U]))){if(M.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[U],x1:z[W],y1:z[W+1],x2:z[W+2],y2:z[W+3]})}}}let F=this.circleCells[v];if(F!==null){let z=this.circles;for(let U of F)if(!O.circle[U]){O.circle[U]=!0;let W=3*U;if(this._circleAndRectCollide(z[W],z[W+1],z[W+2],t,o,f,g)&&(!A||A(this.circleKeys[U]))){if(M.hitTest)return b.push(!0),!0;{let q=z[W],X=z[W+1],Z=z[W+2];b.push({key:this.circleKeys[U],x1:q-Z,y1:X-Z,x2:q+Z,y2:X+Z})}}}}}_queryCellCircle(t,o,f,g,v,b,M,A){let O=M.circle,P=M.seenUids,F=this.boxCells[v];if(F!==null){let U=this.bboxes;for(let W of F)if(!P.box[W]){P.box[W]=!0;let q=4*W;if(this._circleAndRectCollide(O.x,O.y,O.radius,U[q+0],U[q+1],U[q+2],U[q+3])&&(!A||A(this.boxKeys[W])))return b.push(!0),!0}}let z=this.circleCells[v];if(z!==null){let U=this.circles;for(let W of z)if(!P.circle[W]){P.circle[W]=!0;let q=3*W;if(this._circlesCollide(U[q],U[q+1],U[q+2],O.x,O.y,O.radius)&&(!A||A(this.circleKeys[W])))return b.push(!0),!0}}}_forEachCell(t,o,f,g,v,b,M,A){let O=this._convertToXCellCoord(t),P=this._convertToYCellCoord(o),F=this._convertToXCellCoord(f),z=this._convertToYCellCoord(g);for(let U=O;U<=F;U++)for(let W=P;W<=z;W++)if(v.call(this,t,o,f,g,this.xCellCount*W+U,b,M,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,f,g,v,b){let M=g-t,A=v-o,O=f+b;return O*O>M*M+A*A}_circleAndRectCollide(t,o,f,g,v,b,M){let A=(b-g)/2,O=Math.abs(t-(g+A));if(O>A+f)return!1;let P=(M-v)/2,F=Math.abs(o-(v+P));if(F>P+f)return!1;if(O<=A||F<=P)return!0;let z=O-A,U=F-P;return z*z+U*U<=f*f}}let fo={unknown:0,flipRequired:1,flipNotRequired:2},gt=Math.tan(85*Math.PI/180);function pn(h,t,o,f,g,v,b){let M=n.a6.mat4.create();if(o)if(v.name==="globe"){let A=n.bj(g,t);n.a6.mat4.multiply(M,M,A)}else{let A=n.a6.mat2.invert([],b);M[0]=A[0],M[1]=A[1],M[4]=A[2],M[5]=A[3],f||n.a6.mat4.rotateZ(M,M,g.angle)}else n.a6.mat4.multiply(M,g.labelPlaneMatrix,h);return M}function mn(h,t,o,f,g,v,b){let M=pn(h,t,o,f,g,v,b);return v.name==="globe"&&o||(M[2]=M[6]=M[10]=M[14]=0),M}function wr(h,t,o,f,g,v,b){if(o){if(v.name==="globe"){let M=pn(h,t,o,f,g,v,b);return n.a6.mat4.invert(M,M),n.a6.mat4.multiply(M,h,M),M}{let M=n.a6.mat4.clone(h),A=n.a6.mat4.identity([]);return A[0]=b[0],A[1]=b[1],A[4]=b[2],A[5]=b[3],n.a6.mat4.multiply(M,M,A),f||n.a6.mat4.rotateZ(M,M,-g.angle),M}}return g.glCoordMatrix}function lr(h,t,o,f){let g=[h,t,o,1];o?n.a6.vec4.transformMat4(g,g,f):Yu(g,g,f);let v=g[3];return g[0]/=v,g[1]/=v,g[2]/=v,g}function yn(h,t){return Math.min(.5+h/t*.5,1.5)}function Xu(h,t){let o=h[0]/h[3],f=h[1]/h[3];return o>=-t[0]&&o<=t[0]&&f>=-t[1]&&f<=t[1]}function sl(h,t,o,f,g,v,b,M,A,O){let P=o.transform,F=f?h.textSizeData:h.iconSizeData,z=n.bk(F,o.transform.zoom),U=P.projection.name==="globe",W=[256/o.width*2+1,256/o.height*2+1],q=f?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;q.clear();let X=null;U&&(X=f?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);let Z=h.lineVertexArray,Q=f?h.text.placedSymbolArray:h.icon.placedSymbolArray,re=o.transform.width/o.transform.height,oe,ae=!1;for(let ue=0;ue<Q.length;ue++){let le=Q.get(ue),{numGlyphs:he,writingMode:ge}=le;if(ge!==n.bl.vertical||ae||oe===n.bl.horizontal||(ae=!0),oe=ge,(le.hidden||ge===n.bl.vertical)&&!ae){ko(he,q);continue}ae=!1;let be=new n.P(le.tileAnchorX,le.tileAnchorY),{x:ye,y:_e,z:Oe}=P.projection.projectTilePoint(be.x,be.y,O.canonical);if(A){let[Ge,at,vt]=A(be);ye+=Ge,_e+=at,Oe+=vt}let Ve=[ye,_e,Oe,1];if(n.a6.vec4.transformMat4(Ve,Ve,t),!Xu(Ve,W)){ko(he,q);continue}let Ze=Ve[3],Ke=yn(o.transform.getCameraToCenterDistance(P.projection),Ze),nt=n.bm(F,z,le),Ce=b?nt/Ke:nt*Ke,qe=lr(ye,_e,Oe,g);if(qe[3]<=0){ko(he,q);continue}let ke={},We=b?null:A,Xe=_i(le,Ce,!1,M,t,g,v,h.glyphOffsetArray,Z,q,X,qe,be,ke,re,We,P.projection,O,b);ae=Xe.useVertical,We&&Xe.needsFlipping&&(ke={}),(Xe.notEnoughRoom||ae||Xe.needsFlipping&&_i(le,Ce,!0,M,t,g,v,h.glyphOffsetArray,Z,q,X,qe,be,ke,re,We,P.projection,O,b).notEnoughRoom)&&ko(he,q)}f?(h.text.dynamicLayoutVertexBuffer.updateData(q),X&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(X)):(h.icon.dynamicLayoutVertexBuffer.updateData(q),X&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(X))}function al(h,t,o,f,g,v,b,M,A,O,P,F,z,U,W,q){let{lineStartIndex:X,glyphStartIndex:Z,segment:Q}=M,re=Z+M.numGlyphs,oe=X+M.lineLength,ae=t.getoffsetX(Z),ue=t.getoffsetX(re-1),le=cl(h*ae,o,f,g,v,b,Q,X,oe,A,O,P,F,z,!0,U,W,q);if(!le)return null;let he=cl(h*ue,o,f,g,v,b,Q,X,oe,A,O,P,F,z,!0,U,W,q);return he?{first:le,last:he}:null}function dr(h,t,o,f){return h===n.bl.horizontal&&Math.abs(f)>Math.abs(o)?{useVertical:!0}:h===n.bl.vertical?f>0?{needsFlipping:!0}:null:t!==fo.unknown&&function(g,v){return g===0||Math.abs(v/g)>gt}(o,f)?t===fo.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function _i(h,t,o,f,g,v,b,M,A,O,P,F,z,U,W,q,X,Z,Q){let re=t/24,oe=h.lineOffsetX*re,ae=h.lineOffsetY*re,{lineStartIndex:ue,glyphStartIndex:le,numGlyphs:he,segment:ge,writingMode:be,flipState:ye}=h,_e=ue+h.lineLength,Oe=Ve=>{if(P){let[Ce,qe,ke]=Ve.up,We=O.length;n.bn(P,We+0,Ce,qe,ke),n.bn(P,We+1,Ce,qe,ke),n.bn(P,We+2,Ce,qe,ke),n.bn(P,We+3,Ce,qe,ke)}let[Ze,Ke,nt]=Ve.point;n.bo(O,Ze,Ke,nt,Ve.angle)};if(he>1){let Ve=al(re,M,oe,ae,o,F,z,h,A,v,U,q,!1,X,Z,Q);if(!Ve)return{notEnoughRoom:!0};if(f&&!o){let[Ze,Ke,nt]=Ve.first.point,[Ce,qe,ke]=Ve.last.point;[Ze,Ke]=lr(Ze,Ke,nt,b),[Ce,qe]=lr(Ce,qe,ke,b);let We=dr(be,ye,(Ce-Ze)*W,qe-Ke);if(h.flipState=We&&We.needsFlipping?fo.flipRequired:fo.flipNotRequired,We)return We}Oe(Ve.first);for(let Ze=le+1;Ze<le+he-1;Ze++){let Ke=cl(re*M.getoffsetX(Ze),oe,ae,o,F,z,ge,ue,_e,A,v,U,q,!1,!1,X,Z,Q);if(!Ke)return O.length-=4*(Ze-le),{notEnoughRoom:!0};Oe(Ke)}Oe(Ve.last)}else{if(f&&!o){let Ze=lr(z.x,z.y,0,g),Ke=ue+ge+1,nt=new n.P(A.getx(Ke),A.gety(Ke)),Ce=lr(nt.x,nt.y,0,g),qe=Ce[3]>0?Ce:ll(z,nt,Ze,1,g,void 0,X,Z.canonical),ke=dr(be,ye,(qe[0]-Ze[0])*W,qe[1]-Ze[1]);if(h.flipState=ke&&ke.needsFlipping?fo.flipRequired:fo.flipNotRequired,ke)return ke}let Ve=cl(re*M.getoffsetX(le),oe,ae,o,F,z,ge,ue,_e,A,v,U,q,!1,!1,X,Z,Q);if(!Ve)return{notEnoughRoom:!0};Oe(Ve)}return{}}function tg(h,t,o,f,g){let{x:v,y:b,z:M}=f.projectTilePoint(h.x,h.y,t);if(!g)return lr(v,b,M,o);let[A,O,P]=g(h);return lr(v+A,b+O,M+P,o)}function ll(h,t,o,f,g,v,b,M){let A=tg(h.sub(t)._unit()._add(h),M,g,b,v);return n.a6.vec3.sub(A,o,A),n.a6.vec3.normalize(A,A),n.a6.vec3.scaleAndAdd(A,o,A,f)}function cl(h,t,o,f,g,v,b,M,A,O,P,F,z,U,W,q,X,Z){let Q=f?h-t:h+t,re=Q>0?1:-1,oe=0;f&&(re*=-1,oe=Math.PI),re<0&&(oe+=Math.PI);let ae=M+b+(re>0?0:1)|0,ue=g,le=g,he=0,ge=0,be=Math.abs(Q),ye=[],_e=[],Oe=v,Ve=Oe,Ze=()=>ll(Ve,Oe,le,be-he+1,P,z,q,X.canonical);for(;he+ge<=be;){if(ae+=re,ae<M||ae>=A)return null;if(le=ue,Ve=Oe,ye.push(le),U&&_e.push(Ve),Oe=new n.P(O.getx(ae),O.gety(ae)),ue=F[ae],!ue){let at=tg(Oe,X.canonical,P,q,z);ue=at[3]>0?F[ae]=at:Ze()}he+=ge,ge=n.a6.vec3.distance(le,ue)}W&&z&&(F[ae]&&(ue=Ze(),ge=n.a6.vec3.distance(le,ue)),F[ae]=ue);let Ke=(be-he)/ge,nt=Oe.sub(Ve)._mult(Ke)._add(Ve),Ce=n.a6.vec3.sub([],ue,le),qe=n.a6.vec3.scaleAndAdd([],le,Ce,Ke),ke=[0,0,1],We=Ce[0],Xe=Ce[1];if(Z&&(ke=q.upVector(X.canonical,nt.x,nt.y),ke[0]!==0||ke[1]!==0||ke[2]!==1)){let at=[ke[2],0,-ke[0]],vt=n.a6.vec3.cross([],ke,at);n.a6.vec3.normalize(at,at),n.a6.vec3.normalize(vt,vt),We=n.a6.vec3.dot(Ce,at),Xe=n.a6.vec3.dot(Ce,vt)}if(o){let at=n.a6.vec3.cross([],ke,Ce);n.a6.vec3.normalize(at,at),n.a6.vec3.scaleAndAdd(qe,qe,at,o*re)}let Ge=oe+Math.atan2(Xe,We);return ye.push(qe),U&&_e.push(nt),{point:qe,angle:Ge,path:ye,tilePath:_e,up:ke}}function ko(h,t){let o=t.length,f=o+4*h;t.resize(f),t.float32.fill(-1/0,4*o,4*f)}function Yu(h,t,o){let f=t[0],g=t[1];return h[0]=o[0]*f+o[4]*g+o[12],h[1]=o[1]*f+o[5]*g+o[13],h[3]=o[3]*f+o[7]*g+o[15],h}let Ar=100;class cr{constructor(t,o,f=new Zu(t.width+200,t.height+200,25),g=new Zu(t.width+200,t.height+200,25)){this.transform=t,this.grid=f,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ar,this.screenBottomBoundary=t.height+Ar,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,f,g,v,b,M,A){let O=f.projectedAnchorX,P=f.projectedAnchorY,F=f.projectedAnchorZ,z=f.elevation,U=f.tileID,W=t.getProjection();if(z&&U){let[ue,le,he]=W.upVector(U.canonical,f.tileAnchorX,f.tileAnchorY),ge=W.upVectorScale(U.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=ue*z*ge,P+=le*z*ge,F+=he*z*ge}let q=this.projectAndGetPerspectiveRatio(M,O,P,F,f.tileID,W.name==="globe"||!!z||this.transform.pitch>0,W),X=b*q.perspectiveRatio,Z=(f.x1*o+g.x-f.padding)*X+q.point.x,Q=(f.y1*o+g.y-f.padding)*X+q.point.y,re=(f.x2*o+g.x+f.padding)*X+q.point.x,oe=(f.y2*o+g.y+f.padding)*X+q.point.y,ae=q.perspectiveRatio<=.55||q.occluded;return!this.isInsideGrid(Z,Q,re,oe)||!v&&this.grid.hitTest(Z,Q,re,oe,A)||ae?{box:[],offscreen:!1,occluded:q.occluded}:{box:[Z,Q,re,oe],offscreen:this.isOffscreen(Z,Q,re,oe),occluded:!1}}placeCollisionCircles(t,o,f,g,v,b,M,A,O,P,F,z,U,W,q){let X=[],Z=this.transform.elevation,Q=t.getProjection(),re=Z?Z.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,Q):null,oe=new n.P(f.tileAnchorX,f.tileAnchorY),{x:ae,y:ue,z:le}=Q.projectTilePoint(oe.x,oe.y,q.canonical);if(re){let[nt,Ce,qe]=re(oe);ae+=nt,ue+=Ce,le+=qe}let he=Q.name==="globe",ge=this.projectAndGetPerspectiveRatio(M,ae,ue,le,q,he||!!Z||this.transform.pitch>0,Q),{perspectiveRatio:be}=ge,ye=(F?b/be:b*be)/n.br,_e=lr(ae,ue,le,A),Oe=ge.signedDistanceFromCamera>0?al(ye,v,f.lineOffsetX*ye,f.lineOffsetY*ye,!1,_e,oe,f,g,A,{},Z&&!F?re:null,F&&!!Z,Q,q,F):null,Ve=!1,Ze=!1,Ke=!0;if(Oe&&!ge.occluded){let nt=.5*U*be+W,Ce=new n.P(-100,-100),qe=new n.P(this.screenRightBoundary,this.screenBottomBoundary),ke=new ho,{first:We,last:Xe}=Oe,Ge=We.path.length,at=[];for(let pt=Ge-1;pt>=1;pt--)at.push(We.path[pt]);for(let pt=1;pt<Xe.path.length;pt++)at.push(Xe.path[pt]);let vt=2.5*nt;O&&(at=at.map(([pt,Tt,ut],Mt)=>(re&&!he&&(ut=re(Mt<Ge-1?We.tilePath[Ge-1-Mt]:Xe.tilePath[Mt-Ge+2])[2]),lr(pt,Tt,ut,O))),at.some(pt=>pt[3]<=0)&&(at=[]));let Et=[];if(at.length>0){let pt=1/0,Tt=-1/0,ut=1/0,Mt=-1/0;for(let Ht of at)pt=Math.min(pt,Ht[0]),ut=Math.min(ut,Ht[1]),Tt=Math.max(Tt,Ht[0]),Mt=Math.max(Mt,Ht[1]);Tt>=Ce.x&&pt<=qe.x&&Mt>=Ce.y&&ut<=qe.y&&(Et=[at.map(Ht=>new n.P(Ht[0],Ht[1]))],(pt<Ce.x||Tt>qe.x||ut<Ce.y||Mt>qe.y)&&(Et=n.bp(Et,Ce.x,Ce.y,qe.x,qe.y)))}for(let pt of Et){ke.reset(pt,.25*nt);let Tt=0;Tt=ke.length<=.5*nt?1:Math.ceil(ke.paddedLength/vt)+1;for(let ut=0;ut<Tt;ut++){let Mt=ut/Math.max(Tt-1,1),Ht=ke.lerp(Mt),cn=Ht.x+Ar,Vn=Ht.y+Ar;X.push(cn,Vn,nt,0);let vn=cn-nt,Zn=Vn-nt,In=cn+nt,jn=Vn+nt;if(Ke=Ke&&this.isOffscreen(vn,Zn,In,jn),Ze=Ze||this.isInsideGrid(vn,Zn,In,jn),!o&&this.grid.hitTestCircle(cn,Vn,nt,z)&&(Ve=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!P&&Ve||!Ze?[]:X,offscreen:Ke,collisionDetected:Ve,occluded:ge.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let o=[],f=1/0,g=1/0,v=-1/0,b=-1/0;for(let P of t){let F=new n.P(P.x+Ar,P.y+Ar);f=Math.min(f,F.x),g=Math.min(g,F.y),v=Math.max(v,F.x),b=Math.max(b,F.y),o.push(F)}let M=this.grid.query(f,g,v,b).concat(this.ignoredGrid.query(f,g,v,b)),A={},O={};for(let P of M){let F=P.key;if(A[F.bucketInstanceId]===void 0&&(A[F.bucketInstanceId]={}),A[F.bucketInstanceId][F.featureIndex])continue;let z=[new n.P(P.x1,P.y1),new n.P(P.x2,P.y1),new n.P(P.x2,P.y2),new n.P(P.x1,P.y2)];n.bq(o,z)&&(A[F.bucketInstanceId][F.featureIndex]=!0,O[F.bucketInstanceId]===void 0&&(O[F.bucketInstanceId]=[]),O[F.bucketInstanceId].push(F.featureIndex))}return O}insertCollisionBox(t,o,f,g,v){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,f,g,v){let b=o?this.ignoredGrid:this.grid,M={bucketInstanceId:f,featureIndex:g,collisionGroupID:v};for(let A=0;A<t.length;A+=4)b.insertCircle(M,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,o,f,g,v,b,M){let A=[o,f,g,1],O=!1;g||this.transform.pitch>0?(n.a6.vec4.transformMat4(A,A,t),this.fogState&&v&&M.name!=="globe"&&(O=function(z,U,W,q,X,Z){let Q=Z.calculateFogTileMatrix(X),re=[U,W,q];return n.a6.vec3.transformMat4(re,re,Q),ct(z,n.a6.vec3.length(re),Z.pitch,Z._fov)}(this.fogState,o,f,g,v.toUnwrapped(),this.transform)>.9)):Yu(A,A,t);let P=A[3];return{point:new n.P((A[0]/P+1)/2*this.transform.width+Ar,(-A[1]/P+1)/2*this.transform.height+Ar),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/P*.5,1.5),signedDistanceFromCamera:P,occluded:b&&A[2]>P||O}}isOffscreen(t,o,f,g){return f<Ar||t>=this.screenRightBoundary||g<Ar||o>this.screenBottomBoundary}isInsideGrid(t,o,f,g){return f>=0&&t<this.gridRightBoundary&&g>=0&&o<this.gridBottomBoundary}getViewportMatrix(){let t=n.a6.mat4.identity([]);return n.a6.mat4.translate(t,t,[-100,-100,0]),t}}function fr(h,t,o){let f=t.createTileMatrix(h,h.worldSize,o.toUnwrapped());return n.a6.mat4.multiply(new Float32Array(16),h.projMatrix,f)}function ng(h,t,o){if(t.projection.name===o.projection.name)return h.projMatrix;let f=o.clone();return f.setProjection(t.projection),fr(f,t.getProjection(),h)}function ks(h,t,o){return t.name===o.projection.name?h.projMatrix:fr(o,t,h)}class Ci{constructor(t,o,f,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class pr{constructor(t,o,f,g,v,b=!1){this.text=new Ci(t?t.text:null,o,f,v),this.icon=new Ci(t?t.icon:null,o,g,v),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class po{constructor(t,o,f,g=!1){this.text=t,this.icon=o,this.skipFade=f,this.clipped=g}}class Vi{constructor(){this.invProjMatrix=n.a6.mat4.create(),this.viewportMatrix=n.a6.mat4.create(),this.circles=[]}}class of{constructor(t,o,f,g,v){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=v}}class mo{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:f=>f.collisionGroupID===o}}return this.collisionGroups[t]}}function ul(h,t,o,f,g){let{horizontalAlign:v,verticalAlign:b}=n.by(h),M=-(v-.5)*t,A=-(b-.5)*o,O=n.bx(h,f);return new n.P(M+O[0]*g,A+O[1]*g)}function ma(h,t,o,f,g){let v=new n.P(h,t);return o&&v._rotate(f?g:-g),v}class ga{constructor(t,o,f,g,v,b){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new cr(this.transform,v),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new mo(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,f,g,v=1){let b=f.getBucket(o),M=f.latestFeatureIndex;if(!b||!M||o.fqid!==b.layerIds[0])return;let A=b.layers[0].layout,O=b.layers[0].paint,P=f.collisionBoxArray,F=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),z=f.tileSize/n.ab,U=f.tileID.toUnwrapped();this.transform.setProjection(b.projection);let W=(q=f.tileID,X=b.getProjection(),Z=this.transform,X.name===this.projection?Z.calculateProjMatrix(q.toUnwrapped()):fr(Z,X,q));var q,X,Z;let Q=A.get("text-pitch-alignment")==="map",re=A.get("text-rotation-alignment")==="map";o.compileFilter(o.options);let oe=o.dynamicFilter(),ae=o.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(f),le=mn(W,f.tileID.canonical,Q,re,this.transform,b.getProjection(),ue),he=null;if(Q){let Ze=wr(W,f.tileID.canonical,Q,re,this.transform,b.getProjection(),ue);he=n.a6.mat4.multiply([],this.transform.labelPlaneMatrix,Ze)}let ge=null;oe&&f.latestFeatureIndex&&(ge={unwrappedTileID:U,dynamicFilter:oe,dynamicFilterNeedsFeature:ae}),this.retainedQueryData[b.bucketInstanceId]=new of(b.bucketInstanceId,M,b.sourceLayerIndex,b.index,f.tileID);let be=b.layers[0].layout.get("text-size-scale-range"),ye=n.ap(v,be[0],be[1]),_e=b.layers[0].layout.get("icon-size-scale-range"),Oe=n.ap(v,_e[0],_e[1]),Ve={bucket:b,layout:A,paint:O,posMatrix:W,textLabelPlaneMatrix:le,labelToScreenMatrix:he,clippingData:ge,scale:F,textPixelRatio:z,holdingForFade:f.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:n.bk(b.textSizeData,this.transform.zoom,ye),partiallyEvaluatedIconSize:n.bk(b.iconSizeData,this.transform.zoom,Oe),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(g)for(let Ze of b.sortKeyRanges){let{sortKey:Ke,symbolInstanceStart:nt,symbolInstanceEnd:Ce}=Ze;t.push({sortKey:Ke,symbolInstanceStart:nt,symbolInstanceEnd:Ce,parameters:Ve})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ve})}attemptAnchorPlacement(t,o,f,g,v,b,M,A,O,P,F,z,U,W,q,X,Z,Q){let{textOffset0:re,textOffset1:oe,crossTileID:ae}=z,ue=[re,oe],le=ul(t,f,g,ue,v),he=this.collisionIndex.placeCollisionBox(W,v,o,ma(le.x,le.y,b,M,this.transform.angle),F,A,O,P.predicate);if(X){let ge=W.getSymbolInstanceIconSize(Q,this.transform.zoom,z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(W,ge,X,ma(le.x,le.y,b,M,this.transform.angle),F,A,O,P.predicate).box.length===0)return}if(he.box.length>0){let ge;return this.prevPlacement&&this.prevPlacement.variableOffsets[ae]&&this.prevPlacement.placements[ae]&&this.prevPlacement.placements[ae].text&&(ge=this.prevPlacement.variableOffsets[ae].anchor),this.variableOffsets[ae]={textOffset:ue,width:f,height:g,anchor:t,textScale:v,prevAnchor:ge},this.markUsedJustification(W,t,z,q),W.allowVerticalPlacement&&(this.markUsedOrientation(W,q,z),this.placedOrientations[ae]=q),{shift:le,placedGlyphBoxes:he}}}placeLayerBucketPart(t,o,f,g,v=1){let{bucket:b,layout:M,paint:A,posMatrix:O,textLabelPlaneMatrix:P,labelToScreenMatrix:F,clippingData:z,textPixelRatio:U,holdingForFade:W,collisionBoxArray:q,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:Z,collisionGroup:Q,latestFeatureIndex:re}=t.parameters,oe=M.get("text-optional"),ae=M.get("icon-optional"),ue=M.get("text-allow-overlap"),le=M.get("icon-allow-overlap"),he=M.get("text-rotation-alignment")==="map",ge=M.get("text-pitch-alignment")==="map",be=M.get("symbol-z-elevate"),ye=A.get("symbol-z-offset"),_e=M.get("symbol-elevation-reference")==="sea",Oe=M.get("text-size-scale-range"),Ve=M.get("icon-size-scale-range"),Ze=n.ap(v,Oe[0],Oe[1]),Ke=n.ap(v,Ve[0],Ve[1]);this.transform.setProjection(b.projection);let nt=ue&&(le||!b.hasIconData()||ae),Ce=le&&(ue||!b.hasTextData()||oe),qe=!ye.isConstant();!b.collisionArrays&&q&&b.deserializeCollisionBoxes(q),f&&g&&b.updateCollisionDebugBuffers(this.transform.zoom,q,Ze,Ke);let ke=(We,Xe,Ge)=>{let{crossTileID:at,numVerticalGlyphVertices:vt}=We,Et=null;if(z&&z.dynamicFilterNeedsFeature||qe){let gn=this.retainedQueryData[b.bucketInstanceId];Et=re.loadFeature({featureIndex:We.featureIndex,bucketIndex:gn.bucketIndex,sourceLayerIndex:gn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(z&&!(0,z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Et,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new n.P(We.tileAnchorX,We.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[at]=new po(!1,!1,!1,!0),void o.add(at);let pt=ye.evaluate(Et,{});if(o.has(at))return;if(W)return void(this.placements[at]=new po(!1,!1,!1));let Tt=!1,ut=!1,Mt=!0,Ht=!1,cn=!1,Vn=null,vn={box:null,offscreen:null,occluded:null},Zn={box:null,offscreen:null,occluded:null},In=null,jn=null,nn=null,Nn=0,Ln=0,Cn=0;Ge.textFeatureIndex?Nn=Ge.textFeatureIndex:We.useRuntimeCollisionCircles&&(Nn=We.featureIndex),Ge.verticalTextFeatureIndex&&(Ln=Ge.verticalTextFeatureIndex);let ni=gn=>{gn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;let un=this.transform.elevation;gn.elevation=_e?pt:pt+(un?un.getAtTileOffset(gn.tileID,gn.tileAnchorX,gn.tileAnchorY):0),gn.elevation+=We.zOffset},Ri=Ge.textBox;if(Ri){ni(Ri);let gn=Tn=>{let qn=n.bl.horizontal;if(b.allowVerticalPlacement&&!Tn&&this.prevPlacement){let mi=this.prevPlacement.placedOrientations[at];mi&&(this.placedOrientations[at]=mi,qn=mi,this.markUsedOrientation(b,qn,We))}return qn},un=(Tn,qn)=>{if(b.allowVerticalPlacement&&vt>0&&Ge.verticalTextBox){for(let mi of b.writingModes)if(mi===n.bl.vertical?(vn=qn(),Zn=vn):vn=Tn(),vn&&vn.box&&vn.box.length)break}else vn=Tn()};if(M.get("text-variable-anchor")){let Tn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[at]){let ii=this.prevPlacement.variableOffsets[at];Tn.indexOf(ii.anchor)>0&&(Tn=Tn.filter(ji=>ji!==ii.anchor),Tn.unshift(ii.anchor))}let qn=(ii,ji,zo)=>{let Ir=b.getSymbolInstanceTextSize(X,We,this.transform.zoom,Xe),Tr=(ii.x2-ii.x1)*Ir+2*ii.padding,Kr=(ii.y2-ii.y1)*Ir+2*ii.padding,yo=We.hasIconTextFit&&!le?ji:null;yo&&ni(yo);let Cr={box:[],offscreen:!1,occluded:!1},fs=ue?2*Tn.length:Tn.length;for(let Qr=0;Qr<fs;++Qr){let An=this.attemptAnchorPlacement(Tn[Qr%Tn.length],ii,Tr,Kr,Ir,he,ge,U,O,Q,Qr>=Tn.length,We,Xe,b,zo,yo,X,Z);if(An&&(Cr=An.placedGlyphBoxes,Cr&&Cr.box&&Cr.box.length)){Tt=!0,Vn=An.shift;break}}return Cr};un(()=>qn(Ri,Ge.iconBox,n.bl.horizontal),()=>{let ii=Ge.verticalTextBox;return ii&&ni(ii),b.allowVerticalPlacement&&!(vn&&vn.box&&vn.box.length)&&vt>0&&ii?qn(ii,Ge.verticalIconBox,n.bl.vertical):{box:null,offscreen:null,occluded:null}}),vn&&(Tt=vn.box,Mt=vn.offscreen,Ht=vn.occluded);let mi=gn(!(!vn||!vn.box));if(!Tt&&this.prevPlacement){let ii=this.prevPlacement.variableOffsets[at];ii&&(this.variableOffsets[at]=ii,this.markUsedJustification(b,ii.anchor,We,mi))}}else{let Tn=(qn,mi)=>{let ii=b.getSymbolInstanceTextSize(X,We,this.transform.zoom,Xe,v),ji=this.collisionIndex.placeCollisionBox(b,ii,qn,new n.P(0,0),ue,U,O,Q.predicate);return ji&&ji.box&&ji.box.length&&(this.markUsedOrientation(b,mi,We),this.placedOrientations[at]=mi),ji};un(()=>Tn(Ri,n.bl.horizontal),()=>{let qn=Ge.verticalTextBox;return b.allowVerticalPlacement&&vt>0&&qn?(ni(qn),Tn(qn,n.bl.vertical)):{box:null,offscreen:null,occluded:null}}),gn(!!(vn&&vn.box&&vn.box.length))}}if(In=vn,Tt=In&&In.box&&In.box.length>0,Mt=In&&In.offscreen,Ht=In&&In.occluded,We.useRuntimeCollisionCircles){let gn=b.text.placedSymbolArray.get(We.centerJustifiedTextSymbolIndex>=0?We.centerJustifiedTextSymbolIndex:We.verticalPlacedTextSymbolIndex),un=n.bm(b.textSizeData,X,gn),Tn=M.get("text-padding");jn=this.collisionIndex.placeCollisionCircles(b,ue,gn,b.lineVertexArray,b.glyphOffsetArray,un,O,P,F,f,ge,Q.predicate,We.collisionCircleDiameter*un/n.br,Tn,this.retainedQueryData[b.bucketInstanceId].tileID),Tt=ue||jn.circles.length>0&&!jn.collisionDetected,Mt=Mt&&jn.offscreen,Ht=jn.occluded}if(Ge.iconFeatureIndex&&(Cn=Ge.iconFeatureIndex),Ge.iconBox){let gn=un=>{ni(un);let Tn=We.hasIconTextFit&&Vn?ma(Vn.x,Vn.y,he,ge,this.transform.angle):new n.P(0,0),qn=b.getSymbolInstanceIconSize(Z,this.transform.zoom,We.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,qn,un,Tn,le,U,O,Q.predicate)};Zn&&Zn.box&&Zn.box.length&&Ge.verticalIconBox?(nn=gn(Ge.verticalIconBox),ut=nn.box.length>0):(nn=gn(Ge.iconBox),ut=nn.box.length>0),Mt=Mt&&nn.offscreen,cn=nn.occluded}let Nr=oe||We.numHorizontalGlyphVertices===0&&vt===0,Jr=ae||We.numIconVertices===0;if(Nr||Jr?Jr?Nr||(ut=ut&&Tt):Tt=ut&&Tt:ut=Tt=ut&&Tt,Tt&&In&&In.box&&this.collisionIndex.insertCollisionBox(In.box,M.get("text-ignore-placement"),b.bucketInstanceId,Zn&&Zn.box&&Ln?Ln:Nn,Q.ID),ut&&nn&&this.collisionIndex.insertCollisionBox(nn.box,M.get("icon-ignore-placement"),b.bucketInstanceId,Cn,Q.ID),jn&&(Tt&&this.collisionIndex.insertCollisionCircles(jn.circles,M.get("text-ignore-placement"),b.bucketInstanceId,Nn,Q.ID),f)){let gn=b.bucketInstanceId,un=this.collisionCircleArrays[gn];un===void 0&&(un=this.collisionCircleArrays[gn]=new Vi);for(let Tn=0;Tn<jn.circles.length;Tn+=4)un.circles.push(jn.circles[Tn+0]),un.circles.push(jn.circles[Tn+1]),un.circles.push(jn.circles[Tn+2]),un.circles.push(jn.collisionDetected?1:0)}let Li=b.projection.name!=="globe";nt=nt&&(Li||!Ht),Ce=Ce&&(Li||!cn),this.placements[at]=new po(Tt||nt,ut||Ce,Mt||b.justReloaded),o.add(at)};if(be&&this.buildingIndex&&(this.buildingIndex.updateZOffset(b,this.retainedQueryData[b.bucketInstanceId].tileID),b.updateZOffset()),b.sortFeaturesByY){let We=b.getSortedSymbolIndexes(this.transform.angle);for(let Xe=We.length-1;Xe>=0;--Xe){let Ge=We[Xe];ke(b.symbolInstances.get(Ge),Ge,b.collisionArrays[Ge])}b.hasAnyZOffset&&n.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){let We=b.getSortedIndexesByZOffset();for(let Xe=0;Xe<We.length;++Xe){let Ge=We[Xe];ke(b.symbolInstances.get(Ge),Ge,b.collisionArrays[Ge])}}else for(let We=t.symbolInstanceStart;We<t.symbolInstanceEnd;We++)ke(b.symbolInstances.get(We),We,b.collisionArrays[We]);if(f&&b.bucketInstanceId in this.collisionCircleArrays){let We=this.collisionCircleArrays[b.bucketInstanceId];n.a6.mat4.invert(We.invProjMatrix,O),We.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(t,o,f,g){let{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:A,crossTileID:O}=f,P=n.bw(o),F=g===n.bl.vertical?A:P==="left"?v:P==="center"?b:P==="right"?M:-1;v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=F>=0&&v!==F?0:O),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=F>=0&&b!==F?0:O),M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=F>=0&&M!==F?0:O),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=F>=0&&A!==F?0:O)}markUsedOrientation(t,o,f){let g=o===n.bl.horizontal||o===n.bl.horizontalOnly?o:0,v=o===n.bl.vertical?o:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:O}=f,P=t.text.placedSymbolArray;b>=0&&(P.get(b).placedOrientation=g),M>=0&&(P.get(M).placedOrientation=g),A>=0&&(P.get(A).placedOrientation=g),O>=0&&(P.get(O).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let o=this.prevPlacement,f=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;let g=o?o.symbolFadeChange(t):1,v=o?o.opacities:{},b=o?o.variableOffsets:{},M=o?o.placedOrientations:{};for(let A in this.placements){let O=this.placements[A],P=v[A];P?(this.opacities[A]=new pr(P,g,O.text,O.icon,null,O.clipped),f=f||O.text!==P.text.placed||O.icon!==P.icon.placed):(this.opacities[A]=new pr(null,g,O.text,O.icon,O.skipFade,O.clipped),f=f||O.text||O.icon)}for(let A in v){let O=v[A];if(!this.opacities[A]){let P=new pr(O,g,!1,!1);P.isHidden()||(this.opacities[A]=P,f=f||O.text.placed||O.icon.placed)}}for(let A in b)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=b[A]);for(let A in M)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=M[A]);f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,f,g){let v=new Set;for(let b of o){let M=b.getBucket(t);M&&b.latestFeatureIndex&&t.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,v,b,b.collisionBoxArray,f,g,b.tileID,t.scope),M.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(M,b.tileID),M.updateZOffset()))}}updateBucketOpacities(t,o,f,g,v,b,M,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let O=t.layers[0].layout,P=t.layers[0].paint,F=!!t.layers[0].dynamicFilter(),z=new pr(null,0,!1,!1,!0),U=O.get("text-allow-overlap"),W=O.get("icon-allow-overlap"),q=O.get("text-variable-anchor"),X=O.get("text-rotation-alignment")==="map",Z=O.get("text-pitch-alignment")==="map",Q=P.get("symbol-z-offset"),re=O.get("symbol-elevation-reference")==="sea",oe=!Q.isConstant(),ae=new pr(null,0,U&&(W||!t.hasIconData()||O.get("icon-optional")),W&&(U||!t.hasTextData()||O.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);let ue=(he,ge,be)=>{for(let ye=0;ye<ge/4;ye++)he.opacityVertexArray.emplaceBack(be)},le=0;b&&t.updateReplacement(M,b);for(let he=0;he<t.symbolInstances.length;he++){let ge=t.symbolInstances.get(he),{numHorizontalGlyphVertices:be,numVerticalGlyphVertices:ye,crossTileID:_e,numIconVertices:Oe,tileAnchorX:Ve,tileAnchorY:Ze}=ge,Ke=null,nt=this.retainedQueryData[t.bucketInstanceId];oe&&ge&&nt&&(Ke=f.latestFeatureIndex.loadFeature({featureIndex:ge.featureIndex,bucketIndex:nt.bucketIndex,sourceLayerIndex:nt.sourceLayerIndex,layoutVertexArrayOffset:0}));let Ce=Q.evaluate(Ke,{}),qe=o.has(_e),ke=this.opacities[_e];qe?ke=z:ke||(ke=ae,this.opacities[_e]=ke),o.add(_e);let We=be>0||ye>0,Xe=Oe>0,Ge=this.placedOrientations[_e],at=Ge===n.bl.vertical,vt=Ge===n.bl.horizontal||Ge===n.bl.horizontalOnly;!We&&!Xe||ke.isHidden()||le++;let Et=!1;if((We||Xe)&&b)for(let pt of t.activeReplacements){if(n.bs(pt,v,n.bt.Symbol,A)||pt.min.x>Ve||Ve>pt.max.x||pt.min.y>Ze||Ze>pt.max.y)continue;let Tt=n.bu(Ve,Ze,M.canonical,pt.footprintTileId.canonical);if(Et=n.bv(Tt,pt.footprint),Et)break}if(We){let pt=Et?dl:hl(ke.text);ue(t.text,be,at?dl:pt),ue(t.text,ye,vt?dl:pt);let Tt=ke.text.isHidden(),{leftJustifiedTextSymbolIndex:ut,centerJustifiedTextSymbolIndex:Mt,rightJustifiedTextSymbolIndex:Ht,verticalPlacedTextSymbolIndex:cn}=ge,Vn=t.text.placedSymbolArray,vn=Tt||at?1:0;ut>=0&&(Vn.get(ut).hidden=vn),Mt>=0&&(Vn.get(Mt).hidden=vn),Ht>=0&&(Vn.get(Ht).hidden=vn),cn>=0&&(Vn.get(cn).hidden=Tt||vt?1:0);let Zn=this.variableOffsets[_e];Zn&&this.markUsedJustification(t,Zn.anchor,ge,Ge);let In=this.placedOrientations[_e];In&&(this.markUsedJustification(t,"left",ge,In),this.markUsedOrientation(t,In,ge))}if(Xe){let pt=Et?dl:hl(ke.icon),{placedIconSymbolIndex:Tt,verticalPlacedIconSymbolIndex:ut}=ge,Mt=t.icon.placedSymbolArray,Ht=ke.icon.isHidden()?1:0;Tt>=0&&(ue(t.icon,Oe,at?dl:pt),Mt.get(Tt).hidden=Ht),ut>=0&&(ue(t.icon,ge.numVerticalIconVertices,vt?dl:pt),Mt.get(ut).hidden=Ht)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let pt=t.collisionArrays[he];if(pt){let Tt=new n.P(0,0),ut=!0;if(pt.textBox||pt.verticalTextBox){if(q){let Ht=this.variableOffsets[_e];Ht?(Tt=ul(Ht.anchor,Ht.width,Ht.height,Ht.textOffset,Ht.textScale),X&&Tt._rotate(Z?this.transform.angle:-this.transform.angle)):ut=!1}F&&(ut=!ke.clipped),pt.textBox&&Ju(t.textCollisionBox.collisionVertexArray,ke.text.placed,!ut||at,Ce,re,Tt.x,Tt.y),pt.verticalTextBox&&Ju(t.textCollisionBox.collisionVertexArray,ke.text.placed,!ut||vt,Ce,re,Tt.x,Tt.y)}let Mt=ut&&!!(!vt&&pt.verticalIconBox);pt.iconBox&&Ju(t.iconCollisionBox.collisionVertexArray,ke.icon.placed,Mt,Ce,re,ge.hasIconTextFit?Tt.x:0,ge.hasIconTextFit?Tt.y:0),pt.verticalIconBox&&Ju(t.iconCollisionBox.collisionVertexArray,ke.icon.placed,!Mt,Ce,re,ge.hasIconTextFit?Tt.x:0,ge.hasIconTextFit?Tt.y:0)}}}if(t.fullyClipped=le===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){let he=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=he.invProjMatrix,t.placementViewportMatrix=he.viewportMatrix,t.collisionCircleArray=he.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){let f=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function Ju(h,t,o,f,g,v,b){h.emplaceBack(t?1:0,o?1:0,v||0,b||0,f,g?1:0),h.emplaceBack(t?1:0,o?1:0,v||0,b||0,f,g?1:0),h.emplaceBack(t?1:0,o?1:0,v||0,b||0,f,g?1:0),h.emplaceBack(t?1:0,o?1:0,v||0,b||0,f,g?1:0)}let ns=Math.pow(2,25),g0=Math.pow(2,24),ig=Math.pow(2,17),Er=Math.pow(2,16),_0=Math.pow(2,9),Ku=Math.pow(2,8),rg=Math.pow(2,1);function hl(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;let t=h.placed?1:0,o=Math.floor(127*h.opacity);return o*ns+t*g0+o*ig+t*Er+o*_0+t*Ku+o*rg+t}let dl=0;class y0{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,f,g,v,b){let M=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(M,g,t[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((A,O)=>A.sortKey-O.sortKey));this._currentPartIndex<M.length;){let A=M[this._currentPartIndex];if(o.placeLayerBucketPart(A,this._seenCrossTileIDs,f,A.symbolInstanceStart===0,b),this._currentPartIndex++,v())return!0}return!1}}class Oc{constructor(t,o,f,g,v,b,M,A,O){this.placement=new ga(t,v,b,M,A,O),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,o,f,g,v){let b=n.q.now(),M=()=>{let A=n.q.now()-b;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){let A=o[t[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=O)&&(!A.maxzoom||A.maxzoom>O)){let P=A,F=P.layout.get("symbol-z-elevate"),z=P.layout.get("symbol-sort-key").constantOr(1)!==void 0,U=P.layout.get("symbol-z-order"),W=U==="viewport-y"||U==="auto"&&!(U!=="viewport-y"&&z),q=P.layout.get("text-allow-overlap")||P.layout.get("icon-allow-overlap")||P.layout.get("text-ignore-placement")||P.layout.get("icon-ignore-placement"),X=W&&q,Z=this._inProgressLayer=this._inProgressLayer||new y0(P),Q=n.av(A.source,A.scope);if(Z.continuePlacement(F||X?g[Q]:f[Q],this.placement,this._showCollisionBoxes,A,M,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let _a=512/n.ab/2;class v0{constructor(t,o,f){this.tileID=t,this.bucketInstanceId=f,this.index=new n.bz(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let g=t.canonical.x*n.ab,v=t.canonical.y*n.ab;for(let b=0;b<o.length;b++){let{key:M,crossTileID:A,tileAnchorX:O,tileAnchorY:P}=o.get(b),F=Math.floor((g+O)*_a),z=Math.floor((v+P)*_a);this.index.add(F,z),this.keys.push(M),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,o,f){let g=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),v=_a/Math.pow(2,o.canonical.z-this.tileID.canonical.z),b=o.canonical.x*n.ab,M=o.canonical.y*n.ab;for(let A=0;A<t.length;A++){let O=t.get(A);if(O.crossTileID)continue;let{key:P,tileAnchorX:F,tileAnchorY:z}=O,U=Math.floor((b+F)*v),W=Math.floor((M+z)*v),q=this.index.range(U-g,W-g,U+g,W+g);for(let X of q){let Z=this.crossTileIDs[X];if(this.keys[X]===P&&!f.has(Z)){f.add(Z),O.crossTileID=Z;break}}}}}class fl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class og{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let o=Math.round((t-this.lng)/360);if(o!==0)for(let f in this.indexes){let g=this.indexes[f],v={};for(let b in g){let M=g[b];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+o),v[M.tileID.key]=M}this.indexes[f]=v}this.lng=t}addBucket(t,o,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<o.symbolInstances.length;v++)o.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);let g=this.usedCrossTileIDs[t.overscaledZ];for(let v in this.indexes){let b=this.indexes[v];if(Number(v)>t.overscaledZ)for(let M in b){let A=b[M];A.tileID.isChildOf(t)&&A.findMatches(o.symbolInstances,t,g)}else{let M=b[t.scaledTo(Number(v)).key];M&&M.findMatches(o.symbolInstances,t,g)}}for(let v=0;v<o.symbolInstances.length;v++){let b=o.symbolInstances.get(v);b.crossTileID||(b.crossTileID=f.generate(),g.add(b.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new v0(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(let f of o.crossTileIDs)this.usedCrossTileIDs[t].delete(f)}removeStaleBuckets(t){let o=!1;for(let f in this.indexes){let g=this.indexes[f];for(let v in g)t[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[v]),delete g[v],o=!0)}return o}}class Qu{constructor(){this.layerIndexes={},this.crossTileIDs=new fl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,f,g){let v=this.layerIndexes[t.fqid];v===void 0&&(v=this.layerIndexes[t.fqid]=new og);let b=!1,M={};g.name!=="globe"&&v.handleWrapJump(f);for(let A of o){let O=A.getBucket(t);O&&t.fqid===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(A.tileID,O,this.crossTileIDs)&&(b=!0),M[O.bucketInstanceId]=!0)}return v.removeStaleBuckets(M)&&(b=!0),b}pruneUnusedLayers(t){let o={};t.forEach(f=>{o[f]=!0});for(let f in this.layerIndexes)o[f]||delete this.layerIndexes[f]}}let Rr=771;class sn{constructor(t,o,f,g){this.blendFunction=t,this.blendColor=o,this.mask=f,this.blendEquation=g}}sn.Replace=[1,0,1,0],sn.disabled=new sn(sn.Replace,n.bA.transparent,[!1,!1,!1,!1]),sn.unblended=new sn(sn.Replace,n.bA.transparent,[!0,!0,!0,!0]),sn.alphaBlended=new sn([1,Rr,1,Rr],n.bA.transparent,[!0,!0,!0,!0]),sn.alphaBlendedNonPremultiplied=new sn([770,Rr,770,Rr],n.bA.transparent,[!0,!0,!0,!0]),sn.multiply=new sn([774,0,774,0],n.bA.transparent,[!0,!0,!0,!0]);class Ct{constructor(t,o,f){this.func=t,this.mask=o,this.range=f}}Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);let sf=7680;class Gt{constructor(t,o,f,g,v,b){this.test=t,this.ref=o,this.mask=f,this.fail=g,this.depthFail=v,this.pass=b}}Gt.disabled=new Gt({func:519,mask:0},0,0,sf,sf,sf);let af=1029,kc=2305;class zt{constructor(t,o,f){this.enable=t,this.mode=o,this.frontFace=f}}function lf(h,t){let o=n.bD(h,3);n.a6.mat4.fromQuat(h,t),n.bF(h,3,o)}function eh(h,t){let o=n.a6.quat.identity([]);return n.a6.quat.rotateZ(o,o,-t),n.a6.quat.rotateX(o,o,-h),o}function cf(h,t){let o=[h[0],h[1],0],f=[t[0],t[1],0];if(n.a6.vec3.length(o)>=1e-15){let b=n.a6.vec3.normalize([],o);n.a6.vec3.scale(f,b,n.a6.vec3.dot(f,b)),t[0]=f[0],t[1]=f[1]}let g=n.a6.vec3.cross([],t,h);if(n.a6.vec3.len(g)<1e-15)return null;let v=Math.atan2(-g[1],g[0]);return eh(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}zt.disabled=new zt(!1,af,kc),zt.backCCW=new zt(!0,af,kc),zt.backCW=new zt(!0,af,2304),zt.frontCW=new zt(!0,1028,2304),zt.frontCCW=new zt(!0,1028,kc);class Ls{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){let o=t instanceof n.a5?t:new n.a5(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=n.bB(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o){if(this.orientation=null,!this.position)return;let f=this.position,g=this._elevation?this._elevation.getAtPointOrZero(n.a5.fromLngLat(t)):0,v=n.a5.fromLngLat(t,g),b=[v.x-f.x,v.y-f.y,v.z-f.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=cf(b,o)}setPitchBearing(t,o){this.orientation=eh(n.bC(t),n.bC(-o))}}class ya{constructor(t,o){this._transform=n.a6.mat4.identity([]),this.orientation=o,this.position=t}get mercatorPosition(){let t=this.position;return new n.a5(t[0],t[1],t[2])}get position(){let t=n.bD(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&n.bF(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.a6.quat.identity([]),t&&lf(this._transform,this._orientation)}getPitchBearing(){let t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=eh(t,o),lf(this._transform,this._orientation)}forward(){let t=n.bD(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){let t=n.bD(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){let t=n.bD(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){let f=new Float64Array(16);return n.a6.mat4.invert(f,this.getWorldToCamera(t,o)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,f){let g=this.position;n.a6.vec3.scale(g,g,-t);let v=new Float64Array(16);return n.a6.mat4.fromScaling(v,[f,f,f]),n.a6.mat4.translate(v,v,g),v[10]*=o,v}getWorldToCamera(t,o){let f=new Float64Array(16),g=new Float64Array(4),v=this.position;return n.a6.quat.conjugate(g,this._orientation),n.a6.vec3.scale(v,v,-t),n.a6.mat4.fromQuat(f,g),n.a6.mat4.translate(f,f,v),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=o,f[9]*=o,f[10]*=o,f[11]*=o,f}getCameraToClipPerspective(t,o,f,g){let v=new Float64Array(16);return n.a6.mat4.perspective(v,t,o,f,g),v}getCameraToClipOrthographic(t,o,f,g,v,b){let M=new Float64Array(16);return n.a6.mat4.ortho(M,t,o,f,g,v,b),M}getDistanceToElevation(t,o=!1){let f=t===0?0:n.bE(t,o?n.aN(this.position[1]):this.position[1]),g=this.forward();return(f-this.position[2])/g[2]}clone(){return new ya([...this.position],[...this.orientation])}}let Ki={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class th{constructor(t=0,o=0,f=0,g=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=f,this.right=g}interpolate(t,o,f){return o.top!=null&&t.top!=null&&(this.top=n.aa(t.top,o.top,f)),o.bottom!=null&&t.bottom!=null&&(this.bottom=n.aa(t.bottom,o.bottom,f)),o.left!=null&&t.left!=null&&(this.left=n.aa(t.left,o.left,f)),o.right!=null&&t.right!=null&&(this.right=n.aa(t.right,o.right,f)),this}getCenter(t,o){let f=n.ap((this.left+t-this.right)/2,0,t),g=n.ap((this.top+o-this.bottom)/2,0,o);return new n.P(f,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new th(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}let pl=(h,t,o)=>(1-o)*h+o*t,ml=h=>h*h*h*h*h;class nh{constructor(t,o,f,g,v,b,M){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=f??0,this._maxPitch=g??60,this.setProjection(b),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new n.bL(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new th,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ya,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let t=new nh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){let f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(t||f)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return n.ar(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};let o=this.projection?this.getProjection():void 0;this.projection=n.bM(this.projectionOptions);let f=this.getProjection(),g=!n.bi(o,f);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){let t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.bM({name:"mercator"});let o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.bE(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bB(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){let o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=n.a6.mat2.create(),n.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let o=n.ap(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.bC(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){let o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){let t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let f=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop(),g=0,v=0;for(let b=0;b<o.length;b++){let M=new n.P(o[b][0]*this.width,f+o[b][1]*(this.height-f)),A=t.pointCoordinate(M);if(!A)continue;let O=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);g+=A[3]*O,v+=O}return v===0?NaN:g/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*o,g=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),b=Math.max(g-f,v);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){let o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),f;f=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];let g=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,f));return n.ap(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!n.a6.quat.exactEquals(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){let f=[t.position.x,t.position.y,t.position.z];n.a6.vec3.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let t=this._camera.position,o=new Ls;return o.position=new n.a5(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!n.a6.quat.length(t))return!1;n.a6.quat.normalize(t,t);let o=n.a6.vec3.transformQuat([],[0,0,-1],t),f=n.a6.vec3.transformQuat([],[0,-1,0],t);if(f[2]<0)return!1;let g=cf(o,f);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){let o=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=n.ap(t[2],g/f,g/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,f){this._unmodified=!1,this._edgeInsets.interpolate(t,o,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){let o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){let o=[new n.bN(0,t)];if(this.renderWorldCopies){let f=this.pointCoordinate(new n.P(0,0)),g=this.pointCoordinate(new n.P(this.width,0)),v=this.pointCoordinate(new n.P(this.width,this.height)),b=this.pointCoordinate(new n.P(0,this.height)),M=Math.floor(Math.min(f.x,g.x,v.x,b.x)),A=Math.floor(Math.max(f.x,g.x,v.x,b.x)),O=1;for(let P=M-O;P<=A+O;P++)P!==0&&o.push(new n.bN(P,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,f){let g=[],v=f!==void 0,b=!v;if(b&&this.zoom<o||v&&f[0]===0&&f[1]===0)return g;let M=new Set,A=(P,F,z,U,W)=>{let q=n.c2(F,P,z,U,W);M.has(q)||(g.push(new n.aA(P,F,z,U,W)),M.add(q))};for(let P=0;P<t.length;P++){let F=t[P];if(b&&F.canonical.z!==o)continue;let z=F.canonical,U=F.overscaledZ,W=F.wrap,q=1<<z.z,X=z.x+1<q,Z=z.x>0,Q=z.y+1<q,re=z.y>0,oe=F.wrap-(Z?0:1),ae=F.wrap+(X?0:1),ue=Z?z.x-1:q-1,le=X?z.x+1:0;if(v)f[0]<0?(A(U,ae,z.z,le,z.y),f[1]<0&&Q&&(A(U,W,z.z,z.x,z.y+1),A(U,ae,z.z,le,z.y+1)),f[1]>0&&re&&(A(U,W,z.z,z.x,z.y-1),A(U,ae,z.z,le,z.y-1))):f[0]>0?(A(U,oe,z.z,ue,z.y),f[1]<0&&Q&&(A(U,W,z.z,z.x,z.y+1),A(U,oe,z.z,ue,z.y+1)),f[1]>0&&re&&(A(U,W,z.z,z.x,z.y-1),A(U,oe,z.z,ue,z.y-1))):f[1]<0&&Q?A(U,W,z.z,z.x,z.y+1):re&&A(U,W,z.z,z.x,z.y-1);else{let he=F.visibleQuadrants;1&he&&(A(U,oe,z.z,ue,z.y),re&&(A(U,W,z.z,z.x,z.y-1),A(U,oe,z.z,ue,z.y-1))),2&he&&(A(U,ae,z.z,le,z.y),re&&(A(U,W,z.z,z.x,z.y-1),A(U,ae,z.z,le,z.y-1))),4&he&&(A(U,oe,z.z,ue,z.y),Q&&(A(U,W,z.z,z.x,z.y+1),A(U,oe,z.z,ue,z.y+1))),8&he&&(A(U,ae,z.z,le,z.y),Q&&(A(U,W,z.z,z.x,z.y+1),A(U,ae,z.z,le,z.y+1)))}}let O=[];for(let P of g)g.some(F=>P.isChildOf(F))||O.push(P);if(g=O.filter(P=>!t.some(F=>!!(P.overscaledZ<o&&F.isChildOf(P))||P.equals(F)||P.isChildOf(F))),b){let P=1<<o,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),z=[P*F.x,P*F.y],U=4,W=U*U;g=g.filter(q=>{let X=q.canonical.x+.5-z[0],Z=q.canonical.y+.5-z[1];return X*X+Z*Z<W})}return g}coveringTiles(t){let o=this.coveringZoomLevel(t),f=o,g=this.elevation&&this.elevation.exaggeration(),v=g&&!t.isTerrainDEM,b=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);let M=this.locationCoordinate(this.center),A=this.center.lat,O=1<<o,P=[O*M.x,O*M.y,0],F=this.projection.name==="globe",z=!F,U=n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,z),W=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=O*n.bE(1,this.center.lat),X=this._camera.position[2]/n.bE(1,this.center.lat),Z=[O*W.x,O*W.y,X*(z?1:q)],Q=F||g,re=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),oe=this.isLODDisabled(!0)?o:0,ae;if(this._elevation&&t.isTerrainDEM)ae=1e4*this._elevation.exaggeration();else if(this._elevation){let Ce=this._elevation.getMinMaxForVisibleTiles();ae=Ce?Ce.max:this._centerAltitude}else ae=this._centerAltitude;let ue=t.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,le=this.projection.isReprojectedInTileSpace?n.bP(this):1,he=Ce=>{let ke=new n.a5(Ce.x+25e-6,Ce.y,Ce.z),We=new n.a5(Ce.x,Ce.y+25e-6,Ce.z),Xe=Ce.toLngLat(),Ge=ke.toLngLat(),at=We.toLngLat(),vt=this.locationCoordinate(Xe),Et=this.locationCoordinate(Ge),pt=this.locationCoordinate(at),Tt=Math.hypot(Et.x-vt.x,Et.y-vt.y),ut=Math.hypot(pt.x-vt.x,pt.y-vt.y);return Math.sqrt(Tt*ut)*le/25e-6},ge=Ce=>{let qe=ae,ke=ue;return{aabb:n.bS(this,O,0,0,0,Ce,ke,qe,this.projection),zoom:0,x:0,y:0,minZ:ke,maxZ:qe,wrap:Ce,fullyVisible:!1}},be=[],ye=[],_e=o,Oe=t.reparseOverscaled?f:o,Ve=(X-this._centerAltitude)*q,Ze=Ce=>{if(!this._elevation||!Ce.tileID||!b)return;let qe=this._elevation.getMinMaxForTile(Ce.tileID),ke=Ce.aabb;qe?(ke.min[2]=qe.min,ke.max[2]=qe.max,ke.center[2]=(ke.min[2]+ke.max[2])/2):(Ce.shouldSplit=nt(Ce),Ce.shouldSplit||(ke.min[2]=ke.max[2]=ke.center[2]=this._centerAltitude))},Ke=(Ce,qe)=>{if(.707*qe<Ce)return 1;let ke=qe/Ce;return ke/(1.4144271570014144+(Math.pow(1.1,ke-1.4144271570014144+1)-1)/(1.1-1)-1)},nt=Ce=>{if(Ce.zoom<oe)return!0;if(Ce.zoom===_e)return!1;if(Ce.shouldSplit!=null)return Ce.shouldSplit;let qe=Ce.aabb.distanceX(Z),ke=Ce.aabb.distanceY(Z),We=Ve,Xe=1;if(F){We=Ce.aabb.distanceZ(Z);let ut=Math.pow(2,Ce.zoom),Mt=n.aN((Ce.y+1)/ut),Ht=n.aN(Ce.y/ut),cn=Math.min(Math.max(A,Mt),Ht),Vn=n.c6(cn)/n.c6(A);if(Xe=cn===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Vn/this._mercatorScaleRatio),this.zoom<=n.c3&&Ce.zoom===_e-1&&Vn>=.9)return!0}else if(v&&(We=Ce.aabb.distanceZ(Z)*q),this.projection.isReprojectedInTileSpace&&f<=5){let ut=Math.pow(2,Ce.zoom),Mt=he(new n.a5((Ce.x+.5)/ut,(Ce.y+.5)/ut));Xe=Mt>.85?1:Mt}if(!b){let ut=Math.sqrt(qe*qe+ke*ke+We*We),Mt=(1<<_e-Ce.zoom)*re*Xe;return Mt*=Ke(Math.max(We,Ve),ut),ut<Mt}let Ge=Number.MAX_VALUE,at=0,vt=Ce.aabb.getCorners(),Et=[];for(let ut of vt){n.a6.vec3.sub(Et,ut,Z),F||(v?Et[2]*=q:Et[2]=Ve);let Mt=n.a6.vec3.dot(Et,this._camera.forward());Mt<Ge&&(Ge=Mt,at=Math.abs(Et[2]))}let pt=(1<<_e-Ce.zoom)*re*Xe;if(pt*=Ke(Math.max(at,Ve),Ge),Ge<pt)return!0;let Tt=Ce.aabb.closestPoint(P);return Tt[0]===P[0]&&Tt[1]===P[1]};if(this.renderWorldCopies)for(let Ce=1;Ce<=3;Ce++)be.push(ge(-Ce)),be.push(ge(Ce));for(be.push(ge(0));be.length>0;){let Ce=be.pop(),qe=Ce.x,ke=Ce.y,We=Ce.fullyVisible,Xe=()=>this.projection.name==="globe"&&(Ce.y===0||Ce.y===(1<<Ce.zoom)-1);if(!We){let Ge=Q?Ce.aabb.intersects(U):Ce.aabb.intersectsFlat(U);if(Ge===0&&Xe()){let at=new n.bQ(Ce.zoom,qe,ke);Ge=n.bR(this,O,at,!0).intersects(U)}if(Ge===0)continue;We=Ge===2}if(Ce.zoom!==_e&&nt(Ce))for(let Ge=0;Ge<4;Ge++){let at=(qe<<1)+Ge%2,vt=(ke<<1)+(Ge>>1),Et={aabb:b?Ce.aabb.quadrant(Ge):n.bS(this,O,Ce.zoom+1,at,vt,Ce.wrap,Ce.minZ,Ce.maxZ,this.projection),zoom:Ce.zoom+1,x:at,y:vt,wrap:Ce.wrap,fullyVisible:We,tileID:void 0,shouldSplit:void 0,minZ:Ce.minZ,maxZ:Ce.maxZ};v&&!F&&(Et.tileID=new n.aA(Ce.zoom+1===_e?Oe:Ce.zoom+1,Ce.wrap,Ce.zoom+1,at,vt),Ze(Et)),be.push(Et)}else{let Ge=Ce.zoom===_e?Oe:Ce.zoom;if(t.minzoom&&t.minzoom>Ge)continue;let at=0;if(!We){let Tt=Q?Ce.aabb.intersectsPrecise(U):Ce.aabb.intersectsPreciseFlat(U);if(Tt===0&&Xe()){let ut=new n.bQ(Ce.zoom,qe,ke);Tt=n.bR(this,O,ut,!0).intersectsPrecise(U)}if(Tt===0)continue;if(t.calculateQuadrantVisibility)if(U.containsPoint(Ce.aabb.center))at=15;else for(let ut=0;ut<4;ut++)Ce.aabb.quadrant(ut).intersects(U)!==0&&(at|=1<<ut)}let vt=P[0]-(.5+qe+(Ce.wrap<<Ce.zoom))*(1<<o-Ce.zoom),Et=P[1]-.5-ke,pt=Ce.tileID?Ce.tileID:new n.aA(Ge,Ce.wrap,Ce.zoom,qe,ke);t.calculateQuadrantVisibility&&(pt.visibleQuadrants=at),ye.push({tileID:pt,distanceSq:vt*vt+Et*Et})}}if(this.fogCullDistSq){let Ce=this.fogCullDistSq,qe=this.horizonLineFromTop();ye=ye.filter(ke=>{let We=[0,0,0,1],Xe=[n.ab,n.ab,0,1],Ge=this.calculateFogTileMatrix(ke.tileID.toUnwrapped());n.a6.vec4.transformMat4(We,We,Ge),n.a6.vec4.transformMat4(Xe,Xe,Ge);let at=n.a6.vec4.min([],We,Xe),vt=n.a6.vec4.max([],We,Xe),Et=n.bT(at,vt);if(Et===0)return!0;let pt=!1,Tt=this._elevation;if(Tt&&Et>Ce&&qe!==0){let ut=this.calculateProjMatrix(ke.tileID.toUnwrapped()),Mt;t.isTerrainDEM||(Mt=Tt.getMinMaxForTile(ke.tileID)),Mt||(Mt={min:ue,max:ae});let Ht=n.c4(this.rotation),cn=[Ht[0]*n.ab,Ht[1]*n.ab,Mt.max];n.a6.vec3.transformMat4(cn,cn,ut),pt=(1-cn[1])*this.height*.5<qe}return Et<Ce||pt})}return ye.sort((Ce,qe)=>Ce.distanceSq-qe.distanceSq).map(Ce=>Ce.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){let o=n.ap(t.lat,-n.bU,n.bU),f=this.projection.project(t.lng,o);return new n.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.bE(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let f,g,v=this.centerPoint;if(this.projection.name==="globe"){let M=this.worldSize;f=(o.x-v.x)/M,g=(o.y-v.y)/M}else{let M=this.pointCoordinate(o),A=this.pointCoordinate(v);f=M.x-A.x,g=M.y-A.y}let b=this.locationCoordinate(t);this.setLocation(new n.a5(b.x-f,b.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,o){let f=o?n.bE(o,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new n.a5(g.x,g.y,f)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){let f=o??this._centerAltitude,g=[t.x,t.y,0,1],v=[t.x,t.y,1,1];n.a6.vec4.transformMat4(g,g,this.pixelMatrixInverse),n.a6.vec4.transformMat4(v,v,this.pixelMatrixInverse);let b=v[3];n.a6.vec4.scale(g,g,1/g[3]),n.a6.vec4.scale(v,v,1/b);let M=g[2],A=v[2];return{p0:g,p1:v,t:M===A?0:(f-M)/(A-M)}}screenPointToMercatorRay(t){let o=[t.x,t.y,0,1],f=[t.x,t.y,1,1];return n.a6.vec4.transformMat4(o,o,this.pixelMatrixInverse),n.a6.vec4.transformMat4(f,f,this.pixelMatrixInverse),n.a6.vec4.scale(o,o,1/o[3]),n.a6.vec4.scale(f,f,1/f[3]),o[2]=n.bE(o[2],this._center.lat)*this.worldSize,f[2]=n.bE(f[2],this._center.lat)*this.worldSize,n.a6.vec4.scale(o,o,1/this.worldSize),n.a6.vec4.scale(f,f,1/this.worldSize),new n.aj([o[0],o[1],o[2]],n.a6.vec3.normalize([],n.a6.vec3.sub([],f,o)))}rayIntersectionCoordinate(t){let{p0:o,p1:f,t:g}=t,v=n.bE(o[2],this._center.lat),b=n.bE(f[2],this._center.lat);return new n.a5(n.aa(o[0],f[0],g)/this.worldSize,n.aa(o[1],f[1],g)/this.worldSize,n.aa(v,b,g))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let o=this.projection.pointCoordinate3D(this,t.x,t.y);if(o)return new n.a5(o[0],o[1],o[2]);let f=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t);let v=.02*g,b=t.clone();for(let M=0;M<10&&g-f>v;M++){b.y=n.aa(f,g,.66);let A=this.projection.pointCoordinate3D(this,b.x,b.y);A?(g=b.y,o=A):f=b.y}return o?new n.a5(o[0],o[1],o[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.bV)return!this.isPointAboveHorizon(t);let o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){let f=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,f+t.toAltitude(),1];return n.a6.vec4.transformMat4(g,g,this.pixelMatrix),g[3]>0?new n.P(g[0]/g[3],g[1]/g[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:t,left:o}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointLocation3D(new n.P(o,t)),b=this.pointLocation3D(new n.P(g,t)),M=this.pointLocation3D(new n.P(g,f)),A=this.pointLocation3D(new n.P(o,f)),O=Math.min(v.lng,b.lng,M.lng,A.lng),P=Math.max(v.lng,b.lng,M.lng,A.lng),F=Math.min(v.lat,b.lat,M.lat,A.lat),z=Math.max(v.lat,b.lat,M.lat,A.lat),U=Math.pow(2,-this.zoom)/16*270,W=this.projection.name==="globe"?1:4,q=(X,Z,Q,re,oe)=>{let ae=(X+Q)/2,ue=(Z+re)/2,le=new n.P(ae,ue),{lng:he,lat:ge}=this.pointLocation3D(le),be=Math.max(0,O-he,F-ge,he-P,ge-z);O=Math.min(O,he),P=Math.max(P,he),F=Math.min(F,ge),z=Math.max(z,ge),(oe<W||be>U)&&(q(X,Z,ae,ue,oe+1),q(ae,ue,Q,re,oe+1))};if(q(o,t,g,t,1),q(g,t,g,f,1),q(g,f,o,f,1),q(o,f,o,t,1),this.projection.name==="globe"){let[X,Z]=n.bW(this);X?(z=90,P=180,O=-180):Z&&(F=-90,P=180,O=-180)}return new n.as(new n.bL(O,F),new n.bL(P,z))}_getBoundsRectangular(t,o){let{top:f,left:g}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,M=new n.P(g,f),A=new n.P(b,f),O=new n.P(b,v),P=new n.P(g,v),F=this.pointCoordinate(M,t),z=this.pointCoordinate(A,t),U=this.pointCoordinate(O,o),W=this.pointCoordinate(P,o),q=(X,Z)=>(Z.y-X.y)/(Z.x-X.x);return F.y>1&&z.y>=0?F=new n.a5((1-W.y)/q(W,F)+W.x,1):F.y<0&&z.y<=1&&(F=new n.a5(-W.y/q(W,F)+W.x,0)),z.y>1&&F.y>=0?z=new n.a5((1-U.y)/q(U,z)+U.x,1):z.y<0&&F.y<=1&&(z=new n.a5(-U.y/q(U,z)+U.x,0)),new n.as().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){let t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);let o=t.visibleDemTiles.reduce((f,g)=>{if(g.dem){let v=g.dem.tree;f.min=Math.min(f.min,v.minimums[0]),f.max=Math.max(f.max,v.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){let o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.bU,this.maxLat=n.bU,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.am(this.minLng)*this.tileSize,this.worldMaxX=n.am(this.maxLng)*this.tileSize,this.worldMinY=n.at(this.maxLat)*this.tileSize,this.worldMaxY=n.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){let o=t.key,f=this._distanceTileDataCache;if(f[o])return f[o];let g=t.canonical,v=1/this.height,b=this.cameraWorldSize,M=b/this.zoomScale(g.z),A=(g.x+Math.pow(2,g.z)*t.wrap)*M,O=g.y*M,P=this.point;P.x*=b/this.worldSize,P.y*=b/this.worldSize;let F=this.angle,z=Math.sin(-F),U=-Math.cos(-F);return f[o]={bearing:[z,U],center:[(P.x-A)*v,(P.y-O)*v],scale:M/n.ab*v},f[o]}calculateFogTileMatrix(t){let o=t.key,f=this._fogTileMatrixCache;if(f[o])return f[o];let g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.a6.mat4.multiply(g,this.worldToFogMatrix,g),f[o]=new Float32Array(g),f[o]}calculateProjMatrix(t,o=!1,f=!1){let g=t.key,v;if(v=f?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,v[g])return v[g];let b=this.calculatePosMatrix(t,this.worldSize),M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,n.a6.mat4.multiply(b,M,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(t){let o=t.tileID.key,f=this._pixelsToTileUnitsCache;if(f[o])return f[o];let g=n.bX(t,this);return f[o]=g,f[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let t=1/this.worldSize,o=n.a6.mat4.fromScaling([],[t,t,t]);return n.a6.mat4.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let t=this._elevation;this._updateCameraState();let o=n.bE(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(o),g=this._camera.forward(),v=n.bE(1,this._center.lat);f[2]/=v,g[2]/=v,n.a6.vec3.normalize(g,g);let b=t.raycast(f,g,t.exaggeration());if(b){let M=n.a6.vec3.scaleAndAdd([],f,g,b),A=new n.a5(M[0],M[1],n.bE(M[2],n.aN(M[1]))),O=(A.z+n.a6.vec3.length([A.x-f[0],A.y-f[1],A.z-f[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;let o=this._elevation,f=n.bE(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(f),v=o.getAtPointOrZero(new n.a5(...g)),b=this.pixelsPerMeter/this.worldSize*v,M=this._minimumHeightOverTerrain(),A=g[2]-b;if(A<=M)if(A<0||t){let O=this.locationCoordinate(this._center,this._centerAltitude),P=[g[0],g[1],O.z-g[2]],F=n.a6.vec3.length(P);P[2]-=(M-A)/this._pixelsPerMercatorPixel;let z=n.a6.vec3.length(P);if(z===0)return;n.a6.vec3.scale(P,P,F/z*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],O.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){let z=this.center;return z.lat=n.ap(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(z.lng=n.ap(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}let o=this._unmodified,{x:f,y:g}=this.point,v=0,b=f,M=g,A=this.width/2,O=this.height/2,P=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(g-O<P&&(M=P+O),g+O>F&&(M=F-O),F-P<this.height&&(v=Math.max(v,this.height/(F-P)),M=(F+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let z=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,W=this.worldSize/2-(z+U)/2;b=(f+W+this.worldSize)%this.worldSize-W,b-A<z&&(b=z+A),b+A>U&&(b=U-A),U-z<this.width&&(v=Math.max(v,this.width/(U-z)),b=(U+z)/2)}b===f&&M===g||(this.center=this.unproject(new n.P(b,M))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,o=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.bE(1,this.center.lat)/n.bE(1,n.c5));let g=n.bY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let v=this.projection.zAxisUnit==="meters"?f:1,b=this._camera.getWorldToCamera(this.worldSize,v),M,A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let ge=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),be=ge*this.aspect,ye=-be,_e=-ge;be-=t.x,ye-=t.x,ge+=t.y,_e+=t.y,M=this._camera.getCameraToClipOrthographic(ye,be,_e,ge,this._nearZ,this._farZ),((Oe,Ve,Ze,Ke)=>{for(let nt=0;nt<16;nt++)Oe[nt]=pl(Ve[nt],Ze[nt],Ke)})(M,M,A,ml(this.pitch>=15?1:this.pitch/15))}else M=A;let O=n.a6.mat4.mul([],A,b),P=n.a6.mat4.mul([],M,b);if(this.projection.isReprojectedInTileSpace){let ge=this.locationCoordinate(this.center),be=n.a6.mat4.identity([]);n.a6.mat4.translate(be,be,[ge.x*this.worldSize,ge.y*this.worldSize,0]),n.a6.mat4.multiply(be,be,n.bZ(this)),n.a6.mat4.translate(be,be,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),n.a6.mat4.multiply(P,P,be),n.a6.mat4.multiply(O,O,be),this.inverseAdjustmentMatrix=n.b_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.a6.mat4.scale([],P,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=P,this.invProjMatrix=n.a6.mat4.invert(new Float64Array(16),this.projMatrix),o){let ge=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ge[8]=2*-t.x/this.width,ge[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.a6.mat4.mul([],ge,b)}else this.expandedFarZProjMatrix=this.projMatrix;let F=n.a6.mat4.invert([],M);this.frustumCorners=n.b$.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);let z=new Float32Array(16);n.a6.mat4.identity(z),n.a6.mat4.scale(z,z,[1,-1,1]),n.a6.mat4.rotateX(z,z,this._pitch),n.a6.mat4.rotateZ(z,z,this.angle);let U=n.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.a6.mat4.clone(U);let W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-t.x/this.width,U[9]=2*(t.y+W)/this.height,this.skyboxMatrix=n.a6.mat4.multiply(z,U,z);let q=this.point,X=q.x,Z=q.y,Q=this.width%2/2,re=this.height%2/2,oe=Math.cos(this.angle),ae=Math.sin(this.angle),ue=X-Math.round(X)+oe*Q+ae*re,le=Z-Math.round(Z)+oe*re+ae*Q,he=new Float64Array(P);if(n.a6.mat4.translate(he,he,[ue>.5?ue-1:ue,le>.5?le-1:le,0]),this.alignedProjMatrix=he,P=n.a6.mat4.create(),n.a6.mat4.scale(P,P,[this.width/2,-this.height/2,1]),n.a6.mat4.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=n.a6.mat4.create(),n.a6.mat4.scale(P,P,[1,-1,1]),n.a6.mat4.translate(P,P,[-1,-1,0]),n.a6.mat4.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=n.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,O),this._calcFogMatrices(),this._distanceTileDataCache={},P=n.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.c0(this);let ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.a6.vec3.transformMat4(ge,ge,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,f=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[t,t,o];n.a6.vec3.scale(v,v,g),n.a6.vec3.scale(f,f,-1),n.a6.vec3.multiply(f,f,v);let b=n.a6.mat4.create();n.a6.mat4.translate(b,b,f),n.a6.mat4.scale(b,b,v),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,g)}_computeCameraPosition(t){let o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-f[0]*v,g.y/this.worldSize-f[1]*v,t/this.worldSize*this._centerAltitude-f[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){let o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],g=t[2],v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((o-f)/g,1)),this._camera.position=n.a6.vec3.scaleAndAdd([],this._camera.position,t,v),this._updateStateFromCamera()}_updateStateFromCamera(){let t=this._camera.position,o=this._camera.forward(),{pitch:f,bearing:g}=this._camera.getPitchBearing(),v=n.bE(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.bC(this._maxPitch)),M=Math.max((t[2]-v)/Math.cos(f),b),A=this._zoomFromMercatorZ(M);n.a6.vec3.scaleAndAdd(t,t,o,M),this._pitch=n.ap(f,n.bC(this.minPitch),n.bC(this.maxPitch)),this.angle=n.bB(g,-Math.PI,Math.PI),this._setZoom(n.ap(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.a5(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){let t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,f=n.bV,g=0,v=1/0;for(;f-o>1e-6&&f>o;){let b=o+.5*(f-o),M=this.tileSize*Math.pow(2,b),A=this.getCameraToCenterDistance(this.projection,b,M),O=this.scaleZoom(A/(t*this.tileSize)),P=Math.abs(b-O);P<v&&(v=P,g=b),b<O?o=b:f=b}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){let f=Math.min(t.x,o.x),g=Math.max(t.x,o.x),v=Math.min(t.y,o.y),b=Math.max(t.y,o.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let M=[new n.P(f,v),new n.P(g,b),new n.P(f,b),new n.P(g,v)],A=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(let P of M){let F=this.pointRayIntersection(P);if(F.t<0)return!0;let z=this.rayIntersectionCoordinate(F);if(z.x<A||z.y<0||z.x>O||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.c1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,o){let f=n.a6.vec3.length(n.a6.vec3.sub([],this._camera.position,t)),g=this._zoomFromMercatorZ(f)+o;return f-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){let t=function([o,f,g],v){let b=[o,f,g,1];n.a6.vec4.transformMat4(b,b,v);let M=b[3]=Math.max(b[3],1e-6);return b[0]/=M,b[1]/=M,b[2]/=M,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,f=this.worldSize){let g=n.bY(t,o,this.width,this.height,1024),v=t.pixelSpaceConversion(this.center.lat,f,g),b=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(b=pl(1,b,ml(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){let t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.a6.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return n.bO.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}let is=(h,t)=>{if(t>0&&h.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let o=h.transform,f=Math.max(Math.abs(o._zoom-(h.minCutoffZoom-1)),1),g=o.isLODDisabled(!1)?n.a7(60,45,o.pitch):n.a7(30,15,o.pitch),v=o._farZ-o._nearZ,b=t*o.height,M=((1-(A=g))*o.cameraToCenterDistance+A*(o._farZ+b))*f;var A;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(M-o._nearZ)/v,(M-b-o._nearZ)/v]}}},di={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class uf{constructor(t,o){this.aabb=t,this.lastCascade=o}}class st{add(t,o){let f=this.receivers[t.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],o.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],o.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],o.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],o.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],o.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],o.max[2])):this.receivers[t.key]=new uf(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,f){let g=n.ca.fromPoints(t.points),v=0;for(let b in this.receivers){let M=this.receivers[b];if(!M||!g.intersectsAabb(M.aabb))continue;M.aabb.min=g.closestPoint(M.aabb.min),M.aabb.max=g.closestPoint(M.aabb.max);let A=M.aabb.getCorners();for(let O=0;O<f.length;O++){let P=!0;for(let F of A){let z=[F[0]*o,F[1]*o,F[2]];if(n.a6.vec3.transformMat4(z,z,f[O].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){P=!1;break}}if(M.lastCascade=O,v=Math.max(v,O),P)break}}return v+1}}class sg{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new st,this._depthMode=new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(di,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(di,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(di,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){let f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;let g=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||g<=0||(this._shadowLayerCount=f.style.order.reduce((W,q)=>{let X=f.style._mergedLayers[q];return W+(X.hasShadowPass()&&!X.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let v=f.context,b=di.shadowMapResolution,M=di.shadowMapResolution;if(this._cascades.length===0||di.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let W=0;W<di.cascadeCount;++W){let q=f._shadowMapDebug,X=v.gl,Z=v.createFramebuffer(b,M,q,"texture"),Q=new n.T(v,{width:b,height:M,data:null},X.DEPTH_COMPONENT16);if(Z.depthAttachment.set(Q.texture),q){let re=new n.T(v,{width:b,height:M,data:null},X.RGBA8);Z.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:Z,texture:Q,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.bO,scale:0})}}this.shadowDirection=ih(o);let A=0;if(t.elevation){let W=t.elevation,q=[1e4,-1e4];W.visibleDemTiles.filter(X=>X.dem).forEach(X=>{let Z=X.dem.tree;q[0]=Math.min(q[0],Z.minimums[0]),q[1]=Math.max(q[1],Z.maximums[0])}),q[0]!==1e4&&(A=(q[1]-q[0])*W.exaggeration())}let O=1.5*t.cameraToCenterDistance,P=3*O,F=new Float64Array(16);for(let W=0;W<this._cascades.length;++W){let q=this._cascades[W],X=t.height/50,Z=1;di.cascadeCount===1?Z=P:W===0?Z=O:(X=O,Z=P);let[Q,re]=oh(t,this.shadowDirection,X,Z,di.shadowMapResolution,A);q.scale=t.scale,q.matrix=Q,q.boundingSphereRadius=re,n.a6.mat4.invert(F,q.matrix),q.frustum=n.bO.fromInvProjectionMatrix(F,1,0,!0),q.far=Z}let z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/di.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=di.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ki.ShadowMap0,this._uniformValues.u_shadowmap_1=Ki.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let U=f.transform.elevation;for(let W of this._groundShadowTiles){let q={min:0,max:0};if(U){let X=U.getMinMaxForTile(W);X&&(q=X)}this.addShadowReceiver(W.toUnwrapped(),q.min,q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;let f=this.painter,g=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),g.viewport.set([0,0,di.shadowMapResolution,di.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){f.currentShadowCascade=v,g.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),g.clear({color:n.bA.white,depth:1});for(let b of t.order){let M=t._mergedLayers[b];if(!M.hasShadowPass()||M.isHidden(f.transform.zoom))continue;let A=t.getLayerSourceCache(M),O=A?o[A.id]:void 0;(M.type==="model"||O&&O.length)&&f.renderLayer(f,A,M,O)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let t=this.painter,o=t.style,f=t.context,g=o.directionalLight,v=o.ambientLight;if(!g||!v)return;let b=[],M=is(t,t.longestCutoffRange);M.shouldRenderCutoff&&b.push("RENDER_CUTOFF"),b.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&b.push("NORMAL_OFFSET");let A=rh(o,g,v),O=new Ct(f.gl.LEQUAL,Ct.ReadOnly,t.depthRangeFor3D);for(let P of this._groundShadowTiles){let F=P.toUnwrapped(),z=t.isTileAffectedByFog(P),U=t.getOrCreateProgram("groundShadow",{defines:b,overrideFog:z});this.setupShadows(F,U),t.uploadCommonUniforms(f,U,F,null,M);let W={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:A};U.draw(t,f.gl.TRIANGLES,O,Gt.disabled,sn.multiply,zt.disabled,W,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?sn.unblended:sn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){let o=this.painter.transform,f=o.calculatePosMatrix(t,o.worldSize);return n.a6.mat4.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(t){return n.a6.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,o,f,g=0){if(!this.enabled)return;let v=this.painter.transform,b=this.painter.context,M=b.gl,A=this._uniformValues,O=new Float64Array(16),P=v.calculatePosMatrix(t,v.worldSize);for(let F=0;F<this._cascades.length;F++)n.a6.mat4.multiply(O,this._cascades[F].matrix,P),A[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),b.activeTexture.set(M.TEXTURE0+Ki.ShadowMap0+F),this._cascades[F].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){let F=n.c9(t.canonical),z=2/v.tileSize*n.ab/di.shadowMapResolution,U=z*this._cascades[0].boundingSphereRadius,W=z*this._cascades[this._cascades.length-1].boundingSphereRadius,q=(f==="vector-tile"?1:3)/Math.pow(2,g-t.canonical.z-(1-v.zoom+Math.floor(v.zoom)));A.u_shadow_normal_offset=[F,U*q,W*q],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(b,A)}setupShadowsFromMatrix(t,o,f=!1){if(!this.enabled)return;let g=this.painter.context,v=g.gl,b=this._uniformValues,M=new Float64Array(16);for(let A=0;A<di.cascadeCount;A++)n.a6.mat4.multiply(M,this._cascades[A].matrix,t),b[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),g.activeTexture.set(v.TEXTURE0+Ki.ShadowMap0+A),this._cascades[A].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=f,f){let A=di.normalOffset;b.u_shadow_normal_offset=[1,A,A],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(g,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,f,g){if(g[2]>=0)return{};let v=function(A,O,P){let F=P/(1<<A.canonical.z);return new n.ca([A.canonical.x*F+A.wrap*P,A.canonical.y*F+A.wrap*P,0],[(A.canonical.x+1)*F+A.wrap*P,(A.canonical.y+1)*F+A.wrap*P,O])}(t,o,f).getCorners(),b=o/-g[2];g[0]<0?(n.a6.vec3.add(v[0],v[0],[g[0]*b,0,0]),n.a6.vec3.add(v[3],v[3],[g[0]*b,0,0])):g[0]>0&&(n.a6.vec3.add(v[1],v[1],[g[0]*b,0,0]),n.a6.vec3.add(v[2],v[2],[g[0]*b,0,0])),g[1]<0?(n.a6.vec3.add(v[0],v[0],[0,g[1]*b,0]),n.a6.vec3.add(v[1],v[1],[0,g[1]*b,0])):g[1]>0&&(n.a6.vec3.add(v[2],v[2],[0,g[1]*b,0]),n.a6.vec3.add(v[3],v[3],[0,g[1]*b,0]));let M={};return M.vertices=v,M.planes=[gl(v[1],v[0],v[4]),gl(v[2],v[1],v[5]),gl(v[3],v[2],v[6]),gl(v[0],v[3],v[7])],M}addShadowReceiver(t,o,f){this._receivers.add(t,n.ca.fromTileIdAndHeight(t,o,f))}getMaxCascadeForTile(t){let o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function gl(h,t,o){let f=n.a6.vec3.sub([],o,t),g=n.a6.vec3.sub([],h,t),v=n.a6.vec3.cross([],f,g),b=n.a6.vec3.length(v);return b===0?[0,0,1,0]:(n.a6.vec3.scale(v,v,1/b),[v[0],v[1],v[2],-n.a6.vec3.dot(v,t)])}function ih(h){let t=h.properties.get("direction"),o=n.c8(t.x,t.y,t.z);o[2]=n.ap(o[2],0,75);let f=n.cb([o[0],o[1],o[2]]);return n.a6.vec3.fromValues(f.x,f.y,f.z)}function rh(h,t,o){let f=t.properties.get("color"),g=t.properties.get("intensity"),v=t.properties.get("direction"),b=[v.x,v.y,v.z],M=o.properties.get("color"),A=o.properties.get("intensity"),O=Math.max(n.a6.vec3.dot([0,0,1],b),0),P=[0,0,0];n.a6.vec3.scale(P,M.toRenderColor(h.getLut(t.scope)).toArray01Linear().slice(0,3),A);let F=[0,0,0];return n.a6.vec3.scale(F,f.toRenderColor(h.getLut(o.scope)).toArray01Linear().slice(0,3),O*g),n.cc([P[0]>0?P[0]/(P[0]+F[0]):0,P[1]>0?P[1]/(P[1]+F[1]):0,P[2]>0?P[2]/(P[2]+F[2]):0])}function oh(h,t,o,f,g,v){let b=h.zoom,M=h.scale,A=h.worldSize,O=1/A,P=h.aspect,F=Math.sqrt(1+P*P)*Math.tan(.5*h.fovX),z=F*F,U=f-o,W=f+o,q,X;z>U/W?(q=f,X=f*F):(q=.5*W*(1+z),X=.5*Math.sqrt(U*U+2*(f*f+o*o)*z+W*W*z*z));let Z=h.projection.pixelsPerMeter(h.center.lat,A),Q=h._camera.getCameraToWorldMercator(),re=[0,0,-q*O];n.a6.vec3.transformMat4(re,re,Q);let oe=X*O,ae=h._edgeInsets;if(!(ae.left===0&&ae.top===0&&ae.right===0&&ae.bottom===0||ae.left===ae.right&&ae.top===ae.bottom)){let We=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?Z:1),Xe=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,o,f);Xe[8]=2*-h.centerOffset.x/h.width,Xe[9]=2*h.centerOffset.y/h.height;let Ge=new Float64Array(16);n.a6.mat4.mul(Ge,Xe,We);let at=new Float64Array(16);n.a6.mat4.invert(at,Ge);let vt=n.bO.fromInvProjectionMatrix(at,A,b,!0);for(let Et of vt.points){let pt=((ue=Et)[0]/=M,ue[1]/=M,ue[2]=n.bE(ue[2],h._center.lat),ue);oe=Math.max(oe,n.a6.vec3.len(n.a6.vec3.subtract([],re,pt)))}}var ue;oe*=g/(g-1);let le=Math.acos(t[2]),he=Math.atan2(-t[0],-t[1]),ge=new ya;ge.position=re,ge.setPitchBearing(le,he);let be=ge.getWorldToCamera(A,Z),ye=oe*A,_e=Math.min(h._mercatorZfromZoom(17)*A*-2,-2*ye),Oe=ge.getCameraToClipOrthographic(-ye,ye,-ye,ye,_e,(ye+v*Z)/t[2]),Ve=new Float64Array(16);n.a6.mat4.multiply(Ve,Oe,be);let Ze=n.a6.vec3.fromValues(Math.floor(1e6*re[0])/1e6*A,Math.floor(1e6*re[1])/1e6*A,0),Ke=.5*g,nt=[0,0,0];n.a6.vec3.transformMat4(nt,Ze,Ve),n.a6.vec3.scale(nt,nt,Ke);let Ce=[Math.floor(nt[0]),Math.floor(nt[1]),Math.floor(nt[2])],qe=[0,0,0];n.a6.vec3.sub(qe,nt,Ce),n.a6.vec3.scale(qe,qe,-1/Ke);let ke=new Float64Array(16);return n.a6.mat4.identity(ke),n.a6.mat4.translate(ke,ke,qe),n.a6.mat4.multiply(Ve,ke,Ve),[Ve,ye]}class rs extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,o){return n.aG(this.requestManager.transformRequest(o,n.R.Model).url).then(f=>{if(!f)return;let g=n.aH(f),v=new n.aI(t,void 0,void 0,g);return v.computeBoundsAndApplyParent(),v}).catch(f=>{if(f&&f.status===404)return null;this.fire(new n.t(new Error(`Could not load model ${t} from ${o}: ${f.message}`)))})}load(t,o){this.models[o]||(this.models[o]={});let f=Object.keys(t);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+f.length;let g=[];for(let v of f)g.push(this.loadModel(v,t[v]));Promise.allSettled(g).then(v=>{for(let b=0;b<v.length;b++){let{status:M,value:A}=v[b];M==="fulfilled"&&A&&(this.models[o][f[b]]={model:A,numReferences:1})}this.numModelsLoading[o]-=f.length,this.fire(new n.x("data",{dataType:"style"}))}).catch(v=>{this.fire(new n.t(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(let t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o){return!!this.getModel(t,o)}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}addModel(t,o,f){this.models[f]||(this.models[f]={}),this.hasModel(t,f)&&this.models[f][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(o)},f)}addModels(t,o){this.models[o]||(this.models[o]={});let f={};for(let g in t)this.models[o][g]={},f[g]=this.requestManager.normalizeModelURL(t[g]);this.load(f,o)}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={});let f={};for(let g of t)this.hasModel(g,o)?this.models[o][g].numReferences++:f[g]=this.requestManager.normalizeModelURL(g);this.load(f,o)}removeModel(t,o){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0)){let f=this.models[o][t].model;delete this.models[o][t],f.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(let f in this.models[o])this.models[o][f].model&&this.models[o][f].model.upload(t.context)}}let hf=new n.a0({data:new n.a1(n._.colorTheme.data)}),Pr=(h,t)=>Te(h,t&&t.filter(o=>o.identifier!=="source.canvas")),sh=n.ar(bn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),_l=n.ar(bn,["setCenter","setZoom","setBearing","setPitch"]),ag={version:8,layers:[],sources:{}},lg={duration:300,delay:0};class Or extends n.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=n.l({},lg),this._buildingIndex=new tf(this),this.crossTileSymbolIndex=new Qu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._mergedLayerSelectors=new Map,this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Ec,this.dispatcher=o.dispatcher?o.dispatcher:new n.ce(n.cf(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new ca,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new n.cg(t._requestManager,o.localFontFamily?n.ch.all:o.localIdeographFontFamily?n.ch.ideographs:n.ch.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new rs(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",n.ci());let f=this;this._rtlTextPluginCallback=Or.registerForPluginStateChange(g=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,b)=>{if(n.cj(v),b&&b.every(M=>M))for(let M in f._sourceCaches){let A=f._sourceCaches[M],O=A.getSource().type;O!=="vector"&&O!=="geojson"||A.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;let v=this.getOwnSource(g.sourceId);if(v&&v.vectorLayerIds)for(let b in this._layers){let M=this._layers[b];M.source===v.id&&this._validateLayer(M)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.f(t))return t;let o=n.ck(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${n.cl(JSON.stringify(t))}`}_diffStyle(t,o,f){this.globalId=this._getGlobalId(t);let g=(v,b)=>{try{b(null,this.setState(v,f))}catch(M){b(M,!1)}};if(typeof t=="string"){let v=this.map._requestManager.normalizeStyleURL(t),b=this.map._requestManager.transformRequest(v,n.R.Style);n.n(b,(M,A)=>{M?this.fire(new n.t(M)):A&&g(A,o)})}else typeof t=="object"&&g(t,o)}loadURL(t,o={}){this.fire(new n.x("dataloading",{dataType:"style"}));let f=typeof o.validate=="boolean"?o.validate:!n.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);let g=this.importsCache.get(t);if(g)return this._load(g,f);let v=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.n(v,(b,M)=>{if(this._request=null,b)this.fire(new n.t(b));else if(M)return this.importsCache.set(t,M),this._load(M,f)})}loadJSON(t,o={}){this.fire(new n.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.q.frame(()=>{this._request=null,this._load(t,o.validate!==!1)})}loadEmpty(){this.fire(new n.x("dataloading",{dataType:"style"})),this._load(ag,!1)}_loadImports(t,o,f){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let g=[];for(let v of t){let b=this._createFragmentStyle(v),M=new Promise(P=>{b.once("style.import.load",P),b.once("error",P)}).then(()=>this.mergeAll());if(g.push(M),this.resolvedImports.has(v.url)){b.loadEmpty();continue}let A=v.data||this.importsCache.get(v.url);A?(b.loadJSON(A,{validate:o}),this._isInternalStyle(A)&&(b.globalId=null)):v.url?b.loadURL(v.url,{validate:o}):b.loadEmpty();let O={style:b,id:v.id,config:v.config};if(f){let P=this.fragments.findIndex(({id:F})=>F===f);this.fragments=this.fragments.slice(0,P).concat(O).concat(this.fragments.slice(P))}else this.fragments.push(O)}return Promise.allSettled(g)}getImportGlobalIds(t=this,o=new Set){for(let f of t.fragments)f.style.globalId&&o.add(f.style.globalId),this.getImportGlobalIds(f.style,o);return[...o.values()]}_createFragmentStyle(t){let o=this.scope?n.av(t.id,this.scope):t.id,f,g=this._initialConfig&&this._initialConfig[o];(t.config||g)&&(f=n.l({},t.config,g));let v=new Or(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){let f=t.schema;if(this._isInternalStyle(t)){let b=n.l({},ag,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(b,o)}if(this.updateConfig(this._config,f),o&&Pr(this,Sr(t)))return;this._loaded=!0,this.stylesheet=n.cm(t);let g=()=>{for(let O in t.sources)this.addSource(O,t.sources[O],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);let b=nf(this.stylesheet.layers);if(this._order=b.map(O=>O.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let O=this.stylesheet.lights[0];this.light=new Se(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Se(this.stylesheet.light)),this._layers={};for(let O of b){let P=n.cq(O,this.scope,this._styleColorTheme.lut,this.options);P.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P;let F=this.getOwnLayerSourceCache(P),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&P.canCastShadows()&&z&&(F.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.x("data",{dataType:"style"}));let A=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then(()=>{this._reloadImports(),this.fire(new n.x(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.x(A?"style.load":"style.import.load")))},v=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=v,v){let b=this._evaluateColorThemeData(v);this._loadColorTheme(b).then(()=>{g()}).catch(M=>{n.w(`Couldn't load color theme from the stylesheet: ${M}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,o,f,g,v,b,M,A,O={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(P=>{if(P.stylesheet){if(P.light!=null&&(t=P.light),P.stylesheet.lights)for(let F of P.stylesheet.lights)F.type==="ambient"&&P.ambientLight!=null&&(o=P.ambientLight),F.type==="directional"&&P.directionalLight!=null&&(f=P.directionalLight);g=this._prioritizeTerrain(g,P.terrain,P.stylesheet.terrain),P.stylesheet.fog&&P.fog!=null&&(v=P.fog),P.stylesheet.camera!=null&&(A=P.stylesheet.camera),P.stylesheet.projection!=null&&(b=P.stylesheet.projection),P.stylesheet.transition!=null&&(M=P.stylesheet.transition),O[P.scope]=P._styleColorTheme}}),this.light=t,this.ambientLight=o,this.directionalLight=f,this.fog=v,this._styleColorThemeForScope=O,g===null?delete this.terrain:this.terrain=g,this.camera=A||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=n.l({},lg,M),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){let o=f=>{for(let g of f.fragments)o(g.style);t(f)};o(this)}_prioritizeTerrain(t,o,f){let g=t&&t.drapeRenderMode===0;return f===null?o&&o.drapeRenderMode===0?o:g?t:null:o!=null&&(!t||g||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){let t={},o={},f={};this.forEachFragmentStyle(g=>{for(let v in g._sourceCaches){let b=n.av(v,g.scope);t[b]=g._sourceCaches[v]}for(let v in g._otherSourceCaches){let b=n.av(v,g.scope);o[b]=g._otherSourceCaches[v]}for(let v in g._symbolSourceCaches){let b=n.av(v,g.scope);f[b]=g._symbolSourceCaches[v]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=f}mergeLayers(){let t={},o=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._mergedLayerSelectors.clear(),this.forEachFragmentStyle(v=>{for(let M of v._order){let A=v._layers[M];if(A.type==="slot"){let O=n.cn(M);if(t[O])continue;t[O]=[]}A.slot&&t[A.slot]?t[A.slot].push(A):o.push(A)}let{featuresets:b}=v.stylesheet||{};if(b)for(let M in b){let{selectors:A}=b[M];for(let O of A){let P=v._layers[O.layer],F=this._mergedLayerSelectors.get(P.fqid)||[],z;if(O.properties)for(let U in O.properties){let W=n.M(O.properties[U]);W.result==="success"&&(z=z||{},z[U]=W.value)}F.push({featuresetId:M,featureNamespace:O.featureNamespace,properties:z}),this._mergedLayerSelectors.set(P.fqid,F)}}}),this._mergedOrder=[];let g=(v=[])=>{for(let b of v)if(b.type==="slot"){let M=n.cn(b.id);t[M]&&g(t[M]),this._mergedSlots.push(M)}else{let M=n.av(b.id,b.scope);this._mergedOrder.push(M),f[M]=b,b.is3D()&&(this._has3DLayers=!0),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};g(o),this._mergedOrder.sort((v,b)=>{let M=f[v],A=f[b];return M.hasInitialOcclusionOpacityProperties?A.is3D()?1:0:M.is3D()&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=n.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(o,f,g){let v=n.l({},f);for(let M of Object.keys(n._.colorTheme))v[M]===void 0&&(v[M]=n._.colorTheme[M].default);let b=new n.$(hf,o,new Map(g));return b.setTransitionOrValue(v,g),b.untransitioned().possiblyEvaluate(new n.a3(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;let o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,g)=>{let v="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let b=t;b.startsWith(v)||(b=v+b);let M="mapbox-reserved-lut",A=new Image;A.src=b,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void f();this._styleColorTheme.lutLoading=!1;let{width:O,height:P,data:F}=n.q.getImageData(A);if(P>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(O!==P*P)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new n.r({width:O,height:P},F),pixelRatio:1,sdf:!1,version:0});let z=this.imageManager.getImage(M,this.scope);z?(this._styleColorTheme.lut={image:z.data,data:t},f()):g(new Error("Missing LUT image."))}})}getLut(t){let o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(o,f,g){let v,b,M,A=n.q.devicePixelRatio>1?"@2x":"",O=n.n(f.transformRequest(f.normalizeSpriteURL(o,A,".json"),n.R.SpriteJSON),(z,U)=>{O=null,M||(M=z,v=U,F())}),P=n.o(f.transformRequest(f.normalizeSpriteURL(o,A,".png"),n.R.SpriteImage),(z,U)=>{P=null,M||(M=z,b=U,F())});function F(){if(M)g(M);else if(v&&b){let z=n.q.getImageData(b),U={};for(let W in v){let{width:q,height:X,x:Z,y:Q,sdf:re,pixelRatio:oe,stretchX:ae,stretchY:ue,content:le}=v[W],he=new n.r({width:q,height:X});n.r.copy(z,he,{x:Z,y:Q},{x:0,y:0},{width:q,height:X},null),U[W]={data:he,pixelRatio:oe,sdf:re,stretchX:ae,stretchY:ue,content:le}}g(null,U)}}return{cancel(){O&&(O.cancel(),O=null),P&&(P.cancel(),P=null)}}}(t,this.map._requestManager,(o,f)=>{if(this._spriteRequest=null,o)this.fire(new n.t(o));else if(f)for(let g in f)this.imageManager.addImage(g,this.scope,f[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.x("data",{dataType:"style"}))})}_validateLayer(t){let o=this.getOwnSource(t.source);if(!o)return;let f=t.sourceLayer;f&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(f)===-1)&&this.fire(new n.t(new Error(`Source layer "${f}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(let{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,o)=>{let f=this.fragments[o];return f&&f.style&&(t.data=f.style.serialize()),t})}_serializeSources(){let t={};for(let o in this._sourceCaches){let f=this._sourceCaches[o].getSource();t[f.id]||(t[f.id]=f.serialize())}return t}_serializeLayers(t){let o=[];for(let f of t){let g=this._layers[f];g&&g.type!=="custom"&&o.push(g.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(let t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){let o=this.getOwnLayer(t);if(o)return o;this.fire(new n.t(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){let o=this.getOwnSource(t);if(o)return o;this.fire(new n.t(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){let f=this.map.painter;if(f)for(let g=t.minzoom||0;g<(t.maxzoom||25.5);g++){let v=t.getProgramIds();if(v)for(let b of v){let M=t.getDefaultProgramParams(b,o.zoom,this._styleColorTheme.lut);M&&(f.style=this,this.fog&&(f._fogVisible=!0,M.overrideFog=!0,f.getOrCreateProgram(b,M)),f._fogVisible=!1,M.overrideFog=!1,f.getOrCreateProgram(b,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,f.getOrCreateProgram(b,M)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);let o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));let f=this._changes.isDirty(),g=!1;if(this._changes.isDirty()){let b=this._changes.getLayerUpdatesByScope();for(let M in b){let{updatedIds:A,removedIds:O}=b[M];(A||O)&&(this._updateWorkerLayers(M,A,O),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}let v={};for(let b in this._mergedSourceCaches){let M=this._mergedSourceCaches[b];v[b]=M.used,M.used=!1,M.tileCoverLift=0}for(let b of this._mergedOrder){let M=this._mergedLayers[b];if(M.recalculate(t,this._availableImages),!M.isHidden(t.zoom)){let A=this.getLayerSourceCache(M);A&&(A.used=!0,A.tileCoverLift=Math.max(A.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,t)}):this.precompilePrograms(M,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();for(let b in v){let M=this._mergedSourceCaches[b];v[b]!==M.used&&M.getSource().fire(new n.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new n.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){let t=this._changes.getUpdatedImages();if(t.length){for(let o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,o,f){let g=this.getFragmentStyle(t);g&&this.dispatcher.broadcast("updateLayers",{layers:o?g._serializeLayers(o):[],scope:t,removedIds:f||[],options:g.options})}setState(t,o){if(this._checkLoaded(),Pr(this,Sr(t)))return!1;(t=n.cm(t)).layers=nf(t.layers);let f=function(b,M){if(!b)return[{command:bn.setStyle,args:[M]}];let A=[];try{if(!n.bi(b.version,M.version))return[{command:bn.setStyle,args:[M]}];if(n.bi(b.center,M.center)||A.push({command:bn.setCenter,args:[M.center]}),n.bi(b.zoom,M.zoom)||A.push({command:bn.setZoom,args:[M.zoom]}),n.bi(b.bearing,M.bearing)||A.push({command:bn.setBearing,args:[M.bearing]}),n.bi(b.pitch,M.pitch)||A.push({command:bn.setPitch,args:[M.pitch]}),n.bi(b.sprite,M.sprite)||A.push({command:bn.setSprite,args:[M.sprite]}),n.bi(b.glyphs,M.glyphs)||A.push({command:bn.setGlyphs,args:[M.glyphs]}),n.bi(b.imports,M.imports)||function(U=[],W=[],q){W=W||[];let X=(U=U||[]).map(pa),Z=W.map(pa),Q=U.reduce(ol,{}),re=W.reduce(ol,{}),oe=X.slice(),ae,ue,le,he;for(ae=0,ue=0;ae<X.length;ae++)le=X[ae],re.hasOwnProperty(le)?ue++:(q.push({command:bn.removeImport,args:[le]}),oe.splice(oe.indexOf(le,ue),1));for(ae=0,ue=0;ae<Z.length;ae++)le=Z[Z.length-1-ae],oe[oe.length-1-ae]!==le&&(Q.hasOwnProperty(le)?(q.push({command:bn.removeImport,args:[le]}),oe.splice(oe.lastIndexOf(le,oe.length-ue),1)):ue++,he=oe[oe.length-ae],q.push({command:bn.addImport,args:[re[le],he]}),oe.splice(oe.length-ae,0,le));for(let ge of W){let be=Q[ge.id];be&&!n.bi(be,ge)&&q.push({command:bn.updateImport,args:[ge.id,ge]})}}(b.imports,M.imports,A),n.bi(b.transition,M.transition)||A.push({command:bn.setTransition,args:[M.transition]}),n.bi(b.light,M.light)||A.push({command:bn.setLight,args:[M.light]}),n.bi(b.fog,M.fog)||A.push({command:bn.setFog,args:[M.fog]}),n.bi(b.projection,M.projection)||A.push({command:bn.setProjection,args:[M.projection]}),n.bi(b.lights,M.lights)||A.push({command:bn.setLights,args:[M.lights]}),n.bi(b.camera,M.camera)||A.push({command:bn.setCamera,args:[M.camera]}),!n.bi(b["color-theme"],M["color-theme"]))return[{command:bn.setStyle,args:[M]}];let O={},P=[];(function(U,W,q,X){let Z;for(Z in W=W||{},U=U||{})U.hasOwnProperty(Z)&&(W.hasOwnProperty(Z)||On(Z,q,X));for(Z in W){if(!W.hasOwnProperty(Z))continue;let Q=W[Z];U.hasOwnProperty(Z)?n.bi(U[Z],Q)||(U[Z].type==="geojson"&&Q.type==="geojson"&&Rt(U,W,Z)?q.push({command:bn.setGeoJSONSourceData,args:[Z,Q.data]}):m0(Z,W,q,X)):rf(Z,W,q)}})(b.sources,M.sources,P,O);let F=[];b.layers&&b.layers.forEach(U=>{U.source&&O[U.source]?A.push({command:bn.removeLayer,args:[U.id]}):F.push(U)});let z=b.terrain;z&&O[z.source]&&(A.push({command:bn.setTerrain,args:[void 0]}),z=void 0),A=A.concat(P),n.bi(z,M.terrain)||A.push({command:bn.setTerrain,args:[M.terrain]}),function(U,W,q){W=W||[];let X=(U=U||[]).map(pa),Z=W.map(pa),Q=U.reduce(ol,{}),re=W.reduce(ol,{}),oe=X.slice(),ae=Object.create(null),ue,le,he,ge,be,ye,_e;for(ue=0,le=0;ue<X.length;ue++)he=X[ue],re.hasOwnProperty(he)?le++:(q.push({command:bn.removeLayer,args:[he]}),oe.splice(oe.indexOf(he,le),1));for(ue=0,le=0;ue<Z.length;ue++)he=Z[Z.length-1-ue],oe[oe.length-1-ue]!==he&&(Q.hasOwnProperty(he)?(q.push({command:bn.removeLayer,args:[he]}),oe.splice(oe.lastIndexOf(he,oe.length-le),1)):le++,ye=oe[oe.length-ue],q.push({command:bn.addLayer,args:[re[he],ye]}),oe.splice(oe.length-ue,0,he),ae[he]=!0);for(ue=0;ue<Z.length;ue++)if(he=Z[ue],ge=Q[he],be=re[he],!ae[he]&&!n.bi(ge,be))if(n.bi(ge.source,be.source)&&n.bi(ge["source-layer"],be["source-layer"])&&n.bi(ge.type,be.type)){for(_e in Pc(ge.layout,be.layout,q,he,null,bn.setLayoutProperty),Pc(ge.paint,be.paint,q,he,null,bn.setPaintProperty),n.bi(ge.slot,be.slot)||q.push({command:bn.setSlot,args:[he,be.slot]}),n.bi(ge.filter,be.filter)||q.push({command:bn.setFilter,args:[he,be.filter]}),n.bi(ge.minzoom,be.minzoom)&&n.bi(ge.maxzoom,be.maxzoom)||q.push({command:bn.setLayerZoomRange,args:[he,be.minzoom,be.maxzoom]}),ge)ge.hasOwnProperty(_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&_e!=="slot"&&(_e.indexOf("paint.")===0?Pc(ge[_e],be[_e],q,he,_e.slice(6),bn.setPaintProperty):n.bi(ge[_e],be[_e])||q.push({command:bn.setLayerProperty,args:[he,_e,be[_e]]}));for(_e in be)be.hasOwnProperty(_e)&&!ge.hasOwnProperty(_e)&&_e!=="layout"&&_e!=="paint"&&_e!=="filter"&&_e!=="metadata"&&_e!=="minzoom"&&_e!=="maxzoom"&&_e!=="slot"&&(_e.indexOf("paint.")===0?Pc(ge[_e],be[_e],q,he,_e.slice(6),bn.setPaintProperty):n.bi(ge[_e],be[_e])||q.push({command:bn.setLayerProperty,args:[he,_e,be[_e]]}))}else q.push({command:bn.removeLayer,args:[he]}),ye=oe[oe.lastIndexOf(he)+1],q.push({command:bn.addLayer,args:[be,ye]})}(F,M.layers,A)}catch(O){console.warn("Unable to compute style diff:",O),A=[{command:bn.setStyle,args:[M]}]}return A}(this.serialize(),t).filter(b=>!(b.command in _l));if(f.length===0)return!1;let g=f.filter(b=>!(b.command in sh));if(g.length>0)throw new Error(`Unimplemented: ${g.map(b=>b.command).join(", ")}.`);let v=[];return f.forEach(b=>{v.push(this[b.command].apply(this,b.args))}),o&&Promise.all(v).then(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,o){return this.getImage(t)?this.fire(new n.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,o),this._afterImageUpdated(t),this)}updateImage(t,o){this.imageManager.updateImage(t,this.scope,o)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new n.t(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new n.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,o,f={}){return this._checkLoaded(),this._validate(we,`models.${t}`,o,null,f)||(this.modelManager.addModel(t,o,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new n.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,o,f={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(fa,`sources.${t}`,o,null,f))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);let g=Hu(t,o,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));let v=b=>{let M=(b?"symbol:":"other:")+g.id,A=n.av(M,this.scope),O=this._sourceCaches[M]=new br(A,g,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=O,O.onAdd(this.map)};v(!1),o.type!=="vector"&&o.type!=="geojson"||v(!0),g.onAdd&&g.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();let o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(let g in this._layers)if(this._layers[g].source===t)return this.fire(new n.t(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.t(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));let f=this.getOwnSourceCaches(t);for(let g of f){let v=n.cn(g.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(g.id),g.fire(new n.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){let o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){let t=[];for(let o in this._otherSourceCaches){let f=this.getOwnSourceCache(o);f&&t.push(f.getSource())}return t}areTilesLoaded(){let t=this._mergedSourceCaches;for(let o in t){let f=t[o]._tiles;for(let g in f){let v=f[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;let o=this._getTransitionParameters();for(let g of t){if(this._validate(Mc,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){let v=this.ambientLight;v.set(g),v.updateTransitions(o)}else this.ambientLight=new Nt(g,Sn||(Sn=new n.a0({color:new n.a1(n._.properties_light_ambient.color),intensity:new n.a1(n._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){let v=this.directionalLight;v.set(g),v.updateTransitions(o)}else this.directionalLight=new Nt(g,xn||(xn=new n.a0({direction:new n.ad(n._.properties_light_directional.direction),color:new n.a1(n._.properties_light_directional.color),intensity:new n.a1(n._.properties_light_directional.intensity),"cast-shadows":new n.a1(n._.properties_light_directional["cast-shadows"]),"shadow-intensity":new n.a1(n._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}let f=new n.a3(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;let f=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),g=t.properties.get("color").toRenderColor(null).toArray01(),v=t.properties.get("intensity"),b=t.properties.get("direction"),M=1-n.c8(b.x,b.y,b.z)[2]/90,A=f(g)*v*M,O=o.properties.get("color").toRenderColor(null).toArray01(),P=o.properties.get("intensity"),F=f(O)*P;return Number(((A+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(n.aK(t)){let o=n.co(t),f=this.fragments.find(({id:v})=>v===o);if(!f)throw new Error(`Style import '${t}' not found`);let g=n.cn(t);return f.style.getFragmentStyle(g)}{let o=this.fragments.find(({id:f})=>f===t);if(!o)throw new Error(`Style import '${t}' not found`);return o.style}}getFeaturesetDescriptors(t){let o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];let f=[];for(let g in o.stylesheet.featuresets)f.push({featuresetId:g,importId:o.scope?o.scope:void 0});return f}getFeaturesetLayers(t,o){let f=this.getFragmentStyle(o),g=f.stylesheet.featuresets;if(!g||!g[t])return this.fire(new n.t(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];let v=[];for(let b of g[t].selectors){let M=f.getOwnLayer(b.layer);M&&v.push(M)}return v}getConfigProperty(t,o){let f=this.getFragmentStyle(t);if(!f)return null;let g=n.av(o,f.scope),v=f.options.get(g),b=v?v.value||v.default:null;return b?b.serialize():null}setConfigProperty(t,o,f){let g=this.getFragmentStyle(t);if(!g)return;let v=g.stylesheet.schema;if(!v||!v[o])return;let b=n.M(f);if(b.result!=="success")return void Pr(this,b.value);let M=b.value.expression,A=n.av(o,g.scope),O=g.options.get(A);if(!O)return;let P,{minValue:F,maxValue:z,stepValue:U,type:W,values:q}=v[o],X=n.M(v[o].default);X.result==="success"&&(P=X.value.expression),P?(this.options.set(A,Un(bt({},O),{value:M,default:P,minValue:F,maxValue:z,stepValue:U,type:W,values:q})),this.updateConfigDependencies(o)):this.fire(new n.t(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){let o=this.getFragmentStyle(t);if(!o)return null;let f=o.stylesheet.schema;if(!f)return null;let g={};for(let v in f){let b=n.av(v,o.scope),M=o.options.get(b),A=M?M.value||M.default:null;g[v]=A?A.serialize():null}return g}setConfig(t,o){let f=this.getFragmentStyle(t);f&&(f.updateConfig(o,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){let o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){let f=this.getFragmentStyle(t);f&&(f.stylesheet.schema=o,f.updateConfig(f._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(let f in o){let g,v,b=n.M(o[f].default);if(b.result==="success"&&(g=b.value.expression),t&&t[f]!==void 0){let z=n.M(t[f]);z.result==="success"&&(v=z.value.expression)}let{minValue:M,maxValue:A,stepValue:O,type:P,values:F}=o[f];if(g){let z=n.av(f,this.scope);this.options.set(z,{default:g,value:v,minValue:M,maxValue:A,stepValue:O,type:P,values:F})}else this.fire(new n.t(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new n.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(let o of this._configDependentLayers){let f=this.getLayer(o);if(f){if(t&&!f.configDependencies.has(t))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(o=>{if(o._styleColorTheme.colorTheme){let f=o._evaluateColorThemeData(o._styleColorTheme.colorTheme);(!o._styleColorTheme.lut&&f!==""||o._styleColorTheme.lut&&f!==o._styleColorTheme.lut.data)&&o.setColorTheme(o._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(t,o,f={}){this._checkLoaded();let g=t.id;if(this._layers[g])return void this.fire(new n.t(new Error(`Layer with id "${g}" already exists on this map`)));let v;if(t.type==="custom"){if(Pr(this,n.cp(t)))return;v=n.cq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(g,t.source),t=n.cm(t),t=n.l(t,{source:g})),this._validate(Ne,`layers.${g}`,t,{arrayIndex:-1},f))return;v=n.cq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let b=this._order.length;if(o){let P=this._order.indexOf(o);if(P===-1)return void this.fire(new n.t(new Error(`Layer with id "${o}" does not exist on this map.`)));v.slot===this._layers[o].slot?b=P:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,g),this._layerOrderChanged=!0,this._layers[g]=v;let M=this.getOwnLayerSourceCache(v),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&v.canCastShadows()&&A&&(M.castsShadows=!0);let O=this._changes.getRemovedLayer(v);if(O&&v.source&&M&&v.type!=="custom"){this._changes.discardLayerRemoval(v);let P=n.av(v.source,v.scope);O.type!==v.type?this._changes.updateSourceCache(P,"clear"):(this._changes.updateSourceCache(P,"reload"),M.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();let f=this._checkLayer(t);if(!f||t===o)return;let g=this._order.indexOf(t);this._order.splice(g,1);let v=this._order.length;if(o){let b=this._order.indexOf(o);if(b===-1)return void this.fire(new n.t(new Error(`Layer with id "${o}" does not exist on this map.`)));f.slot===this._layers[o].slot?v=b:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();let o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);let f=this._order.indexOf(t);this._order.splice(f,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);let g=this.getOwnLayerSourceCache(o);if(g&&g.castsShadows){let v=!1;for(let b in this._layers)if(this._layers[b].source===o.source&&this._layers[b].canCastShadows()){v=!0;break}g.castsShadows=v}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(let o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,f){this._checkLoaded();let g=this._checkLayer(t);g&&(g.minzoom===o&&g.maxzoom===f||(o!=null&&(g.minzoom=o),f!=null&&(g.maxzoom=f),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();let f=this._checkLayer(t);f&&f.slot!==o&&(f.slot=o,this._updateLayer(f))}setFilter(t,o,f={}){this._checkLoaded();let g=this._checkLayer(t);if(g&&!n.bi(g.filter,o))return o==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Y,`layers.${g.id}.filter`,o,{layerType:g.type},f)||(g.filter=n.cm(o),this._updateLayer(g)))}getFilter(t){let o=this._checkLayer(t);if(o)return n.cm(o.filter)}setLayoutProperty(t,o,f,g={}){this._checkLoaded();let v=this._checkLayer(t);if(v&&!n.bi(v.getLayoutProperty(o),f)){if(f!=null&&(!g||g.validate!==!1)&&Pr(v,ce.call(Sr,{key:`layers.${t}.layout.${o}`,layerType:v.type,objectKey:o,value:f,styleSpec:n._,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(o,f),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(t,o){let f=this._checkLayer(t);if(f)return f.getLayoutProperty(o)}setPaintProperty(t,o,f,g={}){this._checkLoaded();let v=this._checkLayer(t);if(!v||n.bi(v.getPaintProperty(o),f)||f!=null&&(!g||g.validate!==!1)&&Pr(v,K.call(Sr,{key:`layers.${t}.paint.${o}`,layerType:v.type,objectKey:o,value:f,styleSpec:n._})))return;let b=v.setPaintProperty(o,f);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),b&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(t,o){let f=this._checkLayer(t);if(f)return f.getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();let f=t.featureset;if(f){if("featuresetId"in f){let O=this.getFragmentStyle(f.importId),P=O.getFeaturesetLayers(f.featuresetId);for(let{source:F,sourceLayer:z}of P)O.setFeatureState({id:t.id,source:F,sourceLayer:z},o)}else if("layerId"in f){let O=this.getLayer(f.layerId);this.setFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},o)}return}let g=t.source,v=t.sourceLayer,b=this._checkSource(g);if(!b)return;let M=b.type;if(M==="geojson"&&v)return void this.fire(new n.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!v)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided.")));let A=this.getOwnSourceCaches(g);for(let O of A)O.setFeatureState(v,t.id,o)}removeFeatureState(t,o){this._checkLoaded();let f=t.featureset;if(f){if("featuresetId"in f){let O=this.getFragmentStyle(f.importId),P=O.getFeaturesetLayers(f.featuresetId);for(let{source:F,sourceLayer:z}of P)O.removeFeatureState({id:t.id,source:F,sourceLayer:z},o)}else if("layerId"in f){let O=this.getLayer(f.layerId);this.removeFeatureState({id:t.id,source:O.source,sourceLayer:O.sourceLayer},o)}return}let g=t.source,v=this._checkSource(g);if(!v)return;let b=v.type,M=b==="vector"?t.sourceLayer:void 0;if(b==="vector"&&!M)return void this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.t(new Error("A feature id is required to remove its specific state property.")));let A=this.getOwnSourceCaches(g);for(let O of A)O.removeFeatureState(M,t.id,o)}getFeatureState(t){this._checkLoaded();let o=t.featureset;if(o){let b;if("featuresetId"in o){let M=this.getFragmentStyle(o.importId),A=M.getFeaturesetLayers(o.featuresetId);for(let{source:O,sourceLayer:P}of A){let F=M.getFeatureState({id:t.id,source:O,sourceLayer:P});if(F&&!b)b=F;else if(!n.bi(b,F))return void this.fire(new n.t(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t){let M=this.getLayer(o.layerId);b=this.getFeatureState({id:t.id,source:M.source,sourceLayer:M.sourceLayer})}return b}let f=t.source,g=t.sourceLayer,v=this._checkSource(f);if(v){if(v.type!=="vector"||g)return t.id===void 0&&this.fire(new n.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(f)[0].getFeatureState(g,t.id);this.fire(new n.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=n.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return n.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();let t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(t){for(let o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);let o=this.getLayerSourceCache(t),f=n.av(t.source,t.scope),g=this._changes.getUpdatedSourceCaches();t.source&&!g[f]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){let o=M=>this._mergedLayers[M].is3D(),f=this.order,g={},v=[];for(let M=f.length-1;M>=0;M--){let A=f[M];if(o(A)){g[A]=M;for(let O of t){let P=O[A];if(P)for(let F of P)v.push(F)}}}v.sort((M,A)=>A.intersectionZ-M.intersectionZ);let b=[];for(let M=f.length-1;M>=0;M--){let A=f[M];if(o(A))for(let O=v.length-1;O>=0;O--){let P=v[O].feature;if(P.layer&&g[P.layer.id]<M)break;b.push(P),v.pop()}else for(let O of t){let P=O[A];if(P)for(let F of P)b.push(F.feature)}}return b}queryRenderedFeatures(t,o,f){o&&!Array.isArray(o)&&o.filter&&this._validate(Y,"queryRenderedFeatures.filter",o.filter,null,o);let g,v=!1,b=new Set;if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.t(new Error("parameters.layers must be an Array."))),[];g=[];for(let P of o.layers){let F=this._mergedLayers[P];if(!F)return this.fire(new n.t(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];F.is3D()&&(v=!0),b.add(F.source),g.push(P)}}else v=this.has3DLayers();let M=this._queryRenderedFeatures(t,f,{layerIds:g,filter:o.filter,has3DLayers:v,includedSources:b}),A=this._flattenAndSortRenderedFeatures(M),O=[];for(let P of A)n.co(P.layer.id)===this.scope&&O.push(P);return O}queryRenderedFeaturesForInteractions(t,o,f){let g=[];for(let{featureset:A,filter:O,radius:P}of o){let F=!1,z=[],U=new Set;if("featuresetId"in A){let q=this.getFeaturesetLayers(A.featuresetId,A.importId);if(q.length===0)continue;for(let X of q)X.is3D()&&(F=!0),U.add(X.source),z.push(X.fqid)}else if("layerId"in A){let q=this._mergedLayers[A.layerId];if(!q)return this.fire(new n.t(new Error(`The layer '${A.layerId}' does not exist in the map's style and cannot be queried for features.`))),[];q.is3D()&&(F=!0),U.add(q.source),z.push(A.layerId)}let W=t;if(P)if(t instanceof n.P||typeof t[0]=="number"){let q=n.P.convert(t);W=[[q.x-P,q.y-P],[q.x+P,q.y+P]]}else{let q=n.P.convert(t[0]),X=n.P.convert(t[1]);W=[[q.x-P,q.y-P],[X.x+P,X.y+P]]}g=g.concat(this._queryRenderedFeatures(W,f,{layerIds:z,filter:O,has3DLayers:F,includedSources:U}))}let v=this._flattenAndSortRenderedFeatures(g),b=(A,O,P)=>{let F=A.clone();if(delete F.layer,F.featureset=O,P&&P.featureNamespace&&(F.namespace=P.featureNamespace),P&&P.properties){let z={},U=this.map.transform.zoom;for(let W of Object.keys(P.properties)){let q=P.properties[W].evaluate({zoom:U},A._vectorTileFeature,A.state,A.tile,this._availableImages);q!=null&&(z[W]=q)}F.properties=z}return F},M=[];for(let A of v){let O=A.layer.id,P=n.cn(O),F=n.co(O);for(let{featureset:z}of o){if("layerId"in z&&z.layerId!==O)continue;if("layerId"in z&&z.layerId===O){let W=b(A,z);M.push(W);continue}if("featuresetId"in z&&(z.importId!==F||!this.getFeaturesetLayers(z.featuresetId,z.importId).map(W=>W.id).includes(P)))continue;let U=this._mergedLayerSelectors.get(O)||[];for(let W of U){let q=b(A,z,W);M.push(q)}}}return M}_queryRenderedFeatures(t,o,f){let{layerIds:g,filter:v,has3DLayers:b,includedSources:M}=f,A=[],O=en.createFromScreenPoints(t,o);for(let P in this._mergedSourceCaches){if(!this._mergedSourceCaches[P].getSource())continue;let F=this._mergedSourceCaches[P].getSource().id;g&&!M.has(F)||A.push(Jd(this._mergedSourceCaches[P],this._mergedLayers,O,v,g||[],this._availableImages,o,b,!!this.map._showQueryGeometry))}return this.placement&&A.push(function(P,F,z,U,W,q,X,Z){let Q={},re=X.queryRenderedSymbols(z),oe=[];for(let ae of Object.keys(re).map(Number))oe.push(Z[ae]);oe.sort(tl);for(let ae of oe){let ue=ae.featureIndex.lookupSymbolFeatures(re[ae.bucketInstanceId],ae.bucketIndex,ae.sourceLayerIndex,U,W,q,P);for(let le in ue){let he=Q[le]=Q[le]||[],ge=ue[le];ge.sort((be,ye)=>{let _e=ae.featureSortOrder;if(_e){let Oe=_e.indexOf(be.featureIndex);return _e.indexOf(ye.featureIndex)-Oe}return ye.featureIndex-be.featureIndex});for(let be of ge)he.push(be)}}for(let ae in Q)Q[ae].forEach(ue=>{let le=ue.feature,he=P[ae],ge=F(he);if(!ge)return;let be=ge.getFeatureState(le.layer["source-layer"],le.id);le.state=be,n.aK(he.id)||(le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]))});return Q}(this._mergedLayers,this.getLayerSourceCache.bind(this),O.screenGeometry,v,g||[],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData)),A}querySourceFeatures(t,o){let f=o&&o.filter;f&&this._validate(Y,"querySourceFeatures.filter",f,null,o);let g=[],v=this.getOwnSourceCaches(t);for(let b of v)g=g.concat(Kd(b,o));return g}addSourceType(t,o,f){return Or.getSourceType(t)?f(new Error(`A source type called "${t}" already exists.`)):(Or.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,f={}){this._checkLoaded();let g=this.light.getLight(),v=!1;for(let M in t)if(!n.bi(t[M],g[M])){v=!0;break}if(!v)return;let b=this._getTransitionParameters();this.light.setLight(t,o,f),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=t,g=t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){let M="terrain-dem-src";this.addSource(M,f.source),f=n.cm(f),f=n.l(f,{source:M})}let v=n.l({},f),b={};if(this.terrain&&g){v.source=this.terrain.get().source;let M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(b.style=M.serialize())}if(this._validate(el,"terrain",v,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&o!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,o),this.fire(new n.x("data",{dataType:"style"}))}else{let v=this.terrain,b=v.get();for(let M of Object.keys(n._.terrain))!f.hasOwnProperty(M)&&n._.terrain[M].default&&(f[M]=n._.terrain[M].default);for(let M in t)if(!n.bi(t[M],b[M])){v.set(t,this.options),this.stylesheet.terrain=t;let A=this._getTransitionParameters({duration:0});v.updateTransitions(A),this.fire(new n.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){let o=this.fog=new $t(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();let f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let o=this.fog;if(!n.bi(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();let f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}}else this._createFog(t);this._markersNeedUpdate=!0}setColorTheme(t){this._checkLoaded();let o=()=>{for(let g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(let g in this._sourceCaches)this._sourceCaches[g].clearTiles()};if(this._styleColorTheme.colorTheme=t,!t)return this._styleColorTheme.lut=null,void o();let f=this._evaluateColorThemeData(t);this._loadColorTheme(f).then(()=>{this.fire(new n.x("colorthemeset")),o()}).catch(g=>{n.w(`Couldn't set color theme: ${g}`)})}_getTransitionParameters(t){return{now:n.q.now(),transition:n.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;let t=[],o=[];for(let f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?t.push(f):o.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){let f=this.terrain=new Fe(t,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let g=this._getTransitionParameters({duration:0});f.updateTransitions(g)}_force3DLayerUpdate(){for(let t in this._layers){let o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(let t in this._layers){let o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,f,g,v={}){if(v&&v.validate===!1)return!1;let b=n.l({},this.serialize());return Pr(this,t.call(Sr,n.l({key:o,style:b,value:f,styleSpec:n._},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(let t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){let o=this.getSourceCaches(t);for(let f of o)f.clearTiles()}clearSources(){for(let t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){let o=this.getSourceCaches(t);for(let f of o)f.resume(),f.reload()}reloadSources(){for(let t of this.getSources())t.reload&&t.reload()}updateSources(t){let o;this.directionalLight&&(o=ih(this.directionalLight));for(let f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(t,void 0,void 0,o)}_generateCollisionBoxes(){for(let t in this._sourceCaches){let o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,f,g,v,b,M=!1){let A=!1,O=!1,P={},F={};for(let z of this._mergedOrder){let U=this._mergedLayers[z];if(U.type!=="symbol")continue;let W=n.av(U.source,U.scope),q=P[W];if(!q){let Z=this.getLayerSourceCache(U);if(!Z)continue;let Q=Z.getRenderableIds(!0).map(re=>Z.getTileByID(re));F[W]=Q.slice(),q=P[W]=Q.sort((re,oe)=>oe.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(oe.tileID)?-1:1))}let X=this.crossTileSymbolIndex.addLayer(U,q,o.center.lng,o.projection);A=A||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new n.x("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),o.zoom))&&(this.pauseablePlacement=new Oc(o,this._mergedOrder,M,f,g,v,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,P,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),O=!0),A&&this.pauseablePlacement.placement.setStale()),O||A){this._buildingIndex.onNewFrame(o.zoom);for(let z=0;z<this._mergedOrder.length;z++){let U=this._mergedLayers[this._mergedOrder[z]];if(U.type!=="symbol")continue;let W=this.isLayerClipped(U);this.placement.updateLayerOpacities(U,P[n.av(U.source,U.scope)],z,W?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(let t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();let f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:v})=>v===t.id)!==-1)return void this.fire(new n.t(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return f.push(t),this._loadImports([t],!0);let g=f.findIndex(({id:v})=>v===o);return g===-1&&this.fire(new n.t(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,g).concat(t).concat(f.slice(g)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(t);return g===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==f[g].url&&this.setImportUrl(t,o.url),n.bi(o.config,f[g].config)||this.setImportConfig(t,o.config),n.bi(o.data,f[g].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;let v=this.getImportIndex(o);if(v===-1)return this;let b=f[g],M=this.fragments[g];return f=f.filter(({id:A})=>A!==t),this.fragments=this.fragments.filter(({id:A})=>A!==t),this.stylesheet.imports=f.slice(0,v).concat(b).concat(f.slice(v)),this.fragments=this.fragments.slice(0,v).concat(M).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();let f=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;f[g].url=o;let v=this.fragments[g];return v.style=this._createFragmentStyle(f[g]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();let f=this.getImportIndex(t),g=this.stylesheet.imports||[];return f===-1?this:o?(this.fragments[f].style.setState(o),this._reloadImports(),this):(delete g[f].data,this.setImportUrl(t,g[f].url))}setImportConfig(t,o){this._checkLoaded();let f=this.getImportIndex(t),g=this.stylesheet.imports||[];if(f===-1)return this;o?g[f].config=o:delete g[f].config;let v=this.fragments[f],b=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=o,v.style.updateConfig(o,b),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();let o=this.stylesheet.imports||[],f=this.getImportIndex(t);f!==-1&&(o.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(t){let o=(this.stylesheet.imports||[]).findIndex(f=>f.id===t);return o===-1&&this.fire(new n.t(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){let t=[];for(let o in this._mergedOtherSourceCaches){let f=this._mergedOtherSourceCaches[o];f&&t.push(f.getSource())}return t}getSource(t,o){let f=this.getSourceCache(t,o);return f&&f.getSource()}getLayerSource(t){let o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){let f=n.av(t,o);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(t){let o=n.av(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);let o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){let t=this._changes.getUpdatedSourceCaches();for(let o in t){let f=t[o];f==="reload"?this.reloadSource(o):f==="clear"&&this.clearSource(o)}}updateLayers(t){let o=this._changes.getUpdatedPaintProperties();for(let f of o){let g=this.getLayer(f);g&&g.updateTransitions(t)}}getImages(t,o,f){this.imageManager.getImages(o.icons,o.scope,f),this._updateTilesForChangedImages();let g=v=>{v&&v.setDependencies(o.tileID.key,o.type,o.icons)};g(this._otherSourceCaches[o.source]),g(this._symbolSourceCaches[o.source])}getGlyphs(t,o,f){this.glyphManager.getGlyphs(o.stacks,o.scope,f)}getResource(t,o,f){return n.ct(o,f)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){let o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){let o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new n.t(new Error(`There is no source with ID '${t}'`))),!1):o.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;let f=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(f||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Or.getSourceType=function(h){return Gu[h]},Or.setSourceType=function(h,t){Gu[h]=t},Or.registerForPluginStateChange=n.cd;var cg=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,df=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ff=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ah="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ug=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,hg=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,dg=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,fg=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,pf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,pg=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Lc=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let lh=[];Ns(cg,lh),Ns(ff,lh),Ns(df,lh);let Fc={"_prelude_fog.vertex.glsl":hg,"_prelude_terrain.vertex.glsl":ug,"_prelude_shadow.vertex.glsl":pg,"_prelude_fog.fragment.glsl":dg,"_prelude_shadow.fragment.glsl":Lc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":fg,"_prelude_raster_particle.glsl":pf},yl={};dn("",ug),dn(dg,hg),dn(Lc,pg),dn(fg,""),dn(pf,"");let Nc=dn(df,ff),ch=cg;var Fs={background:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:dn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:dn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:dn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:dn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:dn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:dn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:dn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:dn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:dn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:dn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:dn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:dn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:dn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:dn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ah),skyboxGradient:dn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ah),skyboxCapture:dn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:dn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:dn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:dn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:dn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),occlusion:dn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ns(h,t){let o=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of o)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let g=f.split(" ");for(let v of g)t.includes(v)||t.push(v)}}function dn(h,t){let o=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,g=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(O=>{let P=O.split(" ");return P[P.length-1]}),g=[...new Set(g)]);let v={},b=[],M=[];if(h=h.replace(o,(O,P)=>(M.push(P),"")),(t=t.replace(o,(O,P)=>(b.push(P),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...lh];Ns(h,A),Ns(t,A);for(let O of[...b,...M])Fc[O]||console.error(`Undefined include: ${O}`),yl[O]||(yl[O]=[],Ns(Fc[O],yl[O])),A=[...A,...yl[O]];return{fragmentSource:h=h.replace(f,(O,P,F,z,U)=>(v[U]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${U}
in ${F} ${z} ${U};
#else
uniform ${F} ${z} u_${U};
#endif
`:P==="initialize"?`
#ifdef HAS_UNIFORM_u_${U}
    ${F} ${z} ${U} = u_${U};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${F} ${z} ${U};
#endif
`:P==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(f,(O,P,F,z,U)=>{let W=z==="float"?"vec2":z,q=U.match(/color/)?"color":W;return P==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${U}
in ${F} ${z} a_${U};
#endif
`:v[U]?P==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${F} ${W} a_${U};
out ${F} ${z} ${U};
#else
uniform ${F} ${z} u_${U};
#endif
`:P==="initialize"?q==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${F} ${z} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${q}(a_${U}, u_${U}_t);
#else
    ${F} ${z} ${U} = u_${U};
#endif
`:P==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${F} ${z} a_${U};
    out ${F} ${z} ${U};
#endif
`:P==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${U} = a_${U};
#endif
`:void 0:P==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${F} ${W} a_${U};
#else
uniform ${F} ${z} u_${U};
#endif
`:P==="define-instanced"?q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${U}0;
in vec4 a_${U}1;
in vec4 a_${U}2;
in vec4 a_${U}3;
#else
uniform ${F} ${z} u_${U};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${W} a_${U};
#else
uniform ${F} ${z} u_${U};
#endif
`:P==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${F} ${z} ${U} = a_${U};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${F} ${z} ${U} = a_${U};
#else
    ${F} ${z} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${F} ${z} ${U} = unpack_mix_${q}(a_${U}, u_${U}_t);
#else
    ${F} ${z} ${U} = u_${U};
#endif
`}),staticAttributes:g,usedDefines:A,vertexIncludes:b,fragmentIncludes:M}}class vl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,f,g,v,b,M,A){this.context=t;let O=this.boundPaintVertexBuffers.length!==g.length;for(let F=0;!O&&F<g.length;F++)this.boundPaintVertexBuffers[F]!==g[F]&&(O=!0);let P=this.boundDynamicVertexBuffers.length!==M.length;for(let F=0;!P&&F<M.length;F++)this.boundDynamicVertexBuffers[F]!==M[F]&&(P=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==f||O||P||this.boundIndexBuffer!==v||this.boundVertexOffset!==b)this.freshBind(o,f,g,v,b,M,A);else{t.bindVertexArrayOES.set(this.vao);for(let F of M)F&&(F.bind(),A&&F.instanceCount&&F.setVertexAttribDivisor(t.gl,o,A));v&&v.dynamicDraw&&v.bind()}}freshBind(t,o,f,g,v,b,M){let A=t.numAttributes,O=this.context,P=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=b,o.enableAttributes(P,t),o.bind(),o.setVertexAttribPointers(P,t,v);for(let F of f)F.enableAttributes(P,t),F.bind(),F.setVertexAttribPointers(P,t,v);for(let F of b)F&&(F.enableAttributes(P,t),F.bind(),F.setVertexAttribPointers(P,t,v),M&&F.instanceCount&&F.setVertexAttribDivisor(P,t,M));g&&g.bind(),O.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function zc(h,t){let o=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new n.a5(0,f/o).toLngLat().lat,new n.a5(0,(f+1)/o).toLngLat().lat]}function uh(h,t,o,f,g,v,b){let M=h.context,A=M.gl,O=o.hillshadeFBO;if(!O)return;h.prepareDrawTile();let P=h.isTileAffectedByFog(t),F=h.getOrCreateProgram("hillshade",{overrideFog:P});M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,O.colorAttachment.get());let z=((X,Z,Q,re)=>{let oe=Q.paint.get("hillshade-shadow-color"),ae=Q.paint.get("hillshade-highlight-color"),ue=Q.paint.get("hillshade-accent-color"),le=Q.paint.get("hillshade-emissive-strength"),he=n.bC(Q.paint.get("hillshade-illumination-direction"));if(Q.paint.get("hillshade-illumination-anchor")==="viewport")he-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){let be=X.style.directionalLight.properties.get("direction"),ye=n.c8(be.x,be.y,be.z);he=n.bC(ye[1])}let ge=!X.options.moving;return{u_matrix:re||X.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),ge),u_image:0,u_latrange:zc(0,Z.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),he],u_shadow:oe.toRenderColor(Q.lut),u_highlight:ae.toRenderColor(Q.lut),u_emissive_strength:le,u_accent:ue.toRenderColor(Q.lut)}})(h,o,f,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(M,F,t.toUnwrapped());let{tileBoundsBuffer:U,tileBoundsIndexBuffer:W,tileBoundsSegments:q}=h.getTileBoundsBuffers(o);F.draw(h,A.TRIANGLES,g,v,b,zt.disabled,z,f.id,U,W,q)}function Bc(h,t,o){if(!t.needsDEMTextureUpload)return;let f=h.context,g=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(o.stride);let v=o.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new n.T(f,v,g.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function xl(h,t,o){let f=h.context,g=f.gl;if(!t.dem)return;let v=t.dem;if(f.activeTexture.set(g.TEXTURE1),Bc(h,t,v),!t.demTexture)return;t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);let b=v.dim;f.activeTexture.set(g.TEXTURE0);let M=t.hillshadeFBO;if(!M){let z=new n.T(f,{width:b,height:b,data:null},g.RGBA8);z.bind(g.LINEAR,g.CLAMP_TO_EDGE),M=t.hillshadeFBO=f.createFramebuffer(b,b,!0,"renderbuffer"),M.colorAttachment.set(z.texture)}f.bindFramebuffer.set(M.framebuffer),f.viewport.set([0,0,b,b]);let{tileBoundsBuffer:A,tileBoundsIndexBuffer:O,tileBoundsSegments:P}=h.getMercatorTileBoundsBuffers(),F=[];h.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(h,g.TRIANGLES,Ct.disabled,Gt.disabled,sn.unblended,zt.disabled,((z,U)=>{let W=U.stride,q=n.a6.mat4.create();return n.a6.mat4.ortho(q,0,n.ab,-n.ab,0,0,1),n.a6.mat4.translate(q,q,[0,-n.ab,0]),{u_matrix:q,u_image:1,u_dimension:[W,W],u_zoom:z.overscaledZ}})(t.tileID,v),o.id,A,O,P),t.needsHillshadePrepare=!1}class Hn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mf extends Hn{getDefault(){return n.bA.transparent}set(t){let o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class mg extends Hn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class gf extends Hn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class hh extends Hn{getDefault(){return[!0,!0,!0,!0]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Vc extends Hn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class gg extends Hn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class _g extends Hn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class yg extends Hn{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class bl extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class vg extends Hn{getDefault(){return[0,1]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class x0 extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class b0 extends Hn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class w0 extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class _f extends Hn{getDefault(){let t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class yf extends Hn{getDefault(){return n.bA.transparent}set(t){let o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class vf extends Hn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class xf extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class xg extends Hn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class bg extends Hn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let E0=class extends Hn{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class jc extends Hn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Uc extends Hn{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class wg extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class kr extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class bf extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class dh extends Hn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class fh extends Hn{getDefault(){return null}set(t){let o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wf extends Hn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Ef extends Hn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ph extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class If extends Hn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class $c extends Hn{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class mh extends $c{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Tf extends $c{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Eg extends $c{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class wl extends Tf{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}let I0=(h,t,o)=>({u_matrix:h,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:o}),Ig=(h,t,o,f,g,v,b,M,A,O,P,F,z,U,W,q)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:o,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_frustum_tl:b,u_frustum_tr:M,u_frustum_br:A,u_frustum_bl:O,u_globe_pos:P,u_globe_radius:F,u_viewport:z,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9),u_skirt_height:U,u_far_z_cutoff:W});function Tg(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}let El=new class{constructor(){this.operations={}}newMorphing(h,t,o,f,g){if(h in this.operations){let v=this.operations[h];v.to.tileID.key!==o.tileID.key&&(v.queued=o)}else this.operations[h]={startTime:f,phase:0,duration:g,from:t,to:o,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;let t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(let t in this.operations){let o=this.operations[t];for(o.phase=(h-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Cg={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Dg(h,t,o){if(t===0)return 0;let f=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*f}function Cf(h,t){let o=1<<h.z;return!t&&(h.x===0||h.x===o-1)||h.y===0||h.y===o-1}let Gc=h=>({u_matrix:h});function gh(h,t,o,f,g){if(g>0){let v=n.q.now(),b=(v-h.timeAdded)/g,M=t?(v-t.timeAdded)/g:-1,A=o.getSource(),O=f.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),P=!t||Math.abs(t.tileID.overscaledZ-O)>Math.abs(h.tileID.overscaledZ-O),F=P&&h.refreshedUponExpiration?1:n.ap(P?b:1-M,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Il extends br{constructor(t){let o={type:"raster-dem",maxzoom:t.transform.maxZoom},f=new n.ce(n.cf(),null),g=Hu("mock-dem",o,f,t.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class Mg extends br{constructor(t){let o=Hu("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new n.ce(n.cf(),null),t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,f){if(t.freezeTileCoverage)return;this.transform=t;let g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,b)=>{if(v[b.key]="",!this._tiles[b.key]){let M=new Oo(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom);M.state="loaded",this._tiles[b.key]=M}return v},{});for(let v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){let o=this.proxyCachedFBO[t];if(o!==void 0){let f=Object.values(o);this.renderCachePool.push(...f),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Df extends n.aA{constructor(t,o,f){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=f}}class Mf extends n.cE{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[f,g,v]=function(A){let O=new n.a$,P=new n.aP,F=131;O.reserve(17161),P.reserve(33800);let z=n.ab/128,U=n.ab+z/2,W=U+z;for(let X=-z;X<W;X+=z)for(let Z=-z;Z<W;Z+=z){let Q=Z<0||Z>U||X<0||X>U?24575:0,re=n.ap(Math.round(Z),0,n.ab),oe=n.ap(Math.round(X),0,n.ab);O.emplaceBack(re+Q,oe)}let q=(X,Z)=>{let Q=Z*F+X;P.emplaceBack(Q+1,Q,Q+F),P.emplaceBack(Q+F,Q+F+1,Q+1)};for(let X=1;X<129;X++)for(let Z=1;Z<129;Z++)q(Z,X);return[0,129].forEach(X=>{for(let Z=0;Z<130;Z++)q(Z,X),q(X,Z)}),[O,P,32768]}(),b=t.context;this.gridBuffer=b.createVertexBuffer(f,n.b1.members),this.gridIndexBuffer=b.createIndexBuffer(g),this.gridSegments=n.b2.simpleSegment(0,0,f.length,g.length),this.gridNoSkirtSegments=n.b2.simpleSegment(0,0,f.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Mg(o.map),this.orthoMatrix=n.a6.mat4.create(),n.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.ab,0,n.ab,0,1);let M=b.gl;this._overlapStencilMode=new Gt({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Il(o.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,o,f){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);let g=t.terrain.properties,v=t.terrain.drapeRenderMode===0,b=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();let M=t.terrain&&t.terrain.scope,A=g.get("source"),O=v?this._mockSourceCache:t.getSourceCache(A,M);if(!O)return void n.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=O,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(o):g.get("exaggeration"),!o.projection.requiresDraping&&b&&this._exaggeration===0)return void this._disable();this.enabled=!0;let P=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let F=this.getScaledDemTileSize();this.sourceCache.update(o,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),o.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);let o=this._previousCameraAltitude,f=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=f;let g=o!=null?f-o:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;let v=t.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(v);let M=v-this._previousZoom,A=this._previousUpdateTimestamp,O=v;this._evaluationZoom!=null&&(O=this._evaluationZoom,Math.abs(v-O)>.5&&(M=.5*(v-O+M)),M*g<0&&(O+=M)),this._evaluationZoom=O;let P=b.getExaggeration(O),F=P===b.getExaggeration(Math.max(0,O-.1));if(F&&Math.abs(P-this._exaggeration)<.01)return P;let z=Math.min(.1,.00375*(this._updateTimestamp-A));return(F||P<.1||Math.abs(M)<1e-4)&&(z=Math.min(.2,4*z)),n.aa(this._exaggeration,P,z)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let o=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(n.a5.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let g=this.proxyCoords=o.getIds().map(A=>{let O=o.getTileByID(A).tileID;return O.projMatrix=f.calculateProjMatrix(O.toUnwrapped()),O});(function(A,O){let P=O.transform.pointCoordinate(O.transform.getCameraPoint()),F=new n.P(P.x,P.y);A.sort((z,U)=>{if(U.overscaledZ-z.overscaledZ)return U.overscaledZ-z.overscaledZ;let W=new n.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),q=new n.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),X=F.mult(1<<z.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(W)-X.distSqr(q)})})(g,this.painter);let v=this.proxyToSource||{};this.proxyToSource={},g.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};let b=this._style._mergedSourceCaches;for(let A in b){let O=b[A];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,t[A],v),O.usedForTerrain))continue;let P=t[A];O.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[o.id]=g.map(A=>new Df(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;let M={};this._visibleDemTiles=[];for(let A of this.proxyCoords){let O=this.terrainTileForTile[A.key];if(!O)continue;let P=O.tileID.key;P in M||(this._visibleDemTiles.push(O),M[P]=P)}}_assignTerrainTiles(t){this._initializing||t.forEach(o=>{if(this.terrainTileForTile[o.key])return;let f=this._findTileCoveringTileID(o,this.sourceCache);f&&(this.terrainTileForTile[o.key]=f)})}_prepareDEMTextures(){let t=this.painter.context,o=t.gl;for(let f in this.terrainTileForTile){let g=this.terrainTileForTile[f],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),Bc(this.painter,g,v))}}_prepareDemTileUniforms(t,o,f,g){if(!o||o.demTexture==null)return!1;let v=t.tileID.canonical,b=Math.pow(2,o.tileID.canonical.z-v.z),M=g||"";return f[`u_dem_tl${M}`]=[v.x*b%1,v.y*b%1],f[`u_dem_scale${M}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0,o=this._visibleDemTiles.reduce((f,g)=>{if(!g.dem)return f;let v=g.dem.tree.minimums[0];return v>0&&t++,f+v},0);return t?o/t:0}_updateEmptyDEMTexture(){let t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);let f=this._getLoadedAreaMinimum(),g=new n.cF({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(g,{premultiply:!1}):v=this._emptyDEMTexture=new n.T(t,g,o.R32F,{premultiply:!1}),v}setupElevationDraw(t,o,f){let g=this.painter.context,v=g.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let M=null,A=null,O=1;if(f&&f.morphing&&this._useVertexMorphing){let U=f.morphing.srcDemTile,W=f.morphing.dstDemTile;O=f.morphing.phase,U&&W&&(this._prepareDemTileUniforms(t,U,b,"_prev")&&(A=U),this._prepareDemTileUniforms(t,W,b)&&(M=W))}let P=U=>U&&U.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST,F=null;var z;if(this.enabled?A&&M?(F=M.demTexture,g.activeTexture.set(v.TEXTURE4),A.demTexture.bind(P(A),v.CLAMP_TO_EDGE),b.u_dem_lerp=O):(M=this.terrainTileForTile[t.tileID.key],F=this._prepareDemTileUniforms(t,M,b)?M.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,g.activeTexture.set(v.TEXTURE2),F&&(b.u_dem_size=(z=F).size[0]===1?1:z.size[0]-2,F.bind(P(M),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,o,b),f&&f.useMeterToDem&&M){let U=(1<<M.tileID.canonical.z)*n.bE(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=U}if(f&&f.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),o.setTerrainUniformValues(g,b),this.painter.transform.projection.name==="globe"){let U=this.globeUniformValues(this.painter.transform,t.tileID.canonical,f&&f.useDenormalizedUpVectorScale);o.setGlobeUniformValues(g,U)}}globeUniformValues(t,o,f){let g=t.projection;return{u_tile_tl_up:g.upVector(o,0,0),u_tile_tr_up:g.upVector(o,n.ab,0),u_tile_br_up:g.upVector(o,n.ab,n.ab),u_tile_bl_up:g.upVector(o,0,n.ab),u_tile_up_scale:f?n.cG(1):g.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){let o=this.painter,f=this.painter.context;t.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,v,b,M,A){if(g.transform.projection.name==="globe")(function(O,P,F,z,U){let W=O.context,q=W.gl,X,Z,Q=O.transform,re=n.cx(O,W,Q),oe=(Oe,Ve)=>{if(Z===Ve)return;let Ze=[Cg[Ve],"PROJECTION_GLOBE_VIEW"];re&&Ze.push("CUSTOM_ANTIALIASING");let Ke=O.isTileAffectedByFog(Oe);X=O.getOrCreateProgram("globeRaster",{defines:Ze,overrideFog:Ke}),Z=Ve},ae=O.colorModeForRenderPass(),ue=new Ct(q.LEQUAL,Ct.ReadWrite,O.depthRangeFor3D);El.update(U);let le=n.cy(Q),he=[n.am(Q.center.lng),n.at(Q.center.lat)],ge=O.globeSharedBuffers,be=[Q.width*n.q.devicePixelRatio,Q.height*n.q.devicePixelRatio],ye=Float32Array.from(Q.globeMatrix),_e={useDenormalizedUpVectorScale:!0};{let Oe=O.transform,Ve=Dg(Oe.zoom,P.exaggeration(),P.sourceCache._source.tileSize);Z=-1;let Ze=q.TRIANGLES;for(let Ke of z){let nt=F.getTile(Ke),Ce=Gt.disabled,qe=P.prevTerrainTileForTile[Ke.key],ke=P.terrainTileForTile[Ke.key];Tg(qe,ke)&&El.newMorphing(Ke.key,qe,ke,U,250),W.activeTexture.set(q.TEXTURE0),nt.texture&&nt.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let We=El.getMorphValuesForProxy(Ke.key),Xe=We?1:0;We&&n.C(_e,{morphing:{srcDemTile:We.from,dstDemTile:We.to,phase:n.cw(We.phase)}});let Ge=n.cz(Ke.canonical),at=n.cA(Ge.getCenter().lat),vt=n.cB(Ke.canonical,Ge,at,Oe.worldSize/Oe._pixelsPerMercatorPixel),Et=n.b6(n.cC(Ke.canonical)),pt=Ig(Oe.expandedFarZProjMatrix,ye,le,Et,n.a9(Oe.zoom),he,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,be,Ve,Oe._farZ,vt);if(oe(Ke,Xe),X&&(P.setupElevationDraw(nt,X,_e),O.uploadCommonUniforms(W,X,Ke.toUnwrapped()),ge)){let[Tt,ut,Mt]=ge.getGridBuffers(at,Ve!==0);X.draw(O,Ze,ue,Ce,ae,zt.backCCW,pt,"globe_raster",Tt,ut,Mt)}}}if(ge&&(O.renderDefaultNorthPole||O.renderDefaultSouthPole)){let Oe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&Oe.push("CUSTOM_ANTIALIASING"),X=O.getOrCreateProgram("globeRaster",{defines:Oe});for(let Ve of z){let{x:Ze,y:Ke,z:nt}=Ve.canonical,Ce=Ke===0,qe=Ke===(1<<nt)-1,[ke,We,Xe,Ge]=ge.getPoleBuffers(nt,!1);if(Ge&&(Ce||qe)){let at=F.getTile(Ve);W.activeTexture.set(q.TEXTURE0),at.texture&&at.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let vt=n.cD(nt,Ze,Q),Et=n.b6(n.cC(Ve.canonical)),pt=(Tt,ut)=>Tt.draw(O,q.TRIANGLES,ue,Gt.disabled,ae,zt.disabled,Ig(Q.expandedFarZProjMatrix,vt,vt,Et,0,he,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,be,0,Q._farZ),"globe_pole_raster",ut,Xe,Ge);P.setupElevationDraw(at,X,_e),O.uploadCommonUniforms(W,X,Ve.toUnwrapped()),Ce&&O.renderDefaultNorthPole&&pt(X,ke),qe&&O.renderDefaultSouthPole&&(vt=n.a6.mat4.scale(n.a6.mat4.create(),vt,[1,-1,1]),pt(X,We))}}}})(g,v,b,M,A);else{let O=g.context,P=O.gl,F,z,U=g.shadowRenderer,W=is(g,g.longestCutoffRange),q=ae=>{if(z===ae)return;let ue=[];ue.push(Cg[ae]),W.shouldRenderCutoff&&ue.push("RENDER_CUTOFF"),U&&(ue.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&ue.push("NORMAL_OFFSET")),F=g.getOrCreateProgram("terrainRaster",{defines:ue}),z=ae},X=g.colorModeForRenderPass(),Z=new Ct(P.LEQUAL,Ct.ReadWrite,g.depthRangeFor3D);El.update(A);let Q=g.transform,re=Dg(Q.zoom,v.exaggeration(),v.sourceCache._source.tileSize),oe=[0,0,0];if(U){let ae=g.style.directionalLight,ue=g.style.ambientLight;ae&&ue&&(oe=rh(g.style,ae,ue))}{z=-1;let ae=P.TRIANGLES,[ue,le]=[v.gridIndexBuffer,v.gridSegments];for(let he of M){let ge=b.getTile(he),be=Gt.disabled,ye=v.prevTerrainTileForTile[he.key],_e=v.terrainTileForTile[he.key];Tg(ye,_e)&&El.newMorphing(he.key,ye,_e,A,250),O.activeTexture.set(P.TEXTURE0),ge.texture&&ge.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);let Oe=El.getMorphValuesForProxy(he.key),Ve=Oe?1:0,Ze;Oe&&(Ze={morphing:{srcDemTile:Oe.from,dstDemTile:Oe.to,phase:n.cw(Oe.phase)}});let Ke=I0(he.projMatrix,Cf(he.canonical,Q.renderWorldCopies)?re/10:re,oe);if(q(Ve),!F)continue;v.setupElevationDraw(ge,F,Ze);let nt=he.toUnwrapped();U&&U.setupShadows(nt,F),g.uploadCommonUniforms(O,F,nt,null,W),F.draw(g,ae,Z,be,X,zt.backCCW,Ke,"terrain_raster",v.gridBuffer,ue,le)}}}}(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;let o=this.painter,f=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],b=this._drapedRenderBatches.shift(),M=o.style.order,A=[],O=0;for(let P of v){let F=g.getTileByID(P.proxyTileKey),z=g.proxyCachedFBO[P.key]?g.proxyCachedFBO[P.key][t]:void 0,U=z!==void 0?g.renderCache[z]:this.pool[O++],W=z!==void 0;if(F.texture=U.tex,W&&!U.dirty){A.push(F.tileID);continue}let q;f.bindFramebuffer.set(U.fb.framebuffer),this.renderedToTile=!1,U.dirty&&(f.clear({color:n.bA.transparent,stencil:0}),U.dirty=!1);for(let X=b.start;X<=b.end;++X){let Z=o.style._mergedLayers[M[X]];if(Z.isHidden(o.transform.zoom))continue;let Q=o.style.getLayerSourceCache(Z),re=Q?this.proxyToSource[P.key][Q.id]:[P];if(!re)continue;let oe=re;f.viewport.set([0,0,U.fb.width,U.fb.height]),q!==(Q?Q.id:null)&&(this._setupStencil(U,re,Z,Q),q=Q?Q.id:null),o.renderLayer(o,Q,Z,oe)}if(this._drapedRenderBatches.length===0)for(let X of this._pendingGroundEffectLayers){let Z=o.style._mergedLayers[M[X]];if(Z.isHidden(o.transform.zoom))continue;let Q=o.style.getLayerSourceCache(Z),re=Q?this.proxyToSource[P.key][Q.id]:[P];if(!re)continue;let oe=re;f.viewport.set([0,0,U.fb.width,U.fb.height]),q!==(Q?Q.id:null)&&(this._setupStencil(U,re,Z,Q),q=Q?Q.id:null),o.renderLayer(o,Q,Z,oe)}this.renderedToTile?(U.dirty=!0,A.push(F.tileID)):W||--O,O===5&&(O=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),b.end+1}postRender(){}isLayerOrderingCorrect(t){let o=t.order.length,f=-1,g=o;for(let v=0;v<o;++v)this._style.isLayerDraped(t._mergedLayers[t.order[v]])?f=Math.max(f,v):g=Math.min(g,v);return g>f}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{t=Math.min(t,o.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,o,f){if(!this._visibleDemTiles)return null;let g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{let b=v.tileID,M=1<<b.overscaledZ,{x:A,y:O}=b.canonical,P=A/M,F=(A+1)/M,z=O/M,U=(O+1)/M;return{minx:P,miny:z,maxx:F,maxy:U,t:v.dem.tree.raycastRoot(P,z,F,U,t,o,f),tile:v}});g.sort((v,b)=>(v.t!==null?v.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(let v of g){if(v.t==null)return null;let b=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,o,f);if(b!=null)return b}return null}_createFBO(){let t=this.painter.context,o=t.gl,f=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);let g=new n.T(t,{width:f[0],height:f[1],data:null},o.RGBA8);g.bind(o.LINEAR,o.CLAMP_TO_EDGE);let v=t.createFramebuffer(f[0],f[1],!0,null);return v.colorAttachment.set(g.texture),v.depthAttachment=new wl(t,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{let o=this._style._mergedLayers[t],f=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!f&&o.shouldRedrape():!f&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(let f of this._style.getSources())if(f instanceof Ji){t=!0;break}if(!t)return;let o={};for(let f=0;f<this._style.order.length;++f){let g=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(g);if(v&&!o[v.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof n.a4){o[v.id]=!0;for(let b of this.proxyCoords){let M=this.proxyToSource[b.key][v.id];if(M)for(let A of M)this._clearRenderCacheForTile(v.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(let f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof Ps){t=!0;break}if(!t)return;let o={};for(let f=0;f<this._style.order.length;++f){let g=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(g);if(!v||o[v.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;let b=g.paint.get("raster-fade-duration");for(let M of this.proxyCoords){let A=this.proxyToSource[M.key][v.id];if(A)for(let O of A){let P=gh(v.getTile(O),v.findLoadedParent(O,0),v,this.painter.transform,b);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(v.id,O)}}}}_setupDrapedRenderBatches(){let t=this._style.order,o=t.length;if(o===0)return;let f=[];this._pendingGroundEffectLayers=[];let g,v=0,b=this._style._mergedLayers[t[v]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++v<o;)b=this._style._mergedLayers[t[v]];for(;v<o;++v){let M=this._style._mergedLayers[t[v]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?g===void 0&&(g=v):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),g!==void 0&&(f.push({start:g,end:v-1}),g=void 0)))}if(g!==void 0&&f.push({start:g,end:v-1}),f.length!==0){let M=f[f.length-1];this._pendingGroundEffectLayers.every(A=>A>M.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(t){let o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){let b=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let M=0;M<b.length;++M){let A=Object.values(b[M]);o.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();let f=this.proxyCoords,g=this._tilesDirty;for(let b=f.length-1;b>=0;b--){let M=f[b];if(o.getTileByID(M.key),o.proxyCachedFBO[M.key]!==void 0){let A=t[M.key],O=this.proxyToSource[M.key],P=0;for(let F in O){let z=O[F],U=A[F];if(!U||U.length!==z.length||z.some((W,q)=>W!==U[q]||g[F]&&g[F].hasOwnProperty(W.key))){P=-1;break}++P}for(let F in o.proxyCachedFBO[M.key])o.renderCache[o.proxyCachedFBO[M.key][F]].dirty=P<0||P!==Object.values(A).length}}let v=[...this._drapedRenderBatches];v.sort((b,M)=>M.end-M.start-(b.end-b.start));for(let b of v)for(let M of f){if(o.proxyCachedFBO[M.key])continue;let A=o.renderCachePool.pop();A===void 0&&o.renderCache.length<50&&(A=o.renderCache.length,o.renderCache.push(this._createFBO())),A!==void 0&&(o.proxyCachedFBO[M.key]={},o.proxyCachedFBO[M.key][b.start]=A,o.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,f,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let v=this.painter.context,b=v.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let M;if(f.isTileClipped())M=o.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Gt.disabled}_renderTileClippingMasks(t,o){let f=this.painter,g=this.painter.context,v=g.gl;f._tileClippingMaskIDs={},g.setColorMode(sn.disabled),g.setDepthMode(Ct.disabled);let b=f.getOrCreateProgram("clippingMask");for(let M of t){let A=f._tileClippingMaskIDs[M.key]=--o;b.draw(f,v.TRIANGLES,Ct.disabled,new Gt({func:v.ALWAYS,mask:0},A,255,v.KEEP,v.KEEP,v.REPLACE),sn.disabled,zt.disabled,Gc(M.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(t){let o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;let f=[t.x,t.y,1,1];n.a6.vec4.transformMat4(f,f,o.pixelMatrixInverse),n.a6.vec4.scale(f,f,1/f[3]),f[0]/=o.worldSize,f[1]/=o.worldSize;let g=o._camera.position,v=n.bE(1,o.center.lat),b=[g[0],g[1],g[2]/v,0],M=n.a6.vec3.subtract([],f.slice(0,3),b);n.a6.vec3.normalize(M,M);let A=this.raycast(b,M,this._exaggeration);return A!==null&&A?(n.a6.vec3.scaleAndAdd(b,b,M,A),b[3]=b[2],b[2]*=v,b):null}_setupProxiedCoordsForOrtho(t,o,f){if(t.getSource()instanceof n.aD)return this._setupProxiedCoordsForImageSource(t,o,f);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};let g=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let A=0;A<v.length;A++){let O=v[A],P=this._findTileCoveringTileID(O,t);if(P){let F=this._createProxiedId(O,P,f[O.key]&&f[O.key][t.id]);g.push(F),this.proxyToSource[O.key][t.id]=[F]}}let b=!1,M=new Set;for(let A=0;A<o.length;A++){let O=t.getTile(o[A]);if(!O||!O.hasData())continue;let P=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==O.tileID.canonical.z){let F=this.proxyToSource[P.tileID.key][t.id],z=this._createProxiedId(P.tileID,O,f[P.tileID.key]&&f[P.tileID.key][t.id]);F?F.splice(F.length-1,0,z):this.proxyToSource[P.tileID.key][t.id]=[z];let U=this.proxyToSource[P.tileID.key][t.id];M.has(U)||M.add(U),g.push(z),b=!0}}if(this._sourceTilesOverlap[t.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(let A of M)A.sort((O,P)=>P.overscaledZ-O.overscaledZ)}_setupProxiedCoordsForImageSource(t,o,f){if(!t.getSource().loaded())return;let g=this.proxiedCoords[t.id]=[],v=this.proxyCoords,b=t.getSource(),M=b.tileID;if(!M)return;let A=new n.P(M.x,M.y)._div(1<<M.z),O=b.coordinates.map(n.a5.fromLngLat).reduce((F,z)=>(F.min.x=Math.min(F.min.x,z.x-A.x),F.min.y=Math.min(F.min.y,z.y-A.y),F.max.x=Math.max(F.max.x,z.x-A.x),F.max.y=Math.max(F.max.y,z.y-A.y),F),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(F,z)=>{let U=F.wrap+F.canonical.x/(1<<F.canonical.z),W=F.canonical.y/(1<<F.canonical.z),q=n.ab/(1<<F.canonical.z),X=z.wrap+z.canonical.x/(1<<z.canonical.z),Z=z.canonical.y/(1<<z.canonical.z);return U+q<X+O.min.x||U>X+O.max.x||W+q<Z+O.min.y||W>Z+O.max.y};for(let F=0;F<v.length;F++){let z=v[F];for(let U=0;U<o.length;U++){let W=t.getTile(o[U]);if(!W||!W.hasData()||P(z,W.tileID))continue;let q=this._createProxiedId(z,W,f[z.key]&&f[z.key][t.id]),X=this.proxyToSource[z.key][t.id];X?X.push(q):this.proxyToSource[z.key][t.id]=[q],g.push(q)}}}_createProxiedId(t,o,f){let g=this.orthoMatrix;if(f){let v=f.find(b=>b.key===o.tileID.key);if(v)return v}if(o.tileID.key!==t.key){let v=t.canonical.z-o.tileID.canonical.z,b,M,A;g=n.a6.mat4.create();let O=o.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(b=n.ab>>v,M=b*((o.tileID.canonical.x<<v)-t.canonical.x+O),A=b*((o.tileID.canonical.y<<v)-t.canonical.y)):(b=n.ab<<-v,M=n.ab*(o.tileID.canonical.x-(t.canonical.x+O<<-v)),A=n.ab*(o.tileID.canonical.y-(t.canonical.y<<-v))),n.a6.mat4.ortho(g,0,b,0,b,0,1),n.a6.mat4.translate(g,g,[M,A,0])}return new Df(o.tileID,t.key,g)}_findTileCoveringTileID(t,o){let f=o.getTile(t);if(f&&f.hasData())return f;let g=this._findCoveringTileCache[o.id],v=g[t.key];if(f=v?o.getTileByID(v):null,f&&f.hasData()||v===null)return f;let b=f?f.tileID:t,M=b.overscaledZ,A=o.getSource().minzoom,O=[];if(!v){let F=o.getSource().maxzoom;if(t.canonical.z>=F){let z=t.canonical.z-F;o.getSource().reparseOverscaled?(M=Math.max(t.canonical.z+2,o.transform.tileZoom),b=new n.aA(M,t.wrap,F,t.canonical.x>>z,t.canonical.y>>z)):z!==0&&(M=F,b=new n.aA(M,t.wrap,F,t.canonical.x>>z,t.canonical.y>>z))}b.key!==t.key&&(O.push(b.key),f=o.getTile(b))}let P=F=>{O.forEach(z=>{g[z]=F}),O.length=0};for(M-=1;M>=A&&(!f||!f.hasData());M--){f&&P(f.tileID.key);let F=b.calculateScaledKey(M);if(f=o.getTileByID(F),f&&f.hasData())break;let z=g[F];if(z===null)break;z===void 0?O.push(F):f=o.getTileByID(z)}return P(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let f=this._tilesDirty[t];f||(f=this._tilesDirty[t]={}),f[o.key]=!0}}function Sf(h,t,o){let f=function(M,A,O){let P=n.a6.vec3.dot(A,M),F=n.a6.vec3.dot(O,[.2126,.7152,.0722]),z=(W,q,X)=>(1-X)*W+X*q,U=z(1-.3*Math.min(F,1),1,Math.min(P+1,1));return z(.92,1,Math.asin(n.ap(A[2],-1,1))/Math.PI+.5)*U}(h,[0,0,1],t),g=[0,0,0];n.a6.vec3.scale(g,o.slice(0,3),f);let v=[0,0,0];n.a6.vec3.scale(v,t.slice(0,3),h[2]);let b=[0,0,0];return n.a6.vec3.add(b,g,v),n.cc(b)}let va=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Sg=["stars","rain_particle","snow_particle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class os{static cacheKey(t,o,f,g){let v=`${o}${g?g.cacheKey:""}`;for(let b of f)t.usedDefines.includes(b)&&(v+=`/${b}`);return v}constructor(t,o,f,g,v,b){let M=t.gl;this.program=M.createProgram(),this.configuration=g,this.name=o,this.fixedDefines=[...b];let A=g?g.getBinderAttributes():[],O=(f.staticAttributes||[]).concat(A),P=g?g.defines():[];P=P.concat(b.map(X=>`#define ${X}`));let F=`#version 300 es
`,z=F+P.concat("precision mediump float;",ch,Nc.fragmentSource).join(`
`);for(let X of f.fragmentIncludes)z+=`
${Fc[X]}`;z+=`
${f.fragmentSource}`;let U=F+P.concat("precision highp float;",ch,Nc.vertexSource).join(`
`);for(let X of f.vertexIncludes)U+=`
${Fc[X]}`;U+=`
${f.vertexSource}`;let W=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(W,z),M.compileShader(W),M.attachShader(this.program,W);let q=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(q,U),M.compileShader(q),M.attachShader(this.program,q),this.attributes={},this.numAttributes=O.length;for(let X=0;X<this.numAttributes;X++)if(O[X]){let Z=O[X].startsWith("a_")?O[X]:`a_${O[X]}`;M.bindAttribLocation(this.program,X,Z),this.attributes[Z]=X}M.linkProgram(this.program),M.deleteShader(q),M.deleteShader(W),this.fixedUniforms=v(t),this.binderUniforms=g?g.getUniforms(t):[],(b.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(X=>({u_dem:new n.bK(X),u_dem_prev:new n.bK(X),u_dem_tl:new n.bH(X),u_dem_scale:new n.bJ(X),u_dem_tl_prev:new n.bH(X),u_dem_scale_prev:new n.bJ(X),u_dem_size:new n.bJ(X),u_dem_lerp:new n.bJ(X),u_exaggeration:new n.bJ(X),u_depth:new n.bK(X),u_depth_size_inv:new n.bH(X),u_depth_range_unpack:new n.bH(X),u_occluder_half_size:new n.bJ(X),u_occlusion_depth_offset:new n.bJ(X),u_meter_to_dem:new n.bJ(X),u_label_plane_matrix_inv:new n.bG(X)}))(t)),b.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new n.bI(X),u_tile_tr_up:new n.bI(X),u_tile_br_up:new n.bI(X),u_tile_bl_up:new n.bI(X),u_tile_up_scale:new n.bJ(X)}))(t)),b.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new n.bG(X),u_fog_range:new n.bH(X),u_fog_color:new n.c7(X),u_fog_horizon_blend:new n.bJ(X),u_fog_vertical_limit:new n.bH(X),u_fog_temporal_offset:new n.bJ(X),u_frustum_tl:new n.bI(X),u_frustum_tr:new n.bI(X),u_frustum_br:new n.bI(X),u_frustum_bl:new n.bI(X),u_globe_pos:new n.bI(X),u_globe_radius:new n.bJ(X),u_globe_transition:new n.bJ(X),u_is_globe:new n.bK(X),u_viewport:new n.bH(X)}))(t)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new n.c7(X)}))(t)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new n.bI(X),u_lighting_directional_dir:new n.bI(X),u_lighting_directional_color:new n.bI(X),u_ground_radiance:new n.bI(X)}))(t)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new n.bG(X),u_light_matrix_1:new n.bG(X),u_fade_range:new n.bH(X),u_shadow_normal_offset:new n.bI(X),u_shadow_intensity:new n.bJ(X),u_shadow_texel_size:new n.bJ(X),u_shadow_map_resolution:new n.bJ(X),u_shadow_direction:new n.bI(X),u_shadow_bias:new n.bI(X),u_shadowmap_0:new n.bK(X),u_shadowmap_1:new n.bK(X)}))(t))}}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;let f=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)f[g]&&f[g].set(this.program,g,o[g])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;let f=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)f[g]&&f[g].set(this.program,g,o[g])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;let f=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)f[g].set(this.program,g,o[g])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;let f=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)f[g].set(this.program,g,o[g])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;let f=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let g in o)f[g].set(this.program,g,o[g])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;let f=this.shadowUniforms;t.program.set(this.program);for(let g in o)f[g].set(this.program,g,o[g])}_drawDebugWireframe(t,o,f,g,v,b,M,A,O,P){let F=t.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;let z=t.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||t._terrain&&t._terrain.renderingToTexture||!va.includes(this.name))||!(!F.layers3D||!Sg.includes(this.name))))return;let U=z.gl,W=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,v,z);if(!W)return;let q=[...this.fixedDefines];q.push("DEBUG_WIREFRAME");let X=t.getOrCreateProgram(this.name,{config:this.configuration,defines:q});z.program.set(X.program);let Z=(oe,ae,ue)=>{if(ae[oe]&&ue[oe])for(let le in ae[oe])ue[oe][le]&&ue[oe][le].set(ue.program,le,ae[oe][le].current)};O&&O.setUniforms(X.program,z,X.binderUniforms,M,{zoom:A}),Z("fixedUniforms",this,X),Z("terrainUniforms",this,X),Z("globeUniforms",this,X),Z("fogUniforms",this,X),Z("lightsUniforms",this,X),Z("shadowUniforms",this,X),W.bind(),z.setColorMode(new sn([U.ONE,U.ONE_MINUS_SRC_ALPHA,U.ZERO,U.ONE],n.bA.transparent,[!0,!0,!0,!1])),z.setDepthMode(new Ct(o.func===U.LESS?U.LEQUAL:o.func,Ct.ReadOnly,o.range)),z.setStencilMode(Gt.disabled);let Q=3*b.primitiveLength*2,re=3*b.primitiveOffset*2*2;P&&P>1?U.drawElementsInstanced(U.LINES,Q,U.UNSIGNED_SHORT,re,P):U.drawElements(U.LINES,Q,U.UNSIGNED_SHORT,re),v.bind(),z.program.set(this.program),z.setDepthMode(o),z.setStencilMode(f),z.setColorMode(g)}checkUniforms(t,o,f){if(this.fixedDefines.includes(o)){for(let g of Object.keys(f))if(!f[g].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${g} not set but required by ${o} being defined`)}}draw(t,o,f,g,v,b,M,A,O,P,F,z,U,W,q,X){let Z=t.context,Q=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(f),Z.setStencilMode(g),Z.setColorMode(v),Z.setCullFace(b);for(let ae of Object.keys(this.fixedUniforms))this.fixedUniforms[ae].set(this.program,ae,M[ae]);W&&W.setUniforms(this.program,Z,this.binderUniforms,z,{zoom:U});let re={[Q.POINTS]:1,[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[o];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);let oe=X&&X>0?1:void 0;for(let ae of F.get()){let ue=ae.vaos||(ae.vaos={});(ue[A]||(ue[A]=new vl)).bind(Z,this,O,W?W.getPaintVertexBuffers():[],P,ae.vertexOffset,q||[],oe),X&&X>1?Q.drawElementsInstanced(o,ae.primitiveLength*re,Q.UNSIGNED_SHORT,ae.primitiveOffset*re*2,X):P?Q.drawElements(o,ae.primitiveLength*re,Q.UNSIGNED_SHORT,ae.primitiveOffset*re*2):Q.drawArrays(o,ae.vertexOffset,ae.vertexLength),o===Q.TRIANGLES&&P&&this._drawDebugWireframe(t,f,g,v,P,ae,z,U,W,X)}}}function _h(h,t){let o=Math.pow(2,t.tileID.overscaledZ),f=t.tileSize*Math.pow(2,h.transform.tileZoom)/o,g=f*(t.tileID.canonical.x+t.tileID.wrap*o),v=f*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ak(t,1,h.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v]}}let xa={terrain:0,flat:1},Ag=n.a6.mat4.create(),Af=(h,t,o,f,g,v,b,M,A,O,P,F,z,U,W,q,X,Z)=>{let Q=t.style.light,re=Q.properties.get("position"),oe=[re.x,re.y,re.z],ae=n.a6.mat3.create();Q.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(ae,-t.transform.angle),n.a6.vec3.transformMat3(oe,oe,ae));let ue=Q.properties.get("color"),le=t.transform,he={u_matrix:h,u_lightpos:oe,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[ue.r,ue.g,ue.b],u_vertical_gradient:+o,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ag,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:xa[O],u_base_type:xa[P],u_ao:g,u_edge_radius:v,u_width_scale:b,u_flood_light_color:W,u_vertical_scale:q,u_flood_light_intensity:X,u_ground_shadow_factor:Z};return le.projection.name==="globe"&&(he.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],he.u_zoom_transition=F,he.u_inv_rot_matrix=U,he.u_merc_center=z,he.u_up_dir=le.projection.upVector(new n.bQ(0,0,0),z[0]*n.ab,z[1]*n.ab),he.u_height_lift=A),he},Rf=(h,t,o,f,g,v)=>({u_matrix:h,u_edge_radius:t,u_width_scale:o,u_vertical_scale:f,u_height_type:xa[g],u_base_type:xa[v]}),Pf=(h,t,o,f,g,v,b,M,A,O,P,F,z,U,W,q,X)=>{let Z=Af(h,t,o,f,g,v,b,M,O,P,F,z,U,W,q,X,1,[0,0,0]),Q={u_height_factor:-Math.pow(2,M.overscaledZ)/A.tileSize/8};return n.l(Z,_h(t,A),Q)},Rg=(h,t)=>({u_matrix:h,u_emissive_strength:t}),Of=(h,t,o,f)=>n.l(Rg(h,t),_h(o,f)),Hc=(h,t,o)=>({u_matrix:h,u_world:o,u_emissive_strength:t}),T0=(h,t,o,f,g)=>n.l(Of(h,t,o,f),{u_world:g}),C0=(h,t,o,f)=>{let g=n.ab/o.tileSize;return{u_matrix:h,u_camera_to_center_distance:t.getCameraToCenterDistance(f),u_extrude_scale:[t.pixelsToGLUnits[0]/g,t.pixelsToGLUnits[1]/g]}},kf=(h,t,o=1)=>({u_matrix:h,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:o}),D0=n.a6.mat4.create(),Lf=(h,t,o,f,g,v,b)=>{let M=h.transform,A=M.projection.name==="globe",O=A?n.cI(M.zoom,t.canonical)*M._pixelsPerMercatorPixel:n.ak(o,1,v),P={u_matrix:t.projMatrix,u_extrude_scale:O,u_intensity:b,u_inv_rot_matrix:D0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){P.u_inv_rot_matrix=f,P.u_merc_center=g,P.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],P.u_zoom_transition=n.a9(M.zoom);let F=g[0]*n.ab,z=g[1]*n.ab;P.u_up_dir=M.projection.upVector(new n.bQ(0,0,0),F,z)}return P};function yh(h,[t,o,f,g],[v,b]){if(v===b)return[0,0,0,0];let M=255*(h-1)/(h*(b-v));return[t*M,o*M,f*M,g*M]}function Tl(h,t,[o,f]){return o===f?0:.5/h+(t-o)*(h-1)/(h*(f-o))}let vh=(h,t,o,f,g,v,b,M,A,O,P,F,z,U,W,q,X,Z,Q,re,oe)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:O,u_fade_t:P.mix,u_opacity:P.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:n.cJ(F.paint.get("raster-saturation")),u_contrast_factor:n.cK(F.paint.get("raster-contrast")),u_spin_weights:qc(F.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:U,u_zoom_transition:b,u_merc_center:M,u_cutoff_params:A,u_colorization_mix:yh(n.cL,q,Z),u_colorization_offset:Tl(n.cL,X,Z),u_color_ramp:W,u_texture_offset:[re/(Q+2*re),Q/(Q+2*re)],u_texture_res:[Q+2*re,Q+2*re],u_emissive_strength:oe});function qc(h){h*=Math.PI/180;let t=Math.sin(h),o=Math.cos(h);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}let ba=.05,xh=(h,t,o,f,g,v,b,M,A,O,P,F)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:f,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:O,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:b,u_merc_center:M,u_cutoff_params:A}),bh=(h,t,o,f,g,v,b,M,A,O)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:f,u_color_ramp:v,u_velocity_res:g,u_max_speed:b,u_uv_offset:M,u_data_scale:[255*A[0],255*A[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[ba,ba]}),Ff=(h,t,o,f,g,v,b,M,A,O)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:f,u_max_speed:g,u_speed_factor:v,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*A[0],255*A[1]],u_data_offset:O,u_particle_pos_scale:1.1,u_particle_pos_offset:[ba,ba]}),Nf=n.a6.mat4.create(),Pg=(h,t,o,f,g,v,b,M,A,O,P,F,z,U,W,q,X,Z,Q,re,oe,ae)=>{let ue=g.transform,le={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ue.getCameraToCenterDistance(Q),u_rotate_symbol:+o,u_aspect_ratio:ue.width/ue.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:b,u_coord_matrix:M,u_is_text:+O,u_elevation_from_sea:A?1:0,u_pitch_with_map:+f,u_texsize:P,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Nf,u_up_vector:[0,-1,0],u_color_adj_mat:re,u_icon_transition:oe||0,u_gamma_scale:f?g.transform.getCameraToCenterDistance(Q)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:+z,u_scale_factor:ae||1};return Q.name==="globe"&&(le.u_tile_id=[U.canonical.x,U.canonical.y,1<<U.canonical.z],le.u_zoom_transition=W,le.u_inv_rot_matrix=X,le.u_merc_center=q,le.u_camera_forward=ue._camera.forward(),le.u_ecef_origin=n.cM(ue.globeMatrix,U.toUnwrapped()),le.u_tile_matrix=Float32Array.from(ue.globeMatrix),le.u_up_vector=Z),le},wa=(h,t,o,f)=>({u_matrix:h,u_emissive_strength:t,u_opacity:o,u_color:f}),Wc=(h,t,o,f,g,v,b,M,A)=>n.l(function(O,P,F,z,U,W){let{width:q,height:X}=z.imageManager.getPixelSize(P),Z=Math.pow(2,W.tileID.overscaledZ),Q=W.tileSize*Math.pow(2,z.transform.tileZoom)/Z,re=Q*(W.tileID.canonical.x+W.tileID.wrap*Z),oe=Q*W.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[q,X],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:U?[z.transform.width,-1*z.transform.height]:[1/n.ak(W,1,z.transform.tileZoom),1/n.ak(W,1,z.transform.tileZoom)],u_pixel_coord_upper:[re>>16,oe>>16],u_pixel_coord_lower:[65535&re,65535&oe]}}(0,v,b,f,M,A),{u_matrix:h,u_emissive_strength:t,u_opacity:o}),ft=new Float32Array(n.a6.mat4.identity([])),wh=(h,t,o,f,g,v,b,M,A,O,P,F,z,U=[0,0,0],W)=>{let q=g.style.light,X=q.properties.get("position"),Z=[-X.x,-X.y,X.z],Q=n.a6.mat3.create();q.properties.get("anchor")==="viewport"&&(n.a6.mat3.fromRotation(Q,-g.transform.angle),n.a6.vec3.transformMat3(Z,Z,Q));let re=P.alphaMode==="MASK",oe=q.properties.get("color").toRenderColor(null),ae=z.paint.get("model-ambient-occlusion-intensity"),ue=z.paint.get("model-color").constantOr(n.bA.white).toRenderColor(null),le=z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:f||ft,u_lightpos:Z,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[oe.r,oe.g,oe.b],u_camera_pos:U,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+re,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[M[0],M[1],M[2],1],u_metallicFactor:A,u_roughnessFactor:O,u_baseColorTexture:Ki.BaseColor,u_metallicRoughnessTexture:Ki.MetallicRoughness,u_normalTexture:Ki.Normal,u_occlusionTexture:Ki.Occlusion,u_emissionTexture:Ki.Emission,u_lutTexture:Ki.LUT,u_color_mix:[ue.r,ue.g,ue.b,le],u_aoIntensity:ae,u_emissive_strength:F,u_occlusionTextureTransform:W||[0,0,0,0]}},zf=(h,t=ft,o=ft)=>({u_matrix:h,u_instance:t,u_node_matrix:o}),Ea={fillExtrusion:h=>({u_matrix:new n.bG(h),u_lightpos:new n.bI(h),u_lightintensity:new n.bJ(h),u_lightcolor:new n.bI(h),u_vertical_gradient:new n.bJ(h),u_opacity:new n.bJ(h),u_edge_radius:new n.bJ(h),u_width_scale:new n.bJ(h),u_ao:new n.bH(h),u_height_type:new n.bK(h),u_base_type:new n.bK(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_up_dir:new n.bI(h),u_height_lift:new n.bJ(h),u_flood_light_color:new n.bI(h),u_vertical_scale:new n.bJ(h),u_flood_light_intensity:new n.bJ(h),u_ground_shadow_factor:new n.bI(h)}),fillExtrusionDepth:h=>({u_matrix:new n.bG(h),u_edge_radius:new n.bJ(h),u_width_scale:new n.bJ(h),u_vertical_scale:new n.bJ(h),u_height_type:new n.bK(h),u_base_type:new n.bK(h)}),fillExtrusionPattern:h=>({u_matrix:new n.bG(h),u_lightpos:new n.bI(h),u_lightintensity:new n.bJ(h),u_lightcolor:new n.bI(h),u_vertical_gradient:new n.bJ(h),u_height_factor:new n.bJ(h),u_edge_radius:new n.bJ(h),u_width_scale:new n.bJ(h),u_ao:new n.bH(h),u_height_type:new n.bK(h),u_base_type:new n.bK(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_up_dir:new n.bI(h),u_height_lift:new n.bJ(h),u_image:new n.bK(h),u_texsize:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_tile_units_to_pixels:new n.bJ(h),u_opacity:new n.bJ(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new n.bG(h),u_opacity:new n.bJ(h),u_ao_pass:new n.bJ(h),u_meter_to_tile:new n.bJ(h),u_ao:new n.bH(h),u_flood_light_intensity:new n.bJ(h),u_flood_light_color:new n.bI(h),u_attenuation:new n.bJ(h),u_edge_radius:new n.bJ(h),u_fb:new n.bK(h),u_fb_size:new n.bJ(h),u_dynamic_offset:new n.bJ(h)}),fill:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h)}),fillPattern:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_image:new n.bK(h),u_texsize:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_tile_units_to_pixels:new n.bJ(h)}),fillOutline:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_world:new n.bH(h)}),fillOutlinePattern:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_world:new n.bH(h),u_image:new n.bK(h),u_texsize:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_tile_units_to_pixels:new n.bJ(h)}),circle:n.cN,collisionBox:h=>({u_matrix:new n.bG(h),u_camera_to_center_distance:new n.bJ(h),u_extrude_scale:new n.bH(h)}),collisionCircle:h=>({u_matrix:new n.bG(h),u_inv_matrix:new n.bG(h),u_camera_to_center_distance:new n.bJ(h),u_viewport_size:new n.bH(h)}),debug:h=>({u_color:new n.cu(h),u_matrix:new n.bG(h),u_overlay:new n.bK(h),u_overlay_scale:new n.bJ(h)}),clippingMask:h=>({u_matrix:new n.bG(h)}),heatmap:h=>({u_extrude_scale:new n.bJ(h),u_intensity:new n.bJ(h),u_matrix:new n.bG(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_up_dir:new n.bI(h)}),heatmapTexture:h=>({u_image:new n.bK(h),u_color_ramp:new n.bK(h),u_opacity:new n.bJ(h)}),hillshade:h=>({u_matrix:new n.bG(h),u_image:new n.bK(h),u_latrange:new n.bH(h),u_light:new n.bH(h),u_shadow:new n.cu(h),u_highlight:new n.cu(h),u_emissive_strength:new n.bJ(h),u_accent:new n.cu(h)}),hillshadePrepare:h=>({u_matrix:new n.bG(h),u_image:new n.bK(h),u_dimension:new n.bH(h),u_zoom:new n.bJ(h)}),line:n.cO,linePattern:n.cP,raster:h=>({u_matrix:new n.bG(h),u_normalize_matrix:new n.bG(h),u_globe_matrix:new n.bG(h),u_merc_matrix:new n.bG(h),u_grid_matrix:new n.cv(h),u_tl_parent:new n.bH(h),u_scale_parent:new n.bJ(h),u_fade_t:new n.bJ(h),u_opacity:new n.bJ(h),u_image0:new n.bK(h),u_image1:new n.bK(h),u_brightness_low:new n.bJ(h),u_brightness_high:new n.bJ(h),u_saturation_factor:new n.bJ(h),u_contrast_factor:new n.bJ(h),u_spin_weights:new n.bI(h),u_perspective_transform:new n.bH(h),u_raster_elevation:new n.bJ(h),u_zoom_transition:new n.bJ(h),u_merc_center:new n.bH(h),u_cutoff_params:new n.c7(h),u_colorization_mix:new n.c7(h),u_colorization_offset:new n.bJ(h),u_color_ramp:new n.bK(h),u_texture_offset:new n.bH(h),u_texture_res:new n.bH(h),u_emissive_strength:new n.bJ(h)}),rasterParticle:h=>({u_matrix:new n.bG(h),u_normalize_matrix:new n.bG(h),u_globe_matrix:new n.bG(h),u_merc_matrix:new n.bG(h),u_grid_matrix:new n.cv(h),u_tl_parent:new n.bH(h),u_scale_parent:new n.bJ(h),u_fade_t:new n.bJ(h),u_opacity:new n.bJ(h),u_image0:new n.bK(h),u_image1:new n.bK(h),u_raster_elevation:new n.bJ(h),u_zoom_transition:new n.bJ(h),u_merc_center:new n.bH(h),u_cutoff_params:new n.c7(h)}),rasterParticleTexture:h=>({u_texture:new n.bK(h),u_opacity:new n.bJ(h)}),rasterParticleDraw:h=>({u_particle_texture:new n.bK(h),u_particle_texture_side_len:new n.bJ(h),u_tile_offset:new n.bH(h),u_velocity:new n.bK(h),u_color_ramp:new n.bK(h),u_velocity_res:new n.bH(h),u_max_speed:new n.bJ(h),u_uv_offset:new n.bH(h),u_data_scale:new n.bH(h),u_data_offset:new n.bJ(h),u_particle_pos_scale:new n.bJ(h),u_particle_pos_offset:new n.bH(h)}),rasterParticleUpdate:h=>({u_particle_texture:new n.bK(h),u_particle_texture_side_len:new n.bJ(h),u_velocity:new n.bK(h),u_velocity_res:new n.bH(h),u_max_speed:new n.bJ(h),u_speed_factor:new n.bJ(h),u_reset_rate:new n.bJ(h),u_rand_seed:new n.bJ(h),u_uv_offset:new n.bH(h),u_data_scale:new n.bH(h),u_data_offset:new n.bJ(h),u_particle_pos_scale:new n.bJ(h),u_particle_pos_offset:new n.bH(h)}),symbol:h=>({u_is_size_zoom_constant:new n.bK(h),u_is_size_feature_constant:new n.bK(h),u_size_t:new n.bJ(h),u_size:new n.bJ(h),u_camera_to_center_distance:new n.bJ(h),u_rotate_symbol:new n.bK(h),u_aspect_ratio:new n.bJ(h),u_fade_change:new n.bJ(h),u_matrix:new n.bG(h),u_label_plane_matrix:new n.bG(h),u_coord_matrix:new n.bG(h),u_is_text:new n.bK(h),u_elevation_from_sea:new n.bK(h),u_pitch_with_map:new n.bK(h),u_texsize:new n.bH(h),u_texsize_icon:new n.bH(h),u_texture:new n.bK(h),u_texture_icon:new n.bK(h),u_gamma_scale:new n.bJ(h),u_device_pixel_ratio:new n.bJ(h),u_tile_id:new n.bI(h),u_zoom_transition:new n.bJ(h),u_inv_rot_matrix:new n.bG(h),u_merc_center:new n.bH(h),u_camera_forward:new n.bI(h),u_tile_matrix:new n.bG(h),u_up_vector:new n.bI(h),u_ecef_origin:new n.bI(h),u_is_halo:new n.bK(h),u_icon_transition:new n.bJ(h),u_color_adj_mat:new n.bG(h),u_scale_factor:new n.bJ(h)}),background:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_opacity:new n.bJ(h),u_color:new n.cu(h)}),backgroundPattern:h=>({u_matrix:new n.bG(h),u_emissive_strength:new n.bJ(h),u_opacity:new n.bJ(h),u_image:new n.bK(h),u_pattern_tl:new n.bH(h),u_pattern_br:new n.bH(h),u_texsize:new n.bH(h),u_pattern_size:new n.bH(h),u_pixel_coord_upper:new n.bH(h),u_pixel_coord_lower:new n.bH(h),u_pattern_units_to_pixels:new n.bH(h)}),terrainRaster:h=>({u_matrix:new n.bG(h),u_image0:new n.bK(h),u_skirt_height:new n.bJ(h),u_ground_shadow_factor:new n.bI(h)}),skybox:h=>({u_matrix:new n.bG(h),u_sun_direction:new n.bI(h),u_cubemap:new n.bK(h),u_opacity:new n.bJ(h),u_temporal_offset:new n.bJ(h)}),skyboxGradient:h=>({u_matrix:new n.bG(h),u_color_ramp:new n.bK(h),u_center_direction:new n.bI(h),u_radius:new n.bJ(h),u_opacity:new n.bJ(h),u_temporal_offset:new n.bJ(h)}),skyboxCapture:h=>({u_matrix_3f:new n.cv(h),u_sun_direction:new n.bI(h),u_sun_intensity:new n.bJ(h),u_color_tint_r:new n.c7(h),u_color_tint_m:new n.c7(h),u_luminance:new n.bJ(h)}),globeRaster:h=>({u_proj_matrix:new n.bG(h),u_globe_matrix:new n.bG(h),u_normalize_matrix:new n.bG(h),u_merc_matrix:new n.bG(h),u_zoom_transition:new n.bJ(h),u_merc_center:new n.bH(h),u_image0:new n.bK(h),u_grid_matrix:new n.cv(h),u_skirt_height:new n.bJ(h),u_far_z_cutoff:new n.bJ(h),u_frustum_tl:new n.bI(h),u_frustum_tr:new n.bI(h),u_frustum_br:new n.bI(h),u_frustum_bl:new n.bI(h),u_globe_pos:new n.bI(h),u_globe_radius:new n.bJ(h),u_viewport:new n.bH(h)}),globeAtmosphere:h=>({u_frustum_tl:new n.bI(h),u_frustum_tr:new n.bI(h),u_frustum_br:new n.bI(h),u_frustum_bl:new n.bI(h),u_horizon:new n.bJ(h),u_transition:new n.bJ(h),u_fadeout_range:new n.bJ(h),u_color:new n.c7(h),u_high_color:new n.c7(h),u_space_color:new n.c7(h),u_temporal_offset:new n.bJ(h),u_horizon_angle:new n.bJ(h)}),model:h=>({u_matrix:new n.bG(h),u_lighting_matrix:new n.bG(h),u_normal_matrix:new n.bG(h),u_node_matrix:new n.bG(h),u_lightpos:new n.bI(h),u_lightintensity:new n.bJ(h),u_lightcolor:new n.bI(h),u_camera_pos:new n.bI(h),u_opacity:new n.bJ(h),u_baseColorFactor:new n.c7(h),u_emissiveFactor:new n.c7(h),u_metallicFactor:new n.bJ(h),u_roughnessFactor:new n.bJ(h),u_baseTextureIsAlpha:new n.bK(h),u_alphaMask:new n.bK(h),u_alphaCutoff:new n.bJ(h),u_baseColorTexture:new n.bK(h),u_metallicRoughnessTexture:new n.bK(h),u_normalTexture:new n.bK(h),u_occlusionTexture:new n.bK(h),u_emissionTexture:new n.bK(h),u_lutTexture:new n.bK(h),u_color_mix:new n.c7(h),u_aoIntensity:new n.bJ(h),u_emissive_strength:new n.bJ(h),u_occlusionTextureTransform:new n.c7(h)}),modelDepth:h=>({u_matrix:new n.bG(h),u_instance:new n.bG(h),u_node_matrix:new n.bG(h)}),groundShadow:h=>({u_matrix:new n.bG(h),u_ground_shadow_factor:new n.bI(h)}),stars:h=>({u_matrix:new n.bG(h),u_up:new n.bI(h),u_right:new n.bI(h),u_intensity_multiplier:new n.bJ(h)}),snowParticle:h=>({u_modelview:new n.bG(h),u_projection:new n.bG(h),u_time:new n.bJ(h),u_cam_pos:new n.bI(h),u_velocityConeAperture:new n.bJ(h),u_velocity:new n.bJ(h),u_horizontalOscillationRadius:new n.bJ(h),u_horizontalOscillationRate:new n.bJ(h),u_boxSize:new n.bJ(h),u_billboardSize:new n.bJ(h),u_simpleShapeParameters:new n.bH(h),u_screenSize:new n.bH(h),u_thinningCenterPos:new n.bH(h),u_thinningShape:new n.bI(h),u_thinningAffectedRatio:new n.bJ(h),u_thinningParticleOffset:new n.bJ(h),u_particleColor:new n.c7(h),u_direction:new n.bI(h)}),rainParticle:h=>({u_modelview:new n.bG(h),u_projection:new n.bG(h),u_time:new n.bJ(h),u_cam_pos:new n.bI(h),u_texScreen:new n.bK(h),u_velocityConeAperture:new n.bJ(h),u_velocity:new n.bJ(h),u_boxSize:new n.bJ(h),u_rainDropletSize:new n.bH(h),u_distortionStrength:new n.bJ(h),u_rainDirection:new n.bI(h),u_color:new n.c7(h),u_screenSize:new n.bH(h),u_thinningCenterPos:new n.bH(h),u_thinningShape:new n.bI(h),u_thinningAffectedRatio:new n.bJ(h),u_thinningParticleOffset:new n.bJ(h),u_shapeDirectionalPower:new n.bJ(h),u_mode:new n.bJ(h)}),occlusion:h=>({u_matrix:new n.bG(h),u_anchorPos:new n.bI(h),u_screenSizePx:new n.bH(h),u_occluderSizePx:new n.bH(h),u_color:new n.c7(h)})},zs=(()=>{class h{constructor(o,f,g,v){this.id=h.uniqueIdxCounter,h.uniqueIdxCounter++,this.context=o;let b=o.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||v||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=h.uniqueIdxCounter,h.uniqueIdxCounter++;let f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return h.uniqueIdxCounter=0,h})(),xt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bf{constructor(t,o,f,g,v,b){this.length=o.length,this.attributes=f,this.itemSize=o.bytesPerElement,this.dynamicDraw=g,this.instanceCount=b,this.context=t;let M=t.gl;this.buffer=M.createBuffer(),t.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||v||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){let o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let f=0;f<this.attributes.length;f++){let g=o.attributes[this.attributes[f].name];g!==void 0&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,o,f){for(let g=0;g<this.attributes.length;g++){let v=this.attributes[g],b=o.attributes[v.name];b!==void 0&&t.vertexAttribPointer(b,v.components,t[xt[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(t,o,f){for(let g=0;g<this.attributes.length;g++){let v=o.attributes[this.attributes[g].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(v,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Og{constructor(t,o,f,g,v){this.context=t,this.width=o,this.height=f;let b=this.framebuffer=t.gl.createFramebuffer();g&&(this.colorAttachment=new mh(t,b)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Tf(t,b):new Eg(t,b))}destroy(){let t=this.context.gl;if(this.colorAttachment){let o=this.colorAttachment.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{let o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class M0{constructor(t,o){this.gl=t,this.clearColor=new mf(this),this.clearDepth=new mg(this),this.clearStencil=new gf(this),this.colorMask=new hh(this),this.depthMask=new Vc(this),this.stencilMask=new gg(this),this.stencilFunc=new _g(this),this.stencilOp=new yg(this),this.stencilTest=new bl(this),this.depthRange=new vg(this),this.depthTest=new x0(this),this.depthFunc=new b0(this),this.blend=new w0(this),this.blendFunc=new _f(this),this.blendColor=new yf(this),this.blendEquation=new vf(this),this.cullFace=new xf(this),this.cullFaceSide=new xg(this),this.frontFace=new bg(this),this.program=new E0(this),this.activeTexture=new jc(this),this.viewport=new Uc(this),this.bindFramebuffer=new wg(this),this.bindRenderbuffer=new kr(this),this.bindTexture=new bf(this),this.bindVertexBuffer=new dh(this),this.bindElementBuffer=new fh(this),this.bindVertexArrayOES=new wf(this),this.pixelStoreUnpack=new Ef(this),this.pixelStoreUnpackPremultiplyAlpha=new ph(this),this.pixelStoreUnpackFlipY=new If(this),this.options=o?bt({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,f){return new zs(this,t,o,f)}createVertexBuffer(t,o,f,g,v){return new Bf(this,t,o,f,g,v)}createRenderbuffer(t,o,f){let g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,t,o,f),this.bindRenderbuffer.set(null),v}createFramebuffer(t,o,f,g){return new Og(this,t,o,f,g)}clear({color:t,depth:o,stencil:f,colorMask:g}){let v=this.gl,b=0;t&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(g||[!0,!0,!0,!0])),o!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),f!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),v.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.bi(t.blendFunction,sn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Cl;function Vf(h,t,o,f,g,v,b){let M=h.context,A=M.gl,O=h.transform,P=h.getOrCreateProgram("collisionBox"),F=[],z=0,U=0;for(let oe=0;oe<f.length;oe++){let ae=f[oe],ue=t.getTile(ae),le=ue.getBucket(o);if(!le)continue;let he=ng(ae,le,O),ge=he;g[0]===0&&g[1]===0||(ge=h.translatePosMatrix(he,ue,g,v));let be=b?le.textCollisionBox:le.iconCollisionBox,ye=le.collisionCircleArray;if(ye.length>0){let _e=n.a6.mat4.create(),Oe=ge;n.a6.mat4.mul(_e,le.placementInvProjMatrix,O.glCoordMatrix),n.a6.mat4.mul(_e,_e,le.placementViewportMatrix),F.push({circleArray:ye,circleOffset:U,transform:Oe,invTransform:_e,projection:le.getProjection()}),z+=ye.length/4,U=z}be&&(h.terrain&&h.terrain.setupElevationDraw(ue,P),P.draw(h,A.LINES,Ct.disabled,Gt.disabled,h.colorModeForRenderPass(),zt.disabled,C0(ge,O,ue,le.getProjection()),o.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,O.zoom,null,[be.collisionVertexBuffer,be.collisionVertexBufferExt]))}if(!b||!F.length)return;let W=h.getOrCreateProgram("collisionCircle"),q=new n.cQ;q.resize(4*z),q._trim();let X=0;for(let oe of F)for(let ae=0;ae<oe.circleArray.length/4;ae++){let ue=4*ae,le=oe.circleArray[ue+0],he=oe.circleArray[ue+1],ge=oe.circleArray[ue+2],be=oe.circleArray[ue+3];q.emplace(X++,le,he,ge,be,0),q.emplace(X++,le,he,ge,be,1),q.emplace(X++,le,he,ge,be,2),q.emplace(X++,le,he,ge,be,3)}(!Cl||Cl.length<2*z)&&(Cl=function(oe){let ae=2*oe,ue=new n.aP;ue.resize(ae),ue._trim();for(let le=0;le<ae;le++){let he=6*le;ue.uint16[he+0]=4*le+0,ue.uint16[he+1]=4*le+1,ue.uint16[he+2]=4*le+2,ue.uint16[he+3]=4*le+2,ue.uint16[he+4]=4*le+3,ue.uint16[he+5]=4*le+0}return ue}(z));let Z=M.createIndexBuffer(Cl,!0),Q=M.createVertexBuffer(q,n.cR.members,!0);for(let oe of F){let ae={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(re=O).getCameraToCenterDistance(oe.projection),u_viewport_size:[re.width,re.height]};W.draw(h,A.TRIANGLES,Ct.disabled,Gt.disabled,h.colorModeForRenderPass(),zt.disabled,ae,o.id,Q,Z,n.b2.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,O.zoom)}var re;Q.destroy(),Z.destroy()}let Zc=n.a6.mat4.create();function kg(h){let t=h._camera.getWorldToCamera(h.worldSize,1),o=n.a6.mat4.multiply([],t,h.globeMatrix);n.a6.mat4.invert(o,o);let f=[0,0,0],g=[0,1,0,0];return n.a6.vec4.transformMat4(g,g,o),f[0]=g[0],f[1]=g[1],f[2]=g[2],n.a6.vec3.normalize(f,f),f}function S0({width:h,height:t,anchor:o,textOffset:f,textScale:g},v){let{horizontalAlign:b,verticalAlign:M}=n.by(o),A=-(b-.5)*h,O=-(M-.5)*t,P=n.bx(o,f);return new n.P((A/g+P[0])*v,(O/g+P[1])*v)}function jf(h,t,o,f,g,v,b,M,A,O,P){let F=h.text.placedSymbolArray,z=h.text.dynamicLayoutVertexArray,U=h.icon.dynamicLayoutVertexArray,W={},q=h.getProjection(),X=ks(M,q,v),Z=v.elevation,Q=q.upVectorScale(M.canonical,v.center.lat,v.worldSize).metersToTile;z.clear();for(let re=0;re<F.length;re++){let oe=F.get(re),{tileAnchorX:ae,tileAnchorY:ue,numGlyphs:le}=oe,he=oe.hidden||!oe.crossTileID||h.allowVerticalPlacement&&!oe.placedOrientation?null:f[oe.crossTileID];if(he){let ge=0,be=0,ye=0;if(Z){let ke=Z?Z.getAtTileOffset(M,ae,ue):0,[We,Xe,Ge]=q.upVector(M.canonical,ae,ue);ge=ke*We*Q,be=ke*Xe*Q,ye=ke*Ge*Q}let[_e,Oe,Ve,Ze]=lr(oe.projectedAnchorX+ge,oe.projectedAnchorY+be,oe.projectedAnchorZ+ye,o?X:b),Ke=yn(v.getCameraToCenterDistance(q),Ze),nt=g.evaluateSizeForFeature(h.textSizeData,O,oe)*Ke/n.br;o&&(nt*=h.tilePixelRatio/A);let Ce=S0(he,nt);o?({x:_e,y:Oe,z:Ve}=q.projectTilePoint(ae+Ce.x,ue+Ce.y,M.canonical),[_e,Oe,Ve]=lr(_e+ge,Oe+be,Ve+ye,b)):(t&&Ce._rotate(-v.angle),_e+=Ce.x,Oe+=Ce.y,Ve=0);let qe=h.allowVerticalPlacement&&oe.placedOrientation===n.bl.vertical?Math.PI/2:0;for(let ke=0;ke<le;ke++)n.bo(z,_e,Oe,Ve,qe);P&&oe.associatedIconIndex>=0&&(W[oe.associatedIconIndex]={x:_e,y:Oe,z:Ve,angle:qe})}else ko(le,z)}if(P){U.clear();let re=h.icon.placedSymbolArray;for(let oe=0;oe<re.length;oe++){let ae=re.get(oe),{numGlyphs:ue}=ae,le=W[oe];if(ae.hidden||!le)ko(ue,U);else{let{x:he,y:ge,z:be,angle:ye}=le;for(let _e=0;_e<ue;_e++)n.bo(U,he,ge,be,ye)}}h.icon.dynamicLayoutVertexBuffer.updateData(U)}h.text.dynamicLayoutVertexBuffer.updateData(z)}function Xc(h,t,o,f,g,v,b={}){let M=o.paint.get("icon-translate"),A=o.paint.get("text-translate"),O=o.paint.get("icon-translate-anchor"),P=o.paint.get("text-translate-anchor"),F=o.layout.get("icon-rotation-alignment"),z=o.layout.get("text-rotation-alignment"),U=o.layout.get("icon-pitch-alignment"),W=o.layout.get("text-pitch-alignment"),q=o.layout.get("icon-keep-upright"),X=o.layout.get("text-keep-upright"),Z=o.paint.get("icon-color-saturation"),Q=o.paint.get("icon-color-contrast"),re=o.paint.get("icon-color-brightness-min"),oe=o.paint.get("icon-color-brightness-max"),ae=o.layout.get("symbol-elevation-reference")==="sea",ue=h.context,le=ue.gl,he=h.transform,ge=F==="map",be=z==="map",ye=U==="map",_e=W==="map",Oe=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ve=!1,Ze=h.depthModeForSublayer(0,Ct.ReadOnly),Ke=[n.am(he.center.lng),n.at(he.center.lat)],nt=o.layout.get("text-variable-anchor"),Ce=he.projection.name==="globe",qe=[],ke=[0,-1,0];for(let We of f){let Xe=t.getTile(We),Ge=Xe.getBucket(o);if(!Ge||Ge.projection.name==="mercator"&&Ce||Ge.fullyClipped)continue;let at=Ge.projection.name==="globe",vt=at?n.a9(he.zoom):0,Et=ks(We,Ge.getProjection(),he),pt=he.calculatePixelsToTileUnitsMatrix(Xe),Tt=nt&&Ge.hasTextData(),ut=Ge.hasIconTextFit()&&Tt&&Ge.hasIconData(),Mt=Ge.getProjection().createInversionMatrix(he,We.canonical),Ht=Ln=>{he.depthOcclusionForSymbolsAndCircles&&(o.hasInitialOcclusionOpacityProperties||h.terrain)&&(Ln.push("DEPTH_D24"),Ln.push("DEPTH_OCCLUSION"))},cn=()=>{let Ln=ge&&o.layout.get("symbol-placement")!=="point",Cn=[];Ht(Cn);let ni=Ln||ut,Ri=o.paint.get("icon-image-cross-fade").constantOr(0);h.terrainRenderModeElevated()&&ye&&Cn.push("PITCH_WITH_MAP_TERRAIN"),at&&(Cn.push("PROJECTION_GLOBE_VIEW"),ni&&Cn.push("PROJECTED_POS_ON_VIEWPORT")),Ri>0&&Cn.push("ICON_TRANSITION"),Ge.icon.zOffsetVertexBuffer&&Cn.push("Z_OFFSET"),Z===0&&Q===0&&re===0&&oe===1||Cn.push("COLOR_ADJUSTMENT"),Ge.sdfIcons&&Cn.push("RENDER_SDF");let Nr=Ge.icon.programConfigurations.get(o.id),Jr=h.getOrCreateProgram("symbol",{config:Nr,defines:Cn}),Li=Xe.imageAtlasTexture?Xe.imageAtlasTexture.size:[0,0],gn=Ge.iconSizeData,un=n.bk(gn,he.zoom),Tn=ye||he.pitch!==0,qn=pn(Et,Xe.tileID.canonical,ye,ge,he,Ge.getProjection(),pt),mi=wr(Et,Xe.tileID.canonical,ye,ge,he,Ge.getProjection(),pt),ii=h.translatePosMatrix(mi,Xe,M,O,!0),ji=h.translatePosMatrix(Et,Xe,M,O),zo=ni?Zc:qn,Ir=ge&&!ye&&!Ln,Tr=ke;!Ce&&!he.mercatorFromTransition||ge||(Tr=kg(he));let Kr=at?Tr:ke,yo=o.getColorAdjustmentMatrix(Z,Q,re,oe),Cr=Pg(gn.kind,un,Ir,ye,h,ji,zo,ii,ae,!1,Li,[0,0],!0,We,vt,Ke,Mt,Kr,Ge.getProjection(),yo,Ri),fs=Xe.imageAtlasTexture?Xe.imageAtlasTexture:null,Qr=o.layout.get("icon-size").constantOr(0)!==1||Ge.iconsNeedLinear,An=Ge.sdfIcons||h.options.rotating||h.options.zooming||Qr||Tn?le.LINEAR:le.NEAREST,zl=Ge.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,up=h.terrain&&ye&&Ln?n.a6.mat4.invert(n.a6.mat4.create(),qn):Zc;if(Ln&&Ge.icon){let Bl=he.elevation,hp=Bl?Bl.getAtTileOffsetFunc(We,he.center.lat,he.worldSize,Ge.getProjection()):null,lu=mn(Et,Xe.tileID.canonical,ye,ge,he,Ge.getProjection(),pt);sl(Ge,Et,h,!1,lu,mi,ye,q,hp,We)}return{program:Jr,buffers:Ge.icon,uniformValues:Cr,atlasTexture:fs,atlasTextureIcon:null,atlasInterpolation:An,atlasInterpolationIcon:null,isSDF:Ge.sdfIcons,hasHalo:zl,tile:Xe,labelPlaneMatrixInv:up}},Vn=()=>{let Ln=be&&o.layout.get("symbol-placement")!=="point",Cn=[],ni=Ln||nt||ut;h.terrainRenderModeElevated()&&_e&&Cn.push("PITCH_WITH_MAP_TERRAIN"),at&&(Cn.push("PROJECTION_GLOBE_VIEW"),ni&&Cn.push("PROJECTED_POS_ON_VIEWPORT")),Ge.text.zOffsetVertexBuffer&&Cn.push("Z_OFFSET"),Ge.iconsInText&&Cn.push("RENDER_TEXT_AND_SYMBOL"),Cn.push("RENDER_SDF"),Ht(Cn);let Ri=Ge.text.programConfigurations.get(o.id),Nr=h.getOrCreateProgram("symbol",{config:Ri,defines:Cn}),Jr,Li=[0,0],gn=null,un=Ge.textSizeData;Ge.iconsInText&&(Li=Xe.imageAtlasTexture?Xe.imageAtlasTexture.size:[0,0],gn=Xe.imageAtlasTexture?Xe.imageAtlasTexture:null,Jr=_e||he.pitch!==0||h.options.rotating||h.options.zooming||un.kind==="composite"||un.kind==="camera"?le.LINEAR:le.NEAREST);let Tn=Xe.glyphAtlasTexture?Xe.glyphAtlasTexture.size:[0,0],qn=o.layout.get("text-size-scale-range"),mi=n.ap(h.scaleFactor,qn[0],qn[1]),ii=n.bk(un,he.zoom,mi),ji=pn(Et,Xe.tileID.canonical,_e,be,he,Ge.getProjection(),pt),zo=wr(Et,Xe.tileID.canonical,_e,be,he,Ge.getProjection(),pt),Ir=h.translatePosMatrix(zo,Xe,A,P,!0),Tr=h.translatePosMatrix(Et,Xe,A,P),Kr=ni?Zc:ji,yo=be&&!_e&&!Ln,Cr=ke;!Ce&&!he.mercatorFromTransition||be||(Cr=kg(he));let fs=Pg(un.kind,ii,yo,_e,h,Tr,Kr,Ir,ae,!0,Tn,Li,!0,We,vt,Ke,Mt,at?Cr:ke,Ge.getProjection(),null,null,mi),Qr=Xe.glyphAtlasTexture?Xe.glyphAtlasTexture:null,An=le.LINEAR,zl=o.paint.get("text-halo-width").constantOr(1)!==0,up=h.terrain&&_e&&Ln?n.a6.mat4.invert(n.a6.mat4.create(),ji):Zc;if(Ln&&Ge.text){let Bl=he.elevation,hp=Bl?Bl.getAtTileOffsetFunc(We,he.center.lat,he.worldSize,Ge.getProjection()):null,lu=mn(Et,Xe.tileID.canonical,_e,be,he,Ge.getProjection(),pt);sl(Ge,Et,h,!0,lu,zo,_e,X,hp,We)}return{program:Nr,buffers:Ge.text,uniformValues:fs,atlasTexture:Qr,atlasTextureIcon:gn,atlasInterpolation:An,atlasInterpolationIcon:Jr,isSDF:!0,hasHalo:zl,tile:Xe,labelPlaneMatrixInv:up}},vn=Ge.icon.segments.get().length,Zn=Ge.text.segments.get().length,In=vn&&!b.onlyText?cn():null,jn=Zn&&!b.onlyIcons?Vn():null,nn=o.paint.get("icon-opacity").constantOr(1),Nn=o.paint.get("text-opacity").constantOr(1);if(Oe&&Ge.canOverlap){Ve=!0;let Ln=nn&&!b.onlyText?Ge.icon.segments.get():[],Cn=Nn&&!b.onlyIcons?Ge.text.segments.get():[];for(let ni of Ln)qe.push({segments:new n.b2([ni]),sortKey:ni.sortKey,state:In});for(let ni of Cn)qe.push({segments:new n.b2([ni]),sortKey:ni.sortKey,state:jn})}else b.onlyText||qe.push({segments:nn?Ge.icon.segments:new n.b2([]),sortKey:0,state:In}),b.onlyIcons||qe.push({segments:Nn?Ge.text.segments:new n.b2([]),sortKey:0,state:jn})}Ve&&qe.sort((We,Xe)=>We.sortKey-Xe.sortKey);for(let We of qe){let Xe=We.state;if(Xe)if(h.terrain?h.terrain.setupElevationDraw(Xe.tile,Xe.program,{useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Xe.labelPlaneMatrixInv}):h.setupDepthForOcclusion(he.depthOcclusionForSymbolsAndCircles,Xe.program),ue.activeTexture.set(le.TEXTURE0),Xe.atlasTexture&&Xe.atlasTexture.bind(Xe.atlasInterpolation,le.CLAMP_TO_EDGE,!0),Xe.atlasTextureIcon&&(ue.activeTexture.set(le.TEXTURE1),Xe.atlasTextureIcon&&Xe.atlasTextureIcon.bind(Xe.atlasInterpolationIcon,le.CLAMP_TO_EDGE,!0)),h.uploadCommonLightUniforms(h.context,Xe.program),Xe.hasHalo){let Ge=Xe.uniformValues;Ge.u_is_halo=1,Yc(Xe.buffers,We.segments,o,h,Xe.program,Ze,g,v,Ge,2),Ge.u_is_halo=0}else{if(Xe.isSDF){let Ge=Xe.uniformValues;Xe.hasHalo&&(Ge.u_is_halo=1,Yc(Xe.buffers,We.segments,o,h,Xe.program,Ze,g,v,Ge,1)),Ge.u_is_halo=0}Yc(Xe.buffers,We.segments,o,h,Xe.program,Ze,g,v,Xe.uniformValues,1)}}}function Yc(h,t,o,f,g,v,b,M,A,O){let P=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer];g.draw(f,f.context.gl.TRIANGLES,v,b,M,zt.disabled,A,o.id,h.layoutVertexBuffer,h.indexBuffer,t,o.paint,f.transform.zoom,h.programConfigurations.get(o.id),P,O)}function Eh(h,t,o,f,g,v,b){let M=h.context.gl,A=o.paint.get("fill-pattern"),O=o.is3D(),P=O?h.stencilModeFor3D():Gt.disabled,F=A&&A.constantOr(1),z,U,W,q,X;b?(U=F&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=M.LINES):(U=F?"fillPattern":"fill",z=M.TRIANGLES);for(let Z of f){let Q=t.getTile(Z);if(F&&!Q.patternsLoaded())continue;let re=Q.getBucket(o);if(!re)continue;h.prepareDrawTile();let oe=re.programConfigurations.get(o.id),ae=h.isTileAffectedByFog(Z),ue=h.getOrCreateProgram(U,{config:oe,overrideFog:ae});F&&(h.context.activeTexture.set(M.TEXTURE0),Q.imageAtlasTexture&&Q.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),oe.updatePaintBuffers());let le=A.constantOr(null);if(le&&Q.imageAtlas){let be=Q.imageAtlas.patternPositions[le.toString()];be&&oe.setConstantPatternPositions(be)}let he=h.translatePosMatrix(Z.projMatrix,Q,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),ge=o.paint.get("fill-emissive-strength");if(b){q=re.indexBuffer2,X=re.segments2;let be=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];W=U==="fillOutlinePattern"&&F?T0(he,ge,h,Q,be):Hc(he,ge,be)}else q=re.indexBuffer,X=re.segments,W=F?Of(he,ge,h,Q):Rg(he,ge);h.uploadCommonUniforms(h.context,ue,Z.toUnwrapped()),ue.draw(h,z,g,O?P:h.stencilModeForClipping(Z),v,zt.disabled,W,o.id,re.layoutVertexBuffer,q,X,o.paint,h.transform.zoom,oe,void 0)}}function Qi(h,t,o,f,g,v,b,M){o.resetLayerRenderingStats(h);let A=h.context,O=A.gl,P=h.transform,F=o.paint.get("fill-extrusion-pattern"),z=F.constantOr(1),U=o.paint.get("fill-extrusion-opacity"),W=h.style.enable3dLights(),q=o.paint.get(W&&!z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),X=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],Z=o.layout.get("fill-extrusion-edge-radius"),Q=Z>0&&!o.paint.get("fill-extrusion-rounded-roof"),re=Q?0:Z,oe=P.projection.name==="globe"?n.c_():0,ae=P.projection.name==="globe",ue=ae?n.a9(P.zoom):0,le=[n.am(P.center.lng),n.at(P.center.lat)],he=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(o.lut).toArray01().slice(0,3),ge=o.paint.get("fill-extrusion-flood-light-intensity"),be=o.paint.get("fill-extrusion-vertical-scale"),ye=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,_e=o.paint.get("fill-extrusion-height-alignment"),Oe=o.paint.get("fill-extrusion-base-alignment"),Ve=is(h,o.paint.get("fill-extrusion-cutoff-fade-range")),Ze=[],Ke;ae&&Ze.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&Ze.push("FAUX_AO"),Q&&Ze.push("ZERO_ROOF_RADIUS"),M&&Ze.push("HAS_CENTROID"),ge>0&&Ze.push("FLOOD_LIGHT"),Ve.shouldRenderCutoff&&Ze.push("RENDER_CUTOFF"),ye&&Ze.push("RENDER_WALL_MODE");let nt=h.renderPass==="shadow",Ce=h.shadowRenderer,qe=nt&&!!Ce;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let ke=[0,0,0];if(Ce){let Ge=h.style.directionalLight,at=h.style.ambientLight;Ge&&at&&(ke=rh(h.style,Ge,at)),nt||(Ze.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ce.useNormalOffset&&Ze.push("NORMAL_OFFSET")),Ke=Ze.concat(["SHADOWS_SINGLE_CASCADE"])}let We=qe?"fillExtrusionDepth":z?"fillExtrusionPattern":"fillExtrusion",Xe=o.getLayerRenderingStats();for(let Ge of f){let at=t.getTile(Ge),vt=at.getBucket(o);if(!vt||vt.projection.name!==P.projection.name)continue;let Et=!1;Ce&&(Et=Ce.getMaxCascadeForTile(Ge.toUnwrapped())===0);let pt=h.isTileAffectedByFog(Ge),Tt=vt.programConfigurations.get(o.id),ut=h.getOrCreateProgram(We,{config:Tt,defines:Et?Ke:Ze,overrideFog:pt});if(h.terrain&&h.terrain.setupElevationDraw(at,ut,{useMeterToDem:!0}),!vt.centroidVertexBuffer){let In=ut.attributes.a_centroid_pos;In!==void 0&&O.vertexAttrib2f(In,0,0)}!nt&&Ce&&Ce.setupShadows(at.tileID.toUnwrapped(),ut,"vector-tile",at.tileID.overscaledZ),z&&(h.context.activeTexture.set(O.TEXTURE0),at.imageAtlasTexture&&at.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Tt.updatePaintBuffers());let Mt=F.constantOr(null);if(Mt&&at.imageAtlas){let In=at.imageAtlas.patternPositions[Mt.toString()];In&&Tt.setConstantPatternPositions(In)}let Ht=o.paint.get("fill-extrusion-vertical-gradient"),cn=1/vt.tileToMeter,Vn;if(nt&&Ce){if(Fg(at.tileID,vt,h))continue;let In=Ce.calculateShadowPassMatrixFromTile(at.tileID.toUnwrapped());Vn=Rf(In,re,cn,be,_e,Oe)}else{let In=h.translatePosMatrix(Ge.expandedProjMatrix,at,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),jn=P.projection.createInversionMatrix(P,Ge.canonical);Vn=z?Pf(In,h,Ht,U,X,re,cn,Ge,at,oe,_e,Oe,ue,le,jn,he,be):Af(In,h,Ht,U,X,re,cn,Ge,oe,_e,Oe,ue,le,jn,he,be,ge,ke)}h.uploadCommonUniforms(A,ut,Ge.toUnwrapped(),null,Ve);let vn=vt.segments;if(P.projection.name==="mercator"&&!nt&&(vn=vt.getVisibleSegments(at.tileID,h.terrain,h.transform.getFrustum(0)),!vn.get().length))continue;if(Xe)if(nt)for(let In of vn.get())Xe.numRenderedVerticesInShadowPass+=In.primitiveLength;else for(let In of vn.get())Xe.numRenderedVerticesInTransparentPass+=In.primitiveLength;let Zn=[];(h.terrain||M)&&Zn.push(vt.centroidVertexBuffer),ae&&Zn.push(vt.layoutVertexExtBuffer),ye&&Zn.push(vt.wallVertexBuffer),ut.draw(h,A.gl.TRIANGLES,g,v,b,zt.backCCW,Vn,o.id,vt.layoutVertexBuffer,vt.indexBuffer,vn,o.paint,h.transform.zoom,Tt,Zn)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}function Lr(h,t,o,f,g,v,b,M,A,O,P,F,z,U,W,q,X,Z,Q){let re=h.context,oe=re.gl,ae=h.transform,ue=h.transform.zoom,le=[],he=is(h,o.paint.get("fill-extrusion-cutoff-fade-range"));O==="clear"?(le.push("CLEAR_SUBPASS"),Q&&(le.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(oe.TEXTURE0),Q.bind(oe.LINEAR,oe.CLAMP_TO_EDGE))):O==="sdf"&&le.push("SDF_SUBPASS"),X&&le.push("HAS_CENTROID"),he.shouldRenderCutoff&&le.push("RENDER_CUTOFF");let ge=o.layout.get("fill-extrusion-edge-radius"),be=(ye,_e,Oe,Ve,Ze)=>{let Ke=_e.programConfigurations.get(o.id),nt=h.isTileAffectedByFog(ye),Ce=h.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ke,defines:le,overrideFog:nt}),qe=((We,Xe,Ge,at,vt,Et,pt,Tt,ut,Mt,Ht)=>({u_matrix:Xe,u_opacity:Ge,u_ao_pass:at?1:0,u_meter_to_tile:vt,u_ao:Et,u_flood_light_intensity:pt,u_flood_light_color:Tt,u_attenuation:ut,u_edge_radius:Mt,u_fb:0,u_fb_size:Ht,u_dynamic_offset:1}))(0,Ve,P,A,Ze,[F,z*Ze],U,W,q,ue>=17?0:ge*Ze,Q?Q.size[0]:0),ke=[];X&&ke.push(_e.hiddenByLandmarkVertexBuffer),h.uploadCommonUniforms(re,Ce,ye.toUnwrapped(),null,he),Ce.draw(h,re.gl.TRIANGLES,g,v,b,M,qe,o.id,_e.vertexBuffer,_e.indexBuffer,Oe,o.paint,ue,Ke,ke)};for(let ye of f){let _e=t.getTile(ye),Oe=_e.getBucket(o);if(!Oe||Oe.projection.name!==ae.projection.name||!Oe.groundEffect||Oe.groundEffect&&!Oe.groundEffect.hasData())continue;let Ve=Oe.groundEffect,Ze=1/Oe.tileToMeter;{let Ke=h.translatePosMatrix(ye.projMatrix,_e,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),nt=Ve.getDefaultSegment();be(ye,Ve,nt,Ke,Ze)}if(Z)for(let Ke=0;Ke<4;Ke++){let nt=n.c$[Ke](ye),Ce=t.getTile(nt);if(!Ce)continue;let qe=Ce.getBucket(o);if(!qe||qe.projection.name!==ae.projection.name||!qe.groundEffect||qe.groundEffect&&!qe.groundEffect.hasData())continue;let ke=qe.groundEffect,We,Xe;Ke===0?(We=[-n.ab,0,0],Xe=1):Ke===1?(We=[n.ab,0,0],Xe=0):Ke===2?(We=[0,-n.ab,0],Xe=3):(We=[0,n.ab,0],Xe=2);let Ge=ke.regionSegments[Xe];if(!Ge)continue;let at=new Float32Array(16);n.a6.mat4.translate(at,ye.projMatrix,We),be(ye,ke,Ge,h.translatePosMatrix(at,_e,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Ze)}}}function Lg(h,t,o,f,g,v,b){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();let M=v?v.findDEMTileFor(o):null;if(!(M&&M.dem||b))return;let A=Z=>new n.P(Math.ceil((Z+n.d2)*n.d3),0),O=Z=>{let Q=t.getSource().minzoom,re=ae=>{let ue=t.getTileByID(ae);if(ue&&ue.hasData())return ue.getBucket(g)},oe=[0,-1,1];for(let ae of oe){if(Z.overscaledZ+ae<Q)continue;let ue=re(Z.calculateScaledKey(Z.overscaledZ+ae));if(ue)return ue}},P=[0,0,0],F=(Z,Q)=>(P[0]=Math.min(Z.min.y,Q.min.y),P[1]=Math.max(Z.max.y,Q.max.y),P[2]=n.ab-Q.min.x>Z.max.x?Q.min.x-n.ab:Z.max.x,P),z=(Z,Q)=>(P[0]=Math.min(Z.min.x,Q.min.x),P[1]=Math.max(Z.max.x,Q.max.x),P[2]=n.ab-Q.min.y>Z.max.y?Q.min.y-n.ab:Z.max.y,P),U=[(Z,Q)=>F(Z,Q),(Z,Q)=>F(Q,Z),(Z,Q)=>z(Z,Q),(Z,Q)=>z(Q,Z)],W=(Z,Q,re,oe,ae,ue,le)=>{if(!v)return 0;let he=[[ue?re:Z,ue?Z:re,0],[ue?re:Q,ue?Q:re,0]],ge=le<0?n.ab+le:le,be=[ue?ge:(Z+Q)/2,ue?(Z+Q)/2:ge,0];return re===0&&le<0||re!==0&&le>0?v.getForTilePoints(ae,[be],!0,oe):he.push(be),v.getForTilePoints(o,he,!0,M),Math.max(he[0][2],he[1][2],be[2])/v.exaggeration()};for(let Z=0;Z<4;Z++){let Q=f.borderFeatureIndices[Z];if(Q.length===0)continue;let re=n.c$[Z](o),oe=O(re);if(!(oe&&oe instanceof n.d0)||f.borderDoneWithNeighborZ[Z]===oe.canonical.z)continue;oe.centroidVertexArray.length===0&&oe.createCentroidsBuffer();let ae=v?v.findDEMTileFor(re):null;if(!(ae&&ae.dem||b))continue;let ue=(Z<2?1:5)-Z,le=oe.borderDoneWithNeighborZ[ue]!==f.canonical.z,he=oe.borderFeatureIndices[ue],ge=0;if(f.canonical.z!==oe.canonical.z){for(let be of Q)f.showCentroid(f.featuresOnBorder[be]);if(le)for(let be of he)oe.showCentroid(oe.featuresOnBorder[be]);f.borderDoneWithNeighborZ[Z]=oe.canonical.z,oe.borderDoneWithNeighborZ[ue]=f.canonical.z}for(let be of Q){let ye=f.featuresOnBorder[be],_e=f.centroidData[ye.centroidDataIndex],Oe=ye.borders[Z],Ve;for(;ge<he.length;){Ve=oe.featuresOnBorder[he[ge]];let Ze=Ve.borders[ue];if(Ze[1]>Oe[0]+3||Ze[0]>Oe[0]-3)break;oe.showCentroid(Ve),ge++}if(Ve&&ge<he.length){let Ze=ge,Ke=0;for(;!(Ve.borders[ue][0]>Oe[1]-3)&&(Ke++,++ge!==he.length);)Ve=oe.featuresOnBorder[he[ge]];Ve=oe.featuresOnBorder[he[Ze]];let nt=!1;if(Ke>=1){let ke=Ve.borders[ue];Math.abs(Oe[0]-ke[0])<3&&Math.abs(Oe[1]-ke[1])<3&&(Ke=1,nt=!0,ge=Ze+1)}else if(Ke===0){f.showCentroid(ye);continue}let Ce=oe.centroidData[Ve.centroidDataIndex];b&&nt&&(((q=_e).flags|(X=Ce).flags)&n.d1?(q.flags|=n.d1,X.flags|=n.d1):(q.flags&=~n.d1,X.flags&=~n.d1));let qe=ye.intersectsCount()>1||Ve.intersectsCount()>1;if(Ke>1)ge=Ze,_e.centroidXY=Ce.centroidXY=new n.P(0,0);else if(ae&&ae.dem&&!qe){let ke=U[Z](_e,Ce),We=Z%2?n.ab-1:0,Xe=W(ke[0],Math.min(n.ab-1,ke[1]),We,ae,re,Z<2,ke[2]);_e.centroidXY=Ce.centroidXY=A(Xe)}else qe?_e.centroidXY=Ce.centroidXY=new n.P(0,0):(_e.centroidXY=f.encodeBorderCentroid(ye),Ce.centroidXY=oe.encodeBorderCentroid(Ve));f.writeCentroidToBuffer(_e),oe.writeCentroidToBuffer(Ce)}else f.showCentroid(ye)}f.borderDoneWithNeighborZ[Z]=oe.canonical.z,oe.borderDoneWithNeighborZ[ue]=f.canonical.z}var q,X;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(h)}let Uf=[1,0,0],$f=[0,1,0],Gf=[0,0,1];function Fg(h,t,o){let f=o.transform,g=o.shadowRenderer;if(!g)return!0;let v=h.toUnwrapped(),b=f.tileSize*g._cascades[o.currentShadowCascade].scale,M=t.maxHeight;if(f.elevation){let q=f.elevation.getMinMaxForTile(h);q&&(M+=q.max)}let A=[...g.shadowDirection];A[2]=-A[2];let O=g.computeSimplifiedTileShadowVolume(v,M,b,A);if(!O)return!1;let P=[Uf,$f,Gf,A,[A[0],0,A[2]],[0,A[1],A[2]]],F=f.projection.name==="globe",z=f.scaleZoom(b),U=n.bO.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,z,!F),W=g.getCurrentCascadeFrustum();return U.intersectsPrecise(O.vertices,O.planes,P)===0||W.intersectsPrecise(O.vertices,O.planes,P)===0}function Fr(h){return[h[0]*n.d4,h[1]*n.d4,h[2]*n.d4,0]}function li(h,t,o,f,g,v,b,M,A){let O=f.getSource(),P=o.globeSharedBuffers;if(!P)return;let F,z,U;if(t&&(F=f.getTile(t)),O instanceof n.aD?(z=O.texture,U=n.cD(0,0,o.transform)):F&&t&&(z=F.texture,U=n.cD(t.canonical.z,t.canonical.x,o.transform)),!z||!U)return;h||(U=n.a6.mat4.scale(n.a6.mat4.create(),U,[1,-1,1]));let W=o.context,q=W.gl,X=g.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR,Z=o.colorModeForDrapableLayerRenderPass(v),Q=b.defines;Q.push("GLOBE_POLES");let re=new Ct(q.LEQUAL,Ct.ReadWrite,o.depthRangeFor3D),oe=Float32Array.from(o.transform.expandedFarZProjMatrix),ae=Float32Array.from(n.b6(n.cC(new n.bQ(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),W.activeTexture.set(q.TEXTURE0),z.bind(X,q.CLAMP_TO_EDGE),W.activeTexture.set(q.TEXTURE1),z.bind(X,q.CLAMP_TO_EDGE),z.useMipmap&&W.extTextureFilterAnisotropic&&o.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);let[ue,le,he,ge]=t?P.getPoleBuffers(t.canonical.z,!1):P.getPoleBuffers(0,!0),be=g.paint.get("raster-elevation"),ye;h?(ye=ue,o.renderDefaultNorthPole=be!==0):(ye=le,o.renderDefaultSouthPole=be!==0);let _e=Fr(b.mix),Oe=((Ze,Ke,nt,Ce,qe,ke,We,Xe,Ge,at,vt,Et,pt)=>vh(Ze,Ke,nt,new Float32Array(16),new Float32Array(9),[0,0],Ce,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ke,[0,0],Xe,2,at,vt,Et,1,0,pt))(oe,ae,U,n.a9(o.transform.zoom),0,g,0,be,0,_e,b.offset,b.range,v),Ve=o.getOrCreateProgram("raster",{defines:Q});o.uploadCommonUniforms(W,Ve,null),Ve.draw(o,q.TRIANGLES,re,A,Z,M,Oe,g.id,ye,he,ge)}function Ih(h){let t=h._nearZ,o=h.projection.farthestPixelDistance(h),f=o-t,g=.2*h.height,v=t+g;return[t,o,(v-g-t)/f,(v-t)/f]}function Hf(h,t,o,f){if(h)return t instanceof Ro&&h instanceof Wu?t.getTextureDescriptor(h,o,!0):{texture:h.texture,mix:Fr(f.mix),offset:f.offset,buffer:0,tileSize:1}}var Ng=n.d5([{name:"a_index",type:"Int16",components:1}]);class zg{constructor(t,o,f,g){let v={width:f[0],height:f[1],data:null},b=t.gl;this.targetColorTexture=new n.T(t,v,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,v,b.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,g),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let f=this.context.gl,g=o.width*o.height;this.particleTexture0=new n.T(this.context,o,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,o,f.RGBA8,{premultiply:!1,useMipmap:!1});let v=new n.d6;v.reserve(g);for(let b=0;b<g;b++)v.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(v,Ng.members,!0),this.particleSegment=n.b2.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Bg(h,t,o){if(!h)return null;let f=t.getTextureDescriptor(h,o,!0);if(!f)return null;let{texture:g,mix:v,offset:b,tileSize:M,buffer:A,format:O}=f;if(!g||!O)return null;let P=!1;return O==="uint32"&&(P=!0,v[3]=0,v=yh(n.d7,v,[0,o.paint.get("raster-particle-max-speed")]),b=Tl(n.d7,b,[0,o.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[A/(M+2*A),M/(M+2*A)],tileSize:M,scalarData:P,scale:v,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[O]]}}function A0(h){let t=h._nearZ,o=h.projection.farthestPixelDistance(h),f=o-t,g=.2*h.height,v=t+g;return[t,o,(v-g-t)/f,(v-t)/f]}let Dl=new n.bA(1,0,0,1),Ml=new n.bA(0,1,0,1),tt=new n.bA(0,0,1,1),wt=new n.bA(1,0,1,1),Sl=new n.bA(0,1,1,1);function Kn(h,t,o,f,g,v,b){let M=h.context,A=h.transform,O=M.gl,P=A.projection.name==="globe",F=P?["PROJECTION_GLOBE_VIEW"]:[],z=n.a6.mat4.clone(o.projMatrix);if(P&&n.a9(A.zoom)>0){let _e=n.b5(o.canonical,A),Oe=n.d8(_e);z=n.a6.mat4.multiply(new Float32Array(16),A.globeMatrix,Oe),n.a6.mat4.multiply(z,A.projMatrix,z)}let U=n.a6.mat4.create();U[12]+=2*g/(n.q.devicePixelRatio*A.width),U[13]+=2*v/(n.q.devicePixelRatio*A.height),n.a6.mat4.multiply(z,U,z);let W=h.getOrCreateProgram("debug",{defines:F}),q=t.getTileByID(o.key);h.terrain&&h.terrain.setupElevationDraw(q,W);let X=Ct.disabled,Z=Gt.disabled,Q=h.colorModeForRenderPass(),re="$debug";M.activeTexture.set(O.TEXTURE0),h.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),P?q._makeGlobeTileDebugBuffers(h.context,A):q._makeDebugTileBoundsBuffers(h.context,A.projection);let oe=q._tileDebugBuffer||h.debugBuffer,ae=q._tileDebugIndexBuffer||h.debugIndexBuffer,ue=q._tileDebugSegments||h.debugSegments;if(W.draw(h,O.LINE_STRIP,X,Z,Q,zt.disabled,kf(z,f),re,oe,ae,ue,null,null,null,[q._globeTileDebugBorderBuffer]),b){let _e=q.latestRawTileData,Oe=Math.floor((_e&&_e.byteLength||0)/1024),Ve=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Ve+=` => ${o.overscaledZ}`),Ve+=` ${q.state}`,Ve+=` ${Oe}kb`,function(Ze,Ke){Ze.initDebugOverlayCanvas();let nt=Ze.debugOverlayCanvas,Ce=Ze.context.gl,qe=Ze.debugOverlayCanvas.getContext("2d");qe.clearRect(0,0,nt.width,nt.height),qe.shadowColor="white",qe.shadowBlur=2,qe.lineWidth=1.5,qe.strokeStyle="white",qe.textBaseline="top",qe.font="bold 36px Open Sans, sans-serif",qe.fillText(Ke,5,5),qe.strokeText(Ke,5,5),Ze.debugOverlayTexture.update(nt),Ze.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}(h,Ve)}let le=t.getTile(o).tileSize,he=512/Math.min(le,512)*(o.overscaledZ/A.zoom)*.5,ge=q._tileDebugTextBuffer||h.debugBuffer,be=q._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,ye=q._tileDebugTextSegments||h.debugSegments;W.draw(h,O.TRIANGLES,X,Z,sn.alphaBlended,zt.disabled,kf(z,n.bA.transparent,he),re,ge,be,ye,null,null,null,[q._globeTileDebugTextBuffer])}function Re(h,t,o,f){Ia(h,0,t+o/2,h.transform.width,o,f)}function qf(h,t,o,f){Ia(h,t-o/2,0,o,h.transform.height,f)}function Ia(h,t,o,f,g,v){let b=h.context,M=b.gl;M.enable(M.SCISSOR_TEST),M.scissor(t*n.q.devicePixelRatio,o*n.q.devicePixelRatio,f*n.q.devicePixelRatio,g*n.q.devicePixelRatio),b.clear({color:v}),M.disable(M.SCISSOR_TEST)}let Wf=n.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Th}=Wf;function ss(h,t,o,f){h.emplaceBack(t,o,f)}class Zf{constructor(t){this.vertexArray=new n.d9,this.indices=new n.aP,ss(this.vertexArray,-1,-1,1),ss(this.vertexArray,1,-1,1),ss(this.vertexArray,-1,1,1),ss(this.vertexArray,1,1,1),ss(this.vertexArray,-1,-1,-1),ss(this.vertexArray,1,-1,-1),ss(this.vertexArray,-1,1,-1),ss(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Th),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.b2.simpleSegment(0,0,36,12)}}function go(h,t,o,f,g,v){let b=h.context.gl,M=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),O=t.paint.get("sky-atmosphere-sun-intensity"),P=((F,z,U,W,q)=>({u_matrix_3f:F,u_sun_direction:z,u_sun_intensity:U,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[q.r,q.g,q.b,q.a],u_luminance:5e-5}))(n.a6.mat3.fromMat4(n.a6.mat3.create(),f),g,O,M,A);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),o.draw(h,b.TRIANGLES,Ct.disabled,Gt.disabled,sn.unblended,zt.frontCW,P,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}let R0=n.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class P0{constructor(t){let o=new n.da;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);let f=new n.aP;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,R0.members),this.indexBuffer=t.createIndexBuffer(f),this.segments=n.b2.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Vg=n.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ch{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Xf{constructor(t){this.colorModeAlphaBlendedWriteRGB=new sn([1,Rr,1,Rr],n.bA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new sn([1,0,1,0],n.bA.transparent,[!1,!1,!1,!0]),this.params=new Ch,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){let o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new P0(o);let f=this.params.sizeRange,g=this.params.intensityRange,v=function(P){let F=n.dd(30),z=[];for(let U=0;U<P;++U){let W=2*Math.PI*F(),q=Math.acos(1-2*F())-.5*Math.PI;z.push(n.a6.vec3.fromValues(Math.cos(q)*Math.cos(W),Math.cos(q)*Math.sin(W),Math.sin(q)))}return z}(this.params.starsCount),b=n.dd(300),M=new n.db,A=new n.aP,O=0;for(let P=0;P<v.length;++P){let F=n.a6.vec3.scale([],v[P],200),z=Math.max(0,1+.01*f*(1*b()-.5)),U=Math.max(0,1+.01*g*(1*b()-.5));M.emplaceBack(F[0],F[1],F[2],-1,-1,z,U),M.emplaceBack(F[0],F[1],F[2],1,-1,z,U),M.emplaceBack(F[0],F[1],F[2],1,1,z,U),M.emplaceBack(F[0],F[1],F[2],-1,1,z,U),A.emplaceBack(O+0,O+1,O+2),A.emplaceBack(O+0,O+2,O+3),O+=4}this.starsVx=o.createVertexBuffer(M,Vg.members),this.starsIdx=o.createIndexBuffer(A),this.starsSegments=n.b2.simpleSegment(0,0,M.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){let f=t.context,g=f.gl,v=t.transform,b=new Ct(g.LEQUAL,Ct.ReadOnly,[0,1]),M=n.a9(v.zoom),A=t.style.getLut(o.scope),O=o.properties.get("color").toRenderColor(A).toArray01(),P=o.properties.get("high-color").toRenderColor(A).toArray01(),F=o.properties.get("space-color").toRenderColor(A).toArray01PremultipliedAlpha(),z=5e-4,U=n.dc(o.properties.get("horizon-blend"),0,1,z,.25),W=n.cx(t,f,v)&&U===z?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,q=t.frameCounter/1e3%1,X=n.a6.vec3.length(v.globeCenterInViewSpace),Z=Math.sqrt(Math.pow(X,2)-Math.pow(W,2)),Q=Math.acos(Z/X),re=oe=>{let ae=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];oe&&ae.push("ALPHA_PASS");let ue=t.getOrCreateProgram("globeAtmosphere",{defines:ae}),le=((ge,be,ye,_e,Oe,Ve,Ze,Ke,nt,Ce,qe,ke)=>({u_frustum_tl:ge,u_frustum_tr:be,u_frustum_br:ye,u_frustum_bl:_e,u_horizon:Oe,u_transition:Ve,u_fadeout_range:Ze,u_color:Ke,u_high_color:nt,u_space_color:Ce,u_temporal_offset:qe,u_horizon_angle:ke}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,M,U,O,P,F,q,Q);t.uploadCommonUniforms(f,ue);let he=this.atmosphereBuffer;he&&ue.draw(t,g.TRIANGLES,b,Gt.disabled,oe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,zt.backCW,le,oe?"atmosphere_glow_alpha":"atmosphere_glow",he.vertexBuffer,he.indexBuffer,he.segments)};re(!1),re(!0)}drawStars(t,o){let f=n.ap(o.properties.get("star-intensity"),0,1);if(f===0)return;let g=t.context,v=g.gl,b=t.transform,M=t.getOrCreateProgram("stars"),A=n.a6.quat.identity([]);n.a6.quat.rotateX(A,A,-b._pitch),n.a6.quat.rotateZ(A,A,-b.angle),n.a6.quat.rotateX(A,A,n.bC(b._center.lat)),n.a6.quat.rotateY(A,A,-n.bC(b._center.lng));let O=n.a6.mat4.fromQuat(new Float32Array(16),A),P=n.a6.mat4.multiply([],b.starsProjMatrix,O),F=n.a6.mat3.fromMat4([],O),z=n.a6.mat3.invert([],F),U=[0,1,0];n.a6.vec3.transformMat3(U,U,z),n.a6.vec3.scale(U,U,this.params.sizeMultiplier);let W=[1,0,0];n.a6.vec3.transformMat3(W,W,z),n.a6.vec3.scale(W,W,this.params.sizeMultiplier);let q=(X=U,Z=W,Q=f,{u_matrix:Float32Array.from(P),u_up:X,u_right:Z,u_intensity_multiplier:Q});var X,Z,Q;t.uploadCommonUniforms(g,M),this.starsVx&&this.starsIdx&&M.draw(t,v.TRIANGLES,Ct.disabled,Gt.disabled,this.colorModeAlphaBlendedWriteRGB,zt.disabled,q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Yf(h,t){let o=[...h],f=t.cameraWorldSizeForFog/t.worldSize,g=n.a6.mat4.identity([]);return n.a6.mat4.scale(g,g,[f,f,1]),n.a6.mat4.multiply(o,g,o),n.a6.mat4.multiply(o,t.worldToFogMatrix,o),o}function Dh(h,t,o,f,g){let v=o.material,b=f.context,{baseColorTexture:M,metallicRoughnessTexture:A}=v.pbrMetallicRoughness,{normalTexture:O,occlusionTexture:P,emissionTexture:F}=v;function z(W,q,X){if(W&&(h.push(q),b.activeTexture.set(b.gl.TEXTURE0+X),W.gfxTexture)){let{minFilter:Z,magFilter:Q,wrapS:re,wrapT:oe}=W.sampler;W.gfxTexture.bindExtraParam(Z,Q,re,oe)}}z(M,"HAS_TEXTURE_u_baseColorTexture",Ki.BaseColor),z(A,"HAS_TEXTURE_u_metallicRoughnessTexture",Ki.MetallicRoughness),z(O,"HAS_TEXTURE_u_normalTexture",Ki.Normal),z(P,"HAS_TEXTURE_u_occlusionTexture",Ki.Occlusion),z(F,"HAS_TEXTURE_u_emissionTexture",Ki.Emission),g&&(g.texture||(g.texture=new n.df(f.context,g.image,[g.image.height,g.image.height,g.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+Ki.LUT),g.texture&&g.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(h.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||h.push("DIFFUSE_SHADED"),h.push("USE_STANDARD_DERIVATIVES");let U=f.shadowRenderer;U&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),U.useNormalOffset&&h.push("NORMAL_OFFSET"))}function Ta(h,t,o,f,g,v){let b=o.paint.get("model-opacity"),M=t.context,A=new Ct(t.context.gl.LEQUAL,Ct.ReadWrite,t.depthRangeFor3D),O=t.transform,P=h.mesh,F=P.material,z=F.pbrMetallicRoughness,U=t.style.fog,W;W=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:n.a6.mat4.multiply([],f.zScaleMatrix,h.nodeModelMatrix),n.a6.mat4.multiply(W,f.negCameraPosMatrix,W);let q=n.a6.mat4.invert([],W);n.a6.mat4.transpose(q,q);let X=o.paint.get("model-emissive-strength").constantOr(0),Z=wh(new Float32Array(h.worldViewProjection),new Float32Array(W),new Float32Array(q),null,t,b,z.baseColorFactor.toRenderColor(null),F.emissiveFactor,z.metallicFactor,z.roughnessFactor,F,X,o),Q={defines:[]},re=[],oe=t.shadowRenderer;oe&&(oe.useNormalOffset=!1),Dh(Q.defines,re,P,t,o.lut);let ae=null;if(U){let he=Yf(h.nodeModelMatrix,t.transform);if(ae=new Float32Array(he),O.projection.name!=="globe"){let ge=P.aabb.min,be=P.aabb.max,[ye,_e]=U.getOpacityForBounds(he,ge[0],ge[1],be[0],be[1]);Q.overrideFog=ye>=Qe||_e>=Qe}}let ue=is(t,o.paint.get("model-cutoff-fade-range"));ue.shouldRenderCutoff&&Q.defines.push("RENDER_CUTOFF");let le=t.getOrCreateProgram("model",Q);t.uploadCommonUniforms(M,le,null,ae,ue),t.renderPass!=="shadow"&&oe&&oe.setupShadowsFromMatrix(h.nodeModelMatrix,le),le.draw(t,M.gl.TRIANGLES,A,g,v,P.material.doubleSided?zt.disabled:zt.backCCW,Z,o.id,P.vertexBuffer,P.indexBuffer,P.segments,o.paint,t.transform.zoom,void 0,re)}function Jc(h,t,o,f,g,v,b){let M;M=h.projection.name==="globe"?n.dg(o,h):[...o],n.a6.mat4.multiply(M,M,t.matrix);let A=n.a6.mat4.multiply([],f,M);if(t.meshes)for(let O of t.meshes){if(O.material.alphaMode!=="BLEND"){b.push({mesh:O,depth:0,modelIndex:g,worldViewProjection:A,nodeModelMatrix:M});continue}let P=n.a6.vec3.transformMat4([],O.centroid,A);P[2]>0&&v.push({mesh:O,depth:P[2],modelIndex:g,worldViewProjection:A,nodeModelMatrix:M})}if(t.children)for(let O of t.children)Jc(h,O,o,f,g,v,b)}function Mh(h,t,o,f){let g=o.shadowRenderer;if(!g)return;let v=g.getShadowPassDepthMode(),b=g.getShadowPassColorMode(),M=g.calculateShadowPassMatrixFromMatrix(t),A=zf(M);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,v,Gt.disabled,b,zt.backCCW,A,f.id,h.vertexBuffer,h.indexBuffer,h.segments,f.paint,o.transform.zoom,void 0,void 0)}function jg(h,t,o){let f=t.updateZoomBasedPaintProperties(),g=function(v,b,M){let A,O,P,F=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&F>0){let z=v.terrain,U=z.findDEMTileFor(M);U&&U.dem?A=n.di.create(z,M,U):F=0}if(F===0&&(b.terrainElevationMin=0,b.terrainElevationMax=0),F===b.validForExaggeration&&(F===0||A&&A._demTile&&A._demTile.tileID===b.validForDEMTile.id&&A._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(let z in b.instancesPerModel){let U=b.instancesPerModel[z];for(let W=0;W<U.instancedDataArray.length;++W){let q=(A?F*A.getElevationAt(0|U.instancedDataArray.float32[16*W],0|U.instancedDataArray.float32[16*W+1],!0,!0):0)+U.instancesEvaluatedElevation[W];U.instancedDataArray.float32[16*W+6]=q,O=O?Math.min(b.terrainElevationMin,q):q,P=P?Math.max(b.terrainElevationMax,q):q}}return b.terrainElevationMin=O||0,b.terrainElevationMax=P||0,b.validForExaggeration=F,b.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,t,o);(f||g)&&(t.uploaded=!1,t.upload(h.context))}let Lo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.ca([0,0,0],[n.ab,n.ab,0])};function mr(h,t){let o=1<<h.canonical.z,f=t.getFreeCameraOptions().position,g=t.elevation,v=h.canonical.x/o,b=(h.canonical.x+1)/o,M=h.canonical.y/o,A=(h.canonical.y+1)/o,O=t._centerAltitude;if(g){let U=g.getMinMaxForTile(h);U&&U.max>O&&(O=U.max)}let P=n.ap(f.x,v,b)-f.x,F=n.ap(f.y,M,A)-f.y,z=n.bE(O,t.center.lat)-f.z;return t._zoomFromMercatorZ(Math.sqrt(P*P+F*F+z*z))}function Ug(h,t,o,f,g,v,b){let M=h.context,A=h.renderPass==="shadow",O=h.shadowRenderer,P=A&&O?O.getShadowPassDepthMode():new Ct(M.gl.LEQUAL,Ct.ReadWrite,h.depthRangeFor3D),F=h.isTileAffectedByFog(v);if(o.meshes)for(let z of o.meshes){let U=["MODEL_POSITION_ON_GPU"],W=[],q,X,Z;f.instancedDataArray.length>20&&U.push("INSTANCED_ARRAYS");let Q=is(h,t.paint.get("model-cutoff-fade-range"));if(Q.shouldRenderCutoff&&U.push("RENDER_CUTOFF"),A&&O)q=h.getOrCreateProgram("modelDepth",{defines:U}),X=zf(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(o.matrix)),Z=O.getShadowPassColorMode();else{Dh(U,W,z,h,t.lut),q=h.getOrCreateProgram("model",{defines:U,overrideFog:F});let oe=z.material,ae=oe.pbrMetallicRoughness,ue=t.paint.get("model-opacity"),le=t.paint.get("model-emissive-strength").constantOr(0);X=wh(v.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,h,ue,ae.baseColorFactor.toRenderColor(null),oe.emissiveFactor,ae.metallicFactor,ae.roughnessFactor,oe,le,t,g),O&&(b.shadowUniformsInitialized?q.setShadowUniformValues(M,O.getShadowUniformValues()):(O.setupShadows(v.toUnwrapped(),q,"model-tile",v.overscaledZ),b.shadowUniformsInitialized=!0)),Z=Q.shouldRenderCutoff||ue<1||oe.alphaMode!=="OPAQUE"?sn.alphaBlended:sn.unblended}h.uploadCommonUniforms(M,q,v.toUnwrapped(),null,Q);let re=z.material.doubleSided?zt.disabled:zt.backCCW;if(f.instancedDataArray.length>20)W.push(f.instancedDataBuffer),q.draw(h,M.gl.TRIANGLES,P,Gt.disabled,Z,re,X,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,h.transform.zoom,void 0,W,f.instancedDataArray.length);else{let oe=A?"u_instance":"u_normal_matrix";for(let ae=0;ae<f.instancedDataArray.length;++ae)X[oe]=new Float32Array(f.instancedDataArray.arrayBuffer,64*ae,16),q.draw(h,M.gl.TRIANGLES,P,Gt.disabled,Z,re,X,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,h.transform.zoom,void 0,W)}}if(o.children)for(let z of o.children)Ug(h,t,z,f,g,v,b)}let Kc=[1,-1,1];function Qn(h,t,o,f){if(!o.modelManager)return!0;let g=o.modelManager;if(!o.shadowRenderer)return!0;let v=o.shadowRenderer,b=t.aabb,M=!0,A=h.maxHeight;if(A===0){let P=0;for(let F in h.instancesPerModel){let z=g.getModel(F,f);z?P=Math.max(P,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):M=!1}A=h.maxScale*P*1.41+h.maxVerticalOffset,M&&(h.maxHeight=A)}b.max[2]=A,b.min[2]+=h.terrainElevationMin,b.max[2]+=h.terrainElevationMax,n.a6.vec3.transformMat4(b.min,b.min,t.tileMatrix),n.a6.vec3.transformMat4(b.max,b.max,t.tileMatrix);let O=b.intersects(v.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=O===2),O===0}function wn(h,t){let o=h.uniformValues.u_cutoff_params[0],f=h.uniformValues.u_cutoff_params[1],g=h.uniformValues.u_cutoff_params[2],v=h.uniformValues.u_cutoff_params[3];return f===o||v===g?1:n.ap(((t-o)/(f-o)-g)/(v-g),0,1)}function $g(h,t,o,f){if(t.pitch<20)return 1;let g=t.getWorldToCameraMatrix();n.a6.mat4.multiply(g,g,h);let v=n.a6.vec4.fromValues(o.min[0],o.min[1],o.min[2],1),b=n.a6.vec4.transformMat4(n.a6.vec4.create(),v,g),M=b,A=b;v[1]=o.max[1],b=n.a6.vec4.transformMat4(n.a6.vec4.create(),v,g),M=b[1]<M[1]?b:M,A=b[1]>A[1]?b:A,v[0]=o.max[0],b=n.a6.vec4.transformMat4(n.a6.vec4.create(),v,g),M=b[1]<M[1]?b:M,A=b[1]>A[1]?b:A,v[1]=o.min[1],b=n.a6.vec4.transformMat4(n.a6.vec4.create(),v,g),M=b[1]<M[1]?b:M,A=b[1]>A[1]?b:A;let O=n.ap(f[0],0,1),P=100*t.pixelsPerMeter*n.ap(f[1],0,1),F=n.ap(f[2],0,1),z=n.a6.vec4.lerp(n.a6.vec4.create(),M,A,O),U=Math.tan(.5*t.fovX),W=-z[2]*U;if(P===0)return z[1]<-Math.abs(W)?F:1;let q=(-Math.abs(W)-z[1])/P,X=(Q,re,oe)=>(1-oe)*Q+oe*re,Z=n.ap(X(1,F,q),F,1);return X(1,Z,n.ap((t.pitch-20)/20,0,1))}class Bs{}class Sh{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,f){{let F=this._storage.get(o.id);if(F)return F.lastUsedFrameIdx=t,F.buf}let g=f.gl,v=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),b=new ArrayBuffer(v),M=new Int16Array(b);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));let A=new n.dk;for(let F=0;F<v/2;F+=3){let z=M[F],U=M[F+1],W=M[F+2];A.emplaceBack(z,U),A.emplaceBack(U,W),A.emplaceBack(W,z)}let O=f.bindVertexArrayOES.current,P=new Bs;return P.buf=new zs(f,A),P.lastUsedFrameIdx=t,this._storage.set(o.id,P),f.bindVertexArrayOES.set(O),P.buf}update(t){for(let[o,f]of this._storage)t-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(o))}destroy(){for(let[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class Al{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}class Jf{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}let Qc={symbol:function(h,t,o,f,g){if(h.renderPass!=="translucent")return;let v=Gt.disabled,b=h.colorModeForRenderPass(),M=o.layout.get("text-variable-anchor"),A=o.layout.get("text-size-scale-range"),O=n.ap(h.scaleFactor,A[0],A[1]);M&&function(z,U,W,q,X,Z,Q,re){let oe=U.transform,ae=X==="map",ue=Z==="map";for(let le of z){let he=q.getTile(le),ge=he.getBucket(W);if(!ge||!ge.text||!ge.text.segments.get().length)continue;let be=n.bk(ge.textSizeData,oe.zoom,re),ye=ks(le,ge.getProjection(),oe),_e=oe.calculatePixelsToTileUnitsMatrix(he),Oe=pn(ye,he.tileID.canonical,ue,ae,oe,ge.getProjection(),_e),Ve=ge.hasIconTextFit()&&ge.hasIconData();if(be){let Ze=Math.pow(2,oe.zoom-he.tileID.overscaledZ);jf(ge,ae,ue,Q,n.cS,oe,Oe,le,Ze,be,Ve)}}}(f,h,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),g,O);let P=o.paint.get("icon-opacity").constantOr(1)!==0,F=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(P||F)?Xc(h,t,o,f,v,b):(P&&Xc(h,t,o,f,v,b,{onlyIcons:!0}),F&&Xc(h,t,o,f,v,b,{onlyText:!0})),t.map.showCollisionBoxes&&(Vf(h,t,o,f,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Vf(h,t,o,f,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,o,f){if(h.renderPass!=="translucent")return;let g=o.paint.get("circle-opacity"),v=o.paint.get("circle-stroke-width"),b=o.paint.get("circle-stroke-opacity"),M=o.layout.get("circle-sort-key").constantOr(1)!==void 0,A=o.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(v.constantOr(1)===0||b.constantOr(1)===0))return;let O=h.context,P=O.gl,F=h.transform,z=h.depthModeForSublayer(0,Ct.ReadOnly),U=Gt.disabled,W=h.colorModeForDrapableLayerRenderPass(A),q=F.projection.name==="globe",X=[n.am(F.center.lng),n.at(F.center.lat)],Z=[];for(let re=0;re<f.length;re++){let oe=f[re],ae=t.getTile(oe),ue=ae.getBucket(o);if(!ue||ue.projection.name!==F.projection.name)continue;let le=ue.programConfigurations.get(o.id),he=n.cT(o),ge=h.isTileAffectedByFog(oe);q&&he.push("PROJECTION_GLOBE_VIEW"),he.push("DEPTH_D24"),h.terrain&&F.depthOcclusionForSymbolsAndCircles&&he.push("DEPTH_OCCLUSION");let be=h.getOrCreateProgram("circle",{config:le,defines:he,overrideFog:ge}),ye=ue.layoutVertexBuffer,_e=ue.globeExtVertexBuffer,Oe=ue.indexBuffer,Ve=F.projection.createInversionMatrix(F,oe.canonical),Ze={programConfiguration:le,program:be,layoutVertexBuffer:ye,globeExtVertexBuffer:_e,indexBuffer:Oe,uniformValues:n.cU(h,oe,ae,Ve,X,o),tile:ae};if(M){let Ke=ue.segments.get();for(let nt of Ke)Z.push({segments:new n.b2([nt]),sortKey:nt.sortKey,state:Ze})}else Z.push({segments:ue.segments,sortKey:0,state:Ze})}M&&Z.sort((re,oe)=>re.sortKey-oe.sortKey);let Q={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(let re of Z){let{programConfiguration:oe,program:ae,layoutVertexBuffer:ue,globeExtVertexBuffer:le,indexBuffer:he,uniformValues:ge,tile:be}=re.state,ye=re.segments;h.terrain&&h.terrain.setupElevationDraw(be,ae,Q),h.uploadCommonUniforms(O,ae,be.tileID.toUnwrapped()),ae.draw(h,P.TRIANGLES,z,U,W,zt.disabled,ge,o.id,ue,he,ye,o.paint,F.zoom,oe,[le])}},heatmap:function(h,t,o,f){if(o.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){let g=h.context,v=g.gl,b=Gt.disabled,M=new sn([v.ONE,v.ONE,v.ONE,v.ONE],n.bA.transparent,[!0,!0,!0,!0]);(function(U,W,q,X){let Z=U.gl,Q=W.width*X,re=W.height*X;U.activeTexture.set(Z.TEXTURE1),U.viewport.set([0,0,Q,re]);let oe=q.heatmapFbo;if(!oe||oe&&(oe.width!==Q||oe.height!==re)){oe&&oe.destroy();let ae=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,ae),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),oe=q.heatmapFbo=U.createFramebuffer(Q,re,!0,null),function(ue,le,he,ge,be,ye){let _e=ue.gl;_e.texImage2D(_e.TEXTURE_2D,0,ue.extRenderToTextureHalfFloat?_e.RGBA16F:_e.RGBA,be,ye,0,_e.RGBA,ue.extRenderToTextureHalfFloat?_e.HALF_FLOAT:_e.UNSIGNED_BYTE,null),ge.colorAttachment.set(he)}(U,0,ae,oe,Q,re)}else Z.bindTexture(Z.TEXTURE_2D,oe.colorAttachment.get()),U.bindFramebuffer.set(oe.framebuffer)})(g,h,o,h.transform.projection.name==="globe"?.5:.25),g.clear({color:n.bA.transparent});let A=h.transform,O=A.projection.name==="globe",P=O?["PROJECTION_GLOBE_VIEW"]:[],F=O?zt.frontCCW:zt.disabled,z=[n.am(A.center.lng),n.at(A.center.lat)];for(let U=0;U<f.length;U++){let W=f[U];if(t.hasRenderableParent(W))continue;let q=t.getTile(W),X=q.getBucket(o);if(!X||X.projection.name!==A.projection.name)continue;let Z=h.isTileAffectedByFog(W),Q=X.programConfigurations.get(o.id),re=h.getOrCreateProgram("heatmap",{config:Q,defines:P,overrideFog:Z}),{zoom:oe}=h.transform;h.terrain&&h.terrain.setupElevationDraw(q,re),h.uploadCommonUniforms(g,re,W.toUnwrapped());let ae=A.projection.createInversionMatrix(A,W.canonical);re.draw(h,v.TRIANGLES,Ct.disabled,b,M,F,Lf(h,W,q,ae,z,oe,o.paint.get("heatmap-intensity")),o.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,o.paint,h.transform.zoom,Q,O?[X.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,v){let b=g.context,M=b.gl,A=v.heatmapFbo;if(!A)return;b.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,A.colorAttachment.get()),b.activeTexture.set(M.TEXTURE1);let O=v.colorRampTexture;O||(O=v.colorRampTexture=new n.T(b,v.colorRamp,M.RGBA8)),O.bind(M.LINEAR,M.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,M.TRIANGLES,Ct.disabled,Gt.disabled,g.colorModeForRenderPass(),zt.disabled,((P,F,z,U)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(h,o))},line:function(h,t,o,f){if(h.renderPass!=="translucent")return;let g=o.paint.get("line-opacity"),v=o.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;let b=o.paint.get("line-emissive-strength"),M=o.paint.get("line-occlusion-opacity"),A=o.layout.get("line-elevation-reference")==="sea",O=h.context,P=O.gl,F=!o.isDraped();if(F&&h.transform.projection.name==="globe")return;let z=o.layout.get("line-cross-slope"),U=z!==void 0,W=z<1,q=F?new Ct(h.depthOcclusion?P.GREATER:P.LEQUAL,Ct.ReadOnly,h.depthRangeFor3D):h.depthModeForSublayer(0,Ct.ReadOnly),X=h.colorModeForDrapableLayerRenderPass(b),Z=h.terrain&&h.terrain.renderingToTexture,Q=Z?1:n.q.devicePixelRatio,re=o.paint.get("line-dasharray"),oe=re.constantOr(1),ae=o.layout.get("line-cap"),ue=re.constantOr(null),le=ae.constantOr(null),he=o.paint.get("line-pattern"),ge=he.constantOr(1),be=he.constantOr(null),ye=o.paint.get("line-opacity").constantOr(1),_e=!ge&&ye!==1||h.depthOcclusion&&M>0&&M<1,Oe=o.paint.get("line-gradient"),Ve=ge?"linePattern":"line",Ze=n.cV(o),Ke;if(Z&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(_e=!1),M!==0&&h.depthOcclusion){let Ce=o.paint._values["line-opacity"];Ce&&Ce.value&&Ce.value.kind==="constant"?Ke=Ce.value:n.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}if(F&&(h.forceTerrainMode=!0),!F&&M!==0&&h.terrain&&!Z)return void n.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`);let nt=_e&&F?h.stencilModeFor3D():Gt.disabled;F&&(Ze.push("ELEVATED"),U&&Ze.push(W?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),A&&Ze.push("ELEVATION_REFERENCE_SEA"));for(let Ce of f){let qe=t.getTile(Ce);if(ge&&!qe.patternsLoaded())continue;let ke=qe.getBucket(o);if(!ke)continue;h.prepareDrawTile();let We=ke.programConfigurations.get(o.id),Xe=h.isTileAffectedByFog(Ce),Ge=h.getOrCreateProgram(Ve,{config:We,defines:Ze,overrideFog:Xe,overrideRtt:!F&&void 0});if(be&&qe.imageAtlas){let ut=qe.imageAtlas.patternPositions[be.toString()];ut&&We.setConstantPatternPositions(ut)}if(!ge&&ue&&le&&qe.lineAtlas){let ut=qe.lineAtlas.getDash(ue,le);ut&&We.setConstantPatternPositions(ut)}let[at,vt]=o.paint.get("line-trim-offset");(le==="round"||le==="square")&&at!==vt&&(at===0&&(at-=1),vt===1&&(vt+=1));let Et=Z?Ce.projMatrix:null,pt=ge?n.cW(h,qe,o,Et,Q,[at,vt]):n.cX(h,qe,o,Et,ke.lineClipsArray.length,Q,[at,vt]);if(Oe){let ut=ke.gradients[o.id],Mt=ut.texture;if(o.gradientVersion!==ut.version){let Ht=256;if(o.stepInterpolant){let cn=t.getSource().maxzoom,Vn=Ce.canonical.z===cn?Math.ceil(1<<h.transform.maxZoom-Ce.canonical.z):1;Ht=n.ap(n.cY(ke.maxLineLength/n.ab*1024*Vn),256,O.maxTextureSize)}ut.gradient=n.cZ({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Ht,image:ut.gradient||void 0,clips:ke.lineClipsArray}),ut.texture?ut.texture.update(ut.gradient):ut.texture=new n.T(O,ut.gradient,P.RGBA8),ut.version=o.gradientVersion,Mt=ut.texture}O.activeTexture.set(P.TEXTURE1),Mt.bind(o.stepInterpolant?P.NEAREST:P.LINEAR,P.CLAMP_TO_EDGE)}oe&&(O.activeTexture.set(P.TEXTURE0),qe.lineAtlasTexture&&qe.lineAtlasTexture.bind(P.LINEAR,P.REPEAT),We.updatePaintBuffers()),ge&&(O.activeTexture.set(P.TEXTURE0),qe.imageAtlasTexture&&qe.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),We.updatePaintBuffers()),F&&!A&&h.terrain.setupElevationDraw(qe,Ge),h.uploadCommonUniforms(O,Ge,Ce.toUnwrapped());let Tt=ut=>{Ke!=null&&(Ke.value=ye*M),Ge.draw(h,P.TRIANGLES,q,ut,X,zt.disabled,pt,o.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,o.paint,h.transform.zoom,We,[ke.layoutVertexBuffer2,ke.patternVertexBuffer,ke.zOffsetVertexBuffer]),Ke!=null&&(Ke.value=ye)};if(_e&&!F){let ut=h.stencilModeForClipping(Ce).ref;ut===0&&Z&&O.clear({stencil:0});let Mt={func:P.EQUAL,mask:255};pt.u_alpha_discard_threshold=.8,Tt(new Gt(Mt,ut,255,P.KEEP,P.KEEP,P.INVERT)),pt.u_alpha_discard_threshold=0,Tt(new Gt(Mt,ut,255,P.KEEP,P.KEEP,P.KEEP))}else _e&&F&&(pt.u_alpha_discard_threshold=.001),Tt(F?nt:h.stencilModeForClipping(Ce))}F&&(h.forceTerrainMode=!1),_e&&(h.resetStencilClippingMasks(),Z&&O.clear({stencil:0})),M===0||h.depthOcclusion||Z||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,o,f){let g=o.paint.get("fill-color"),v=o.paint.get("fill-opacity"),b=o.is3D(),M=new Ct(h.context.gl.LEQUAL,Ct.ReadWrite,h.depthRangeFor3D);if(v.constantOr(1)===0)return;let A=o.paint.get("fill-emissive-strength"),O=h.colorModeForDrapableLayerRenderPass(A),P=o.paint.get("fill-pattern"),F=h.opaquePassEnabledForLayer()&&!P.constantOr(1)&&g.constantOr(n.bA.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===F){let z=b?M:h.depthModeForSublayer(1,h.renderPass==="opaque"?Ct.ReadWrite:Ct.ReadOnly);Eh(h,t,o,f,z,O,!1)}if(!b&&h.renderPass==="translucent"&&o.paint.get("fill-antialias")){let z=b?M:h.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly);Eh(h,t,o,f,z,O,!0)}},"fill-extrusion":function(h,t,o,f){let g=o.paint.get("fill-extrusion-opacity"),v=h.context,b=v.gl,M=h.terrain,A=M&&M.renderingToTexture;if(g===0)return;let O=h.conflationActive&&h.style.isLayerClipped(o,t.getSource()),P=h.style.order.indexOf(o.fqid);if(O&&function(F,z,U,W,q){for(let X of W){let Z=z.getTile(X).getBucket(U);Z&&(Z.updateReplacement(X,F.replacementSource,q),Z.uploadCentroid(F.context))}}(h,t,o,f,P),M||O)for(let F of f){let z=t.getTile(F).getBucket(o);z&&Lg(h.context,t,F,z,o,M,O)}if(h.renderPass==="shadow"&&h.shadowRenderer){let F=h.shadowRenderer;if(M&&g<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.a4)return;let z=F.getShadowPassDepthMode(),U=F.getShadowPassColorMode();Qi(h,t,o,f,z,Gt.disabled,U,O)}else if(h.renderPass==="translucent"){let F=!o.paint.get("fill-extrusion-pattern").constantOr(1),z=o.paint.get("fill-extrusion-color").constantOr(n.bA.white);if(!A&&z.a!==0){let U=new Ct(h.context.gl.LEQUAL,Ct.ReadWrite,h.depthRangeFor3D);g===1&&F?Qi(h,t,o,f,U,Gt.disabled,sn.unblended,O):(Qi(h,t,o,f,U,Gt.disabled,sn.disabled,O),Qi(h,t,o,f,U,h.stencilModeFor3D(),h.colorModeForRenderPass(),O),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&F&&(!M&&h.transform.projection.name!=="globe"||A)){let U=o.paint.get("fill-extrusion-opacity"),W=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=o.paint.get("fill-extrusion-flood-light-intensity"),Z=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(o.lut).toArray01().slice(0,3),Q=W>0&&q>0,re=X>0,oe=(ue,le,he)=>(1-he)*ue+he*le,ae=ue=>{let le=h.depthModeForSublayer(1,Ct.ReadOnly,b.LEQUAL,!0),he=o.paint.get(ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ge=oe(.1,3,he),be=h._showOverdrawInspector;if(!be){let ye=new Gt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),_e=new sn([b.ONE,b.ONE,b.ONE,b.ONE],n.bA.transparent,[!1,!1,!1,!0],b.MIN);Lr(h,t,o,f,le,ye,_e,zt.disabled,ue,"sdf",U,W,q,X,Z,ge,O,!1)}{let ye=be?Gt.disabled:new Gt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),_e=be?h.colorModeForRenderPass():new sn([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],n.bA.transparent,[!0,!0,!0,!0]);Lr(h,t,o,f,le,ye,_e,zt.disabled,ue,"color",U,W,q,X,Z,ge,O,!1)}};if(A){let ue=(le,he,ge)=>{let be=h.depthModeForSublayer(1,Ct.ReadOnly,b.LEQUAL,!1),ye=o.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),_e=oe(.1,3,ye);{let Oe=new sn([b.ONE,b.ONE,b.ONE,b.ONE],n.bA.transparent,[!1,!1,!1,!0]);Lr(h,t,o,f,be,Gt.disabled,Oe,zt.disabled,le,"clear",U,W,q,X,Z,_e,O,he)}{let Oe=new Gt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),Ve=new sn([b.ONE,b.ONE,b.ONE,b.ONE],n.bA.transparent,[!1,!1,!1,!0],b.MIN);Lr(h,t,o,f,be,Oe,Ve,zt.disabled,le,"sdf",U,W,q,X,Z,_e,O,he)}{let Oe=le?b.ZERO:b.ONE_MINUS_DST_ALPHA,Ve=new Gt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ze=new sn([Oe,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],n.bA.transparent,[!0,!0,!0,!0]);Lr(h,t,o,f,be,Ve,Ze,zt.disabled,le,"color",U,W,q,X,Z,_e,O,he)}{let Oe=new sn([b.ONE,b.ONE,b.ONE,le?b.ZERO:b.ONE],n.bA.transparent,[!1,!1,!1,!0],le?b.FUNC_ADD:b.MAX);Lr(h,t,o,f,be,Gt.disabled,Oe,zt.disabled,le,"clear",U,W,q,X,Z,_e,O,he,ge)}};if(Q||re){let le;if(h.prepareDrawTile(),M){let he=M.drapeBufferSize[0],ge=M.drapeBufferSize[1];le=M.framebufferCopyTexture,le&&(!le||le.size[0]===he&&le.size[1]===ge)||(le&&le.destroy(),le=M.framebufferCopyTexture=new n.T(v,new n.r({width:he,height:ge}),b.RGBA8)),le.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,he,ge)}Q&&ue(!0,!1,le),re&&ue(!1,!0,le)}}else Q&&ae(!0),re&&ae(!1),(Q||re)&&h.resetStencilClippingMasks()}}},hillshade:function(h,t,o,f){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;let g=h.context,v=h.terrain&&h.terrain.renderingToTexture,[b,M]=h.renderPass!=="translucent"||v?[{},f]:h.stencilConfigForOverlap(f);for(let A of M){let O=t.getTile(A);if(O.needsHillshadePrepare&&h.renderPass==="offscreen")xl(h,O,o);else if(h.renderPass==="translucent"){let P=h.depthModeForSublayer(0,Ct.ReadOnly),F=o.paint.get("hillshade-emissive-strength"),z=h.colorModeForDrapableLayerRenderPass(F),U=v&&h.terrain?h.terrain.stencilModeForRTTOverlap(A):b[A.overscaledZ];uh(h,A,O,o,P,U,z)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,o,f,g,v){if(h.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;let b=h.transform.projection.name==="globe",M=o.paint.get("raster-elevation")!==0,A=M&&b;if(h.renderElevatedRasterBackface&&!A)return;let O=h.context,P=O.gl,F=t.getSource(),z=function(ue,le,he,ge){let be=le.paint.get("raster-color"),ye=ue.type==="raster-array",_e=[],Oe=le.paint.get("raster-resampling"),Ve=le.paint.get("raster-color-mix"),Ze=le.paint.get("raster-color-range"),Ke=[Ve[0],Ve[1],Ve[2],0],nt=Ve[3],Ce=Oe==="nearest"?ge.NEAREST:ge.LINEAR;if(ye&&(_e.push("RASTER_ARRAY"),be||_e.push("RASTER_COLOR"),Oe==="linear"&&_e.push("RASTER_ARRAY_LINEAR"),Ce=ge.NEAREST,!Ze&&ue.rasterLayers)){let qe=ue.rasterLayers.find(({id:ke})=>ke===le.sourceLayer);qe&&qe.fields&&qe.fields.range&&(Ze=qe.fields.range)}if(Ze=Ze||[0,1],be){_e.push("RASTER_COLOR"),he.activeTexture.set(ge.TEXTURE2),le.updateColorRamp(Ze);let qe=le.colorRampTexture;qe||(qe=le.colorRampTexture=new n.T(he,le.colorRamp,ge.RGBA8)),qe.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}return{mix:Ke,range:Ze,offset:nt,defines:_e,resampling:Ce}}(F,o,O,P);if(F instanceof n.aD&&!f.length&&!b)return;let U=o.paint.get("raster-emissive-strength"),W=h.colorModeForDrapableLayerRenderPass(U),q=h.terrain&&h.terrain.renderingToTexture,X=!h.options.moving,Z=o.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(F instanceof n.aD&&!f.length&&(F.onNorthPole||F.onSouthPole)){let ue=M?h.stencilModeFor3D():Gt.disabled;return void li(!!F.onNorthPole,null,h,t,o,U,z,zt.disabled,ue)}if(!f.length)return;let[Q,re]=F instanceof n.aD||q?[{},f]:h.stencilConfigForOverlap(f),oe=re[re.length-1].overscaledZ;A&&z.defines.push("PROJECTION_GLOBE_VIEW"),M&&z.defines.push("RENDER_CUTOFF");let ae=(ue,le,he)=>{for(let ge of ue){let be=ge.toUnwrapped(),ye=t.getTile(ge);if(q&&(!ye||!ye.hasData()))continue;O.activeTexture.set(P.TEXTURE0);let _e=Hf(ye,F,o,z);if(!_e||!_e.texture)continue;let{texture:Oe,mix:Ve,offset:Ze,tileSize:Ke,buffer:nt}=_e,Ce,qe;q?(Ce=Ct.disabled,qe=ge.projMatrix):M?(Ce=new Ct(P.LEQUAL,Ct.ReadWrite,h.depthRangeFor3D),qe=b?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(be,X)):(Ce=h.depthModeForSublayer(ge.overscaledZ-oe,o.paint.get("raster-opacity")===1?Ct.ReadWrite:Ct.ReadOnly,P.LESS),qe=h.transform.calculateProjMatrix(be,X));let ke=h.terrain&&q?h.terrain.stencilModeForRTTOverlap(ge):Q[ge.overscaledZ],We=v?0:o.paint.get("raster-fade-duration");ye.registerFadeDuration(We);let Xe=t.findLoadedParent(ge,0),Ge=gh(ye,Xe,t,h.transform,We),at,vt;h.terrain&&h.terrain.prepareDrawTile(),O.activeTexture.set(P.TEXTURE0),Oe.bind(Z,P.CLAMP_TO_EDGE),O.activeTexture.set(P.TEXTURE1),Xe?(Xe.texture&&Xe.texture.bind(Z,P.CLAMP_TO_EDGE),at=Math.pow(2,Xe.tileID.overscaledZ-ye.tileID.overscaledZ),vt=[ye.tileID.canonical.x*at%1,ye.tileID.canonical.y*at%1]):Oe.bind(Z,P.CLAMP_TO_EDGE),Oe.useMipmap&&O.extTextureFilterAnisotropic&&h.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);let Et=h.transform,pt,Tt=M?Ih(Et):[0,0,0,0],ut,Mt,Ht,cn,Vn,vn=0;if(A&&F instanceof n.aD&&F.coordinates.length>3)ut=Float32Array.from(n.b6(n.cC(new n.bQ(0,0,0)))),Mt=Float32Array.from(Et.globeMatrix),Ht=Float32Array.from(n.cy(Et)),cn=[n.am(Et.center.lng),n.at(Et.center.lat)],pt=F.elevatedGlobePerspectiveTransform,Vn=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){let nn=n.cz(ge.canonical);vn=n.cA(nn.getCenter().lat),ut=Float32Array.from(n.b6(n.cC(ge.canonical))),Mt=Float32Array.from(Et.globeMatrix),Ht=Float32Array.from(n.cy(Et)),cn=[n.am(Et.center.lng),n.at(Et.center.lat)],pt=[0,0],Vn=Float32Array.from(n.cB(ge.canonical,nn,vn,Et.worldSize/Et._pixelsPerMercatorPixel))}else pt=F instanceof n.aD?F.perspectiveTransform:[0,0],ut=new Float32Array(16),Mt=new Float32Array(9),Ht=new Float32Array(16),cn=[0,0],Vn=new Float32Array(9);let Zn=vh(qe,ut,Mt,Ht,Vn,vt||[0,0],n.a9(h.transform.zoom),cn,Tt,at||1,Ge,o,pt,M?o.paint.get("raster-elevation"):0,2,Ve,Ze,z.range,Ke,nt,U),In=h.isTileAffectedByFog(ge),jn=h.getOrCreateProgram("raster",{defines:z.defines,overrideFog:In});if(h.uploadCommonUniforms(O,jn,be),F instanceof n.aD){let nn=F.elevatedGlobeVertexBuffer,Nn=F.elevatedGlobeIndexBuffer;if(q||!b)F.boundsBuffer&&F.boundsSegments&&jn.draw(h,P.TRIANGLES,Ce,Gt.disabled,W,zt.disabled,Zn,o.id,F.boundsBuffer,h.quadTriangleIndexBuffer,F.boundsSegments);else if(nn&&Nn){let Ln=Et.zoom<=n.c3?F.elevatedGlobeSegments:F.getSegmentsForLongitude(Et.center.lng);Ln&&jn.draw(h,P.TRIANGLES,Ce,Gt.disabled,W,le,Zn,o.id,nn,Nn,Ln)}}else if(A){Ce=new Ct(P.LEQUAL,Ct.ReadOnly,h.depthRangeFor3D);let nn=h.globeSharedBuffers;if(nn){let[Nn,Ln,Cn]=nn.getGridBuffers(vn,!1);jn.draw(h,P.TRIANGLES,Ce,he||ke,h.colorModeForRenderPass(),le,Zn,o.id,Nn,Ln,Cn)}}else{let{tileBoundsBuffer:nn,tileBoundsIndexBuffer:Nn,tileBoundsSegments:Ln}=h.getTileBoundsBuffers(ye);jn.draw(h,P.TRIANGLES,Ce,ke,W,zt.disabled,Zn,o.id,nn,Nn,Ln)}}if(!(F instanceof n.aD)&&A)for(let ge of ue){let be=ge.canonical.y===(1<<ge.canonical.z)-1;ge.canonical.y===0&&li(!0,ge,h,t,o,U,z,le,he||Gt.disabled),be&&li(!1,ge,h,t,o,U,z,le===zt.frontCW?zt.backCW:zt.frontCW,he||Gt.disabled)}};A?ae(re,h.renderElevatedRasterBackface?zt.backCW:zt.frontCW,h.stencilModeFor3D()):ae(re,zt.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,o,f,g,v){h.renderPass==="offscreen"&&function(b,M,A,O){if(!O.length)return;let P=b.context,F=P.gl,z=M.getSource();if(!(z instanceof Ro))return;let U=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count"))),W=A.particlePositionRGBAImage;if(!W||W.width!==U){let re=function(oe){let ae=oe*oe,ue=new Uint8Array(4*ae),le=function(ge){return ge|=0,ge=Math.imul(2747636419^ge,2654435769),ge=Math.imul(ge^ge>>>16,2654435769),((ge=Math.imul(ge^ge>>>16,2654435769))>>>0)/4294967296},he=1/1.1;for(let ge=0;ge<ae;ge++){let be=he*(le(2*ge+0)+ba),ye=he*(le(2*ge+1)+ba),_e=255*be%1,Oe=255*ye%1,Ve=_e,Ze=ye-Oe/255,Ke=Oe;ue[4*ge+0]=255*(be-_e/255),ue[4*ge+1]=255*Ve,ue[4*ge+2]=255*Ze,ue[4*ge+3]=255*Ke}return ue}(U);W=A.particlePositionRGBAImage=new n.r({width:U,height:U},re)}let q=A.particleFramebuffer;q?q.width!==U&&(q.destroy(),q=A.particleFramebuffer=P.createFramebuffer(U,U,!0,null)):q=A.particleFramebuffer=P.createFramebuffer(U,U,!0,null);let X=[];for(let re of O){let oe=M.getTile(re);if(!(oe instanceof Wu))continue;let ae=Bg(oe,z,A);if(!ae)continue;let ue=[oe.tileSize,oe.tileSize],le=A.tileFramebuffer;le||(le=A.tileFramebuffer=P.createFramebuffer(ue[0],ue[1],!0,null));let he=oe.rasterParticleState;he||(he=oe.rasterParticleState=new zg(P,re,ue,W));let ge=he.update(A.lastInvalidatedAt);he.particleTextureDimension!==U&&he.updateParticleTexture(re,W);let be=he.targetColorTexture;he.targetColorTexture=he.backgroundColorTexture,he.backgroundColorTexture=be;let ye=he.particleTexture0;he.particleTexture0=he.particleTexture1,he.particleTexture1=ye,X.push([re,ae,he,ge])}if(X.length===0)return;let Z=n.q.now(),Q=A.previousDrawTimestamp?.001*(Z-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=Z,A.hasColorMap()){P.activeTexture.set(F.TEXTURE0+2);let re=A.colorRampTexture;re||(re=A.colorRampTexture=new n.T(P,A.colorRamp,F.RGBA8)),re.bind(F.LINEAR,F.CLAMP_TO_EDGE)}P.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(re,oe,ae){let ue=re.context,le=ue.gl,he=oe.tileFramebuffer;ue.activeTexture.set(le.TEXTURE0);let ge={u_texture:0,u_opacity:1.05*(ye=oe.paint.get("raster-particle-fade-opacity-factor"))/(ye+.05)},be=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ye;for(let _e of ae){let[,,Oe,Ve]=_e;he.colorAttachment.set(Oe.targetColorTexture.texture),ue.viewport.set([0,0,he.width,he.height]),ue.clear({color:n.bA.transparent}),Ve&&(Oe.backgroundColorTexture.bind(le.NEAREST,le.CLAMP_TO_EDGE),be.draw(re,le.TRIANGLES,Ct.disabled,Gt.disabled,sn.alphaBlended,zt.disabled,ge,oe.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}}(b,A,X),function(re,oe,ae,ue){let le=re.context,he=le.gl,ge=ae.tileFramebuffer,be=re.transform.projection.name==="globe",ye=ae.paint.get("raster-particle-max-speed");for(let _e of ue){let[Oe,Ve,Ze]=_e;le.activeTexture.set(he.TEXTURE0+0),Ve.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),ge.colorAttachment.set(Ze.targetColorTexture.texture);let Ke=re.getOrCreateProgram("rasterParticleDraw",{defines:Ve.defines,overrideFog:!1});le.activeTexture.set(he.TEXTURE0+1);let nt=Ve.scalarData?[]:[0,1,2,3].map(ke=>n.c$[ke](Oe));nt.push(Oe);let Ce=Oe.canonical.x,qe=Oe.canonical.y;for(let ke of nt){let We=oe.getTile(be?ke.wrapped():ke);if(!We)continue;let Xe=We.rasterParticleState;if(!Xe)continue;let Ge=ke.canonical.x+(1<<ke.canonical.z)*(ke.wrap-Oe.wrap),at=ke.canonical.y;Xe.particleTexture0.bind(he.NEAREST,he.CLAMP_TO_EDGE);let vt=bh(1,Xe.particleTexture0.size[0],[Ge-Ce,at-qe],0,Ve.texture.size,2,ye,Ve.textureOffset,Ve.scale,Ve.offset);Ke.draw(re,he.POINTS,Ct.disabled,Gt.disabled,sn.alphaBlended,zt.disabled,vt,ae.id,Xe.particleIndexBuffer,void 0,Xe.particleSegment)}}}(b,M,A,X),P.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(re,oe,ae,ue){let le=re.context,he=le.gl,ge=oe.paint.get("raster-particle-max-speed"),be=ue*oe.paint.get("raster-particle-speed-factor")*.15,ye=function(Oe){return Math.pow(Oe,6)}(.01+1*oe.paint.get("raster-particle-reset-rate-factor")),_e=oe.particleFramebuffer;le.viewport.set([0,0,_e.width,_e.height]);for(let Oe of ae){let[,Ve,Ze]=Oe;le.activeTexture.set(he.TEXTURE0+0),Ve.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),le.activeTexture.set(he.TEXTURE0+1);let Ke=Ze.particleTexture0;Ke.bind(he.NEAREST,he.CLAMP_TO_EDGE);let nt=Ff(1,Ke.size[0],0,Ve.texture.size,ge,be,ye,Ve.textureOffset,Ve.scale,Ve.offset);_e.colorAttachment.set(Ze.particleTexture1.texture),le.clear({color:n.bA.transparent}),re.getOrCreateProgram("rasterParticleUpdate",{defines:Ve.defines}).draw(re,he.TRIANGLES,Ct.disabled,Gt.disabled,sn.unblended,zt.disabled,nt,oe.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments)}}(b,A,X,Q)}(h,t,o,f),h.renderPass==="translucent"&&(function(b,M,A,O,P){let F=b.context,z=F.gl,U=M.getSource().tileSize,W=5*(1-n.a7(n.bV,n.bV+1,b.transform.zoom))*U+A.paint.get("raster-particle-elevation"),q=!b.options.moving,X=b.transform.projection.name==="globe";if(!O.length)return;let[Z,Q]=b.stencilConfigForOverlap(O),re=[];X&&re.push("PROJECTION_GLOBE_VIEW");let oe=b.stencilModeFor3D();for(let ae of Q){let ue=ae.toUnwrapped(),le=M.getTile(ae);if(!le.rasterParticleState)continue;let he=le.rasterParticleState,ge=100;le.registerFadeDuration(ge);let be=M.findLoadedParent(ae,0),ye=gh(le,be,M,b.transform,ge),_e,Oe;b.terrain&&b.terrain.prepareDrawTile(),F.activeTexture.set(z.TEXTURE0),he.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),F.activeTexture.set(z.TEXTURE1),be&&be.rasterParticleState?(be.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),_e=Math.pow(2,be.tileID.overscaledZ-le.tileID.overscaledZ),Oe=[le.tileID.canonical.x*_e%1,le.tileID.canonical.y*_e%1]):he.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);let Ve=X?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(ue,q),Ze=b.transform,Ke=A0(Ze),nt=n.cz(ae.canonical),Ce=n.cA(nt.getCenter().lat),qe,ke,We,Xe,Ge;X?(qe=Float32Array.from(n.b6(n.cC(ae.canonical))),ke=Float32Array.from(Ze.globeMatrix),We=Float32Array.from(n.cy(Ze)),Xe=[n.am(Ze.center.lng),n.at(Ze.center.lat)],Ge=Float32Array.from(n.cB(ae.canonical,nt,Ce,Ze.worldSize/Ze._pixelsPerMercatorPixel))):(qe=new Float32Array(16),ke=new Float32Array(9),We=new Float32Array(16),Xe=[0,0],Ge=new Float32Array(9));let at=xh(Ve,qe,ke,We,Ge,Oe||[0,0],n.a9(b.transform.zoom),Xe,Ke,_e||1,ye,W),vt=b.isTileAffectedByFog(ae),Et=b.getOrCreateProgram("rasterParticle",{defines:re,overrideFog:vt});if(b.uploadCommonUniforms(F,Et,ue),X){let pt=new Ct(z.LEQUAL,Ct.ReadOnly,b.depthRangeFor3D),Tt=0,ut=b.globeSharedBuffers;if(ut){let[Mt,Ht,cn]=ut.getGridBuffers(Ce,Tt!==0);Et.draw(b,z.TRIANGLES,pt,oe,sn.alphaBlended,b.renderElevatedRasterBackface?zt.frontCCW:zt.backCCW,at,A.id,Mt,Ht,cn)}}else{let pt=b.depthModeForSublayer(0,Ct.ReadOnly),Tt=Z[ae.overscaledZ],{tileBoundsBuffer:ut,tileBoundsIndexBuffer:Mt,tileBoundsSegments:Ht}=b.getTileBoundsBuffers(le);Et.draw(b,z.TRIANGLES,pt,Tt,sn.alphaBlended,zt.disabled,at,A.id,ut,Mt,Ht)}}b.resetStencilClippingMasks()}(h,t,o,f),h.style.map.triggerRepaint())},background:function(h,t,o,f){let g=o.paint.get("background-color"),v=o.paint.get("background-opacity"),b=o.paint.get("background-emissive-strength"),M=o.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;let A=h.context,O=A.gl,P=h.transform,F=P.tileSize,z=o.paint.get("background-pattern"),U;if(z!==void 0&&(z===null||(U=h.imageManager.getPattern(z.toString(),o.scope,h.style.getLut(o.scope)),!U)))return;let W=!z&&g.a===1&&v===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==W)return;let q=Gt.disabled,X=h.depthModeForSublayer(0,W==="opaque"?Ct.ReadWrite:Ct.ReadOnly),Z=h.colorModeForDrapableLayerRenderPass(b),Q=z?"backgroundPattern":"background",re,oe=f;if(oe||(re=h.getBackgroundTiles(),oe=Object.values(re).map(ae=>ae.tileID)),z&&(A.activeTexture.set(O.TEXTURE0),h.imageManager.bind(h.context,o.scope)),M){let ae=h.getOrCreateProgram(Q,{overrideFog:!1,overrideRtt:!0}),ue=new Float32Array(n.a6.mat4.identity([])),le=new n.aA(0,0,0,0,0),he=z?Wc(ue,b,v,h,0,o.scope,U,M,{tileID:le,tileSize:F}):wa(ue,b,v,g.toRenderColor(o.lut));ae.draw(h,O.TRIANGLES,X,q,Z,zt.disabled,he,o.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(let ae of oe){let ue=h.isTileAffectedByFog(ae),le=h.getOrCreateProgram(Q,{overrideFog:ue}),he=ae.toUnwrapped(),ge=f?ae.projMatrix:h.transform.calculateProjMatrix(he);h.prepareDrawTile();let be=t?t.getTile(ae):re?re[ae.key]:new Oo(ae,F,P.zoom,h),ye=z?Wc(ge,b,v,h,0,o.scope,U,M,{tileID:ae,tileSize:F}):wa(ge,b,v,g.toRenderColor(o.lut));h.uploadCommonUniforms(A,le,he);let{tileBoundsBuffer:_e,tileBoundsIndexBuffer:Oe,tileBoundsSegments:Ve}=h.getTileBoundsBuffers(be);le.draw(h,O.TRIANGLES,X,q,Z,zt.disabled,ye,o.id,_e,Oe,Ve)}},sky:function(h,t,o){let f=h._atmosphere?n.a9(h.transform.zoom):1,g=o.paint.get("sky-opacity")*f;if(g===0)return;let v=h.context,b=o.paint.get("sky-type"),M=new Ct(v.gl.LEQUAL,Ct.ReadOnly,[0,1]),A=h.frameCounter/1e3%1;b==="atmosphere"?h.renderPass==="offscreen"?o.needsSkyboxCapture(h)&&(function(O,P,F,z){let U=O.context,W=U.gl,q=P.skyboxFbo;if(!q){q=P.skyboxFbo=U.createFramebuffer(32,32,!0,null),P.skyboxGeometry=new Zf(U),P.skyboxTexture=U.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,P.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let re=0;re<6;++re)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(q.framebuffer),U.viewport.set([0,0,32,32]);let X=P.getCenter(O,!0),Z=O.getOrCreateProgram("skyboxCapture"),Q=new Float64Array(16);n.a6.mat4.identity(Q),n.a6.mat4.rotateY(Q,Q,.5*-Math.PI),go(O,P,Z,Q,X,0),n.a6.mat4.identity(Q),n.a6.mat4.rotateY(Q,Q,.5*Math.PI),go(O,P,Z,Q,X,1),n.a6.mat4.identity(Q),n.a6.mat4.rotateX(Q,Q,.5*-Math.PI),go(O,P,Z,Q,X,2),n.a6.mat4.identity(Q),n.a6.mat4.rotateX(Q,Q,.5*Math.PI),go(O,P,Z,Q,X,3),n.a6.mat4.identity(Q),go(O,P,Z,Q,X,4),n.a6.mat4.identity(Q),n.a6.mat4.rotateY(Q,Q,Math.PI),go(O,P,Z,Q,X,5),U.viewport.set([0,0,O.width,O.height])}(h,o),o.markSkyboxValid(h)):h.renderPass==="sky"&&function(O,P,F,z,U){let W=O.context,q=W.gl,X=O.transform,Z=O.getOrCreateProgram("skybox");W.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,P.skyboxTexture);let Q=((re,oe,ae,ue,le)=>({u_matrix:re,u_sun_direction:oe,u_cubemap:0,u_opacity:ue,u_temporal_offset:le}))(X.skyboxMatrix,P.getCenter(O,!1),0,z,U);O.uploadCommonUniforms(W,Z),Z.draw(O,q.TRIANGLES,F,Gt.disabled,O.colorModeForRenderPass(),zt.backCW,Q,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(h,o,M,g,A):b==="gradient"&&h.renderPass==="sky"&&function(O,P,F,z,U){let W=O.context,q=W.gl,X=O.transform,Z=O.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new Zf(W)),W.activeTexture.set(q.TEXTURE0);let Q=P.colorRampTexture;Q||(Q=P.colorRampTexture=new n.T(W,P.colorRamp,q.RGBA8)),Q.bind(q.LINEAR,q.CLAMP_TO_EDGE);let re=((oe,ae,ue,le,he)=>({u_matrix:oe,u_color_ramp:0,u_center_direction:ae,u_radius:n.bC(ue),u_opacity:le,u_temporal_offset:he}))(X.skyboxMatrix,P.getCenter(O,!1),P.paint.get("sky-gradient-radius"),z,U);O.uploadCommonUniforms(W,Z),Z.draw(O,q.TRIANGLES,F,Gt.disabled,O.colorModeForRenderPass(),zt.backCW,re,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(h,o,M,g,A)},debug:function(h,t,o,f,g,v){for(let b=0;b<o.length;b++)if(g){let O=new n.bA(f.r*.8,f.g*.8,f.b*.8,1);Kn(h,t,o[b],f,-1,-1,v),Kn(h,t,o[b],f,-1,1,v),Kn(h,t,o[b],f,1,1,v),Kn(h,t,o[b],f,1,-1,v),Kn(h,t,o[b],O,0,0,v)}else Kn(h,t,o[b],f,0,0,v)},custom:function(h,t,o,f){let g=h.context,v=o.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&o.isDraped(t)){if(h.renderPass==="offscreen"){let b=v.prerender;if(b){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){let M=h.transform.pointMerc;b.call(v,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.a9(h.transform.zoom),[M.x,M.y],h.transform.pixelsPerMeterRatio)}else b.call(v,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){let M=v.renderToTile;if(M){let A=f[0].canonical,O=new n.a5(A.x+f[0].wrap*(1<<A.z),A.y,A.z);g.setDepthMode(Ct.disabled),g.setStencilMode(Gt.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),M.call(v,g.gl,O),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(Gt.disabled);let b=v.renderingMode==="3d"?new Ct(h.context.gl.LEQUAL,Ct.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Ct.ReadOnly);if(g.setDepthMode(b),h.transform.projection.name==="globe"){let M=h.transform.pointMerc;v.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.a9(h.transform.zoom),[M.x,M.y],h.transform.pixelsPerMeterRatio)}else v.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,o,f){if(h.renderPass==="opaque")return;let g=o.paint.get("model-opacity");if(g===0)return;let v=o.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!v||h.terrain&&g<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof n.a4))return;let b=h.shadowRenderer,M=o.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,M||(b.enabled=!1));let A=()=>{b&&(b.useNormalOffset=!0,M||(b.enabled=!0))},O=t.getSource();if(h.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(Z,Q,re,oe,ae){let ue=Z.transform;if(ue.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${ue.projection.name} projection is not yet implemented`);let le=ue.getFreeCameraOptions().position;if(!Z.modelManager)return;let he=Z.modelManager;re.modelManager=he;let ge=Z.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let be=re._unevaluatedLayout._values["model-id"],ye=bt({},re.layout.get("model-id").parameters),_e=Z.style.order.indexOf(re.fqid);for(let Oe of oe){let Ve=Q.getTile(Oe).getBucket(re);if(!Ve||Ve.projection.name!==ue.projection.name)continue;let Ze=Ve.getModelUris();Ze&&!Ve.modelsRequested&&(he.addModelsFromBucket(Ze,ae),Ve.modelsRequested=!0);let Ke=mr(Oe,ue);ye.zoom=Ke;let nt=be.possiblyEvaluate(ye);if(jg(Z,Ve,Oe),Lo.shadowUniformsInitialized=!1,Lo.useSingleShadowCascade=!!ge&&ge.getMaxCascadeForTile(Oe.toUnwrapped())===0,Z.renderPass==="shadow"&&ge){if(Z.currentShadowCascade===1&&Ve.isInsideFirstShadowMapFrustum)continue;let ke=ue.calculatePosMatrix(Oe.toUnwrapped(),ue.worldSize);if(Lo.tileMatrix.set(ke),Lo.shadowTileMatrix=Float32Array.from(ge.calculateShadowPassMatrixFromMatrix(ke)),Lo.aabb.min.fill(0),Lo.aabb.max[0]=Lo.aabb.max[1]=n.ab,Lo.aabb.max[2]=0,Qn(Ve,Lo,Z,re.scope))continue}let Ce=1<<Oe.canonical.z,qe=[((le.x-Oe.wrap)*Ce-Oe.canonical.x)*n.ab,(le.y*Ce-Oe.canonical.y)*n.ab,le.z*Ce*n.ab];Z.conflationActive&&Object.keys(Ve.instancesPerModel).length>0&&Z.style.isLayerClipped(re,Q.getSource())&&Ve.updateReplacement(Oe,Z.replacementSource,_e,ae)&&(Ve.uploaded=!1,Ve.upload(Z.context));for(let ke in Ve.instancesPerModel){let We=Ve.instancesPerModel[ke];We.features.length>0&&(ke=nt.evaluate(We.features[0].feature,{}));let Xe=he.getModel(ke,ae);if(Xe&&Xe.uploaded)for(let Ge of Xe.nodes)Ug(Z,re,Ge,We,qe,Oe,Lo)}}}(h,t,o,f,O.type==="vector"?o.scope:""),void A();if(!O.loaded())return;if(O.type==="batched-model")return function(Z,Q,re,oe){re.resetLayerRenderingStats(Z);let ae=Z.context,ue=Z.transform,le=Z.style.fog,he=Z.shadowRenderer;if(ue.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${ue.projection.name} projection is not yet implemented`);let ge=Z.transform.getFreeCameraOptions().position,be=n.a6.vec3.scale([],[ge.x,ge.y,ge.z],Z.transform.worldSize),ye=n.a6.vec3.negate([],be),_e=n.a6.mat4.identity([]),Oe=n.de(ue.center.lat,ue.zoom),Ve=n.a6.mat4.fromScaling([],[1,1,1/Oe]);n.a6.mat4.translate(_e,_e,ye);let Ze=re.paint.get("model-opacity"),Ke=new Ct(ae.gl.LEQUAL,Ct.ReadWrite,Z.depthRangeFor3D),nt=new Ct(ae.gl.LEQUAL,Ct.ReadOnly,Z.depthRangeFor3D),Ce=new n.ca([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),qe=Z.renderPass==="shadow",ke=qe&&he?he.getCurrentCascadeFrustum():ue.getFrustum(ue.scaleZoom(ue.worldSize)),We=re.paint.get("model-front-cutoff"),Xe=We[2]<1,Ge=is(Z,re.paint.get("model-cutoff-fade-range")),at=re.getLayerRenderingStats();(function(vt,Et,pt,Tt){let ut=vt.terrain?vt.terrain.exaggeration():0,Mt=vt.transform.zoom;for(let Ht of Tt){let cn=Et.getTile(Ht).getBucket(pt);cn&&(vt.conflationActive&&cn.updateReplacement(Ht,vt.replacementSource),cn.evaluateScale(vt,pt),vt.terrain&&ut>0&&cn.elevationUpdate(vt.terrain,ut,Ht,pt.source),cn.needsReEvaluation(vt,Mt,pt)&&cn.evaluate(pt))}})(Z,Q,re,oe),function(){let vt,Et,pt;Xe?(vt=oe.length-1,Et=-1,pt=-1):(vt=0,Et=oe.length,pt=1);let Tt=new Float64Array(16),ut=n.a6.vec3.create(),Mt=new n.P(0,0);for(let Ht=vt;Ht!==Et;Ht+=pt){let cn=oe[Ht],Vn=Q.getTile(cn).getBucket(re);if(!Vn||!Vn.uploaded)continue;let vn=!1;he&&(vn=he.getMaxCascadeForTile(cn.toUnwrapped())===0);let Zn=ue.calculatePosMatrix(cn.toUnwrapped(),ue.worldSize),In=Vn.modelTraits;!qe&&Xe&&(n.a6.mat4.invert(Tt,Zn),n.a6.vec3.transformMat4(ut,be,Tt),Mt.x=ut[0],Mt.y=ut[1]);let jn=[];for(let nn of Vn.getNodesInfo()){if(nn.hiddenByReplacement||!nn.node.meshes)continue;let Nn=nn.node,Ln=0;Z.terrain&&Nn.elevation&&(Ln=Nn.elevation*Z.terrain.exaggeration());let Cn=(()=>{let mi=nn.aabb;return Ce.min=[...mi.min],Ce.max=[...mi.max],Ce.min[2]+=Ln,Ce.max[2]+=Ln,n.a6.vec3.transformMat4(Ce.min,Ce.min,Zn),n.a6.vec3.transformMat4(Ce.max,Ce.max,Zn),Ce})(),ni=nn.evaluatedScale;if(ni[0]<=1&&ni[1]<=1&&ni[2]<=1&&Cn.intersects(ke)===0)continue;if(!qe&&Xe){let mi=.16666666666666666;nn.cameraCollisionOpacity=be[0]>Cn.min[0]&&be[0]<Cn.max[0]&&be[1]>Cn.min[1]&&be[1]<Cn.max[1]&&be[2]*Oe<Cn.max[2]&&Nn.footprint&&n.bv(Mt,Nn.footprint)?Math.max(nn.cameraCollisionOpacity-mi,0):Math.min(1,nn.cameraCollisionOpacity+mi)}let Ri=[...Zn],Nr=Nn.anchor?Nn.anchor[0]:0,Jr=Nn.anchor?Nn.anchor[1]:0;n.a6.mat4.translate(Ri,Ri,[Nr*(ni[0]-1),Jr*(ni[1]-1),Ln]),n.a6.vec3.exactEquals(ni,n.dh)||n.a6.mat4.scale(Ri,Ri,ni);let Li=n.a6.mat4.multiply([],Ri,Nn.matrix),gn=n.a6.mat4.multiply([],ue.expandedFarZProjMatrix,Li),un=n.a6.mat4.multiply([],ue.expandedFarZProjMatrix,Ri),Tn=n.a6.vec4.transformMat4([],[Nr,Jr,Ln,1],gn)[2];Nn.hidden=!1;let qn=Ze;qe||(Xe&&(qn*=nn.cameraCollisionOpacity,qn*=$g(Ri,ue,nn.aabb,We)),qn*=wn(Ge,Tn)),qn!==0?jn.push({nodeInfo:nn,depth:Tn,opacity:qn,wvpForNode:gn,wvpForTile:un,nodeModelMatrix:Li,tileModelMatrix:Ri}):Nn.hidden=!0}qe||jn.sort((nn,Nn)=>!Xe||nn.opacity===1&&Nn.opacity===1?nn.depth<Nn.depth?-1:1:nn.opacity===1?-1:Nn.opacity===1?1:nn.depth>Nn.depth?-1:1);for(let nn of jn){let Nn=nn.nodeInfo,Ln=Nn.node,Cn=n.a6.mat4.multiply([],Ve,nn.tileModelMatrix);n.a6.mat4.multiply(Cn,_e,Cn);let ni=n.a6.mat4.invert([],Cn);n.a6.mat4.transpose(ni,ni),n.a6.mat4.scale(ni,ni,Kc),Cn=n.a6.mat4.multiply(Cn,Cn,Ln.matrix);let Ri=Z.renderPass==="light-beam",Nr=In&n.dj.HasMapboxMeshFeatures,Jr=Nr?0:Nn.evaluatedRMEA[0][2];for(let Li=0;Li<Ln.meshes.length;++Li){let gn=Ln.meshes[Li],un=Li===Ln.lightMeshIndex,Tn=nn.wvpForNode;if(un){if(!Ri&&!Z.terrain&&Z.shadowRenderer){Z.currentLayer<Z.firstLightBeamLayer&&(Z.firstLightBeamLayer=Z.currentLayer);continue}Tn=nn.wvpForTile}else if(Ri)continue;let qn={defines:[]},mi=[];if(!qe&&he&&(he.useNormalOffset=!!gn.normalBuffer),Dh(qn.defines,mi,gn,Z,re.lut),Nr||qn.defines.push("DIFFUSE_SHADED"),vn&&qn.defines.push("SHADOWS_SINGLE_CASCADE"),at&&(qe?at.numRenderedVerticesInShadowPass+=gn.vertexArray.length:at.numRenderedVerticesInTransparentPass+=gn.vertexArray.length),qe){Mh(gn,nn.nodeModelMatrix,Z,re);continue}let ii=null;if(le){let yo=Yf(nn.nodeModelMatrix,Z.transform);if(ii=new Float32Array(yo),ue.projection.name!=="globe"){let Cr=gn.aabb.min,fs=gn.aabb.max,[Qr,An]=le.getOpacityForBounds(yo,Cr[0],Cr[1],fs[0],fs[1]);qn.overrideFog=Qr>=Qe||An>=Qe}}let ji=gn.material,zo;ji.occlusionTexture&&ji.occlusionTexture.offsetScale&&(zo=ji.occlusionTexture.offsetScale,qn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));let Ir=Z.getOrCreateProgram("model",qn);!qe&&he&&he.setupShadowsFromMatrix(nn.tileModelMatrix,Ir,he.useNormalOffset),Z.uploadCommonUniforms(ae,Ir,null,ii);let Tr=ji.pbrMetallicRoughness;Tr.metallicFactor=.9,Tr.roughnessFactor=.5;let Kr=wh(new Float32Array(Tn),new Float32Array(Cn),new Float32Array(ni),new Float32Array(Ln.matrix),Z,nn.opacity,Tr.baseColorFactor.toRenderColor(null),ji.emissiveFactor,Tr.metallicFactor,Tr.roughnessFactor,ji,Jr,re,[0,0,0],zo);!un&&(Nn.hasTranslucentParts||nn.opacity<1)&&Ir.draw(Z,ae.gl.TRIANGLES,Ke,Gt.disabled,sn.disabled,zt.backCCW,Kr,re.id,gn.vertexBuffer,gn.indexBuffer,gn.segments,re.paint,Z.transform.zoom,void 0,mi),Ir.draw(Z,ae.gl.TRIANGLES,un?nt:Ke,Gt.disabled,un||nn.opacity<1||Nn.hasTranslucentParts?sn.alphaBlended:sn.unblended,zt.backCCW,Kr,re.id,gn.vertexBuffer,gn.indexBuffer,gn.segments,re.paint,Z.transform.zoom,void 0,mi)}}}}()}(h,t,o,f),void A();if(O.type!=="model")return;let P=O.getModels(),F=[],z=h.transform.getFreeCameraOptions().position,U=n.a6.vec3.scale([],[z.x,z.y,z.z],h.transform.worldSize);n.a6.vec3.negate(U,U);let W=[],q=[],X=0;for(let Z of P){let Q=o.paint.get("model-rotation").constantOr(null),re=o.paint.get("model-scale").constantOr(null),oe=o.paint.get("model-translation").constantOr(null);Z.computeModelMatrix(h,Q,re,oe,!0,!0,!1);let ae=n.a6.mat4.identity([]),ue=n.de(Z.position.lat,h.transform.zoom),le=n.a6.mat4.fromScaling([],[1,1,1/ue]);n.a6.mat4.translate(ae,ae,U),F.push({zScaleMatrix:le,negCameraPosMatrix:ae});for(let he of Z.nodes)Jc(h.transform,he,Z.matrix,h.transform.expandedFarZProjMatrix,X,W,q);X++}if(W.sort((Z,Q)=>Q.depth-Z.depth),h.renderPass!=="shadow"){if(g===1)for(let Z of q)Ta(Z,h,o,F[Z.modelIndex],Gt.disabled,h.colorModeForRenderPass());else{for(let Z of q)Ta(Z,h,o,F[Z.modelIndex],Gt.disabled,sn.disabled);for(let Z of q)Ta(Z,h,o,F[Z.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(let Z of W)Ta(Z,h,o,F[Z.modelIndex],Gt.disabled,h.colorModeForRenderPass());A()}else{for(let Z of q)Mh(Z.mesh,Z.nodeModelMatrix,h,o);for(let Z of W)Mh(Z.mesh,Z.nodeModelMatrix,h,o);A()}}},as={model:function(h,t,o){let f=t.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,f.type==="vector"?h.scope:""));if(f.type==="batched-model"||f.type!=="model")return;let g=f.getModels();for(let v of g)v.upload(o.context)},raster:function(h,t,o){let f=t.getSource();if(!(f instanceof Ro&&f.loaded()))return;let g=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;let v=h.paint.get("raster-array-band")||f.getInitialBand(g);if(v==null)return;let b=t.getIds().map(M=>t.getTileByID(M));for(let M of b)M.updateNeeded(g,v)&&f.prepareTile(M,g,v)},"raster-particle":function(h,t,o){let f=t.getSource();if(!(f instanceof Ro&&f.loaded()))return;let g=h.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!g)return;let v=h.paint.get("raster-particle-array-band")||f.getInitialBand(g);if(v==null)return;let b=t.getIds().map(M=>t.getTileByID(M));for(let M of b)M.updateNeeded(g,v)&&f.prepareTile(M,g,v)}};class Vs{constructor(t,o,f,g,v){this.context=new M0(t,o),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let b=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let A of b)this._debugParams.enabledLayers[A]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let A of b)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],A);this.occlusionParams=new Al(v),this.setup(),this.numSublayers=br.maxUnderzooming+br.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new sg(this),this._wireframeDebugCache=new Sh,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];let M=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,M,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g}updateTerrain(t,o){let f=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Mf(this,t));let g=this._terrain;this.transform.elevation=f?g:null,g.update(t,this.transform,o),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(t){let o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[f,g]=o.getFovAdjustedRange(this.transform._fov);if(f>g)return void(this.transform.fogCullDistSq=null);let v=f+.78*(g-f);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Mf(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*n.q.devicePixelRatio,this.height=o*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let f of this.style.order)this.style._mergedLayers[f].resize()}setup(){let t=this.context,o=new n.a$;o.emplaceBack(0,0),o.emplaceBack(n.ab,0),o.emplaceBack(0,n.ab),o.emplaceBack(n.ab,n.ab),this.tileExtentBuffer=t.createVertexBuffer(o,n.b1.members),this.tileExtentSegments=n.b2.simpleSegment(0,0,4,2);let f=new n.a$;f.emplaceBack(0,0),f.emplaceBack(n.ab,0),f.emplaceBack(0,n.ab),f.emplaceBack(n.ab,n.ab),this.debugBuffer=t.createVertexBuffer(f,n.b1.members),this.debugSegments=n.b2.simpleSegment(0,0,4,5);let g=new n.a$;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,n.b1.members),this.viewportSegments=n.b2.simpleSegment(0,0,4,2);let v=new n.aO;v.emplaceBack(0,0,0,0),v.emplaceBack(n.ab,0,n.ab,0),v.emplaceBack(0,n.ab,0,n.ab),v.emplaceBack(n.ab,n.ab,n.ab,n.ab),this.mercatorBoundsBuffer=t.createVertexBuffer(v,n.b4.members),this.mercatorBoundsSegments=n.b2.simpleSegment(0,0,4,2);let b=new n.aP;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);let M=new n.b0;for(let O of[0,1,3,2,0])M.emplaceBack(O);this.debugIndexBuffer=t.createIndexBuffer(M),this.emptyTexture=new n.T(t,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.a6.mat4.create();let A=this.context.gl;this.stencilClearMode=new Gt({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Ct.disabled,this.stencilClearMode,sn.disabled,zt.disabled,Gc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,f){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(let A of f)if(this._tileClippingMaskIDs[A.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=o.id;let g=this.context,v=g.gl;this.nextStencilID+f.length>256&&this.clearStencil(),g.setColorMode(sn.disabled),g.setDepthMode(Ct.disabled);let b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let M of f){let A=o.getTile(M),O=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:F,tileBoundsSegments:z}=this.getTileBoundsBuffers(A);b.draw(this,v.TRIANGLES,Ct.disabled,new Gt({func:v.ALWAYS,mask:0},O,255,v.KEEP,v.KEEP,v.REPLACE),sn.disabled,zt.disabled,Gc(M.projMatrix),"$clipping",P,F,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,o=this.context.gl;return new Gt({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);let o=this.context.gl;return new Gt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){let o=this.context.gl,f=t.sort((b,M)=>M.overscaledZ-b.overscaledZ),g=f[f.length-1].overscaledZ,v=f[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();let b={};for(let M=0;M<v;M++)b[M+g]=new Gt({func:o.GEQUAL,mask:255},M+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=v,[b,f]}return[{[g]:Gt.disabled},f]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new sn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.bA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?sn.unblended:sn.alphaBlended}colorModeForDrapableLayerRenderPass(t){let o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new sn([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new n.bA(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,o,f,g=!1){if(this.depthOcclusion)return new Ct(this.context.gl.GREATER,Ct.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return Ct.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ct(f||this.context.gl.LEQUAL,o,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){let t=this.context.gl,o=Math.ceil(this.width),f=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),v=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&f!==0&&(this.depthFBO=new Og(this.context,o,f,!1,"texture"),this.depthTexture=new n.T(this.context,{width:o,height:f,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),t.bindTexture(t.TEXTURE_2D,v),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,f,0,0,o,f,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,o)=>t+o/this._fpsHistory.length,0))}render(t,o){let f=n.q.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;let g=this.style._mergedLayers,v=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(ye=>{let _e=g[ye];return!(_e.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[_e.type]}),b=!1,M=!1;for(let ye of v){let _e=g[ye];_e.type==="circle"&&(b=!0),_e.type==="symbol"&&(_e.hasInitialOcclusionOpacityProperties?M=!0:b=!0)}let A=v.map(ye=>g[ye]),O=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let P=0,F=!1;for(let ye in O){let _e=O[ye];_e.used&&(_e.prepare(this.context),_e.getSource().usedInConflation&&++P)}let z=!1;for(let ye of A)ye.isHidden(this.transform.zoom)||(ye.type==="clip"&&(z=!0),this.prepareLayer(ye));let U={},W={},q={},X={},Z={};for(let ye in O){let _e=O[ye];U[ye]=_e.getVisibleCoordinates(),W[ye]=U[ye].slice().reverse(),q[ye]=_e.getVisibleCoordinates(!0).reverse(),X[ye]=_e.getShadowCasterCoordinates(),Z[ye]=_e.sortCoordinatesByDistance(U[ye])}let Q=ye=>{let _e=this.style.getLayerSourceCache(ye);return _e&&_e.used?_e.getSource():null};if(P||z||this._clippingActiveLastFrame){let ye=[],_e=[],Oe=0;for(let Ve of A)this.isSourceForClippingOrConflation(Ve,Q(Ve))&&(ye.push(Ve),_e.push(Oe)),Oe++;if(ye&&(z||ye.length>1)||this._clippingActiveLastFrame){z=!1;let Ve=[];for(let Ze=0;Ze<ye.length;Ze++){let Ke=ye[Ze],nt=_e[Ze],Ce=this.style.getLayerSourceCache(Ke);if(!Ce||!Ce.used||!Ce.getSource().usedInConflation&&Ke.type!=="clip")continue;let qe=n.dn,ke=n.bt.None,We=[],Xe=!0;if(Ke.type==="clip"){qe=nt;for(let Ge of Ke.layout.get("clip-layer-types"))ke|=Ge==="model"?n.bt.Model:Ge==="symbol"?n.bt.Symbol:n.bt.FillExtrusion;for(let Ge of Ke.layout.get("clip-layer-scope"))We.push(Ge);Ke.isHidden(this.transform.zoom)?Xe=!1:z=!0}Xe&&Ve.push({layer:Ke.fqid,cache:Ce,order:qe,clipMask:ke,clipScope:We})}this.replacementSource.setSources(Ve),F=!0}}this._clippingActiveLastFrame=z,F||this.replacementSource.clear(),this.conflationActive=F,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ye=0;ye<A.length;ye++){let _e=A[ye],Oe=_e.cutoffRange();if(this.longestCutoffRange=Math.max(Oe,this.longestCutoffRange),Oe>0){let Ve=Q(_e);Ve&&(this.minCutoffZoom=Math.max(Ve.minzoom,this.minCutoffZoom)),_e.minzoom&&(this.minCutoffZoom=Math.max(_e.minzoom,this.minCutoffZoom))}_e.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ye),this._lastOcclusionLayer=ye)}let re=this.style&&this.style.fog;re?(this._fogVisible=re.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=re.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(q),this.opaquePassCutoff=0);let oe=this._shadowRenderer;if(oe){oe.updateShadowParameters(this.transform,this.style.directionalLight);for(let ye in O)for(let _e of U[ye]){let Oe={min:0,max:0};this.terrain&&(Oe=this.terrain.getMinMaxForTile(_e)||Oe),oe.addShadowReceiver(_e.toUnwrapped(),Oe.min,Oe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Xf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Ko.has(this.context.gl))return;this.renderPass="offscreen";for(let ye of A){let _e=t.getLayerSourceCache(ye);if(!ye.hasOffscreenPass()||ye.isHidden(this.transform.zoom))continue;let Oe=_e?W[_e.id]:void 0;(ye.type==="custom"||ye.type==="raster"||ye.type==="raster-particle"||ye.isSky()||Oe&&Oe.length)&&this.renderLayer(this,_e,ye,Oe)}this.depthRangeFor3D=[0,1-(A.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,X)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ue=(()=>{if(o.showOverdrawInspector)return n.bA.black;let ye=this.style.fog;if(ye&&this.transform.projection.supportsFog){let _e=this.style.getLut(ye.scope);if(!ae){let Oe=ye.properties.get("color").toRenderColor(_e).toArray01();return new n.bA(...Oe)}if(ae){let Oe=ye.properties.get("space-color").toRenderColor(_e).toArray01();return new n.bA(...Oe)}}return n.bA.transparent})();if(this.context.clear({color:ue,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){let ye=A[this.currentLayer],_e=t.getLayerSourceCache(ye);if(ye.isSky())continue;let Oe=_e?(ye.is3D()?Z:W)[_e.id]:void 0;this._renderTileClippingMasks(ye,_e,Oe),this.renderLayer(this,_e,ye,Oe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){let ye=A[this.currentLayer],_e=t.getLayerSourceCache(ye);ye.isSky()&&this.renderLayer(this,_e,ye,_e?W[_e.id]:void 0)}function le(ye,_e){let Oe;return _e&&(Oe=(ye.type==="symbol"?q:ye.is3D()?Z:W)[_e.id]),Oe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){let ye=A[this.currentLayer];if(ye.type==="raster"||ye.type==="raster-particle"){let _e=t.getLayerSourceCache(ye);this.renderLayer(this,_e,ye,le(ye,_e))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let he=0;oe&&(he=oe.getShadowCastingLayerCount());let ge=!1,be=-1;for(let ye=0;ye<v.length;++ye){let _e=A[ye];_e.isHidden(this.transform.zoom)||_e.is3D()&&(be=ye)}for(M&&be===-1&&(b=!0);this.currentLayer<v.length;){let ye=A[this.currentLayer],_e=t.getLayerSourceCache(ye);if(ye.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ye)){if(ye.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(b&&!ge&&this.terrain&&!this.transform.isOrthographic&&(ge=!0,this.blitDepth()),M&&be!==-1&&this.currentLayer===be+1&&!this.transform.isOrthographic&&this.blitDepth(),ye.is3D()||this.terrain||this._renderTileClippingMasks(ye,_e,_e?U[_e.id]:void 0),this.renderLayer(this,_e,ye,le(ye,_e)),!this.terrain&&oe&&he>0&&ye.hasShadowPass()&&--he==0&&(oe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let Oe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Oe;this.currentLayer++){let Ve=A[this.currentLayer];if(!Ve.hasLightBeamPass())continue;let Ze=t.getLayerSourceCache(Ve);this.renderLayer(this,Ze,Ve,Ze?W[Ze.id]:void 0)}this.currentLayer=Oe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){let Oe=this.currentLayer;this.depthOcclusion=!0;for(let Ve of this.layersWithOcclusionOpacity){this.currentLayer=Ve;let Ze=A[this.currentLayer],Ke=t.getLayerSourceCache(Ze),nt=Ke?W[Ke.id]:void 0;Ze.is3D()||this.terrain||this._renderTileClippingMasks(Ze,Ke,Ke?U[Ke.id]:void 0),this.renderLayer(this,Ke,Ze,nt)}this.depthOcclusion=!1,this.currentLayer=Oe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ye=null;A.forEach(_e=>{let Oe=t.getLayerSourceCache(_e);Oe&&!_e.isHidden(this.transform.zoom)&&Oe.getVisibleCoordinates().length&&(!ye||ye.getSource().maxzoom<Oe.getSource().maxzoom)&&(ye=Oe)}),ye&&this.options.showTileBoundaries&&Qc.debug(this,ye,ye.getVisibleCoordinates(),n.bA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Qc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.bA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ye){let _e=ye.transform.padding;Re(ye,ye.transform.height-(_e.top||0),3,Dl),Re(ye,_e.bottom||0,3,Ml),qf(ye,_e.left||0,3,tt),qf(ye,ye.transform.width-(_e.right||0),3,wt);let Oe=ye.transform.centerPoint;(function(Ve,Ze,Ke,nt){Ia(Ve,Ze-1,Ke-10,2,20,nt),Ia(Ve,Ze-10,Ke-1,20,2,nt)})(ye,Oe.x,ye.transform.height-Oe.y,Sl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),F||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);let{unsupportedLayers:o}=this.transform.projection,f=!o||!o.includes(t.type);if(as[t.type]&&(f||this.terrain&&t.type==="custom")){let g=this.style.getLayerSourceCache(t);as[t.type](t,g,this)}this.gpuTimingEnd()}renderLayer(t,o,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||g&&g.length)&&(this.id=f.id,this.gpuTimingStart(f),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(f.type)&&(!t.terrain||f.type!=="custom")||f.type==="clip"||Qc[f.type](t,o,f,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;let o=this.context.extTimerQuery,f=this.context.gl,g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:f.createQuery()}),g.calls++,f.beginQuery(o.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let t=this.context.extTimerQuery,o=this.context.gl,f=o.createQuery();this.deferredRenderGpuTimeQueries.push(f),o.beginQuery(t.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){let t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){let o={};for(let f in t){let g=t[f],v=this.context.extTimerQuery,b=v.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(g.query),o[f]=b}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;let o=this.context.gl,f=0;for(let g of t)f+=o.getQueryParameter(g,o.QUERY_RESULT)/1e6,o.deleteQuery(g);return f}translatePosMatrix(t,o,f,g,v){if(!f[0]&&!f[1])return t;let b=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(b){let O=Math.sin(b),P=Math.cos(b);f=[f[0]*P-f[1]*O,f[0]*O+f[1]*P]}let M=[v?f[0]:n.ak(o,f[0],this.transform.zoom),v?f[1]:n.ak(o,f[1],this.transform.zoom),0],A=new Float32Array(16);return n.a6.mat4.translate(A,t,M),A}saveTileTexture(t){let o=t.size[0],f=this._tileTextures[o];f?f.push(t):this._tileTextures[o]=[t]}getTileTexture(t){let o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,f){let g=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,v=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||g||o!==void 0&&!o||v.push("FOG","FOG_DITHERING"),g&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(t,o){this.cache=this.cache||{};let f=o&&o.defines||[],g=o&&o.config,v=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(f),b=os.cacheKey(Fs[t],t,v,g);return this.cache[b]||(this.cache[b]=new os(this.context,t,Fs[t],g,Ea[t],v)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){let f=this.style.directionalLight,g=this.style.ambientLight;if(f&&g){let v=((b,M,A)=>{let O=b.properties.get("direction"),P=b.properties.get("color").toRenderColor(A.getLut(b.scope)).toArray01(),F=b.properties.get("intensity"),z=M.properties.get("color").toRenderColor(A.getLut(M.scope)).toArray01(),U=M.properties.get("intensity"),W=[O.x,O.y,O.z],q=n.cH(z,U),X=n.cH(P,F);return{u_lighting_ambient_color:q,u_lighting_directional_dir:W,u_lighting_directional_color:X,u_ground_radiance:Sf(W,X,q)}})(f,g,this.style);o.setLightsUniformValues(t,v)}}}uploadCommonUniforms(t,o,f,g,v){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;let b=this.style.fog;if(b){let M=b.getOpacity(this.transform.pitch),A=((O,P,F,z,U,W,q,X,Z,Q,re,oe)=>{let ae=O.transform,ue=P.properties.get("color").toRenderColor(O.style.getLut(P.scope)).toArray01();ue[3]=z;let le=O.frameCounter/1e3%1,[he,ge]=P.properties.get("vertical-range");return{u_fog_matrix:F?ae.calculateFogTileMatrix(F):oe||O.identityMat,u_fog_range:P.getFovAdjustedRange(ae._fov),u_fog_color:ue,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,ge),ge],u_fog_temporal_offset:le,u_frustum_tl:U,u_frustum_tr:W,u_frustum_br:q,u_frustum_bl:X,u_globe_pos:Z,u_globe_radius:Q,u_viewport:re,u_globe_transition:n.a9(ae.zoom),u_is_globe:+(ae.projection.name==="globe")}})(this,b,f,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],g);o.setFogUniformValues(t,A)}v&&o.setCutoffUniformValues(t,v.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){let t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){let t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let t=this._backgroundTiles,o=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(let g of f)o[g.key]=t[g.key]||new Oo(g,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=Qe||o[1]>=Qe}setupDepthForOcclusion(t,o,f){let g=this.context,v=g.gl,b=!!f;var M;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(v.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),g.activeTexture.set(v.TEXTURE0),b||o.setTerrainUniformValues(g,f)}}function ls(h,t){let o=!1,f=null,g=()=>{f=null,o&&(h(),f=setTimeout(g,t),o=!1)};return()=>(o=!0,f||g(),f)}class Ah{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ls(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let t=this._map;if(!t)return"";let o=eu(t);if(this._hashName){let f=this._hashName,g=!1,v=location.hash.slice(1).split("&").map(b=>{let M=b.split("=")[0];return M===f?(g=!0,`${M}=${o}`):b}).filter(b=>b);return g||v.push(`${f}=${o}`),`#${v.join("&")}`}return`#${o}`}_getCurrentHash(){let t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(o=f)}),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){let t=this._map;if(!t)return!1;let o=this._getCurrentHash();if(o.length>=3&&!o.some(f=>isNaN(f))){let f=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:f,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function eu(h,t){let o=h.getCenter(),f=Math.round(100*h.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),b=Math.round(o.lng*v)/v,M=Math.round(o.lat*v)/v,A=h.getBearing(),O=h.getPitch(),P=t?`/${b}/${M}/${f}`:`${f}/${M}/${b}`;return(A||O)&&(P+="/"+Math.round(10*A)/10),O&&(P+=`/${Math.round(O)}`),P}let Rl={linearity:.3,easing:n.dp(0,0,.3,1)},Kf=n.l({deceleration:2500,maxSpeed:1400},Rl),Qf=n.l({deceleration:20,maxSpeed:1400},Rl),js=n.l({deceleration:1e3,maxSpeed:360},Rl),ep=n.l({deceleration:1e3,maxSpeed:90},Rl);class Rh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,o=n.q.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let o={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:v}of this._inertiaBuffer)o.zoom+=v.zoomDelta||0,o.bearing+=v.bearingDelta||0,o.pitch+=v.pitchDelta||0,v.panDelta&&o.pan._add(v.panDelta),v.around&&(o.around=v.around),v.pinchAround&&(o.pinchAround=v.pinchAround);let f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(o.pan.mag()){let v=Ol(o.pan.mag(),f,n.l({},Kf,t||{}));g.offset=o.pan.mult(v.amount/o.pan.mag()),g.center=this._map.transform.center,Pl(g,v)}if(o.zoom){let v=Ol(o.zoom,f,Qf);g.zoom=this._map.transform.zoom+v.amount,Pl(g,v)}if(o.bearing){let v=Ol(o.bearing,f,js);g.bearing=this._map.transform.bearing+n.ap(v.amount,-179,179),Pl(g,v)}if(o.pitch){let v=Ol(o.pitch,f,ep);g.pitch=this._map.transform.pitch+v.amount,Pl(g,v)}if(g.zoom||g.bearing){let v=o.pinchAround===void 0?o.around:o.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function Pl(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Ol(h,t,o){let{maxSpeed:f,linearity:g,deceleration:v}=o,b=n.ap(h*g/(t/1e3),-f,f),M=Math.abs(b)/(v*g);return{easing:o.easing,duration:1e3*M,amount:b*(M/2)}}class si extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,f,g={}){let v=ai(o.getCanvasContainer(),f),b=o.unproject(v);super(t,n.l({point:v,lngLat:b,originalEvent:f},g)),this._defaultPrevented=!1,this.target=o}}class kl extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,f){let g=t==="touchend"?f.changedTouches:f.touches,v=Zi(o.getCanvasContainer(),g),b=v.map(A=>o.unproject(A)),M=v.reduce((A,O,P,F)=>A.add(O.div(F.length)),new n.P(0,0));super(t,{points:v,point:M,lngLats:b,lngLat:o.unproject(M),originalEvent:f}),this._defaultPrevented=!1}}class tp extends n.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class Ll{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new tp(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new si(t.type,this._map,t))}mouseup(t){this._map.fire(new si(t.type,this._map,t))}preclick(t){let o=n.l({},t);o.type="preclick",this._map.fire(new si(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new si(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new si(t.type,this._map,t))}mouseover(t){this._map.fire(new si(t.type,this._map,t))}mouseout(t){this._map.fire(new si(t.type,this._map,t))}touchstart(t){return this._firePreventable(new kl(t.type,this._map,t))}touchmove(t){this._map.fire(new kl(t.type,this._map,t))}touchend(t){this._map.fire(new kl(t.type,this._map,t))}touchcancel(t){this._map.fire(new kl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ca{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new si(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new si("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new si(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class np{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(St(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;let f=o,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(f)||!this._box&&f.dist(g)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=Be("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));let b=Math.min(g.x,f.x),M=Math.max(g.x,f.x),A=Math.min(g.y,f.y),O=Math.max(g.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${A}px)`,this._box.style.width=M-b+"px",this._box.style.height=O-A+"px")})}mouseupWindow(t,o){if(!this._active)return;let f=this._startPos,g=o;if(f&&t.button===0){if(this.reset(),Dt(),f.x!==g.x||f.y!==g.y)return this._map.fire(new n.x("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(f,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_n(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new n.x(t,{originalEvent:o}))}}function Ph(h,t){let o={};for(let f=0;f<h.length;f++)o[h[f].identifier]=t[f];return o}class Gg{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){let v=new n.P(0,0);for(let b of g)v._add(b);return v.div(g.length)}(o),this.touches=Ph(f,o)))}touchmove(t,o,f){if(this.aborted||!this.centroid)return;let g=Ph(f,o);for(let v in this.touches){let b=g[v];(!b||b.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,o,f){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){let g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class tu{constructor(t){this.singleTap=new Gg(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,f){this.singleTap.touchstart(t,o,f)}touchmove(t,o,f){this.singleTap.touchmove(t,o,f)}touchend(t,o,f){let g=this.singleTap.touchend(t,o,f);if(g){let v=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(g)<30;if(v&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class ip{constructor(){this._zoomIn=new tu({numTouches:1,numTaps:2}),this._zoomOut=new tu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,f){this._zoomIn.touchstart(t,o,f),this._zoomOut.touchstart(t,o,f)}touchmove(t,o,f){this._zoomIn.touchmove(t,o,f),this._zoomOut.touchmove(t,o,f)}touchend(t,o,f){let g=this._zoomIn.touchend(t,o,f),v=this._zoomOut.touchend(t,o,f);return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(g)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let nu={0:1,2:2};class iu{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;let f=kt(t);this._correctButton(t,f)&&(this._lastPoint=o,this._eventButton=f)}mousemoveWindow(t,o){let f=this._lastPoint;if(f){if(t.preventDefault(),this._eventButton!=null&&function(g,v){let b=nu[v];return g.buttons===void 0||(g.buttons&b)!==b}(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(f,o)}}mouseupWindow(t){this._lastPoint&&kt(t)===this._eventButton&&(this._moved&&Dt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oh extends iu{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class kh extends iu{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){let f=.8*(o.x-t.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(t){t.preventDefault()}}class Lh extends iu{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){let f=-.5*(o.y-t.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(t){t.preventDefault()}}class Hg{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),n.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,o,f){return this._calculateTransform(t,o,f)}touchmove(t,o,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!n.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,f)}}touchend(t,o,f){this._calculateTransform(t,o,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,f){f.length>0&&(this._active=!0);let g=Ph(f,o),v=new n.P(0,0),b=new n.P(0,0),M=0;for(let O in g){let P=g[O],F=this._touches[O];F&&(v._add(P),b._add(P.sub(F)),M++,g[O]=P)}if(this._touches=g,M<this._minTouches||!b.mag())return;let A=b.div(M);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(M),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Be("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Fh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,f){return{}}touchstart(t,o,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,f){let g=this._firstTwoTouches;if(!g)return;t.preventDefault();let[v,b]=g,M=ru(f,o,v),A=ru(f,o,b);if(!M||!A)return;let O=this._aroundCenter?null:M.add(A).div(2);return this._move([M,A],O,t)}touchend(t,o,f){if(!this._firstTwoTouches)return;let[g,v]=this._firstTwoTouches,b=ru(f,o,g),M=ru(f,o,v);b&&M||(this._active&&Dt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ru(h,t,o){for(let f=0;f<h.length;f++)if(h[f].identifier===o)return t[f]}function rp(h,t){return Math.log(h/t)/Math.LN2}class qg extends Fh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){let f=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(rp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:rp(this._distance,f),pinchAround:o}}}function op(h,t){return 180*h.angleWith(t)/Math.PI}class Wg extends Fh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){let f=this._vector;if(this._vector=t[0].sub(t[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:op(this._vector,f),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let o=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;let g=op(t,f);return Math.abs(g)<o}}function Nh(h){return Math.abs(h.y)>Math.abs(h.x)}class Zg extends Fh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Nh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,f){let g=this._lastPoints;if(!g)return;let v=t[0].sub(g[0]),b=t[1].sub(g[1]);return this._map._cooperativeGestures&&!n.dq()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(v,b,f.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5})}gestureBeginsVertically(t,o,f){if(this._valid!==void 0)return this._valid;let g=t.mag()>=2,v=o.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;let b=t.y>0==o.y>0;return Nh(t)&&Nh(o)&&b}}let Xg={panStep:100,bearingStep:15,pitchStep:10};class Yg{constructor(){let t=Xg;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,f=0,g=0,v=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:M=>{let A=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Jg,zoom:o?Math.round(A)+o*(t.shiftKey?2:1):A,bearing:M.getBearing()+f*this._bearingStep,pitch:M.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-b*this._panStep],center:M.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jg(h){return h*(2-h)}let sp=4.000244140625,O0=1/450;class k0{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=O0,n.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,f=n.q.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,o!==0&&o%sp==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let o=ai(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){let O=this._type==="wheel"&&Math.abs(this._delta)>sp?this._wheelZoomRate:this._defaultZoomRate,P=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&P!==0&&(P=1/P);let F=o(),z=Math.pow(2,F),U=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(U*P))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let f=typeof this._targetZoom=="number"?this._targetZoom:o(),g=this._startZoom,v=this._easing,b,M=!1;if(this._type==="wheel"&&g&&v){let O=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),P=v(O);b=n.aa(g,f,P),O<1?this._frameId||(this._frameId=!0):M=!0}else b=f,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=b-o();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=n.dr;if(this._prevEase){let f=this._prevEase,g=(n.q.now()-f.start)/f.duration,v=f.easing(g+.01)-f.easing(g),b=.27/Math.sqrt(v*v+1e-4)*.01,M=Math.sqrt(.0729-b*b);o=n.dp(b,M,.25,1)}return this._prevEase={start:n.q.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Be("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class pi{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(t.shiftKey?-1:1),around:f.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class L0{constructor(){this._tap=new tu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,f){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=o[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(t,o,f))}touchmove(t,o,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;let g=o[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,o,f)}touchend(t,o,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(t,o,f)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class F0{constructor(t,o,f){this._el=t,this._mousePan=o,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ou{constructor(t,o,f){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qg{constructor(t,o,f,g){this._el=t,this._touchZoom=o,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Fl=h=>h.zoom||h.drag||h.pitch||h.rotate;class zh extends n.x{}class cs{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){let f=n.a6.vec3.sub([],o,t);this.radius=n.a6.vec3.length(f[2]<0?n.a6.vec3.div([],f,this.constants):[f[0],f[1],0])}projectRay(t){n.a6.vec3.div(t,t,this.constants),n.a6.vec3.normalize(t,t),n.a6.vec3.mul(t,t,this.constants);let o=n.a6.vec3.scale([],t,this.radius);if(o[2]>0){let f=n.a6.vec3.scale([],[0,0,1],n.a6.vec3.dot(o,[0,0,1])),g=n.a6.vec3.scale([],n.a6.vec3.normalize([],[o[0],o[1],0]),this.radius),v=n.a6.vec3.add([],o,n.a6.vec3.scale([],n.a6.vec3.sub([],n.a6.vec3.add([],g,f),o),2));o[0]=v[0],o[1]=v[1]}return o}}function Da(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class ki{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rh(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cs,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),n.aJ(["handleEvent","handleWindowEvent"],this);let f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(let[g,v,b]of this._listeners){let M=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(v,M,b)}}destroy(){for(let[t,o,f]of this._listeners){let g=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,g,f)}}_addDefaultHandlers(t){let o=this._map,f=o.getCanvasContainer();this._add("mapEvent",new Ll(o,t));let g=o.boxZoom=new np(o,t);this._add("boxZoom",g);let v=new ip,b=new Kg;o.doubleClickZoom=new pi(b,v),this._add("tapZoom",v),this._add("clickZoom",b);let M=new L0;this._add("tapDragZoom",M);let A=o.touchPitch=new Zg(o);this._add("touchPitch",A);let O=new kh(t),P=new Lh(t);o.dragRotate=new ou(t,O,P),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);let F=new Oh(t),z=new Hg(o,t);o.dragPan=new F0(f,F,z),this._add("mousePan",F),this._add("touchPan",z,["touchZoom","touchRotate"]);let U=new Wg,W=new qg;o.touchZoomRotate=new Qg(f,W,U,M),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ca(o));let q=o.scrollZoom=new k0(o,this);this._add("scrollZoom",q,["mousePan"]);let X=o.keyboard=new Yg;this._add("keyboard",X);for(let Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Z]&&o[Z].enable(t[Z])}_add(t,o,f){this._handlers.push({handlerName:t,handler:o,allowed:f}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(let{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,f){for(let g in t)if(g!==f&&(!o||o.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){let o=[];for(let f of t)this._el.contains(f.target)&&o.push(f);return o}handleEvent(t,o){this._updatingCamera=!0;let f=t.type==="renderFrame",g=f?void 0:t,v={needsRenderFrame:!1},b={},M={},A=t.touches?this._getMapTouches(t.touches):void 0,O=A?Zi(this._el,A):f?void 0:ai(this._el,t);for(let{handlerName:z,handler:U,allowed:W}of this._handlers){if(!U.isEnabled())continue;let q;this._blockedByActive(M,W,z)?U.reset():U[o||t.type]&&(q=U[o||t.type](t,O,A),this.mergeHandlerResult(v,b,q,z,g),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||U.isActive())&&(M[z]=U)}let P={};for(let z in this._previousActiveHandlers)M[z]||(P[z]=g);this._previousActiveHandlers=M,(Object.keys(P).length||Da(v))&&(this._changes.push([v,b,P]),this._triggerRenderFrame()),(Object.keys(M).length||Da(v))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=v;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,o,f,g,v){if(!f)return;n.l(t,f);let b={handlerName:g,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(o.zoom=b),f.panDelta!==void 0&&(o.drag=b),f.pitchDelta!==void 0&&(o.pitch=b),f.bearingDelta!==void 0&&(o.rotate=b)}_applyChanges(){let t={},o={},f={};for(let[g,v,b]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.aroundCoord!==void 0&&(t.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),n.l(o,v),n.l(f,b);this._updateMapTransform(t,o,f),this._changes=[]}_updateMapTransform(t,o,f){let g=this._map,v=g.transform,b=Q=>[Q.x,Q.y,Q.z];if((Q=>{let re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Da(t)){let Q=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),Q!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&g._stop(!0),!Da(t))return void this._fireEvents(o,f,!0);let{panDelta:M,zoomDelta:A,bearingDelta:O,pitchDelta:P,around:F,aroundCoord:z,pinchAround:U}=t;v._isCameraConstrained&&(A>0&&(A=0),v._isCameraConstrained=!1),U!==void 0&&(F=U),(A||(Q=>o[Q]&&!this._eventsInProgress[Q])("drag"))&&F&&(this._dragOrigin=b(v.pointCoordinate3D(F)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),F=F||g.transform.centerPoint,O&&(v.bearing+=O),P&&(v.pitch+=P),v._updateCameraState();let W=[0,0,0];if(M)if(v.projection.name==="mercator"){let Q=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(F).dir),re=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(F.sub(M)).dir);W[0]=re[0]-Q[0],W[1]=re[1]-Q[1]}else{let Q=v.pointCoordinate(F);if(v.projection.name==="globe"){M=M.rotate(-v.angle);let re=v._pixelsPerMercatorPixel/v.worldSize;W[0]=-M.x*n.ds(n.aN(Q.y))*re,W[1]=-M.y*n.ds(v.center.lat)*re}else{let re=v.pointCoordinate(F.sub(M));Q&&re&&(W[0]=re.x-Q.x,W[1]=re.y-Q.y)}}let q=v.zoom,X=[0,0,0];if(A){let Q=b(z||v.pointCoordinate3D(F)),re={dir:n.a6.vec3.normalize([],n.a6.vec3.sub([],Q,v._camera.position))};if(re.dir[2]<0){let oe=v.zoomDeltaToMovement(Q,A);n.a6.vec3.scale(X,re.dir,oe)}}let Z=n.a6.vec3.add(W,W,X);v._translateCameraConstrained(Z),A&&Math.abs(v.zoom-q)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,f,!0)}_fireEvents(t,o,f){let g=Fl(this._eventsInProgress),v=Fl(t),b={};for(let P in t){let{originalEvent:F}=t[P];this._eventsInProgress[P]||(b[`${P}start`]=F),this._eventsInProgress[P]=t[P]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(let P in b)this._fireEvent(P,b[P]);v&&this._fireEvent("move",v.originalEvent);for(let P in t){let{originalEvent:F}=t[P];this._fireEvent(P,F)}let M={},A;for(let P in this._eventsInProgress){let{handlerName:F,originalEvent:z}=this._eventsInProgress[P];this._handlersById[F].isActive()||(delete this._eventsInProgress[P],A=o[F]||z,M[`${P}end`]=A)}for(let P in M)this._fireEvent(P,M[P]);let O=Fl(this._eventsInProgress);if(f&&(g||v)&&!O){this._updatingCamera=!0;let P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;P?(F(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:A})):(this._map.fire(new n.x("moveend",{originalEvent:A})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new n.x(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new zh("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Fo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ap extends n.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,n.aJ(["_renderFrameCallback"],this)}getCenter(){return new n.bL(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,f){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,n.l({offset:t},o),f)}panTo(t,o,f){return this.easeTo(n.l({center:t},o),f)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,f){return this.easeTo(n.l({zoom:t},o),f)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,f){return this.easeTo(n.l({bearing:t},o),f)}resetNorth(t,o){return this.rotateTo(0,n.l({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(n.l({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=n.as.convert(t);let f=o&&o.bearing||0,g=o&&o.pitch||0,v=t.getNorthWest(),b=t.getSouthEast();return this._cameraForBounds(this.transform,v,b,f,g,o)}_extendPadding(t){let o={top:0,right:0,bottom:0,left:0};return t==null?n.l({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:n.l({},o,t)}_extendCameraOptions(t){return(t=n.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){let f=o.max[0]-o.min[0],g=o.max[1]-o.min[1];return f/g>t.aspect?f/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,f,g,v,b){let M=t.clone(),A=this._extendCameraOptions(b);M.bearing=g,M.pitch=v;let O=n.bL.convert(o),P=n.bL.convert(f),F=.5*(O.lat+P.lat),z=.5*(O.lng+P.lng),U=n.dt(F,z),W=n.a6.vec3.normalize([],U),q=n.a6.vec3.normalize([],n.a6.vec3.cross([],W,[0,1,0])),X=n.a6.vec3.cross([],q,W),Z=[q[0],q[1],q[2],0,X[0],X[1],X[2],0,W[0],W[1],W[2],0,0,0,0,1],Q=[U,n.dt(O.lat,O.lng),n.dt(P.lat,O.lng),n.dt(P.lat,P.lng),n.dt(O.lat,P.lng),n.dt(F,O.lng),n.dt(F,P.lng),n.dt(O.lat,z),n.dt(P.lat,z)],re=n.ca.fromPoints(Q.map(ke=>[n.a6.vec3.dot(q,ke),n.a6.vec3.dot(X,ke),n.a6.vec3.dot(W,ke)])),oe=n.a6.vec3.transformMat4([],re.center,Z);n.a6.vec3.squaredLength(oe)===0&&n.a6.vec3.set(oe,0,0,1),n.a6.vec3.normalize(oe,oe),n.a6.vec3.scale(oe,oe,n.aq),M.center=n.du(oe);let ae=M.getWorldToCameraMatrix(),ue=n.a6.mat4.invert(new Float64Array(16),ae);re=n.ca.applyTransform(re,n.a6.mat4.multiply([],ae,Z));let le=this._extendAABB(re,M,A,g);if(!le)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=le,n.a6.vec3.transformMat4(oe,oe,ae);let he=.5*(re.max[2]-re.min[2]),ge=this._minimumAABBFrustumDistance(M,re),be=n.a6.vec3.scale([],[0,0,1],he),ye=n.a6.vec3.add(be,oe,be),_e=ge+(M.pitch===0?0:n.a6.vec3.distance(oe,ye)),Oe=M.globeCenterInViewSpace,Ve=n.a6.vec3.sub([],oe,[Oe[0],Oe[1],Oe[2]]);n.a6.vec3.normalize(Ve,Ve),n.a6.vec3.scale(Ve,Ve,_e);let Ze=n.a6.vec3.add([],oe,Ve);n.a6.vec3.transformMat4(Ze,Ze,ue);let Ke=n.dw/n.aq,nt=n.a6.vec3.length(Ze),Ce=n.bE(Math.max(nt*Ke-n.dw,Number.EPSILON),0),qe=Math.min(M.zoomFromMercatorZAdjusted(Ce),A.maxZoom);return qe>.5*(n.c3+n.bV)?(M.setProjection({name:"mercator"}),M.zoom=qe,this._cameraForBounds(M,o,f,g,v,b)):{center:M.center,zoom:qe,bearing:g,pitch:v}}_extendAABB(t,o,f,g){let v=.5*((f.padding.left||0)+(f.padding.right||0)),b=.5*((f.padding.top||0)+(f.padding.bottom||0)),M=b,A=v,O=v,P=b,F=o.width-(A+O),z=o.height-(M+P),U=n.a6.vec3.sub([],t.max,t.min),W=Math.min(F/U[0],z/U[1]),q=Math.min(o.scaleZoom(o.scale*W),f.maxZoom);if(isNaN(q))return null;let X=o.scale/o.zoomScale(q),Z=new n.ca([t.min[0]-A*X,t.min[1]-P*X,t.min[2]],[t.max[0]+O*X,t.max[1]+M*X,t.max[2]]),Q=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new n.P(f.offset.x,f.offset.y):n.P.convert(f.offset)).rotate(-n.bC(g));return Z.center[0]-=Q.x*X,Z.center[1]+=Q.y*X,Z}queryTerrainElevation(t,o){let f=this.transform.elevation;return f?(o=n.l({},{exaggerated:!0},o),f.getAtPoint(n.a5.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,f,g,v,b){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,f,g,v,b);let M=t.clone(),A=this._extendCameraOptions(b);M.bearing=g,M.pitch=v;let O=n.bL.convert(o),P=n.bL.convert(f),F=new n.bL(O.lng,P.lat),z=new n.bL(P.lng,O.lat),U=M.project(O),W=M.project(P),q=this.queryTerrainElevation(O),X=this.queryTerrainElevation(P),Z=this.queryTerrainElevation(F),Q=this.queryTerrainElevation(z),re=[[U.x,U.y,Math.min(q||0,X||0,Z||0,Q||0)],[W.x,W.y,Math.max(q||0,X||0,Z||0,Q||0)]],oe=n.ca.fromPoints(re),ae=M.getWorldToCameraMatrix(),ue=n.a6.mat4.invert(new Float64Array(16),ae);oe=n.ca.applyTransform(oe,ae);let le=this._extendAABB(oe,M,A,g);if(!le)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=le;let he=.5*n.a6.vec3.sub([],oe.max,oe.min)[2],ge=this._minimumAABBFrustumDistance(M,oe),be=[0,0,1,0];n.a6.vec4.transformMat4(be,be,ae),n.a6.vec4.normalize(be,be);let ye=n.a6.vec3.scale([],be,ge+he),_e=n.a6.vec3.add([],oe.center,ye);n.a6.vec3.transformMat4(oe.center,oe.center,ue),n.a6.vec3.transformMat4(_e,_e,ue);let Oe=M.unproject(new n.P(oe.center[0],oe.center[1])),Ve=n.dv(M.projection,Oe),Ze=Math.pow(2,Ve),Ke=Math.min(M._zoomFromMercatorZ(_e[2]*M.pixelsPerMeter*Ze/M.worldSize),A.maxZoom);return M.mercatorFromTransition&&Ke<.5*(n.c3+n.bV)?(M.setProjection({name:"globe"}),M.zoom=Ke,this._cameraForBounds(M,o,f,g,v,b)):{center:Oe,zoom:Ke,bearing:g,pitch:v}}fitBounds(t,o,f){let g=this.cameraForBounds(t,o);return this._fitInternal(g,o,f)}fitScreenCoordinates(t,o,f,g,v){let b=n.P.convert(t),M=n.P.convert(o),A=new n.P(Math.min(b.x,M.x),Math.min(b.y,M.y)),O=new n.P(Math.max(b.x,M.x),Math.max(b.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,M))return this;let P=this.transform.pointLocation3D(A),F=this.transform.pointLocation3D(O),z=this.transform.pointLocation3D(new n.P(A.x,O.y)),U=this.transform.pointLocation3D(new n.P(O.x,A.y)),W=[Math.min(P.lng,F.lng,z.lng,U.lng),Math.min(P.lat,F.lat,z.lat,U.lat)],q=[Math.max(P.lng,F.lng,z.lng,U.lng),Math.max(P.lat,F.lat,z.lat,U.lat)],X=g&&g.pitch?g.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,W,q,f,X,g);return this._fitInternal(Z,g,v)}_fitInternal(t,o,f){return t?(o=n.l(t,o)).linear?this.easeTo(o,f):this.flyTo(o,f):this}jumpTo(t,o){this.stop();let f=t.preloadOnly?this.transform.clone():this.transform,g=!1,v=!1,b=!1;"zoom"in t&&f.zoom!==+t.zoom&&(g=!0,f.zoom=+t.zoom),t.center!==void 0&&(f.center=n.bL.convert(t.center)),"bearing"in t&&f.bearing!==+t.bearing&&(v=!0,f.bearing=+t.bearing),"pitch"in t&&f.pitch!==+t.pitch&&(b=!0,f.pitch=+t.pitch);let M=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!f.isPaddingEqual(M))if(t.retainPadding===!1){let A=f.clone();A.padding=M,f.setLocationAtPoint(f.center,A.centerPoint)}else f.padding=M;return t.preloadOnly?(this._preloadTiles(f),this):(this.fire(new n.x("movestart",o)).fire(new n.x("move",o)),g&&this.fire(new n.x("zoomstart",o)).fire(new n.x("zoom",o)).fire(new n.x("zoomend",o)),v&&this.fire(new n.x("rotatestart",o)).fire(new n.x("rotate",o)).fire(new n.x("rotateend",o)),b&&this.fire(new n.x("pitchstart",o)).fire(new n.x("pitch",o)).fire(new n.x("pitchend",o)),this.fire(new n.x("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Fo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){let f=this.transform;if(!f.projection.supportsFreeCamera)return n.w(Fo),this;this.stop();let g=f.zoom,v=f.pitch,b=f.bearing;f.setFreeCameraOptions(t);let M=g!==f.zoom,A=v!==f.pitch,O=b!==f.bearing;return this.fire(new n.x("movestart",o)).fire(new n.x("move",o)),M&&this.fire(new n.x("zoomstart",o)).fire(new n.x("zoom",o)).fire(new n.x("zoomend",o)),O&&this.fire(new n.x("rotatestart",o)).fire(new n.x("rotate",o)).fire(new n.x("rotateend",o)),A&&this.fire(new n.x("pitchstart",o)).fire(new n.x("pitch",o)).fire(new n.x("pitchend",o)),this.fire(new n.x("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=n.l({offset:[0,0],duration:500,easing:n.dr},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);let f=this.transform,g=this.getZoom(),v=this.getBearing(),b=this.getPitch(),M=this.getPadding(),A="zoom"in t?+t.zoom:g,O="bearing"in t?this._normalizeBearing(t.bearing,v):v,P="pitch"in t?+t.pitch:b,F=this._extendPadding(t.padding),z=n.P.convert(t.offset),U,W,q;if(f.projection.name==="globe"){let be=n.a5.fromLngLat(f.center),ye=z.rotate(-f.angle);be.x+=ye.x/f.worldSize,be.y+=ye.y/f.worldSize;let _e=be.toLngLat(),Oe=n.bL.convert(t.center||_e);this._normalizeCenter(Oe),U=f.centerPoint.add(ye),W=new n.P(be.x,be.y).mult(f.worldSize),q=new n.P(n.am(Oe.lng),n.at(Oe.lat)).mult(f.worldSize).sub(W)}else{U=f.centerPoint.add(z);let be=f.pointLocation(U),ye=n.bL.convert(t.center||be);this._normalizeCenter(ye),W=f.project(be),q=f.project(ye).sub(W)}let X=f.zoomScale(A-g),Z,Q;t.around&&(Z=n.bL.convert(t.around),Q=f.locationPoint(Z));let re=this._zooming||A!==g,oe=this._rotating||v!==O,ae=this._pitching||P!==b,ue=!f.isPaddingEqual(F),le=t.retainPadding===!1?f.clone():f,he=be=>ye=>{if(re&&(be.zoom=n.aa(g,A,ye)),oe&&(be.bearing=n.aa(v,O,ye)),ae&&(be.pitch=n.aa(b,P,ye)),ue&&(le.interpolatePadding(M,F,ye),U=le.centerPoint.add(z)),Z)be.setLocationAtPoint(Z,Q);else{let _e=be.zoomScale(be.zoom-g),Oe=A>g?Math.min(2,X):Math.max(.5,X),Ve=Math.pow(Oe,1-ye),Ze=be.unproject(W.add(q.mult(ye*Ve)).mult(_e));be.setLocationAtPoint(be.renderWorldCopies?Ze.wrap():Ze,U)}return t.preloadOnly||this._fireMoveEvents(o),be};if(t.preloadOnly){let be=this._emulate(he,t.duration,f);return this._preloadTiles(be),this}let ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=oe,this._pitching=ae,this._padding=ue,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,ge),this._ease(he(f),be=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(o,be)},t),this}_prepareEase(t,o,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||f.moving||this.fire(new n.x("movestart",t)),this._zooming&&!f.zooming&&this.fire(new n.x("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new n.x("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new n.x("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.x("move",t)),this._zooming&&this.fire(new n.x("zoom",t)),this._rotating&&this.fire(new n.x("rotate",t)),this._pitching&&this.fire(new n.x("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let f=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new n.x("zoomend",t)),g&&this.fire(new n.x("rotateend",t)),v&&this.fire(new n.x("pitchend",t)),this.fire(new n.x("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){let ke=n.ar(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ke,o)}this.stop(),t=n.l({offset:[0,0],speed:1.2,curve:1.42,easing:n.dr},t);let f=this.transform,g=this.getZoom(),v=this.getBearing(),b=this.getPitch(),M=this.getPadding(),A="zoom"in t?n.ap(+t.zoom,f.minZoom,f.maxZoom):g,O="bearing"in t?this._normalizeBearing(t.bearing,v):v,P="pitch"in t?+t.pitch:b,F=this._extendPadding(t.padding),z=f.zoomScale(A-g),U=n.P.convert(t.offset),W=f.centerPoint.add(U),q=f.pointLocation(W),X=n.bL.convert(t.center||q);this._normalizeCenter(X);let Z=f.project(q),Q=f.project(X).sub(Z),re=t.curve,oe=Math.max(f.width,f.height),ae=oe/z,ue=Q.mag();if("minZoom"in t){let ke=n.ap(Math.min(t.minZoom,g,A),f.minZoom,f.maxZoom),We=oe/f.zoomScale(ke-g);re=Math.sqrt(We/ue*2)}let le=re*re;function he(ke){let We=(ae*ae-oe*oe+(ke?-1:1)*le*le*ue*ue)/(2*(ke?ae:oe)*le*ue);return Math.log(Math.sqrt(We*We+1)-We)}function ge(ke){return(Math.exp(ke)-Math.exp(-ke))/2}function be(ke){return(Math.exp(ke)+Math.exp(-ke))/2}let ye=he(0),_e=function(ke){return be(ye)/be(ye+re*ke)},Oe=function(ke){return oe*((be(ye)*(ge(We=ye+re*ke)/be(We))-ge(ye))/le)/ue;var We},Ve=(he(1)-ye)/re;if(Math.abs(ue)<1e-6||!isFinite(Ve)){if(Math.abs(oe-ae)<1e-6)return this.easeTo(t,o);let ke=ae<oe?-1:1;Ve=Math.abs(Math.log(ae/oe))/re,Oe=function(){return 0},_e=function(We){return Math.exp(ke*re*We)}}t.duration="duration"in t?+t.duration:1e3*Ve/("screenSpeed"in t?+t.screenSpeed/re:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);let Ze=v!==O,Ke=P!==b,nt=!f.isPaddingEqual(F),Ce=t.retainPadding===!1?f.clone():f,qe=ke=>We=>{let Xe=We*Ve,Ge=1/_e(Xe);ke.zoom=We===1?A:g+ke.scaleZoom(Ge),Ze&&(ke.bearing=n.aa(v,O,We)),Ke&&(ke.pitch=n.aa(b,P,We)),nt&&(Ce.interpolatePadding(M,F,We),W=Ce.centerPoint.add(U));let at=We===1?X:ke.unproject(Z.add(Q.mult(Oe(Xe))).mult(Ge));return ke.setLocationAtPoint(ke.renderWorldCopies?at.wrap():at,W),ke._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),ke};if(t.preloadOnly){let ke=this._emulate(qe,t.duration,f);return this._preloadTiles(ke),this}return this._zooming=!0,this._rotating=Ze,this._pitching=Ke,this._padding=nt,this._prepareEase(o,!1),this._ease(qe(f),()=>this._afterEase(o),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,o)}if(!t){let f=this.handlers;f&&f.stop(!1)}return this}_ease(t,o,f){f.animate===!1||f.duration===0?(t(1),o()):(this._easeStart=n.q.now(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let t=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=n.bB(t,-180,180);let f=Math.abs(t-o);return Math.abs(t-360-o)<f&&(t-=360),Math.abs(t+360-o)<f&&(t+=360),t}_normalizeCenter(t){let o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;let f=t.lng-o.center.lng;t.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,f){let g=Math.ceil(15*o/1e3),v=[],b=t(f.clone());for(let M=0;M<=g;M++){let A=b(M/g);v.push(A.clone())}return v}_preloadTiles(t,o){}}class Bh{constructor(t={}){this.options=t,n.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){let o=this.options&&this.options.compact,f=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Be("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);let g=Be("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",f),this._innerContainer=Be("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));let o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){let f=o.reduce((g,v,b)=>(v.value&&(g+=`${v.key}=${v.value}${b<o.length-1?"&":""}`),g),"?");t.href=`${n.e.FEEDBACK_URL}/${f}#${eu(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){let g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}let o=this._map.style._mergedSourceCaches;for(let g in o){let v=o[g];if(v.used){let b=v.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort((g,v)=>g.length-v.length),t=t.filter((g,v)=>{for(let b=v+1;b<t.length;b++)if(t[b].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));let f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class lp{constructor(){n.aJ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Be("div","mapboxgl-ctrl");let o=Be("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(let o in t){let f=t[o].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){let t=this._container.children;if(t.length){let o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class e_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){let o=this._currentlyRunning,f=o?this._queue.concat(o):this._queue;for(let g of f)if(g.id===t)return void(g.cancelled=!0)}run(t=0){let o=this._currentlyRunning=this._queue;this._queue=[];for(let f of o)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class su{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;let o=n.cw((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,f){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+f}}let N0={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},t_=["mouseenter","mouseover","mouseleave","mouseout"];class Vh extends n.x{constructor(t,o,f,g){let{point:v,lngLat:b,originalEvent:M,target:A}=t;super(t.type,{point:v,lngLat:b,originalEvent:M,target:A}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=f,this.feature=g}}class cp{constructor(t){this.map=t,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);let{type:f,filter:g}=o;if(g){let b=n.M(g,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(b.result==="error")throw new Error(b.value.map(M=>`${M.key}: ${M.message}`).join(", "));this.filters.set(t,b.value)}let v=this.interactionsByType.get(f)||new Map;v.size===0&&(t_.includes(f)?this.map.on(f,o.featureset,this.handleType):this.map.on(f,this.handleType),this.interactionsByType.set(f,v)),v.set(t,o),this.typeById.set(t,f)}remove(t){let o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);let f=this.interactionsByType.get(o);f&&(f.delete(t),f.size===0&&this.map.off(o,this.handleType))}handleType(t){let o=this.interactionsByType.get(t.type),f=Array.from(o).reverse(),g=[];for(let[,M]of f)M.featureset&&g.push({featureset:M.featureset,filter:M.filter,radius:M.radius});let v=this.map.style.queryRenderedFeaturesForInteractions(t.point,g,this.map.transform);!v.length&&t_.includes(t.type)&&(v=[null]);let b=!1;for(let M of v){for(let[A,O]of f){let{handler:P,featureset:F}=O;if(F&&(M==null||n.bi(M.featureset,F))&&P(new Vh(t,A,O,M))!==!1){b=!0;break}}if(b)break}if(!b)for(let[M,A]of f){let{handler:O,featureset:P}=A;if(!P&&O(new Vh(t,M,A,null))!==!1)break}}}function au(h,t){if(Array.isArray(h)&&Array.isArray(t)){let o=new Set(h),f=new Set(t);return o.size===f.size&&h.every(g=>f.has(g))}return n.bi(h,t)}let Nl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1},us={showCompass:!0,showZoom:!0,visualizePitch:!1};class _o{constructor(t,o,f=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new kh({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,f&&(this.mousePitch=new Lh({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),St()}move(t,o){let f=this.map,g=this.mouseRotate.mousemoveWindow(t,o),v=g&&g.bearingDelta;if(v&&f.setBearing(f.getBearing()+v),this.mousePitch){let b=this.mousePitch.mousemoveWindow(t,o),M=b&&b.pitchDelta;M&&f.setPitch(f.getPitch()+M)}}off(){let t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_n(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(n.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ai(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,ai(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Zi(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Zi(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function hs(h,t,o){if(h=new n.bL(h.lng,h.lat),t){let f=new n.bL(h.lng-360,h.lat),g=new n.bL(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-o.center.lng)/360),b=o.locationPoint(h).distSqr(t),M=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint(f).distSqr(t)<b&&(M||Math.abs(f.lng-o.center.lng)<v)?h=f:o.locationPoint(g).distSqr(t)<b&&(M||Math.abs(g.lng-o.center.lng)<v)&&(h=g)}for(;Math.abs(h.lng-o.center.lng)>180;){let f=o.locationPoint(h);if(f.x>=0&&f.y>=0&&f.x<=o.width&&f.y<=o.height)break;h.lng>o.center.lng?h.lng-=360:h.lng+=360}return h}let ds={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class No extends n.E{constructor(t,o){if(super(),(t instanceof HTMLElement||o)&&(t=n.l({element:t},o)),n.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Be("div");let v=41,b=27,M=lt("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),A=lt("radialGradient",{id:"shadowGradient"},lt("defs",{},M));lt("stop",{offset:"10%","stop-opacity":.4},A),lt("stop",{offset:"100%","stop-opacity":.05},A),lt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),lt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),lt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),lt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=n.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});let f=this._element.classList;for(let v in ds)f.remove(`mapboxgl-marker-anchor-${v}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);let g=t&&t.className?t.className.trim().split(/\s+/):[];f.add(...g),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){let t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.bL.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){let o=t.code,f=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(t){let o=t.originalEvent.target,f=this._element;this._popup&&(o===f||f.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let t=this._map,o=this._pos;if(!t||!o)return!1;let f=t.unproject(o),g=t.getFreeCameraOptions();if(!g.position)return!1;let v=g.position.toLngLat();return v.distanceTo(f)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){let t=this._map;if(!t)return;let o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();let f=t.unproject(o),g;t._showingGlobe()&&n.dz(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(f),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let t=this._pos;if(!t||!this._map)return;let o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${ds[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){let t=this._pos,o=this._map,f=this.getPitchAlignment();if(!o||!t||f!=="map")return"";if(!o._showingGlobe()){let A=o.getPitch();return A?`rotateX(${A}deg)`:""}let g=n.c1(n.dA(o.transform,this._lngLat)),v=t.sub(n.dB(o.transform)),b=Math.abs(v.x)+Math.abs(v.y);if(b===0)return"";let M=g/b;return`rotateX(${-v.y*M}deg) rotateY(${v.x*M}deg)`}_calculateZTransform(){let t=this._pos,o=this._map;if(!o||!t)return"";let f=0,g=this.getRotationAlignment();if(g==="map")if(o._showingGlobe()){let v=o.project(new n.bL(this._lngLat.lng,this._lngLat.lat+.001)),b=o.project(new n.bL(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);f=n.c1(Math.atan2(b.y,b.x))-90}else f=-o.getBearing();else if(g==="horizon"){let v=n.a7(4,6,o.getZoom()),b=n.dB(o.transform);b.y+=v*o.transform.height;let M=t.sub(b),A=n.c1(Math.atan2(M.y,M.x));f=(A>90?A-270:A+90)*(1-v)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);let o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=hs(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){let o=this._map;if(!o)return;let f=this._pointerdownPos,g=this._positionDelta;if(f&&g){if(!this._isDragging){let v=this._clickTolerance||o._clickTolerance;if(t.point.dist(f)<v)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.x("dragstart"))),this.fire(new n.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.x("dragend")),this._state="inactive"}_addDragHandler(t){let o=this._map,f=this._pos;o&&f&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(f),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;let o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let z0={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},B0={maxWidth:100,unit:"metric"},V0={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},j0={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},n_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function er(h=new n.P(0,0),t="bottom"){if(typeof h=="number"){let o=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new n.P(0,h);case"top-left":return new n.P(o,o);case"top-right":return new n.P(-o,o);case"bottom":return new n.P(0,-h);case"bottom-left":return new n.P(o,-o);case"bottom-right":return new n.P(-o,-o);case"left":return new n.P(h,0);case"right":return new n.P(-h,0)}return new n.P(0,0)}return h instanceof n.P||Array.isArray(h)?n.P.convert(h):n.P.convert(h[t]||[0,0])}return{version:R,supported:He.supported,setRTLTextPlugin:n.dC,getRTLTextPluginStatus:n.dD,Map:class extends ap{constructor(h){$.mark(j.create);let t=h;if((h=n.l({},Nl,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&n.dx(window)&&(h.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new nh(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new e_,this._domRenderTaskQueue=new e_,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.aQ(),this._locale=n.l({},N0,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new su(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new Uu(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?bt({},h.contextCreateOptions):{},typeof h.container=="string"){let o=document.getElementById(h.container);if(!o)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=o}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),n.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Jf),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ki(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||n.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new Ah(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});let o=h.bounds;o&&(this.resize(),this.fitBounds(o,n.l({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Bh({customAttribution:h.customAttribution})),this._logoControl=new lp,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new n.x(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new n.x(`${o.dataType}dataloading`,o))}),this._interactions=new cp(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new n.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let o=h.onAdd(this);this._controls.push(h);let f=this._controlPositions[t];return t.indexOf("bottom")!==-1?f.insertBefore(o,f.firstChild):f.appendChild(o),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new n.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let t=!this._moving;return t&&this.fire(new n.x("movestart",h)).fire(new n.x("move",h)),this.fire(new n.x("resize",h)),t&&this.fire(new n.x("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(n.as.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new n.x("zoomstart")).fire(new n.x("zoom")).fire(new n.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new n.x("pitchstart")).fire(new n.x("pitch")).fire(new n.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(t=>t==="auto"?navigator.language:t):h}setLanguage(h){let t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(let o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let h=this.transform,t=h.projection.name,o;t==="globe"&&h.zoom>=n.bV?(h.setMercatorFromTransition(),o=!0):t==="mercator"&&h.zoom<n.bV&&(h.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;return t=h.name==="globe"&&this.transform.zoom>=n.bV?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h){return this.transform.locationPoint3D(n.bL.convert(h))}unproject(h){return this.transform.pointLocation3D(n.P.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,o){let f=g=>{let v=[];if(Array.isArray(t)){let b=t.filter(M=>this.getLayer(M));v=b.length?this.queryRenderedFeatures(g,{layers:b}):[]}else v=this.queryRenderedFeatures(g,{featureset:t});return v};if(h==="mouseenter"||h==="mouseover"){let g=!1;return{listener:o,targets:t,delegates:{mousemove:b=>{let M=f(b.point);M.length?g||(g=!0,o.call(this,new si(h,this,b.originalEvent,{features:M}))):g=!1},mouseout:()=>{g=!1}}}}if(h==="mouseleave"||h==="mouseout"){let g=!1;return{listener:o,targets:t,delegates:{mousemove:M=>{f(M.point).length?g=!0:g&&(g=!1,o.call(this,new si(h,this,M.originalEvent)))},mouseout:M=>{g&&(g=!1,o.call(this,new si(h,this,M.originalEvent)))}}}}{let g=v=>{let b=f(v.point);b.length&&(v.features=b,o.call(this,v),delete v.features)};return{listener:o,targets:t,delegates:{[h]:g}}}}on(h,t,o){if(typeof t=="function"||o===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let f=this._createDelegatedListener(h,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(f);for(let g in f.delegates)this.on(g,f.delegates[g]);return this}once(h,t,o){if(typeof t=="function"||o===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let f=this._createDelegatedListener(h,t,o);for(let g in f.delegates)this.once(g,f.delegates[g]);return this}off(h,t,o){if(typeof t=="function"||o===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;let f=this._delegatedListeners?this._delegatedListeners[h]:void 0;return f&&(g=>{for(let v=0;v<g.length;v++){let b=g[v];if(b.listener===o&&au(b.targets,t)){for(let M in b.delegates)this.off(M,b.delegates[M]);return g.splice(v,1),this}}})(f),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(t!==void 0||h===void 0||h instanceof n.P||Array.isArray(h)||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],"featureset"in(t=t||{}))return this._isFeaturesetDescriptorValid(t.featureset)?this.style.queryRenderedFeaturesForInteractions(h,[t],this.transform):[];if(t.layers&&Array.isArray(t.layers)){for(let o of t.layers)if(!this._isValidId(o))return[]}return this.style.queryRenderedFeatures(h,t,this.transform)}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}isPointOnSurface(h){let{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}setStyle(h,t){return t=n.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,(o,f)=>{o?(n.w(`Unable to perform style diff: ${String(o.message||o.error||o)}. Rebuilding the style from scratch.`),this._updateStyle(h,t)):f&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){let t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){let o=n.l({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new Or(this,o).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Or(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new n.t(new Error("IDs can't be empty."))),!1):!n.aK(h)||(this.fire(new n.t(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isFeaturesetDescriptorValid(h){return"featuresetId"in h?this._isValidId(h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(let t of h)if(!this._isValidId(t))return!1;return!0}return this._isFeaturesetDescriptorValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,o)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:o=1,sdf:f=!1,stretchX:g,stretchY:v,content:b}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){let{width:M,height:A,data:O}=n.q.getImageData(t);this.style.addImage(h,{data:new n.r({width:M,height:A},O),pixelRatio:o,stretchX:g,stretchY:v,content:b,sdf:f,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new n.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:M,height:A}=t,O=t;this.style.addImage(h,{data:new n.r({width:M,height:A},new Uint8Array(O.data)),pixelRatio:o,stretchX:g,stretchY:v,content:b,sdf:f,version:0,userImage:O}),O.onAdd&&O.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();let o=this.style.getImage(h);if(!o)return void this.fire(new n.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let f=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.q.getImageData(t):t,{width:g,height:v,data:b}=f;if(g===void 0||v===void 0)return void this.fire(new n.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==o.data.width||v!==o.data.height)return void this.fire(new n.t(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));let M=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);o.data.replace(b,M),this.style.updateImage(h,o)}hasImage(h){return h?!!this.style&&!!this.style.getImage(h):(this.fire(new n.t(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){n.o(this._requestManager.transformRequest(h,n.R.Image),(o,f)=>{t(o,f instanceof HTMLImageElement?n.q.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new n.t(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){let t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;let t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,o){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,o),this._update(!0)):this}setFilter(h,t,o={}){return this._isValidId(h)?(this.style.setFilter(h,t,o),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,o,f={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,o,f),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,o,f={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,o,f),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,o){return this.style.setConfigProperty(h,t,o),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){let t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.bL.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;let h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300,o,f,g,v=this._container;for(;v&&(!f||!g);){let b=window.getComputedStyle(v).transform;b&&b!=="none"&&(o=b.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(f=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(g=o[3])),v=v.parentElement}this._containerWidth=f?Math.abs(h/f):h,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Be("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();let t=this._canvasContainer=Be("div","mapboxgl-canvas-container",h);this._canvas=Be("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let o=this._controlContainer=Be("div","mapboxgl-control-container",h),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{f[g]=Be("div",`mapboxgl-ctrl-${g}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){let o=n.q.devicePixelRatio||1;this._canvas.width=o*Math.ceil(h),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){let t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){let t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){let h=n.l({},He.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(As(t,!0),this.painter=new Vs(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.m.testSupport(t)):this.fire(new n.t(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.x("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new n.x("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new n.x("renderstart")),++this._frameId;let o=this.painter.context.extTimerQuery,f=n.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=g.createQuery(),g.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();let v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let O=this.transform.zoom,P=this.transform.pitch,F=n.q.now(),z=new n.a3(O,{now:F,fadeDuration:v,pitch:P,transition:this.style.transition});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(f);let M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,$.mark(j.load),this.fire(new n.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){let O=n.q.now()-f;g.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{let P=g.getQueryParameter(t,g.QUERY_RESULT)/1e6;g.deleteQuery(t),this.fire(new n.x("gpu-timing-frame",{cpuTime:O,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){let O=this.painter.collectGpuTimers();setTimeout(()=>{let P=this.painter.queryGpuTimers(O);this.fire(new n.x("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){let O=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let P=this.painter.queryGpuTimeDeferredRender(O);this.fire(new n.x("gpu-timing-deferred-render",{gpuTime:P}))},50)}let A=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(A||this._repaint)this.triggerRepaint();else{let O=this.idle();if(O&&(b=this._updateAverageElevation(f,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new n.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let P=this._calculateSpeedIndex();this.fire(new n.x("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,$.mark(j.fullLoad),this._performanceMetricsCollection&&wc(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(let t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(let t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){let o=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);let f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){let g=this.transform.averageElevation,v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=h;let b=Math.abs(g-v);if(b>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(v),o(v);this._averageElevation.easeTo(v,h,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),o(v)}return!!this._averageElevation.isEasing(h)&&o(this._averageElevation.getValue(h))}_authenticate(){Ee(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===Ss||h.status===401)){let t=this.painter.context.gl;As(t,!1),this._logoControl instanceof lp&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),bc(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Zr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){let h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());let o=this.painter.context.gl,f=o.createFramebuffer();function g(v){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,v,0);let b=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,b),b}return o.bindFramebuffer(o.FRAMEBUFFER,f),this._canvasPixelComparison(g(h),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(h,t,o){let f=o[1]-o[0],g=h.length/4;for(let v=0;v<t.length;v++){let b=t[v],M=0;for(let A=0;A<b.length;A+=4)b[A]===h[A]&&b[A+1]===h[A+1]&&b[A+2]===h[A+2]&&b[A+3]===h[A+3]&&(M+=1);f+=(o[v+2]-o[v+1])*(1-M/g)}return f}remove(){this._hash&&this._hash.remove();for(let t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ko.delete(this.painter.context.gl),la.remove(),Wt.remove(),this._removed=!0,this.fire(new n.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=n.q.frame(t=>{let o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)}))}_preloadTiles(h){let t=this.style?this.style.getSourceCaches():[];return n.bg(t,(o,f)=>o._preloadTiles(h,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,t){n.dy(h,t)}get version(){return R}},NavigationControl:class{constructor(h={}){this.options=n.l({},us,h),this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Be("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Be("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{let o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))}),this._compassIcon=Be("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let h=this._map;if(!h)return;let t=h.getZoom(),o=t===h.getMaxZoom(),f=t===h.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){let h=this._map;if(!h)return;let t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new _o(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){let h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){let o=Be("button",h,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(h,t){if(!this._map)return;let o=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",o),h.firstElementChild&&h.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends n.E{constructor(h={}){super();let t=navigator.geolocation;this.options=n.l({geolocation:t},z0,h),n.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ls(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){let t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,h(o)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>t(o.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(h){let t=this._map.getMaxBounds(),o=h.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new n.x("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("geolocate",h)),this._finish()}}_updateCamera(h){let t=new n.bL(h.coords.longitude,h.coords.latitude),o=h.coords.accuracy,f=this._map.getBearing(),g=n.l({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),g,{geolocateSource:!0})}_updateMarker(h){if(h){let t=new n.bL(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let h=this._map.transform,t=n.bE(1,h._center.lat)*h.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.x("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Be("button","mapboxgl-ctrl-geolocate",this._container),Be("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{let t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Be("div","mapboxgl-user-location"),this._dotElement.appendChild(Be("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Be("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new No({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Be("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new No({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.x("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Bh,ScaleControl:class{constructor(h={}){this.options=n.l({},B0,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let h=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,f=t._containerWidth/2-h/2,g=t.unproject([f,o]),v=t.unproject([f+h,o]),b=g.distanceTo(v);if(this.options.unit==="imperial"){let M=3.2808*b;M>5280?this._setScale(h,M/5280,"mile"):this._setScale(h,M,"foot")}else this.options.unit==="nautical"?this._setScale(h,b/1852,"nautical-mile"):b>=1e3?this._setScale(h,b/1e3,"kilometer"):this._setScale(h,b,"meter")}_setScale(h,t,o){this._map._requestDomTask(()=>{let f=function(v){let b=Math.pow(10,`${Math.floor(v)}`.length-1),M=v/b;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(A){let O=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*O)/O}(M),b*M}(t),g=f/t;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(f):`${f}&nbsp;${V0[o]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=Be("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:n.w("Full screen control 'container' must be a DOM element.")),n.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Be("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let h=this._fullscreenButton=Be("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Be("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(h){super(),this.options=n.l(Object.create(j0),h),n.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new n.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new n.x("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=n.bL.convert(h),this._pos=null,this._trackPointer=!1,this._update();let t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){let t=document.createDocumentFragment(),o=document.createElement("body"),f;for(o.innerHTML=h;f=o.firstChild,f;)t.appendChild(f);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Be("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){let o=this._closeButton=Be("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;let t=this._map,o=this._container,f=this._pos;if(!t||!o||!f)return"bottom";let g=o.offsetWidth,v=o.offsetHeight,b=f.x<g/2,M=f.x>t.transform.width-g/2;if(f.y+h<v)return b?"top-left":M?"top-right":"top";if(f.y>t.transform.height-v){if(b)return"bottom-left";if(M)return"bottom-right"}return b?"left":M?"right":"bottom"}_updateClassList(){let h=this._container;if(!h)return;let t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){let t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let f=this._container;if(f||(f=this._container=Be("div","mapboxgl-popup",t.getContainer()),this._tip=Be("div","mapboxgl-popup-tip",f),f.appendChild(o)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hs(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){let g=this._pos=this._trackPointer&&h instanceof n.P?h:t.project(this._lngLat),v=er(this.options.offset),b=this._anchor=this._getAnchor(v.y),M=er(this.options.offset,b),A=g.add(M).round();t._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${ds[b]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._showingGlobe()){let g=n.dz(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let h=this._container.querySelector(n_);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:No,Style:Or,LngLat:n.bL,LngLatBounds:n.as,Point:n.P,MercatorCoordinate:n.a5,FreeCameraOptions:Ls,Evented:n.E,config:n.e,prewarm:n.dE,clearPrewarmedResources:n.dF,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(h){n.e.ACCESS_TOKEN=h},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(h){n.e.API_URL=h},get workerCount(){return n.dG.workerCount},set workerCount(h){n.dG.workerCount=h},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){n.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){n.dH(h)},get workerUrl(){return n.dI.workerUrl},set workerUrl(h){n.dI.workerUrl=h},get workerClass(){return n.dI.workerClass},set workerClass(h){n.dI.workerClass=h},get workerParams(){return n.dI.workerParams},set workerParams(h){n.dI.workerParams=h},get dracoUrl(){return n.dJ()},set dracoUrl(h){n.dK(h)},get meshoptUrl(){return n.dL()},set meshoptUrl(h){n.dM(h)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var y=a;return y})});function _D(r,s){return Object.is(r,s)}var ir=null,q_=!1,W_=1,Aa=Symbol("SIGNAL");function oi(r){let s=ir;return ir=r,s}function yD(){return ir}var Wp={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function ob(r){if(q_)throw new Error("");if(ir===null)return;ir.consumerOnSignalRead(r);let s=ir.nextProducerIndex++;if(J_(ir),s<ir.producerNode.length&&ir.producerNode[s]!==r&&qp(ir)){let a=ir.producerNode[s];Y_(a,ir.producerIndexOfThis[s])}ir.producerNode[s]!==r&&(ir.producerNode[s]=r,ir.producerIndexOfThis[s]=qp(ir)?wD(r,ir,s):0),ir.producerLastReadVersion[s]=r.version}function WL(){W_++}function vD(r){if(!(qp(r)&&!r.dirty)&&!(!r.dirty&&r.lastCleanEpoch===W_)){if(!r.producerMustRecompute(r)&&!ab(r)){r.dirty=!1,r.lastCleanEpoch=W_;return}r.producerRecomputeValue(r),r.dirty=!1,r.lastCleanEpoch=W_}}function xD(r){if(r.liveConsumerNode===void 0)return;let s=q_;q_=!0;try{for(let a of r.liveConsumerNode)a.dirty||ZL(a)}finally{q_=s}}function bD(){return ir?.consumerAllowSignalWrites!==!1}function ZL(r){r.dirty=!0,xD(r),r.consumerMarkedDirty?.(r)}function X_(r){return r&&(r.nextProducerIndex=0),oi(r)}function sb(r,s){if(oi(s),!(!r||r.producerNode===void 0||r.producerIndexOfThis===void 0||r.producerLastReadVersion===void 0)){if(qp(r))for(let a=r.nextProducerIndex;a<r.producerNode.length;a++)Y_(r.producerNode[a],r.producerIndexOfThis[a]);for(;r.producerNode.length>r.nextProducerIndex;)r.producerNode.pop(),r.producerLastReadVersion.pop(),r.producerIndexOfThis.pop()}}function ab(r){J_(r);for(let s=0;s<r.producerNode.length;s++){let a=r.producerNode[s],d=r.producerLastReadVersion[s];if(d!==a.version||(vD(a),d!==a.version))return!0}return!1}function lb(r){if(J_(r),qp(r))for(let s=0;s<r.producerNode.length;s++)Y_(r.producerNode[s],r.producerIndexOfThis[s]);r.producerNode.length=r.producerLastReadVersion.length=r.producerIndexOfThis.length=0,r.liveConsumerNode&&(r.liveConsumerNode.length=r.liveConsumerIndexOfThis.length=0)}function wD(r,s,a){if(ED(r),r.liveConsumerNode.length===0&&ID(r))for(let d=0;d<r.producerNode.length;d++)r.producerIndexOfThis[d]=wD(r.producerNode[d],r,d);return r.liveConsumerIndexOfThis.push(a),r.liveConsumerNode.push(s)-1}function Y_(r,s){if(ED(r),r.liveConsumerNode.length===1&&ID(r))for(let d=0;d<r.producerNode.length;d++)Y_(r.producerNode[d],r.producerIndexOfThis[d]);let a=r.liveConsumerNode.length-1;if(r.liveConsumerNode[s]=r.liveConsumerNode[a],r.liveConsumerIndexOfThis[s]=r.liveConsumerIndexOfThis[a],r.liveConsumerNode.length--,r.liveConsumerIndexOfThis.length--,s<r.liveConsumerNode.length){let d=r.liveConsumerIndexOfThis[s],y=r.liveConsumerNode[s];J_(y),y.producerIndexOfThis[d]=s}}function qp(r){return r.consumerIsAlwaysLive||(r?.liveConsumerNode?.length??0)>0}function J_(r){r.producerNode??=[],r.producerIndexOfThis??=[],r.producerLastReadVersion??=[]}function ED(r){r.liveConsumerNode??=[],r.liveConsumerIndexOfThis??=[]}function ID(r){return r.producerNode!==void 0}function TD(r){let s=Object.create(XL);s.computation=r;let a=()=>{if(vD(s),ob(s),s.value===Z_)throw s.error;return s.value};return a[Aa]=s,a}var ib=Symbol("UNSET"),rb=Symbol("COMPUTING"),Z_=Symbol("ERRORED"),XL=Un(bt({},Wp),{value:ib,dirty:!0,error:null,equal:_D,producerMustRecompute(r){return r.value===ib||r.value===rb},producerRecomputeValue(r){if(r.value===rb)throw new Error("Detected cycle in computations.");let s=r.value;r.value=rb;let a=X_(r),d;try{d=r.computation()}catch(y){d=Z_,r.error=y}finally{sb(r,a)}if(s!==ib&&s!==Z_&&d!==Z_&&r.equal(s,d)){r.value=s;return}r.value=d,r.version++}});function YL(){throw new Error}var CD=YL;function DD(){CD()}function MD(r){CD=r}var JL=null;function SD(r){let s=Object.create(RD);s.value=r;let a=()=>(ob(s),s.value);return a[Aa]=s,a}function cb(r,s){bD()||DD(),r.equal(r.value,s)||(r.value=s,KL(r))}function AD(r,s){bD()||DD(),cb(r,s(r.value))}var RD=Un(bt({},Wp),{equal:_D,value:void 0});function KL(r){r.version++,WL(),xD(r),JL?.()}function Mn(r){return typeof r=="function"}function ed(r){let a=r(d=>{Error.call(d),d.stack=new Error().stack});return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}var K_=ed(r=>function(a){r(this),this.message=a?`${a.length} errors occurred during unsubscription:
${a.map((d,y)=>`${y+1}) ${d.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=a});function yu(r,s){if(r){let a=r.indexOf(s);0<=a&&r.splice(a,1)}}var Oi=class r{constructor(s){this.initialTeardown=s,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let s;if(!this.closed){this.closed=!0;let{_parentage:a}=this;if(a)if(this._parentage=null,Array.isArray(a))for(let n of a)n.remove(this);else a.remove(this);let{initialTeardown:d}=this;if(Mn(d))try{d()}catch(n){s=n instanceof K_?n.errors:[n]}let{_finalizers:y}=this;if(y){this._finalizers=null;for(let n of y)try{PD(n)}catch(R){s=s??[],R instanceof K_?s=[...s,...R.errors]:s.push(R)}}if(s)throw new K_(s)}}add(s){var a;if(s&&s!==this)if(this.closed)PD(s);else{if(s instanceof r){if(s.closed||s._hasParent(this))return;s._addParent(this)}(this._finalizers=(a=this._finalizers)!==null&&a!==void 0?a:[]).push(s)}}_hasParent(s){let{_parentage:a}=this;return a===s||Array.isArray(a)&&a.includes(s)}_addParent(s){let{_parentage:a}=this;this._parentage=Array.isArray(a)?(a.push(s),a):a?[a,s]:s}_removeParent(s){let{_parentage:a}=this;a===s?this._parentage=null:Array.isArray(a)&&yu(a,s)}remove(s){let{_finalizers:a}=this;a&&yu(a,s),s instanceof r&&s._removeParent(this)}};Oi.EMPTY=(()=>{let r=new Oi;return r.closed=!0,r})();var ub=Oi.EMPTY;function Q_(r){return r instanceof Oi||r&&"closed"in r&&Mn(r.remove)&&Mn(r.add)&&Mn(r.unsubscribe)}function PD(r){Mn(r)?r():r.unsubscribe()}var xs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var td={setTimeout(r,s,...a){let{delegate:d}=td;return d?.setTimeout?d.setTimeout(r,s,...a):setTimeout(r,s,...a)},clearTimeout(r){let{delegate:s}=td;return(s?.clearTimeout||clearTimeout)(r)},delegate:void 0};function ey(r){td.setTimeout(()=>{let{onUnhandledError:s}=xs;if(s)s(r);else throw r})}function Zp(){}var OD=hb("C",void 0,void 0);function kD(r){return hb("E",void 0,r)}function LD(r){return hb("N",r,void 0)}function hb(r,s,a){return{kind:r,value:s,error:a}}var vu=null;function nd(r){if(xs.useDeprecatedSynchronousErrorHandling){let s=!vu;if(s&&(vu={errorThrown:!1,error:null}),r(),s){let{errorThrown:a,error:d}=vu;if(vu=null,a)throw d}}else r()}function FD(r){xs.useDeprecatedSynchronousErrorHandling&&vu&&(vu.errorThrown=!0,vu.error=r)}var xu=class extends Oi{constructor(s){super(),this.isStopped=!1,s?(this.destination=s,Q_(s)&&s.add(this)):this.destination=tF}static create(s,a,d){return new bs(s,a,d)}next(s){this.isStopped?fb(LD(s),this):this._next(s)}error(s){this.isStopped?fb(kD(s),this):(this.isStopped=!0,this._error(s))}complete(){this.isStopped?fb(OD,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(s){this.destination.next(s)}_error(s){try{this.destination.error(s)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},QL=Function.prototype.bind;function db(r,s){return QL.call(r,s)}var pb=class{constructor(s){this.partialObserver=s}next(s){let{partialObserver:a}=this;if(a.next)try{a.next(s)}catch(d){ty(d)}}error(s){let{partialObserver:a}=this;if(a.error)try{a.error(s)}catch(d){ty(d)}else ty(s)}complete(){let{partialObserver:s}=this;if(s.complete)try{s.complete()}catch(a){ty(a)}}},bs=class extends xu{constructor(s,a,d){super();let y;if(Mn(s)||!s)y={next:s??void 0,error:a??void 0,complete:d??void 0};else{let n;this&&xs.useDeprecatedNextContext?(n=Object.create(s),n.unsubscribe=()=>this.unsubscribe(),y={next:s.next&&db(s.next,n),error:s.error&&db(s.error,n),complete:s.complete&&db(s.complete,n)}):y=s}this.destination=new pb(y)}};function ty(r){xs.useDeprecatedSynchronousErrorHandling?FD(r):ey(r)}function eF(r){throw r}function fb(r,s){let{onStoppedNotification:a}=xs;a&&td.setTimeout(()=>a(r,s))}var tF={closed:!0,next:Zp,error:eF,complete:Zp};var id=typeof Symbol=="function"&&Symbol.observable||"@@observable";function bo(r){return r}function mb(...r){return gb(r)}function gb(r){return r.length===0?bo:r.length===1?r[0]:function(a){return r.reduce((d,y)=>y(d),a)}}var Xn=(()=>{class r{constructor(a){a&&(this._subscribe=a)}lift(a){let d=new r;return d.source=this,d.operator=a,d}subscribe(a,d,y){let n=iF(a)?a:new bs(a,d,y);return nd(()=>{let{operator:R,source:j}=this;n.add(R?R.call(n,j):j?this._subscribe(n):this._trySubscribe(n))}),n}_trySubscribe(a){try{return this._subscribe(a)}catch(d){a.error(d)}}forEach(a,d){return d=ND(d),new d((y,n)=>{let R=new bs({next:j=>{try{a(j)}catch($){n($),R.unsubscribe()}},error:n,complete:y});this.subscribe(R)})}_subscribe(a){var d;return(d=this.source)===null||d===void 0?void 0:d.subscribe(a)}[id](){return this}pipe(...a){return gb(a)(this)}toPromise(a){return a=ND(a),new a((d,y)=>{let n;this.subscribe(R=>n=R,R=>y(R),()=>d(n))})}}return r.create=s=>new r(s),r})();function ND(r){var s;return(s=r??xs.Promise)!==null&&s!==void 0?s:Promise}function nF(r){return r&&Mn(r.next)&&Mn(r.error)&&Mn(r.complete)}function iF(r){return r&&r instanceof xu||nF(r)&&Q_(r)}function _b(r){return Mn(r?.lift)}function $n(r){return s=>{if(_b(s))return s.lift(function(a){try{return r(a,this)}catch(d){this.error(d)}});throw new TypeError("Unable to lift unknown Observable type")}}function Gn(r,s,a,d,y){return new yb(r,s,a,d,y)}var yb=class extends xu{constructor(s,a,d,y,n,R){super(s),this.onFinalize=n,this.shouldUnsubscribe=R,this._next=a?function(j){try{a(j)}catch($){s.error($)}}:super._next,this._error=y?function(j){try{y(j)}catch($){s.error($)}finally{this.unsubscribe()}}:super._error,this._complete=d?function(){try{d()}catch(j){s.error(j)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var s;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:a}=this;super.unsubscribe(),!a&&((s=this.onFinalize)===null||s===void 0||s.call(this))}}};function rd(){return $n((r,s)=>{let a=null;r._refCount++;let d=Gn(s,void 0,void 0,void 0,()=>{if(!r||r._refCount<=0||0<--r._refCount){a=null;return}let y=r._connection,n=a;a=null,y&&(!n||y===n)&&y.unsubscribe(),s.unsubscribe()});r.subscribe(d),d.closed||(a=r.connect())})}var od=class extends Xn{constructor(s,a){super(),this.source=s,this.subjectFactory=a,this._subject=null,this._refCount=0,this._connection=null,_b(s)&&(this.lift=s.lift)}_subscribe(s){return this.getSubject().subscribe(s)}getSubject(){let s=this._subject;return(!s||s.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:s}=this;this._subject=this._connection=null,s?.unsubscribe()}connect(){let s=this._connection;if(!s){s=this._connection=new Oi;let a=this.getSubject();s.add(this.source.subscribe(Gn(a,void 0,()=>{this._teardown(),a.complete()},d=>{this._teardown(),a.error(d)},()=>this._teardown()))),s.closed&&(this._connection=null,s=Oi.EMPTY)}return s}refCount(){return rd()(this)}};var zD=ed(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Gi=(()=>{class r extends Xn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(a){let d=new ny(this,this);return d.operator=a,d}_throwIfClosed(){if(this.closed)throw new zD}next(a){nd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let d of this.currentObservers)d.next(a)}})}error(a){nd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=a;let{observers:d}=this;for(;d.length;)d.shift().error(a)}})}complete(){nd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:a}=this;for(;a.length;)a.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var a;return((a=this.observers)===null||a===void 0?void 0:a.length)>0}_trySubscribe(a){return this._throwIfClosed(),super._trySubscribe(a)}_subscribe(a){return this._throwIfClosed(),this._checkFinalizedStatuses(a),this._innerSubscribe(a)}_innerSubscribe(a){let{hasError:d,isStopped:y,observers:n}=this;return d||y?ub:(this.currentObservers=null,n.push(a),new Oi(()=>{this.currentObservers=null,yu(n,a)}))}_checkFinalizedStatuses(a){let{hasError:d,thrownError:y,isStopped:n}=this;d?a.error(y):n&&a.complete()}asObservable(){let a=new Xn;return a.source=this,a}}return r.create=(s,a)=>new ny(s,a),r})(),ny=class extends Gi{constructor(s,a){super(),this.destination=s,this.source=a}next(s){var a,d;(d=(a=this.destination)===null||a===void 0?void 0:a.next)===null||d===void 0||d.call(a,s)}error(s){var a,d;(d=(a=this.destination)===null||a===void 0?void 0:a.error)===null||d===void 0||d.call(a,s)}complete(){var s,a;(a=(s=this.destination)===null||s===void 0?void 0:s.complete)===null||a===void 0||a.call(s)}_subscribe(s){var a,d;return(d=(a=this.source)===null||a===void 0?void 0:a.subscribe(s))!==null&&d!==void 0?d:ub}};var _r=class extends Gi{constructor(s){super(),this._value=s}get value(){return this.getValue()}_subscribe(s){let a=super._subscribe(s);return!a.closed&&s.next(this._value),a}getValue(){let{hasError:s,thrownError:a,_value:d}=this;if(s)throw a;return this._throwIfClosed(),d}next(s){super.next(this._value=s)}};var vb={now(){return(vb.delegate||Date).now()},delegate:void 0};var iy=class extends Oi{constructor(s,a){super()}schedule(s,a=0){return this}};var Xp={setInterval(r,s,...a){let{delegate:d}=Xp;return d?.setInterval?d.setInterval(r,s,...a):setInterval(r,s,...a)},clearInterval(r){let{delegate:s}=Xp;return(s?.clearInterval||clearInterval)(r)},delegate:void 0};var ry=class extends iy{constructor(s,a){super(s,a),this.scheduler=s,this.work=a,this.pending=!1}schedule(s,a=0){var d;if(this.closed)return this;this.state=s;let y=this.id,n=this.scheduler;return y!=null&&(this.id=this.recycleAsyncId(n,y,a)),this.pending=!0,this.delay=a,this.id=(d=this.id)!==null&&d!==void 0?d:this.requestAsyncId(n,this.id,a),this}requestAsyncId(s,a,d=0){return Xp.setInterval(s.flush.bind(s,this),d)}recycleAsyncId(s,a,d=0){if(d!=null&&this.delay===d&&this.pending===!1)return a;a!=null&&Xp.clearInterval(a)}execute(s,a){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let d=this._execute(s,a);if(d)return d;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(s,a){let d=!1,y;try{this.work(s)}catch(n){d=!0,y=n||new Error("Scheduled action threw falsy error")}if(d)return this.unsubscribe(),y}unsubscribe(){if(!this.closed){let{id:s,scheduler:a}=this,{actions:d}=a;this.work=this.state=this.scheduler=null,this.pending=!1,yu(d,this),s!=null&&(this.id=this.recycleAsyncId(a,s,null)),this.delay=null,super.unsubscribe()}}};var sd=class r{constructor(s,a=r.now){this.schedulerActionCtor=s,this.now=a}schedule(s,a=0,d){return new this.schedulerActionCtor(this,s).schedule(d,a)}};sd.now=vb.now;var oy=class extends sd{constructor(s,a=sd.now){super(s,a),this.actions=[],this._active=!1}flush(s){let{actions:a}=this;if(this._active){a.push(s);return}let d;this._active=!0;do if(d=s.execute(s.state,s.delay))break;while(s=a.shift());if(this._active=!1,d){for(;s=a.shift();)s.unsubscribe();throw d}}};var BD=new oy(ry);var wo=new Xn(r=>r.complete());function VD(r){return r&&Mn(r.schedule)}function jD(r){return r[r.length-1]}function sy(r){return Mn(jD(r))?r.pop():void 0}function Yl(r){return VD(jD(r))?r.pop():void 0}function $D(r,s,a,d){function y(n){return n instanceof a?n:new a(function(R){R(n)})}return new(a||(a=Promise))(function(n,R){function j(pe){try{ie(d.next(pe))}catch(Me){R(Me)}}function $(pe){try{ie(d.throw(pe))}catch(Me){R(Me)}}function ie(pe){pe.done?n(pe.value):y(pe.value).then(j,$)}ie((d=d.apply(r,s||[])).next())})}function UD(r){var s=typeof Symbol=="function"&&Symbol.iterator,a=s&&r[s],d=0;if(a)return a.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&d>=r.length&&(r=void 0),{value:r&&r[d++],done:!r}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function bu(r){return this instanceof bu?(this.v=r,this):new bu(r)}function GD(r,s,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=a.apply(r,s||[]),y,n=[];return y=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),j("next"),j("throw"),j("return",R),y[Symbol.asyncIterator]=function(){return this},y;function R(Be){return function(lt){return Promise.resolve(lt).then(Be,Me)}}function j(Be,lt){d[Be]&&(y[Be]=function(rt){return new Promise(function(At,Kt){n.push([Be,rt,At,Kt])>1||$(Be,rt)})},lt&&(y[Be]=lt(y[Be])))}function $(Be,lt){try{ie(d[Be](lt))}catch(rt){He(n[0][3],rt)}}function ie(Be){Be.value instanceof bu?Promise.resolve(Be.value.v).then(pe,Me):He(n[0][2],Be)}function pe(Be){$("next",Be)}function Me(Be){$("throw",Be)}function He(Be,lt){Be(lt),n.shift(),n.length&&$(n[0][0],n[0][1])}}function HD(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r[Symbol.asyncIterator],a;return s?s.call(r):(r=typeof UD=="function"?UD(r):r[Symbol.iterator](),a={},d("next"),d("throw"),d("return"),a[Symbol.asyncIterator]=function(){return this},a);function d(n){a[n]=r[n]&&function(R){return new Promise(function(j,$){R=r[n](R),y(j,$,R.done,R.value)})}}function y(n,R,j,$){Promise.resolve($).then(function(ie){n({value:ie,done:j})},R)}}var ay=r=>r&&typeof r.length=="number"&&typeof r!="function";function ly(r){return Mn(r?.then)}function cy(r){return Mn(r[id])}function uy(r){return Symbol.asyncIterator&&Mn(r?.[Symbol.asyncIterator])}function hy(r){return new TypeError(`You provided ${r!==null&&typeof r=="object"?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function rF(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var dy=rF();function fy(r){return Mn(r?.[dy])}function py(r){return GD(this,arguments,function*(){let a=r.getReader();try{for(;;){let{value:d,done:y}=yield bu(a.read());if(y)return yield bu(void 0);yield yield bu(d)}}finally{a.releaseLock()}})}function my(r){return Mn(r?.getReader)}function Ni(r){if(r instanceof Xn)return r;if(r!=null){if(cy(r))return oF(r);if(ay(r))return sF(r);if(ly(r))return aF(r);if(uy(r))return qD(r);if(fy(r))return lF(r);if(my(r))return cF(r)}throw hy(r)}function oF(r){return new Xn(s=>{let a=r[id]();if(Mn(a.subscribe))return a.subscribe(s);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function sF(r){return new Xn(s=>{for(let a=0;a<r.length&&!s.closed;a++)s.next(r[a]);s.complete()})}function aF(r){return new Xn(s=>{r.then(a=>{s.closed||(s.next(a),s.complete())},a=>s.error(a)).then(null,ey)})}function lF(r){return new Xn(s=>{for(let a of r)if(s.next(a),s.closed)return;s.complete()})}function qD(r){return new Xn(s=>{uF(r,s).catch(a=>s.error(a))})}function cF(r){return qD(py(r))}function uF(r,s){var a,d,y,n;return $D(this,void 0,void 0,function*(){try{for(a=HD(r);d=yield a.next(),!d.done;){let R=d.value;if(s.next(R),s.closed)return}}catch(R){y={error:R}}finally{try{d&&!d.done&&(n=a.return)&&(yield n.call(a))}finally{if(y)throw y.error}}s.complete()})}function io(r,s,a,d=0,y=!1){let n=s.schedule(function(){a(),y?r.add(this.schedule(null,d)):this.unsubscribe()},d);if(r.add(n),!y)return n}function gy(r,s=0){return $n((a,d)=>{a.subscribe(Gn(d,y=>io(d,r,()=>d.next(y),s),()=>io(d,r,()=>d.complete(),s),y=>io(d,r,()=>d.error(y),s)))})}function _y(r,s=0){return $n((a,d)=>{d.add(r.schedule(()=>a.subscribe(d),s))})}function WD(r,s){return Ni(r).pipe(_y(s),gy(s))}function ZD(r,s){return Ni(r).pipe(_y(s),gy(s))}function XD(r,s){return new Xn(a=>{let d=0;return s.schedule(function(){d===r.length?a.complete():(a.next(r[d++]),a.closed||this.schedule())})})}function YD(r,s){return new Xn(a=>{let d;return io(a,s,()=>{d=r[dy](),io(a,s,()=>{let y,n;try{({value:y,done:n}=d.next())}catch(R){a.error(R);return}n?a.complete():a.next(y)},0,!0)}),()=>Mn(d?.return)&&d.return()})}function yy(r,s){if(!r)throw new Error("Iterable cannot be null");return new Xn(a=>{io(a,s,()=>{let d=r[Symbol.asyncIterator]();io(a,s,()=>{d.next().then(y=>{y.done?a.complete():a.next(y.value)})},0,!0)})})}function JD(r,s){return yy(py(r),s)}function KD(r,s){if(r!=null){if(cy(r))return WD(r,s);if(ay(r))return XD(r,s);if(ly(r))return ZD(r,s);if(uy(r))return yy(r,s);if(fy(r))return YD(r,s);if(my(r))return JD(r,s)}throw hy(r)}function zi(r,s){return s?KD(r,s):Ni(r)}function hn(...r){let s=Yl(r);return zi(r,s)}function Jl(r,s){let a=Mn(r)?r:()=>r,d=y=>y.error(a());return new Xn(s?y=>s.schedule(d,0,y):d)}function xb(r){return!!r&&(r instanceof Xn||Mn(r.lift)&&Mn(r.subscribe))}var ws=ed(r=>function(){r(this),this.name="EmptyError",this.message="no elements in sequence"});function Yp(r,s){let a=typeof s=="object";return new Promise((d,y)=>{let n=new bs({next:R=>{d(R),n.unsubscribe()},error:y,complete:()=>{a?d(s.defaultValue):y(new ws)}});r.subscribe(n)})}function an(r,s){return $n((a,d)=>{let y=0;a.subscribe(Gn(d,n=>{d.next(r.call(s,n,y++))}))})}var{isArray:hF}=Array;function dF(r,s){return hF(s)?r(...s):r(s)}function vy(r){return an(s=>dF(r,s))}var{isArray:fF}=Array,{getPrototypeOf:pF,prototype:mF,keys:gF}=Object;function xy(r){if(r.length===1){let s=r[0];if(fF(s))return{args:s,keys:null};if(_F(s)){let a=gF(s);return{args:a.map(d=>s[d]),keys:a}}}return{args:r,keys:null}}function _F(r){return r&&typeof r=="object"&&pF(r)===mF}function by(r,s){return r.reduce((a,d,y)=>(a[d]=s[y],a),{})}function ad(...r){let s=Yl(r),a=sy(r),{args:d,keys:y}=xy(r);if(d.length===0)return zi([],s);let n=new Xn(yF(d,s,y?R=>by(y,R):bo));return a?n.pipe(vy(a)):n}function yF(r,s,a=bo){return d=>{QD(s,()=>{let{length:y}=r,n=new Array(y),R=y,j=y;for(let $=0;$<y;$++)QD(s,()=>{let ie=zi(r[$],s),pe=!1;ie.subscribe(Gn(d,Me=>{n[$]=Me,pe||(pe=!0,j--),j||d.next(a(n.slice()))},()=>{--R||d.complete()}))},d)},d)}}function QD(r,s,a){r?io(a,r,s):s()}function eM(r,s,a,d,y,n,R,j){let $=[],ie=0,pe=0,Me=!1,He=()=>{Me&&!$.length&&!ie&&s.complete()},Be=rt=>ie<d?lt(rt):$.push(rt),lt=rt=>{n&&s.next(rt),ie++;let At=!1;Ni(a(rt,pe++)).subscribe(Gn(s,Kt=>{y?.(Kt),n?Be(Kt):s.next(Kt)},()=>{At=!0},void 0,()=>{if(At)try{for(ie--;$.length&&ie<d;){let Kt=$.shift();R?io(s,R,()=>lt(Kt)):lt(Kt)}He()}catch(Kt){s.error(Kt)}}))};return r.subscribe(Gn(s,Be,()=>{Me=!0,He()})),()=>{j?.()}}function rr(r,s,a=1/0){return Mn(s)?rr((d,y)=>an((n,R)=>s(d,n,y,R))(Ni(r(d,y))),a):(typeof s=="number"&&(a=s),$n((d,y)=>eM(d,y,r,a)))}function bb(r=1/0){return rr(bo,r)}function tM(){return bb(1)}function Kl(...r){return tM()(zi(r,Yl(r)))}function wy(r){return new Xn(s=>{Ni(r()).subscribe(s)})}function Jp(...r){let s=sy(r),{args:a,keys:d}=xy(r),y=new Xn(n=>{let{length:R}=a;if(!R){n.complete();return}let j=new Array(R),$=R,ie=R;for(let pe=0;pe<R;pe++){let Me=!1;Ni(a[pe]).subscribe(Gn(n,He=>{Me||(Me=!0,ie--),j[pe]=He},()=>$--,void 0,()=>{(!$||!Me)&&(ie||n.next(d?by(d,j):j),n.complete())}))}});return s?y.pipe(vy(s)):y}function Br(r,s){return $n((a,d)=>{let y=0;a.subscribe(Gn(d,n=>r.call(s,n,y++)&&d.next(n)))})}function Hs(r){return $n((s,a)=>{let d=null,y=!1,n;d=s.subscribe(Gn(a,void 0,void 0,R=>{n=Ni(r(R,Hs(r)(s))),d?(d.unsubscribe(),d=null,n.subscribe(a)):y=!0})),y&&(d.unsubscribe(),d=null,n.subscribe(a))})}function nM(r,s,a,d,y){return(n,R)=>{let j=a,$=s,ie=0;n.subscribe(Gn(R,pe=>{let Me=ie++;$=j?r($,pe,Me):(j=!0,pe),d&&R.next($)},y&&(()=>{j&&R.next($),R.complete()})))}}function Ql(r,s){return Mn(s)?rr(r,s,1):rr(r,1)}function wb(r,s=BD){return $n((a,d)=>{let y=null,n=null,R=null,j=()=>{if(y){y.unsubscribe(),y=null;let ie=n;n=null,d.next(ie)}};function $(){let ie=R+r,pe=s.now();if(pe<ie){y=this.schedule(void 0,ie-pe),d.add(y);return}j()}a.subscribe(Gn(d,ie=>{n=ie,R=s.now(),y||(y=s.schedule($,r),d.add(y))},()=>{j(),d.complete()},void 0,()=>{n=y=null}))})}function ec(r){return $n((s,a)=>{let d=!1;s.subscribe(Gn(a,y=>{d=!0,a.next(y)},()=>{d||a.next(r),a.complete()}))})}function Eo(r){return r<=0?()=>wo:$n((s,a)=>{let d=0;s.subscribe(Gn(a,y=>{++d<=r&&(a.next(y),r<=d&&a.complete())}))})}function Eb(r){return an(()=>r)}function Ey(r=vF){return $n((s,a)=>{let d=!1;s.subscribe(Gn(a,y=>{d=!0,a.next(y)},()=>d?a.complete():a.error(r())))})}function vF(){return new ws}function qs(r){return $n((s,a)=>{try{s.subscribe(a)}finally{a.add(r)}})}function Ws(r,s){let a=arguments.length>=2;return d=>d.pipe(r?Br((y,n)=>r(y,n,d)):bo,Eo(1),a?ec(s):Ey(()=>new ws))}function ld(r){return r<=0?()=>wo:$n((s,a)=>{let d=[];s.subscribe(Gn(a,y=>{d.push(y),r<d.length&&d.shift()},()=>{for(let y of d)a.next(y);a.complete()},void 0,()=>{d=null}))})}function Ib(r,s){let a=arguments.length>=2;return d=>d.pipe(r?Br((y,n)=>r(y,n,d)):bo,ld(1),a?ec(s):Ey(()=>new ws))}function Tb(r,s){return $n(nM(r,s,arguments.length>=2,!0))}function Db(r={}){let{connector:s=()=>new Gi,resetOnError:a=!0,resetOnComplete:d=!0,resetOnRefCountZero:y=!0}=r;return n=>{let R,j,$,ie=0,pe=!1,Me=!1,He=()=>{j?.unsubscribe(),j=void 0},Be=()=>{He(),R=$=void 0,pe=Me=!1},lt=()=>{let rt=R;Be(),rt?.unsubscribe()};return $n((rt,At)=>{ie++,!Me&&!pe&&He();let Kt=$=$??s();At.add(()=>{ie--,ie===0&&!Me&&!pe&&(j=Cb(lt,y))}),Kt.subscribe(At),!R&&ie>0&&(R=new bs({next:St=>Kt.next(St),error:St=>{Me=!0,He(),j=Cb(Be,a,St),Kt.error(St)},complete:()=>{pe=!0,He(),j=Cb(Be,d),Kt.complete()}}),Ni(rt).subscribe(R))})(n)}}function Cb(r,s,...a){if(s===!0){r();return}if(s===!1)return;let d=new bs({next:()=>{d.unsubscribe(),r()}});return Ni(s(...a)).subscribe(d)}function Mb(r){return Br((s,a)=>r<=a)}function Kp(...r){let s=Yl(r);return $n((a,d)=>{(s?Kl(r,a,s):Kl(r,a)).subscribe(d)})}function Io(r,s){return $n((a,d)=>{let y=null,n=0,R=!1,j=()=>R&&!y&&d.complete();a.subscribe(Gn(d,$=>{y?.unsubscribe();let ie=0,pe=n++;Ni(r($,pe)).subscribe(y=Gn(d,Me=>d.next(s?s($,Me,pe,ie++):Me),()=>{y=null,j()}))},()=>{R=!0,j()}))})}function Qp(r){return $n((s,a)=>{Ni(r).subscribe(Gn(a,()=>a.complete(),Zp)),!a.closed&&s.subscribe(a)})}function Ui(r,s,a){let d=Mn(r)||s||a?{next:r,error:s,complete:a}:r;return d?$n((y,n)=>{var R;(R=d.subscribe)===null||R===void 0||R.call(d);let j=!0;y.subscribe(Gn(n,$=>{var ie;(ie=d.next)===null||ie===void 0||ie.call(d,$),n.next($)},()=>{var $;j=!1,($=d.complete)===null||$===void 0||$.call(d),n.complete()},$=>{var ie;j=!1,(ie=d.error)===null||ie===void 0||ie.call(d,$),n.error($)},()=>{var $,ie;j&&(($=d.unsubscribe)===null||$===void 0||$.call(d)),(ie=d.finalize)===null||ie===void 0||ie.call(d)}))}):bo}var UM="https://g.co/ng/security#xss",on=class extends Error{constructor(s,a){super(iv(s,a)),this.code=s}};function iv(r,s){return`${`NG0${Math.abs(r)}`}${s?": "+s:""}`}function um(r){return{toString:r}.toString()}var Iy="__parameters__";function xF(r){return function(...a){if(r){let d=r(...a);for(let y in d)this[y]=d[y]}}}function $M(r,s,a){return um(()=>{let d=xF(s);function y(...n){if(this instanceof y)return d.apply(this,n),this;let R=new y(...n);return j.annotation=R,j;function j($,ie,pe){let Me=$.hasOwnProperty(Iy)?$[Iy]:Object.defineProperty($,Iy,{value:[]})[Iy];for(;Me.length<=pe;)Me.push(null);return(Me[pe]=Me[pe]||[]).push(R),$}}return a&&(y.prototype=Object.create(a.prototype)),y.prototype.ngMetadataName=r,y.annotationCls=y,y})}var Ub=globalThis;function xi(r){for(let s in r)if(r[s]===xi)return s;throw Error("Could not find renamed property on target object.")}function bF(r,s){for(let a in s)s.hasOwnProperty(a)&&!r.hasOwnProperty(a)&&(r[a]=s[a])}function jr(r){if(typeof r=="string")return r;if(Array.isArray(r))return"["+r.map(jr).join(", ")+"]";if(r==null)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;let s=r.toString();if(s==null)return""+s;let a=s.indexOf(`
`);return a===-1?s:s.substring(0,a)}function $b(r,s){return r==null||r===""?s===null?"":s:s==null||s===""?r:r+" "+s}var wF=xi({__forward_ref__:xi});function Dd(r){return r.__forward_ref__=Dd,r.toString=function(){return jr(this())},r}function Vr(r){return GM(r)?r():r}function GM(r){return typeof r=="function"&&r.hasOwnProperty(wF)&&r.__forward_ref__===Dd}function Ft(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function Ii(r){return{providers:r.providers||[],imports:r.imports||[]}}function rv(r){return iM(r,qM)||iM(r,WM)}function HM(r){return rv(r)!==null}function iM(r,s){return r.hasOwnProperty(s)?r[s]:null}function EF(r){let s=r&&(r[qM]||r[WM]);return s||null}function rM(r){return r&&(r.hasOwnProperty(oM)||r.hasOwnProperty(IF))?r[oM]:null}var qM=xi({\u0275prov:xi}),oM=xi({\u0275inj:xi}),WM=xi({ngInjectableDef:xi}),IF=xi({ngInjectorDef:xi}),Zt=class{constructor(s,a){this._desc=s,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof a=="number"?this.__NG_ELEMENT_ID__=a:a!==void 0&&(this.\u0275prov=Ft({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function ZM(r){return r&&!!r.\u0275providers}var TF=xi({\u0275cmp:xi}),CF=xi({\u0275dir:xi}),DF=xi({\u0275pipe:xi}),MF=xi({\u0275mod:xi}),Ly=xi({\u0275fac:xi}),nm=xi({__NG_ELEMENT_ID__:xi}),sM=xi({__NG_ENV_ID__:xi});function $1(r){return typeof r=="string"?r:r==null?"":String(r)}function SF(r){return typeof r=="function"?r.name||r.toString():typeof r=="object"&&r!=null&&typeof r.type=="function"?r.type.name||r.type.toString():$1(r)}function AF(r,s){let a=s?`. Dependency path: ${s.join(" > ")} > ${r}`:"";throw new on(-200,r)}function G1(r,s){throw new on(-201,!1)}var Bn=function(r){return r[r.Default=0]="Default",r[r.Host=1]="Host",r[r.Self=2]="Self",r[r.SkipSelf=4]="SkipSelf",r[r.Optional=8]="Optional",r}(Bn||{}),Gb;function XM(){return Gb}function Uo(r){let s=Gb;return Gb=r,s}function YM(r,s,a){let d=rv(r);if(d&&d.providedIn=="root")return d.value===void 0?d.value=d.factory():d.value;if(a&Bn.Optional)return null;if(s!==void 0)return s;G1(r,"Injector")}var RF={},im=RF,Hb="__NG_DI_FLAG__",Fy="ngTempTokenPath",PF="ngTokenPath",OF=/\n/gm,kF="\u0275",aM="__source",dd;function LF(){return dd}function tc(r){let s=dd;return dd=r,s}function FF(r,s=Bn.Default){if(dd===void 0)throw new on(-203,!1);return dd===null?YM(r,void 0,s):dd.get(r,s&Bn.Optional?null:void 0,s)}function Ot(r,s=Bn.Default){return(XM()||FF)(Vr(r),s)}function yt(r,s=Bn.Default){return Ot(r,ov(s))}function ov(r){return typeof r>"u"||typeof r=="number"?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function qb(r){let s=[];for(let a=0;a<r.length;a++){let d=Vr(r[a]);if(Array.isArray(d)){if(d.length===0)throw new on(900,!1);let y,n=Bn.Default;for(let R=0;R<d.length;R++){let j=d[R],$=NF(j);typeof $=="number"?$===-1?y=j.token:n|=$:y=j}s.push(Ot(y,n))}else s.push(Ot(d))}return s}function JM(r,s){return r[Hb]=s,r.prototype[Hb]=s,r}function NF(r){return r[Hb]}function zF(r,s,a,d){let y=r[Fy];throw s[aM]&&y.unshift(s[aM]),r.message=BF(`
`+r.message,y,a,d),r[PF]=y,r[Fy]=null,r}function BF(r,s,a,d=null){r=r&&r.charAt(0)===`
`&&r.charAt(1)==kF?r.slice(2):r;let y=jr(s);if(Array.isArray(s))y=s.map(jr).join(" -> ");else if(typeof s=="object"){let n=[];for(let R in s)if(s.hasOwnProperty(R)){let j=s[R];n.push(R+":"+(typeof j=="string"?JSON.stringify(j):jr(j)))}y=`{${n.join(", ")}}`}return`${a}${d?"("+d+")":""}[${y}]: ${r.replace(OF,`
  `)}`}var sv=JM($M("Optional"),8);var H1=JM($M("SkipSelf"),4);function pd(r,s){let a=r.hasOwnProperty(Ly);return a?r[Ly]:null}function q1(r,s){r.forEach(a=>Array.isArray(a)?q1(a,s):s(a))}function KM(r,s,a){s>=r.length?r.push(a):r.splice(s,0,a)}function Ny(r,s){return s>=r.length-1?r.pop():r.splice(s,1)[0]}function VF(r,s){let a=[];for(let d=0;d<r;d++)a.push(s);return a}function jF(r,s,a,d){let y=r.length;if(y==s)r.push(a,d);else if(y===1)r.push(d,r[0]),r[0]=a;else{for(y--,r.push(r[y-1],r[y]);y>s;){let n=y-2;r[y]=r[n],y--}r[s]=a,r[s+1]=d}}function W1(r,s,a){let d=hm(r,s);return d>=0?r[d|1]=a:(d=~d,jF(r,d,s,a)),d}function Sb(r,s){let a=hm(r,s);if(a>=0)return r[a|1]}function hm(r,s){return UF(r,s,1)}function UF(r,s,a){let d=0,y=r.length>>a;for(;y!==d;){let n=d+(y-d>>1),R=r[n<<a];if(s===R)return n<<a;R>s?y=n:d=n+1}return~(y<<a)}var md={},ro=[],gd=new Zt(""),QM=new Zt("",-1),eS=new Zt(""),zy=class{get(s,a=im){if(a===im){let d=new Error(`NullInjectorError: No provider for ${jr(s)}!`);throw d.name="NullInjectorError",d}return a}},tS=function(r){return r[r.OnPush=0]="OnPush",r[r.Default=1]="Default",r}(tS||{}),Ys=function(r){return r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",r}(Ys||{}),rc=function(r){return r[r.None=0]="None",r[r.SignalBased=1]="SignalBased",r[r.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",r}(rc||{});function $F(r,s,a){let d=r.length;for(;;){let y=r.indexOf(s,a);if(y===-1)return y;if(y===0||r.charCodeAt(y-1)<=32){let n=s.length;if(y+n===d||r.charCodeAt(y+n)<=32)return y}a=y+1}}function Wb(r,s,a){let d=0;for(;d<a.length;){let y=a[d];if(typeof y=="number"){if(y!==0)break;d++;let n=a[d++],R=a[d++],j=a[d++];r.setAttribute(s,R,j,n)}else{let n=y,R=a[++d];GF(n)?r.setProperty(s,n,R):r.setAttribute(s,n,R),d++}}return d}function nS(r){return r===3||r===4||r===6}function GF(r){return r.charCodeAt(0)===64}function rm(r,s){if(!(s===null||s.length===0))if(r===null||r.length===0)r=s.slice();else{let a=-1;for(let d=0;d<s.length;d++){let y=s[d];typeof y=="number"?a=y:a===0||(a===-1||a===2?lM(r,a,y,null,s[++d]):lM(r,a,y,null,null))}}return r}function lM(r,s,a,d,y){let n=0,R=r.length;if(s===-1)R=-1;else for(;n<r.length;){let j=r[n++];if(typeof j=="number"){if(j===s){R=-1;break}else if(j>s){R=n-1;break}}}for(;n<r.length;){let j=r[n];if(typeof j=="number")break;if(j===a){if(d===null){y!==null&&(r[n+1]=y);return}else if(d===r[n+1]){r[n+2]=y;return}}n++,d!==null&&n++,y!==null&&n++}R!==-1&&(r.splice(R,0,s),n=R+1),r.splice(n++,0,a),d!==null&&r.splice(n++,0,d),y!==null&&r.splice(n++,0,y)}var iS="ng-template";function HF(r,s,a,d){let y=0;if(d){for(;y<s.length&&typeof s[y]=="string";y+=2)if(s[y]==="class"&&$F(s[y+1].toLowerCase(),a,0)!==-1)return!0}else if(Z1(r))return!1;if(y=s.indexOf(1,y),y>-1){let n;for(;++y<s.length&&typeof(n=s[y])=="string";)if(n.toLowerCase()===a)return!0}return!1}function Z1(r){return r.type===4&&r.value!==iS}function qF(r,s,a){let d=r.type===4&&!a?iS:r.value;return s===d}function WF(r,s,a){let d=4,y=r.attrs,n=y!==null?YF(y):0,R=!1;for(let j=0;j<s.length;j++){let $=s[j];if(typeof $=="number"){if(!R&&!Es(d)&&!Es($))return!1;if(R&&Es($))continue;R=!1,d=$|d&1;continue}if(!R)if(d&4){if(d=2|d&1,$!==""&&!qF(r,$,a)||$===""&&s.length===1){if(Es(d))return!1;R=!0}}else if(d&8){if(y===null||!HF(r,y,$,a)){if(Es(d))return!1;R=!0}}else{let ie=s[++j],pe=ZF($,y,Z1(r),a);if(pe===-1){if(Es(d))return!1;R=!0;continue}if(ie!==""){let Me;if(pe>n?Me="":Me=y[pe+1].toLowerCase(),d&2&&ie!==Me){if(Es(d))return!1;R=!0}}}}return Es(d)||R}function Es(r){return(r&1)===0}function ZF(r,s,a,d){if(s===null)return-1;let y=0;if(d||!a){let n=!1;for(;y<s.length;){let R=s[y];if(R===r)return y;if(R===3||R===6)n=!0;else if(R===1||R===2){let j=s[++y];for(;typeof j=="string";)j=s[++y];continue}else{if(R===4)break;if(R===0){y+=4;continue}}y+=n?1:2}return-1}else return JF(s,r)}function rS(r,s,a=!1){for(let d=0;d<s.length;d++)if(WF(r,s[d],a))return!0;return!1}function XF(r){let s=r.attrs;if(s!=null){let a=s.indexOf(5);if(!(a&1))return s[a+1]}return null}function YF(r){for(let s=0;s<r.length;s++){let a=r[s];if(nS(a))return s}return r.length}function JF(r,s){let a=r.indexOf(4);if(a>-1)for(a++;a<r.length;){let d=r[a];if(typeof d=="number")return-1;if(d===s)return a;a++}return-1}function KF(r,s){e:for(let a=0;a<s.length;a++){let d=s[a];if(r.length===d.length){for(let y=0;y<r.length;y++)if(r[y]!==d[y])continue e;return!0}}return!1}function cM(r,s){return r?":not("+s.trim()+")":s}function QF(r){let s=r[0],a=1,d=2,y="",n=!1;for(;a<r.length;){let R=r[a];if(typeof R=="string")if(d&2){let j=r[++a];y+="["+R+(j.length>0?'="'+j+'"':"")+"]"}else d&8?y+="."+R:d&4&&(y+=" "+R);else y!==""&&!Es(R)&&(s+=cM(n,y),y=""),d=R,n=n||!Es(d);a++}return y!==""&&(s+=cM(n,y)),s}function eN(r){return r.map(QF).join(",")}function tN(r){let s=[],a=[],d=1,y=2;for(;d<r.length;){let n=r[d];if(typeof n=="string")y===2?n!==""&&s.push(n,r[++d]):y===8&&a.push(n);else{if(!Es(y))break;y=n}d++}return{attrs:s,classes:a}}function qo(r){return um(()=>{let s=cS(r),a=Un(bt({},s),{decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===tS.OnPush,directiveDefs:null,pipeDefs:null,dependencies:s.standalone&&r.dependencies||null,getStandaloneInjector:null,signals:r.signals??!1,data:r.data||{},encapsulation:r.encapsulation||Ys.Emulated,styles:r.styles||ro,_:null,schemas:r.schemas||null,tView:null,id:""});uS(a);let d=r.dependencies;return a.directiveDefs=hM(d,!1),a.pipeDefs=hM(d,!0),a.id=rN(a),a})}function nN(r){return oc(r)||oS(r)}function iN(r){return r!==null}function Ti(r){return um(()=>({type:r.type,bootstrap:r.bootstrap||ro,declarations:r.declarations||ro,imports:r.imports||ro,exports:r.exports||ro,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function uM(r,s){if(r==null)return md;let a={};for(let d in r)if(r.hasOwnProperty(d)){let y=r[d],n,R,j=rc.None;Array.isArray(y)?(j=y[0],n=y[1],R=y[2]??n):(n=y,R=y),s?(a[n]=j!==rc.None?[d,j]:d,s[n]=R):a[n]=d}return a}function or(r){return um(()=>{let s=cS(r);return uS(s),s})}function oc(r){return r[TF]||null}function oS(r){return r[CF]||null}function sS(r){return r[DF]||null}function aS(r){let s=oc(r)||oS(r)||sS(r);return s!==null?s.standalone:!1}function lS(r,s){let a=r[MF]||null;if(!a&&s===!0)throw new Error(`Type ${jr(r)} does not have '\u0275mod' property.`);return a}function cS(r){let s={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:s,inputTransforms:null,inputConfig:r.inputs||md,exportAs:r.exportAs||null,standalone:r.standalone===!0,signals:r.signals===!0,selectors:r.selectors||ro,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:uM(r.inputs,s),outputs:uM(r.outputs),debugInfo:null}}function uS(r){r.features?.forEach(s=>s(r))}function hM(r,s){if(!r)return null;let a=s?sS:nN;return()=>(typeof r=="function"?r():r).map(d=>a(d)).filter(iN)}function rN(r){let s=0,a=[r.selectors,r.ngContentSelectors,r.hostVars,r.hostAttrs,r.consts,r.vars,r.decls,r.encapsulation,r.standalone,r.signals,r.exportAs,JSON.stringify(r.inputs),JSON.stringify(r.outputs),Object.getOwnPropertyNames(r.type.prototype),!!r.contentQueries,!!r.viewQuery].join("|");for(let y of a)s=Math.imul(31,s)+y.charCodeAt(0)<<0;return s+=2147483648,"c"+s}function Md(r){return{\u0275providers:r}}function oN(...r){return{\u0275providers:hS(!0,r),\u0275fromNgModule:!0}}function hS(r,...s){let a=[],d=new Set,y,n=R=>{a.push(R)};return q1(s,R=>{let j=R;Zb(j,n,[],d)&&(y||=[],y.push(j))}),y!==void 0&&dS(y,n),a}function dS(r,s){for(let a=0;a<r.length;a++){let{ngModule:d,providers:y}=r[a];X1(y,n=>{s(n,d)})}}function Zb(r,s,a,d){if(r=Vr(r),!r)return!1;let y=null,n=rM(r),R=!n&&oc(r);if(!n&&!R){let $=r.ngModule;if(n=rM($),n)y=$;else return!1}else{if(R&&!R.standalone)return!1;y=r}let j=d.has(y);if(R){if(j)return!1;if(d.add(y),R.dependencies){let $=typeof R.dependencies=="function"?R.dependencies():R.dependencies;for(let ie of $)Zb(ie,s,a,d)}}else if(n){if(n.imports!=null&&!j){d.add(y);let ie;try{q1(n.imports,pe=>{Zb(pe,s,a,d)&&(ie||=[],ie.push(pe))})}finally{}ie!==void 0&&dS(ie,s)}if(!j){let ie=pd(y)||(()=>new y);s({provide:y,useFactory:ie,deps:ro},y),s({provide:eS,useValue:y,multi:!0},y),s({provide:gd,useValue:()=>Ot(y),multi:!0},y)}let $=n.providers;if($!=null&&!j){let ie=r;X1($,pe=>{s(pe,ie)})}}else return!1;return y!==r&&r.providers!==void 0}function X1(r,s){for(let a of r)ZM(a)&&(a=a.\u0275providers),Array.isArray(a)?X1(a,s):s(a)}var sN=xi({provide:String,useValue:xi});function fS(r){return r!==null&&typeof r=="object"&&sN in r}function aN(r){return!!(r&&r.useExisting)}function lN(r){return!!(r&&r.useFactory)}function _d(r){return typeof r=="function"}function cN(r){return!!r.useClass}var av=new Zt(""),Ay={},uN={},Ab;function lv(){return Ab===void 0&&(Ab=new zy),Ab}var Dr=class{},om=class extends Dr{get destroyed(){return this._destroyed}constructor(s,a,d,y){super(),this.parent=a,this.source=d,this.scopes=y,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Yb(s,R=>this.processProvider(R)),this.records.set(QM,cd(void 0,this)),y.has("environment")&&this.records.set(Dr,cd(void 0,this));let n=this.records.get(av);n!=null&&typeof n.value=="string"&&this.scopes.add(n.value),this.injectorDefTypes=new Set(this.get(eS,ro,Bn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let s=oi(null);try{for(let d of this._ngOnDestroyHooks)d.ngOnDestroy();let a=this._onDestroyHooks;this._onDestroyHooks=[];for(let d of a)d()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),oi(s)}}onDestroy(s){return this.assertNotDestroyed(),this._onDestroyHooks.push(s),()=>this.removeOnDestroy(s)}runInContext(s){this.assertNotDestroyed();let a=tc(this),d=Uo(void 0),y;try{return s()}finally{tc(a),Uo(d)}}get(s,a=im,d=Bn.Default){if(this.assertNotDestroyed(),s.hasOwnProperty(sM))return s[sM](this);d=ov(d);let y,n=tc(this),R=Uo(void 0);try{if(!(d&Bn.SkipSelf)){let $=this.records.get(s);if($===void 0){let ie=mN(s)&&rv(s);ie&&this.injectableDefInScope(ie)?$=cd(Xb(s),Ay):$=null,this.records.set(s,$)}if($!=null)return this.hydrate(s,$)}let j=d&Bn.Self?lv():this.parent;return a=d&Bn.Optional&&a===im?null:a,j.get(s,a)}catch(j){if(j.name==="NullInjectorError"){if((j[Fy]=j[Fy]||[]).unshift(jr(s)),n)throw j;return zF(j,s,"R3InjectorError",this.source)}else throw j}finally{Uo(R),tc(n)}}resolveInjectorInitializers(){let s=oi(null),a=tc(this),d=Uo(void 0),y;try{let n=this.get(gd,ro,Bn.Self);for(let R of n)R()}finally{tc(a),Uo(d),oi(s)}}toString(){let s=[],a=this.records;for(let d of a.keys())s.push(jr(d));return`R3Injector[${s.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new on(205,!1)}processProvider(s){s=Vr(s);let a=_d(s)?s:Vr(s&&s.provide),d=dN(s);if(!_d(s)&&s.multi===!0){let y=this.records.get(a);y||(y=cd(void 0,Ay,!0),y.factory=()=>qb(y.multi),this.records.set(a,y)),a=s,y.multi.push(s)}this.records.set(a,d)}hydrate(s,a){let d=oi(null);try{return a.value===Ay&&(a.value=uN,a.value=a.factory()),typeof a.value=="object"&&a.value&&pN(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}finally{oi(d)}}injectableDefInScope(s){if(!s.providedIn)return!1;let a=Vr(s.providedIn);return typeof a=="string"?a==="any"||this.scopes.has(a):this.injectorDefTypes.has(a)}removeOnDestroy(s){let a=this._onDestroyHooks.indexOf(s);a!==-1&&this._onDestroyHooks.splice(a,1)}};function Xb(r){let s=rv(r),a=s!==null?s.factory:pd(r);if(a!==null)return a;if(r instanceof Zt)throw new on(204,!1);if(r instanceof Function)return hN(r);throw new on(204,!1)}function hN(r){if(r.length>0)throw new on(204,!1);let a=EF(r);return a!==null?()=>a.factory(r):()=>new r}function dN(r){if(fS(r))return cd(void 0,r.useValue);{let s=pS(r);return cd(s,Ay)}}function pS(r,s,a){let d;if(_d(r)){let y=Vr(r);return pd(y)||Xb(y)}else if(fS(r))d=()=>Vr(r.useValue);else if(lN(r))d=()=>r.useFactory(...qb(r.deps||[]));else if(aN(r))d=()=>Ot(Vr(r.useExisting));else{let y=Vr(r&&(r.useClass||r.provide));if(fN(r))d=()=>new y(...qb(r.deps));else return pd(y)||Xb(y)}return d}function cd(r,s,a=!1){return{factory:r,value:s,multi:a?[]:void 0}}function fN(r){return!!r.deps}function pN(r){return r!==null&&typeof r=="object"&&typeof r.ngOnDestroy=="function"}function mN(r){return typeof r=="function"||typeof r=="object"&&r instanceof Zt}function Yb(r,s){for(let a of r)Array.isArray(a)?Yb(a,s):a&&ZM(a)?Yb(a.\u0275providers,s):s(a)}function Ds(r,s){r instanceof om&&r.assertNotDestroyed();let a,d=tc(r),y=Uo(void 0);try{return s()}finally{tc(d),Uo(y)}}function gN(){return XM()!==void 0||LF()!=null}function _N(r){return typeof r=="function"}var La=0,Yn=1,En=2,Ur=3,Ts=4,oo=5,sm=6,By=7,Cs=8,yd=9,Ra=10,qi=11,am=12,dM=13,Sd=14,Ho=15,vd=16,ud=17,xd=18,cv=19,mS=20,nc=21,Rb=22,$o=23,Js=25,gS=1;var Eu=7,Vy=8,jy=9,Go=10,Uy=function(r){return r[r.None=0]="None",r[r.HasTransplantedViews=2]="HasTransplantedViews",r}(Uy||{});function ic(r){return Array.isArray(r)&&typeof r[gS]=="object"}function Fa(r){return Array.isArray(r)&&r[gS]===!0}function _S(r){return(r.flags&4)!==0}function uv(r){return r.componentOffset>-1}function Y1(r){return(r.flags&1)===1}function sc(r){return!!r.template}function Jb(r){return(r[En]&512)!==0}var Kb=class{constructor(s,a,d){this.previousValue=s,this.currentValue=a,this.firstChange=d}isFirstChange(){return this.firstChange}};function yS(r,s,a,d){s!==null?s.applyValueToInputSignal(s,d):r[a]=d}function Au(){return vS}function vS(r){return r.type.prototype.ngOnChanges&&(r.setInput=vN),yN}Au.ngInherit=!0;function yN(){let r=bS(this),s=r?.current;if(s){let a=r.previous;if(a===md)r.previous=s;else for(let d in s)a[d]=s[d];r.current=null,this.ngOnChanges(s)}}function vN(r,s,a,d,y){let n=this.declaredInputs[d],R=bS(r)||xN(r,{previous:md,current:null}),j=R.current||(R.current={}),$=R.previous,ie=$[n];j[n]=new Kb(ie&&ie.currentValue,a,$===md),yS(r,s,y,a)}var xS="__ngSimpleChanges__";function bS(r){return r[xS]||null}function xN(r,s){return r[xS]=s}var fM=null;var Zs=function(r,s,a){fM?.(r,s,a)},bN="svg",wN="math";function Ks(r){for(;Array.isArray(r);)r=r[La];return r}function wS(r,s){return Ks(s[r])}function Wo(r,s){return Ks(s[r.index])}function ES(r,s){return r.data[s]}function lc(r,s){let a=s[r];return ic(a)?a:a[La]}function J1(r){return(r[En]&128)===128}function EN(r){return Fa(r[Ur])}function $y(r,s){return s==null?null:r[s]}function IS(r){r[ud]=0}function TS(r){r[En]&1024||(r[En]|=1024,J1(r)&&dv(r))}function IN(r,s){for(;r>0;)s=s[Sd],r--;return s}function hv(r){return!!(r[En]&9216||r[$o]?.dirty)}function Qb(r){r[Ra].changeDetectionScheduler?.notify(8),r[En]&64&&(r[En]|=1024),hv(r)&&dv(r)}function dv(r){r[Ra].changeDetectionScheduler?.notify(0);let s=Iu(r);for(;s!==null&&!(s[En]&8192||(s[En]|=8192,!J1(s)));)s=Iu(s)}function CS(r,s){if((r[En]&256)===256)throw new on(911,!1);r[nc]===null&&(r[nc]=[]),r[nc].push(s)}function TN(r,s){if(r[nc]===null)return;let a=r[nc].indexOf(s);a!==-1&&r[nc].splice(a,1)}function Iu(r){let s=r[Ur];return Fa(s)?s[Ur]:s}var Jn={lFrame:zS(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var DS=!1;function CN(){return Jn.lFrame.elementDepthCount}function DN(){Jn.lFrame.elementDepthCount++}function MN(){Jn.lFrame.elementDepthCount--}function MS(){return Jn.bindingsEnabled}function SS(){return Jn.skipHydrationRootTNode!==null}function SN(r){return Jn.skipHydrationRootTNode===r}function AN(){Jn.skipHydrationRootTNode=null}function bi(){return Jn.lFrame.lView}function $r(){return Jn.lFrame.tView}function dm(r){return Jn.lFrame.contextLView=r,r[Cs]}function fm(r){return Jn.lFrame.contextLView=null,r}function Gr(){let r=AS();for(;r!==null&&r.type===64;)r=r.parent;return r}function AS(){return Jn.lFrame.currentTNode}function RN(){let r=Jn.lFrame,s=r.currentTNode;return r.isParent?s:s.parent}function pm(r,s){let a=Jn.lFrame;a.currentTNode=r,a.isParent=s}function RS(){return Jn.lFrame.isParent}function PS(){Jn.lFrame.isParent=!1}function OS(){return DS}function pM(r){DS=r}function PN(r){return Jn.lFrame.bindingIndex=r}function fv(){return Jn.lFrame.bindingIndex++}function kS(r){let s=Jn.lFrame,a=s.bindingIndex;return s.bindingIndex=s.bindingIndex+r,a}function ON(){return Jn.lFrame.inI18n}function kN(r,s){let a=Jn.lFrame;a.bindingIndex=a.bindingRootIndex=r,e1(s)}function LN(){return Jn.lFrame.currentDirectiveIndex}function e1(r){Jn.lFrame.currentDirectiveIndex=r}function FN(r){let s=Jn.lFrame.currentDirectiveIndex;return s===-1?null:r[s]}function LS(r){Jn.lFrame.currentQueryIndex=r}function NN(r){let s=r[Yn];return s.type===2?s.declTNode:s.type===1?r[oo]:null}function FS(r,s,a){if(a&Bn.SkipSelf){let y=s,n=r;for(;y=y.parent,y===null&&!(a&Bn.Host);)if(y=NN(n),y===null||(n=n[Sd],y.type&10))break;if(y===null)return!1;s=y,r=n}let d=Jn.lFrame=NS();return d.currentTNode=s,d.lView=r,!0}function K1(r){let s=NS(),a=r[Yn];Jn.lFrame=s,s.currentTNode=a.firstChild,s.lView=r,s.tView=a,s.contextLView=r,s.bindingIndex=a.bindingStartIndex,s.inI18n=!1}function NS(){let r=Jn.lFrame,s=r===null?null:r.child;return s===null?zS(r):s}function zS(r){let s={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return r!==null&&(r.child=s),s}function BS(){let r=Jn.lFrame;return Jn.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}var VS=BS;function Q1(){let r=BS();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function zN(r){return(Jn.lFrame.contextLView=IN(r,Jn.lFrame.contextLView))[Cs]}function Ru(){return Jn.lFrame.selectedIndex}function Tu(r){Jn.lFrame.selectedIndex=r}function ew(){let r=Jn.lFrame;return ES(r.tView,r.selectedIndex)}function BN(){return Jn.lFrame.currentNamespace}var jS=!0;function tw(){return jS}function nw(r){jS=r}function VN(r,s,a){let{ngOnChanges:d,ngOnInit:y,ngDoCheck:n}=s.type.prototype;if(d){let R=vS(s);(a.preOrderHooks??=[]).push(r,R),(a.preOrderCheckHooks??=[]).push(r,R)}y&&(a.preOrderHooks??=[]).push(0-r,y),n&&((a.preOrderHooks??=[]).push(r,n),(a.preOrderCheckHooks??=[]).push(r,n))}function iw(r,s){for(let a=s.directiveStart,d=s.directiveEnd;a<d;a++){let n=r.data[a].type.prototype,{ngAfterContentInit:R,ngAfterContentChecked:j,ngAfterViewInit:$,ngAfterViewChecked:ie,ngOnDestroy:pe}=n;R&&(r.contentHooks??=[]).push(-a,R),j&&((r.contentHooks??=[]).push(a,j),(r.contentCheckHooks??=[]).push(a,j)),$&&(r.viewHooks??=[]).push(-a,$),ie&&((r.viewHooks??=[]).push(a,ie),(r.viewCheckHooks??=[]).push(a,ie)),pe!=null&&(r.destroyHooks??=[]).push(a,pe)}}function Ry(r,s,a){US(r,s,3,a)}function Py(r,s,a,d){(r[En]&3)===a&&US(r,s,a,d)}function Pb(r,s){let a=r[En];(a&3)===s&&(a&=16383,a+=1,r[En]=a)}function US(r,s,a,d){let y=d!==void 0?r[ud]&65535:0,n=d??-1,R=s.length-1,j=0;for(let $=y;$<R;$++)if(typeof s[$+1]=="number"){if(j=s[$],d!=null&&j>=d)break}else s[$]<0&&(r[ud]+=65536),(j<n||n==-1)&&(jN(r,a,s,$),r[ud]=(r[ud]&4294901760)+$+2),$++}function mM(r,s){Zs(4,r,s);let a=oi(null);try{s.call(r)}finally{oi(a),Zs(5,r,s)}}function jN(r,s,a,d){let y=a[d]<0,n=a[d+1],R=y?-a[d]:a[d],j=r[R];y?r[En]>>14<r[ud]>>16&&(r[En]&3)===s&&(r[En]+=16384,mM(j,n)):mM(j,n)}var fd=-1,Cu=class{constructor(s,a,d){this.factory=s,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=d}};function UN(r){return r instanceof Cu}function $N(r){return(r.flags&8)!==0}function GN(r){return(r.flags&16)!==0}var Ob={},t1=class{constructor(s,a){this.injector=s,this.parentInjector=a}get(s,a,d){d=ov(d);let y=this.injector.get(s,Ob,d);return y!==Ob||a===Ob?y:this.parentInjector.get(s,a,d)}};function $S(r){return r!==fd}function Gy(r){return r&32767}function HN(r){return r>>16}function Hy(r,s){let a=HN(r),d=s;for(;a>0;)d=d[Sd],a--;return d}var n1=!0;function gM(r){let s=n1;return n1=r,s}var qN=256,GS=qN-1,HS=5,WN=0,Xs={};function ZN(r,s,a){let d;typeof a=="string"?d=a.charCodeAt(0)||0:a.hasOwnProperty(nm)&&(d=a[nm]),d==null&&(d=a[nm]=WN++);let y=d&GS,n=1<<y;s.data[r+(y>>HS)]|=n}function qy(r,s){let a=qS(r,s);if(a!==-1)return a;let d=s[Yn];d.firstCreatePass&&(r.injectorIndex=s.length,kb(d.data,r),kb(s,null),kb(d.blueprint,null));let y=rw(r,s),n=r.injectorIndex;if($S(y)){let R=Gy(y),j=Hy(y,s),$=j[Yn].data;for(let ie=0;ie<8;ie++)s[n+ie]=j[R+ie]|$[R+ie]}return s[n+8]=y,n}function kb(r,s){r.push(0,0,0,0,0,0,0,0,s)}function qS(r,s){return r.injectorIndex===-1||r.parent&&r.parent.injectorIndex===r.injectorIndex||s[r.injectorIndex+8]===null?-1:r.injectorIndex}function rw(r,s){if(r.parent&&r.parent.injectorIndex!==-1)return r.parent.injectorIndex;let a=0,d=null,y=s;for(;y!==null;){if(d=JS(y),d===null)return fd;if(a++,y=y[Sd],d.injectorIndex!==-1)return d.injectorIndex|a<<16}return fd}function i1(r,s,a){ZN(r,s,a)}function XN(r,s){if(s==="class")return r.classes;if(s==="style")return r.styles;let a=r.attrs;if(a){let d=a.length,y=0;for(;y<d;){let n=a[y];if(nS(n))break;if(n===0)y=y+2;else if(typeof n=="number")for(y++;y<d&&typeof a[y]=="string";)y++;else{if(n===s)return a[y+1];y=y+2}}}return null}function WS(r,s,a){if(a&Bn.Optional||r!==void 0)return r;G1(s,"NodeInjector")}function ZS(r,s,a,d){if(a&Bn.Optional&&d===void 0&&(d=null),!(a&(Bn.Self|Bn.Host))){let y=r[yd],n=Uo(void 0);try{return y?y.get(s,d,a&Bn.Optional):YM(s,d,a&Bn.Optional)}finally{Uo(n)}}return WS(d,s,a)}function XS(r,s,a,d=Bn.Default,y){if(r!==null){if(s[En]&2048&&!(d&Bn.Self)){let R=e3(r,s,a,d,Xs);if(R!==Xs)return R}let n=YS(r,s,a,d,Xs);if(n!==Xs)return n}return ZS(s,a,d,y)}function YS(r,s,a,d,y){let n=KN(a);if(typeof n=="function"){if(!FS(s,r,d))return d&Bn.Host?WS(y,a,d):ZS(s,a,d,y);try{let R;if(R=n(d),R==null&&!(d&Bn.Optional))G1(a);else return R}finally{VS()}}else if(typeof n=="number"){let R=null,j=qS(r,s),$=fd,ie=d&Bn.Host?s[Ho][oo]:null;for((j===-1||d&Bn.SkipSelf)&&($=j===-1?rw(r,s):s[j+8],$===fd||!yM(d,!1)?j=-1:(R=s[Yn],j=Gy($),s=Hy($,s)));j!==-1;){let pe=s[Yn];if(_M(n,j,pe.data)){let Me=YN(j,s,a,R,d,ie);if(Me!==Xs)return Me}$=s[j+8],$!==fd&&yM(d,s[Yn].data[j+8]===ie)&&_M(n,j,s)?(R=pe,j=Gy($),s=Hy($,s)):j=-1}}return y}function YN(r,s,a,d,y,n){let R=s[Yn],j=R.data[r+8],$=d==null?uv(j)&&n1:d!=R&&(j.type&3)!==0,ie=y&Bn.Host&&n===j,pe=JN(j,R,a,$,ie);return pe!==null?bd(s,R,pe,j):Xs}function JN(r,s,a,d,y){let n=r.providerIndexes,R=s.data,j=n&1048575,$=r.directiveStart,ie=r.directiveEnd,pe=n>>20,Me=d?j:j+pe,He=y?j+pe:ie;for(let Be=Me;Be<He;Be++){let lt=R[Be];if(Be<$&&a===lt||Be>=$&&lt.type===a)return Be}if(y){let Be=R[$];if(Be&&sc(Be)&&Be.type===a)return $}return null}function bd(r,s,a,d){let y=r[a],n=s.data;if(UN(y)){let R=y;R.resolving&&AF(SF(n[a]));let j=gM(R.canSeeViewProviders);R.resolving=!0;let $,ie=R.injectImpl?Uo(R.injectImpl):null,pe=FS(r,d,Bn.Default);try{y=r[a]=R.factory(void 0,n,r,d),s.firstCreatePass&&a>=d.directiveStart&&VN(a,n[a],s)}finally{ie!==null&&Uo(ie),gM(j),R.resolving=!1,VS()}}return y}function KN(r){if(typeof r=="string")return r.charCodeAt(0)||0;let s=r.hasOwnProperty(nm)?r[nm]:void 0;return typeof s=="number"?s>=0?s&GS:QN:s}function _M(r,s,a){let d=1<<r;return!!(a[s+(r>>HS)]&d)}function yM(r,s){return!(r&Bn.Self)&&!(r&Bn.Host&&s)}var wu=class{constructor(s,a){this._tNode=s,this._lView=a}get(s,a,d){return XS(this._tNode,this._lView,s,ov(d),a)}};function QN(){return new wu(Gr(),bi())}function Ad(r){return um(()=>{let s=r.prototype.constructor,a=s[Ly]||r1(s),d=Object.prototype,y=Object.getPrototypeOf(r.prototype).constructor;for(;y&&y!==d;){let n=y[Ly]||r1(y);if(n&&n!==a)return n;y=Object.getPrototypeOf(y)}return n=>new n})}function r1(r){return GM(r)?()=>{let s=r1(Vr(r));return s&&s()}:pd(r)}function e3(r,s,a,d,y){let n=r,R=s;for(;n!==null&&R!==null&&R[En]&2048&&!(R[En]&512);){let j=YS(n,R,a,d|Bn.Self,Xs);if(j!==Xs)return j;let $=n.parent;if(!$){let ie=R[mS];if(ie){let pe=ie.get(a,Xs,d);if(pe!==Xs)return pe}$=JS(R),R=R[Sd]}n=$}return y}function JS(r){let s=r[Yn],a=s.type;return a===2?s.declTNode:a===1?r[oo]:null}function pv(r){return XN(Gr(),r)}function vM(r,s=null,a=null,d){let y=KS(r,s,a,d);return y.resolveInjectorInitializers(),y}function KS(r,s=null,a=null,d,y=new Set){let n=[a||ro,oN(r)];return d=d||(typeof r=="object"?void 0:jr(r)),new om(n,s||lv(),d||null,y)}var Pa=class r{static{this.THROW_IF_NOT_FOUND=im}static{this.NULL=new zy}static create(s,a){if(Array.isArray(s))return vM({name:""},a,s,"");{let d=s.name??"";return vM({name:d},s.parent,s.providers,d)}}static{this.\u0275prov=Ft({token:r,providedIn:"any",factory:()=>Ot(QM)})}static{this.__NG_ELEMENT_ID__=-1}};var t3=new Zt("");t3.__NG_ELEMENT_ID__=r=>{let s=Gr();if(s===null)throw new on(204,!1);if(s.type&2)return s.value;if(r&Bn.Optional)return null;throw new on(204,!1)};var n3="ngOriginalError";function Lb(r){return r[n3]}var QS=!0,eA=(()=>{class r{static{this.__NG_ELEMENT_ID__=i3}static{this.__NG_ENV_ID__=a=>a}}return r})(),o1=class extends eA{constructor(s){super(),this._lView=s}onDestroy(s){return CS(this._lView,s),()=>TN(this._lView,s)}};function i3(){return new o1(bi())}var Na=(()=>{class r{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new _r(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let a=this.taskId++;return this.pendingTasks.add(a),a}remove(a){this.pendingTasks.delete(a),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static{this.\u0275prov=Ft({token:r,providedIn:"root",factory:()=>new r})}}return r})();var s1=class extends Gi{constructor(s=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=s,gN()&&(this.destroyRef=yt(eA,{optional:!0})??void 0,this.pendingTasks=yt(Na,{optional:!0})??void 0)}emit(s){let a=oi(null);try{super.next(s)}finally{oi(a)}}subscribe(s,a,d){let y=s,n=a||(()=>null),R=d;if(s&&typeof s=="object"){let $=s;y=$.next?.bind($),n=$.error?.bind($),R=$.complete?.bind($)}this.__isAsync&&(n=this.wrapInTimeout(n),y&&(y=this.wrapInTimeout(y)),R&&(R=this.wrapInTimeout(R)));let j=super.subscribe({next:y,error:n,complete:R});return s instanceof Oi&&s.add(j),j}wrapInTimeout(s){return a=>{let d=this.pendingTasks?.add();setTimeout(()=>{s(a),d!==void 0&&this.pendingTasks?.remove(d)})}}},Hi=s1;function Wy(...r){}function tA(r){let s,a;function d(){r=Wy;try{a!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(a),s!==void 0&&clearTimeout(s)}catch{}}return s=setTimeout(()=>{r(),d()}),typeof requestAnimationFrame=="function"&&(a=requestAnimationFrame(()=>{r(),d()})),()=>d()}function xM(r){return queueMicrotask(()=>r()),()=>{r=Wy}}var ow="isAngularZone",Zy=ow+"_ID",r3=0,ci=class r{constructor(s){this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Hi(!1),this.onMicrotaskEmpty=new Hi(!1),this.onStable=new Hi(!1),this.onError=new Hi(!1);let{enableLongStackTrace:a=!1,shouldCoalesceEventChangeDetection:d=!1,shouldCoalesceRunChangeDetection:y=!1,scheduleInRootZone:n=QS}=s;if(typeof Zone>"u")throw new on(908,!1);Zone.assertZonePatched();let R=this;R._nesting=0,R._outer=R._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(R._inner=R._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(R._inner=R._inner.fork(Zone.longStackTraceZoneSpec)),R.shouldCoalesceEventChangeDetection=!y&&d,R.shouldCoalesceRunChangeDetection=y,R.callbackScheduled=!1,R.scheduleInRootZone=n,a3(R)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(ow)===!0}static assertInAngularZone(){if(!r.isInAngularZone())throw new on(909,!1)}static assertNotInAngularZone(){if(r.isInAngularZone())throw new on(909,!1)}run(s,a,d){return this._inner.run(s,a,d)}runTask(s,a,d,y){let n=this._inner,R=n.scheduleEventTask("NgZoneEvent: "+y,s,o3,Wy,Wy);try{return n.runTask(R,a,d)}finally{n.cancelTask(R)}}runGuarded(s,a,d){return this._inner.runGuarded(s,a,d)}runOutsideAngular(s){return this._outer.run(s)}},o3={};function sw(r){if(r._nesting==0&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function s3(r){if(r.isCheckStableRunning||r.callbackScheduled)return;r.callbackScheduled=!0;function s(){tA(()=>{r.callbackScheduled=!1,a1(r),r.isCheckStableRunning=!0,sw(r),r.isCheckStableRunning=!1})}r.scheduleInRootZone?Zone.root.run(()=>{s()}):r._outer.run(()=>{s()}),a1(r)}function a3(r){let s=()=>{s3(r)},a=r3++;r._inner=r._inner.fork({name:"angular",properties:{[ow]:!0,[Zy]:a,[Zy+a]:!0},onInvokeTask:(d,y,n,R,j,$)=>{if(l3($))return d.invokeTask(n,R,j,$);try{return bM(r),d.invokeTask(n,R,j,$)}finally{(r.shouldCoalesceEventChangeDetection&&R.type==="eventTask"||r.shouldCoalesceRunChangeDetection)&&s(),wM(r)}},onInvoke:(d,y,n,R,j,$,ie)=>{try{return bM(r),d.invoke(n,R,j,$,ie)}finally{r.shouldCoalesceRunChangeDetection&&!r.callbackScheduled&&!c3($)&&s(),wM(r)}},onHasTask:(d,y,n,R)=>{d.hasTask(n,R),y===n&&(R.change=="microTask"?(r._hasPendingMicrotasks=R.microTask,a1(r),sw(r)):R.change=="macroTask"&&(r.hasPendingMacrotasks=R.macroTask))},onHandleError:(d,y,n,R)=>(d.handleError(n,R),r.runOutsideAngular(()=>r.onError.emit(R)),!1)})}function a1(r){r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&r.callbackScheduled===!0?r.hasPendingMicrotasks=!0:r.hasPendingMicrotasks=!1}function bM(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function wM(r){r._nesting--,sw(r)}var l1=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Hi,this.onMicrotaskEmpty=new Hi,this.onStable=new Hi,this.onError=new Hi}run(s,a,d){return s.apply(a,d)}runGuarded(s,a,d){return s.apply(a,d)}runOutsideAngular(s){return s()}runTask(s,a,d,y){return s.apply(a,d)}};function l3(r){return nA(r,"__ignore_ng_zone__")}function c3(r){return nA(r,"__scheduler_tick__")}function nA(r,s){return!Array.isArray(r)||r.length!==1?!1:r[0]?.data?.[s]===!0}var To=class{constructor(){this._console=console}handleError(s){let a=this._findOriginalError(s);this._console.error("ERROR",s),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(s){let a=s&&Lb(s);for(;a&&Lb(a);)a=Lb(a);return a||null}},u3=new Zt("",{providedIn:"root",factory:()=>{let r=yt(ci),s=yt(To);return a=>r.runOutsideAngular(()=>s.handleError(a))}});function h3(){return mv(Gr(),bi())}function mv(r,s){return new ur(Wo(r,s))}var ur=(()=>{class r{constructor(a){this.nativeElement=a}static{this.__NG_ELEMENT_ID__=h3}}return r})();function iA(r){return(r.flags&128)===128}var rA=new Map,d3=0;function f3(){return d3++}function p3(r){rA.set(r[cv],r)}function c1(r){rA.delete(r[cv])}var EM="__ngContext__";function Du(r,s){ic(s)?(r[EM]=s[cv],p3(s)):r[EM]=s}function oA(r){return aA(r[am])}function sA(r){return aA(r[Ts])}function aA(r){for(;r!==null&&!Fa(r);)r=r[Ts];return r}var u1;function lA(r){u1=r}function m3(){if(u1!==void 0)return u1;if(typeof document<"u")return document;throw new on(210,!1)}var mm=new Zt("",{providedIn:"root",factory:()=>g3}),g3="ng",aw=new Zt(""),Qs=new Zt("",{providedIn:"platform",factory:()=>"unknown"});var lw=new Zt(""),gm=new Zt("",{providedIn:"root",factory:()=>m3().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var _3="h",y3="b";var v3=()=>null;function cw(r,s,a=!1){return v3(r,s,a)}var cA=!1,x3=new Zt("",{providedIn:"root",factory:()=>cA});var Ty;function b3(){if(Ty===void 0&&(Ty=null,Ub.trustedTypes))try{Ty=Ub.trustedTypes.createPolicy("angular",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return Ty}function gv(r){return b3()?.createHTML(r)||r}var Oa=class{constructor(s){this.changingThisBreaksApplicationSecurity=s}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${UM})`}},h1=class extends Oa{getTypeName(){return"HTML"}},d1=class extends Oa{getTypeName(){return"Style"}},f1=class extends Oa{getTypeName(){return"Script"}},p1=class extends Oa{getTypeName(){return"URL"}},m1=class extends Oa{getTypeName(){return"ResourceURL"}};function za(r){return r instanceof Oa?r.changingThisBreaksApplicationSecurity:r}function Rd(r,s){let a=w3(r);if(a!=null&&a!==s){if(a==="ResourceURL"&&s==="URL")return!0;throw new Error(`Required a safe ${s}, got a ${a} (see ${UM})`)}return a===s}function w3(r){return r instanceof Oa&&r.getTypeName()||null}function uA(r){return new h1(r)}function hA(r){return new d1(r)}function dA(r){return new f1(r)}function fA(r){return new p1(r)}function pA(r){return new m1(r)}function E3(r){let s=new _1(r);return I3()?new g1(s):s}var g1=class{constructor(s){this.inertDocumentHelper=s}getInertBodyElement(s){s="<body><remove></remove>"+s;try{let a=new window.DOMParser().parseFromString(gv(s),"text/html").body;return a===null?this.inertDocumentHelper.getInertBodyElement(s):(a.firstChild?.remove(),a)}catch{return null}}},_1=class{constructor(s){this.defaultDoc=s,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(s){let a=this.inertDocument.createElement("template");return a.innerHTML=gv(s),a}};function I3(){try{return!!new window.DOMParser().parseFromString(gv(""),"text/html")}catch{return!1}}var T3=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function uw(r){return r=String(r),r.match(T3)?r:"unsafe:"+r}function Ba(r){let s={};for(let a of r.split(","))s[a]=!0;return s}function _m(...r){let s={};for(let a of r)for(let d in a)a.hasOwnProperty(d)&&(s[d]=!0);return s}var mA=Ba("area,br,col,hr,img,wbr"),gA=Ba("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),_A=Ba("rp,rt"),C3=_m(_A,gA),D3=_m(gA,Ba("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),M3=_m(_A,Ba("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),IM=_m(mA,D3,M3,C3),yA=Ba("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),S3=Ba("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),A3=Ba("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),R3=_m(yA,S3,A3),P3=Ba("script,style,template"),y1=class{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(s){let a=s.firstChild,d=!0,y=[];for(;a;){if(a.nodeType===Node.ELEMENT_NODE?d=this.startElement(a):a.nodeType===Node.TEXT_NODE?this.chars(a.nodeValue):this.sanitizedSomething=!0,d&&a.firstChild){y.push(a),a=L3(a);continue}for(;a;){a.nodeType===Node.ELEMENT_NODE&&this.endElement(a);let n=k3(a);if(n){a=n;break}a=y.pop()}}return this.buf.join("")}startElement(s){let a=TM(s).toLowerCase();if(!IM.hasOwnProperty(a))return this.sanitizedSomething=!0,!P3.hasOwnProperty(a);this.buf.push("<"),this.buf.push(a);let d=s.attributes;for(let y=0;y<d.length;y++){let n=d.item(y),R=n.name,j=R.toLowerCase();if(!R3.hasOwnProperty(j)){this.sanitizedSomething=!0;continue}let $=n.value;yA[j]&&($=uw($)),this.buf.push(" ",R,'="',CM($),'"')}return this.buf.push(">"),!0}endElement(s){let a=TM(s).toLowerCase();IM.hasOwnProperty(a)&&!mA.hasOwnProperty(a)&&(this.buf.push("</"),this.buf.push(a),this.buf.push(">"))}chars(s){this.buf.push(CM(s))}};function O3(r,s){return(r.compareDocumentPosition(s)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function k3(r){let s=r.nextSibling;if(s&&r!==s.previousSibling)throw vA(s);return s}function L3(r){let s=r.firstChild;if(s&&O3(r,s))throw vA(s);return s}function TM(r){let s=r.nodeName;return typeof s=="string"?s:"FORM"}function vA(r){return new Error(`Failed to sanitize html because the element is clobbered: ${r.outerHTML}`)}var F3=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,N3=/([^\#-~ |!])/g;function CM(r){return r.replace(/&/g,"&amp;").replace(F3,function(s){let a=s.charCodeAt(0),d=s.charCodeAt(1);return"&#"+((a-55296)*1024+(d-56320)+65536)+";"}).replace(N3,function(s){return"&#"+s.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Cy;function xA(r,s){let a=null;try{Cy=Cy||E3(r);let d=s?String(s):"";a=Cy.getInertBodyElement(d);let y=5,n=d;do{if(y===0)throw new Error("Failed to sanitize html because the input is unstable");y--,d=n,n=a.innerHTML,a=Cy.getInertBodyElement(d)}while(d!==n);let j=new y1().sanitizeChildren(DM(a)||a);return gv(j)}finally{if(a){let d=DM(a)||a;for(;d.firstChild;)d.firstChild.remove()}}}function DM(r){return"content"in r&&z3(r)?r.content:null}function z3(r){return r.nodeType===Node.ELEMENT_NODE&&r.nodeName==="TEMPLATE"}var so=function(r){return r[r.NONE=0]="NONE",r[r.HTML=1]="HTML",r[r.STYLE=2]="STYLE",r[r.SCRIPT=3]="SCRIPT",r[r.URL=4]="URL",r[r.RESOURCE_URL=5]="RESOURCE_URL",r}(so||{});function bA(r){return r instanceof Function?r():r}var ka=function(r){return r[r.Important=1]="Important",r[r.DashCase=2]="DashCase",r}(ka||{}),B3;function hw(r,s){return B3(r,s)}function hd(r,s,a,d,y){if(d!=null){let n,R=!1;Fa(d)?n=d:ic(d)&&(R=!0,d=d[La]);let j=Ks(d);r===0&&a!==null?y==null?DA(s,a,j):Xy(s,a,j,y||null,!0):r===1&&a!==null?Xy(s,a,j,y||null,!0):r===2?K3(s,j,R):r===3&&s.destroyNode(j),n!=null&&ez(s,r,n,a,y)}}function V3(r,s){return r.createText(s)}function j3(r,s,a){r.setValue(s,a)}function wA(r,s,a){return r.createElement(s,a)}function U3(r,s){EA(r,s),s[La]=null,s[oo]=null}function $3(r,s,a,d,y,n){d[La]=y,d[oo]=s,_v(r,d,a,1,y,n)}function EA(r,s){s[Ra].changeDetectionScheduler?.notify(9),_v(r,s,s[qi],2,null,null)}function G3(r){let s=r[am];if(!s)return Fb(r[Yn],r);for(;s;){let a=null;if(ic(s))a=s[am];else{let d=s[Go];d&&(a=d)}if(!a){for(;s&&!s[Ts]&&s!==r;)ic(s)&&Fb(s[Yn],s),s=s[Ur];s===null&&(s=r),ic(s)&&Fb(s[Yn],s),a=s&&s[Ts]}s=a}}function H3(r,s,a,d){let y=Go+d,n=a.length;d>0&&(a[y-1][Ts]=s),d<n-Go?(s[Ts]=a[y],KM(a,Go+d,s)):(a.push(s),s[Ts]=null),s[Ur]=a;let R=s[vd];R!==null&&a!==R&&IA(R,s);let j=s[xd];j!==null&&j.insertView(r),Qb(s),s[En]|=128}function IA(r,s){let a=r[jy],d=s[Ur];if(ic(d))r[En]|=Uy.HasTransplantedViews;else{let y=d[Ur][Ho];s[Ho]!==y&&(r[En]|=Uy.HasTransplantedViews)}a===null?r[jy]=[s]:a.push(s)}function dw(r,s){let a=r[jy],d=a.indexOf(s);a.splice(d,1)}function v1(r,s){if(r.length<=Go)return;let a=Go+s,d=r[a];if(d){let y=d[vd];y!==null&&y!==r&&dw(y,d),s>0&&(r[a-1][Ts]=d[Ts]);let n=Ny(r,Go+s);U3(d[Yn],d);let R=n[xd];R!==null&&R.detachView(n[Yn]),d[Ur]=null,d[Ts]=null,d[En]&=-129}return d}function TA(r,s){if(!(s[En]&256)){let a=s[qi];a.destroyNode&&_v(r,s,a,3,null,null),G3(s)}}function Fb(r,s){if(s[En]&256)return;let a=oi(null);try{s[En]&=-129,s[En]|=256,s[$o]&&lb(s[$o]),W3(r,s),q3(r,s),s[Yn].type===1&&s[qi].destroy();let d=s[vd];if(d!==null&&Fa(s[Ur])){d!==s[Ur]&&dw(d,s);let y=s[xd];y!==null&&y.detachView(r)}c1(s)}finally{oi(a)}}function q3(r,s){let a=r.cleanup,d=s[By];if(a!==null)for(let n=0;n<a.length-1;n+=2)if(typeof a[n]=="string"){let R=a[n+3];R>=0?d[R]():d[-R].unsubscribe(),n+=2}else{let R=d[a[n+1]];a[n].call(R)}d!==null&&(s[By]=null);let y=s[nc];if(y!==null){s[nc]=null;for(let n=0;n<y.length;n++){let R=y[n];R()}}}function W3(r,s){let a;if(r!=null&&(a=r.destroyHooks)!=null)for(let d=0;d<a.length;d+=2){let y=s[a[d]];if(!(y instanceof Cu)){let n=a[d+1];if(Array.isArray(n))for(let R=0;R<n.length;R+=2){let j=y[n[R]],$=n[R+1];Zs(4,j,$);try{$.call(j)}finally{Zs(5,j,$)}}else{Zs(4,y,n);try{n.call(y)}finally{Zs(5,y,n)}}}}}function CA(r,s,a){return Z3(r,s.parent,a)}function Z3(r,s,a){let d=s;for(;d!==null&&d.type&168;)s=d,d=s.parent;if(d===null)return a[La];{let{componentOffset:y}=d;if(y>-1){let{encapsulation:n}=r.data[d.directiveStart+y];if(n===Ys.None||n===Ys.Emulated)return null}return Wo(d,a)}}function Xy(r,s,a,d,y){r.insertBefore(s,a,d,y)}function DA(r,s,a){r.appendChild(s,a)}function MM(r,s,a,d,y){d!==null?Xy(r,s,a,d,y):DA(r,s,a)}function MA(r,s){return r.parentNode(s)}function X3(r,s){return r.nextSibling(s)}function SA(r,s,a){return J3(r,s,a)}function Y3(r,s,a){return r.type&40?Wo(r,a):null}var J3=Y3,SM;function fw(r,s,a,d){let y=CA(r,d,s),n=s[qi],R=d.parent||s[oo],j=SA(R,d,s);if(y!=null)if(Array.isArray(a))for(let $=0;$<a.length;$++)MM(n,y,a[$],j,!1);else MM(n,y,a,j,!1);SM!==void 0&&SM(n,d,s,a,y)}function em(r,s){if(s!==null){let a=s.type;if(a&3)return Wo(s,r);if(a&4)return x1(-1,r[s.index]);if(a&8){let d=s.child;if(d!==null)return em(r,d);{let y=r[s.index];return Fa(y)?x1(-1,y):Ks(y)}}else{if(a&128)return em(r,s.next);if(a&32)return hw(s,r)()||Ks(r[s.index]);{let d=AA(r,s);if(d!==null){if(Array.isArray(d))return d[0];let y=Iu(r[Ho]);return em(y,d)}else return em(r,s.next)}}}return null}function AA(r,s){if(s!==null){let d=r[Ho][oo],y=s.projection;return d.projection[y]}return null}function x1(r,s){let a=Go+r+1;if(a<s.length){let d=s[a],y=d[Yn].firstChild;if(y!==null)return em(d,y)}return s[Eu]}function K3(r,s,a){r.removeChild(null,s,a)}function pw(r,s,a,d,y,n,R){for(;a!=null;){if(a.type===128){a=a.next;continue}let j=d[a.index],$=a.type;if(R&&s===0&&(j&&Du(Ks(j),d),a.flags|=2),(a.flags&32)!==32)if($&8)pw(r,s,a.child,d,y,n,!1),hd(s,r,y,j,n);else if($&32){let ie=hw(a,d),pe;for(;pe=ie();)hd(s,r,y,pe,n);hd(s,r,y,j,n)}else $&16?RA(r,s,d,a,y,n):hd(s,r,y,j,n);a=R?a.projectionNext:a.next}}function _v(r,s,a,d,y,n){pw(a,d,r.firstChild,s,y,n,!1)}function Q3(r,s,a){let d=s[qi],y=CA(r,a,s),n=a.parent||s[oo],R=SA(n,a,s);RA(d,0,s,a,y,R)}function RA(r,s,a,d,y,n){let R=a[Ho],$=R[oo].projection[d.projection];if(Array.isArray($))for(let ie=0;ie<$.length;ie++){let pe=$[ie];hd(s,r,y,pe,n)}else{let ie=$,pe=R[Ur];iA(d)&&(ie.flags|=128),pw(r,s,ie,pe,y,n,!0)}}function ez(r,s,a,d,y){let n=a[Eu],R=Ks(a);n!==R&&hd(s,r,d,n,y);for(let j=Go;j<a.length;j++){let $=a[j];_v($[Yn],$,r,s,d,n)}}function tz(r,s,a,d,y){if(s)y?r.addClass(a,d):r.removeClass(a,d);else{let n=d.indexOf("-")===-1?void 0:ka.DashCase;y==null?r.removeStyle(a,d,n):(typeof y=="string"&&y.endsWith("!important")&&(y=y.slice(0,-10),n|=ka.Important),r.setStyle(a,d,y,n))}}function nz(r,s,a){r.setAttribute(s,"style",a)}function PA(r,s,a){a===""?r.removeAttribute(s,"class"):r.setAttribute(s,"class",a)}function OA(r,s,a){let{mergedAttrs:d,classes:y,styles:n}=a;d!==null&&Wb(r,s,d),y!==null&&PA(r,s,y),n!==null&&nz(r,s,n)}var cc={};function Wi(r=1){kA($r(),bi(),Ru()+r,!1)}function kA(r,s,a,d){if(!d)if((s[En]&3)===3){let n=r.preOrderCheckHooks;n!==null&&Ry(s,n,a)}else{let n=r.preOrderHooks;n!==null&&Py(s,n,0,a)}Tu(a)}function Pn(r,s=Bn.Default){let a=bi();if(a===null)return Ot(r,s);let d=Gr();return XS(d,a,Vr(r),s)}function LA(r,s,a,d,y,n){let R=oi(null);try{let j=null;y&rc.SignalBased&&(j=s[d][Aa]),j!==null&&j.transformFn!==void 0&&(n=j.transformFn(n)),y&rc.HasDecoratorInputTransform&&(n=r.inputTransforms[d].call(s,n)),r.setInput!==null?r.setInput(s,j,n,a,d):yS(s,j,d,n)}finally{oi(R)}}function iz(r,s){let a=r.hostBindingOpCodes;if(a!==null)try{for(let d=0;d<a.length;d++){let y=a[d];if(y<0)Tu(~y);else{let n=y,R=a[++d],j=a[++d];kN(R,n);let $=s[n];j(2,$)}}}finally{Tu(-1)}}function yv(r,s,a,d,y,n,R,j,$,ie,pe){let Me=s.blueprint.slice();return Me[La]=y,Me[En]=d|4|128|8|64,(ie!==null||r&&r[En]&2048)&&(Me[En]|=2048),IS(Me),Me[Ur]=Me[Sd]=r,Me[Cs]=a,Me[Ra]=R||r&&r[Ra],Me[qi]=j||r&&r[qi],Me[yd]=$||r&&r[yd]||null,Me[oo]=n,Me[cv]=f3(),Me[sm]=pe,Me[mS]=ie,Me[Ho]=s.type==2?r[Ho]:Me,Me}function ym(r,s,a,d,y){let n=r.data[s];if(n===null)n=rz(r,s,a,d,y),ON()&&(n.flags|=32);else if(n.type&64){n.type=a,n.value=d,n.attrs=y;let R=RN();n.injectorIndex=R===null?-1:R.injectorIndex}return pm(n,!0),n}function rz(r,s,a,d,y){let n=AS(),R=RS(),j=R?n:n&&n.parent,$=r.data[s]=cz(r,j,a,s,d,y);return r.firstChild===null&&(r.firstChild=$),n!==null&&(R?n.child==null&&$.parent!==null&&(n.child=$):n.next===null&&(n.next=$,$.prev=n)),$}function FA(r,s,a,d){if(a===0)return-1;let y=s.length;for(let n=0;n<a;n++)s.push(d),r.blueprint.push(d),r.data.push(null);return y}function NA(r,s,a,d,y){let n=Ru(),R=d&2;try{Tu(-1),R&&s.length>Js&&kA(r,s,Js,!1),Zs(R?2:0,y),a(d,y)}finally{Tu(n),Zs(R?3:1,y)}}function zA(r,s,a){if(_S(s)){let d=oi(null);try{let y=s.directiveStart,n=s.directiveEnd;for(let R=y;R<n;R++){let j=r.data[R];if(j.contentQueries){let $=a[R];j.contentQueries(1,$,R)}}}finally{oi(d)}}}function BA(r,s,a){MS()&&(mz(r,s,a,Wo(a,s)),(a.flags&64)===64&&HA(r,s,a))}function VA(r,s,a=Wo){let d=s.localNames;if(d!==null){let y=s.index+1;for(let n=0;n<d.length;n+=2){let R=d[n+1],j=R===-1?a(s,r):r[R];r[y++]=j}}}function jA(r){let s=r.tView;return s===null||s.incompleteFirstPass?r.tView=mw(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts,r.id):s}function mw(r,s,a,d,y,n,R,j,$,ie,pe){let Me=Js+d,He=Me+y,Be=oz(Me,He),lt=typeof ie=="function"?ie():ie;return Be[Yn]={type:r,blueprint:Be,template:a,queries:null,viewQuery:j,declTNode:s,data:Be.slice().fill(null,Me),bindingStartIndex:Me,expandoStartIndex:He,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof n=="function"?n():n,pipeRegistry:typeof R=="function"?R():R,firstChild:null,schemas:$,consts:lt,incompleteFirstPass:!1,ssrId:pe}}function oz(r,s){let a=[];for(let d=0;d<s;d++)a.push(d<r?null:cc);return a}function sz(r,s,a,d){let n=d.get(x3,cA)||a===Ys.ShadowDom,R=r.selectRootElement(s,n);return az(R),R}function az(r){lz(r)}var lz=()=>null;function cz(r,s,a,d,y,n){let R=s?s.injectorIndex:-1,j=0;return SS()&&(j|=128),{type:a,index:d,insertBeforeIndex:null,injectorIndex:R,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:j,providerIndexes:0,value:y,attrs:n,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:s,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function AM(r,s,a,d,y){for(let n in s){if(!s.hasOwnProperty(n))continue;let R=s[n];if(R===void 0)continue;d??={};let j,$=rc.None;Array.isArray(R)?(j=R[0],$=R[1]):j=R;let ie=n;if(y!==null){if(!y.hasOwnProperty(n))continue;ie=y[n]}r===0?RM(d,a,ie,j,$):RM(d,a,ie,j)}return d}function RM(r,s,a,d,y){let n;r.hasOwnProperty(a)?(n=r[a]).push(s,d):n=r[a]=[s,d],y!==void 0&&n.push(y)}function uz(r,s,a){let d=s.directiveStart,y=s.directiveEnd,n=r.data,R=s.attrs,j=[],$=null,ie=null;for(let pe=d;pe<y;pe++){let Me=n[pe],He=a?a.get(Me):null,Be=He?He.inputs:null,lt=He?He.outputs:null;$=AM(0,Me.inputs,pe,$,Be),ie=AM(1,Me.outputs,pe,ie,lt);let rt=$!==null&&R!==null&&!Z1(s)?Cz($,pe,R):null;j.push(rt)}$!==null&&($.hasOwnProperty("class")&&(s.flags|=8),$.hasOwnProperty("style")&&(s.flags|=16)),s.initialInputs=j,s.inputs=$,s.outputs=ie}function hz(r){return r==="class"?"className":r==="for"?"htmlFor":r==="formaction"?"formAction":r==="innerHtml"?"innerHTML":r==="readonly"?"readOnly":r==="tabindex"?"tabIndex":r}function UA(r,s,a,d,y,n,R,j){let $=Wo(s,a),ie=s.inputs,pe;!j&&ie!=null&&(pe=ie[d])?(gw(r,a,pe,d,y),uv(s)&&dz(a,s.index)):s.type&3?(d=hz(d),y=R!=null?R(y,s.value||"",d):y,n.setProperty($,d,y)):s.type&12}function dz(r,s){let a=lc(s,r);a[En]&16||(a[En]|=64)}function $A(r,s,a,d){if(MS()){let y=d===null?null:{"":-1},n=_z(r,a),R,j;n===null?R=j=null:[R,j]=n,R!==null&&GA(r,s,a,R,y,j),y&&yz(a,d,y)}a.mergedAttrs=rm(a.mergedAttrs,a.attrs)}function GA(r,s,a,d,y,n){for(let ie=0;ie<d.length;ie++)i1(qy(a,s),r,d[ie].type);xz(a,r.data.length,d.length);for(let ie=0;ie<d.length;ie++){let pe=d[ie];pe.providersResolver&&pe.providersResolver(pe)}let R=!1,j=!1,$=FA(r,s,d.length,null);for(let ie=0;ie<d.length;ie++){let pe=d[ie];a.mergedAttrs=rm(a.mergedAttrs,pe.hostAttrs),bz(r,a,s,$,pe),vz($,pe,y),pe.contentQueries!==null&&(a.flags|=4),(pe.hostBindings!==null||pe.hostAttrs!==null||pe.hostVars!==0)&&(a.flags|=64);let Me=pe.type.prototype;!R&&(Me.ngOnChanges||Me.ngOnInit||Me.ngDoCheck)&&((r.preOrderHooks??=[]).push(a.index),R=!0),!j&&(Me.ngOnChanges||Me.ngDoCheck)&&((r.preOrderCheckHooks??=[]).push(a.index),j=!0),$++}uz(r,a,n)}function fz(r,s,a,d,y){let n=y.hostBindings;if(n){let R=r.hostBindingOpCodes;R===null&&(R=r.hostBindingOpCodes=[]);let j=~s.index;pz(R)!=j&&R.push(j),R.push(a,d,n)}}function pz(r){let s=r.length;for(;s>0;){let a=r[--s];if(typeof a=="number"&&a<0)return a}return 0}function mz(r,s,a,d){let y=a.directiveStart,n=a.directiveEnd;uv(a)&&wz(s,a,r.data[y+a.componentOffset]),r.firstCreatePass||qy(a,s),Du(d,s);let R=a.initialInputs;for(let j=y;j<n;j++){let $=r.data[j],ie=bd(s,r,j,a);if(Du(ie,s),R!==null&&Tz(s,j-y,ie,$,a,R),sc($)){let pe=lc(a.index,s);pe[Cs]=bd(s,r,j,a)}}}function HA(r,s,a){let d=a.directiveStart,y=a.directiveEnd,n=a.index,R=LN();try{Tu(n);for(let j=d;j<y;j++){let $=r.data[j],ie=s[j];e1(j),($.hostBindings!==null||$.hostVars!==0||$.hostAttrs!==null)&&gz($,ie)}}finally{Tu(-1),e1(R)}}function gz(r,s){r.hostBindings!==null&&r.hostBindings(1,s)}function _z(r,s){let a=r.directiveRegistry,d=null,y=null;if(a)for(let n=0;n<a.length;n++){let R=a[n];if(rS(s,R.selectors,!1))if(d||(d=[]),sc(R))if(R.findHostDirectiveDefs!==null){let j=[];y=y||new Map,R.findHostDirectiveDefs(R,j,y),d.unshift(...j,R);let $=j.length;b1(r,s,$)}else d.unshift(R),b1(r,s,0);else y=y||new Map,R.findHostDirectiveDefs?.(R,d,y),d.push(R)}return d===null?null:[d,y]}function b1(r,s,a){s.componentOffset=a,(r.components??=[]).push(s.index)}function yz(r,s,a){if(s){let d=r.localNames=[];for(let y=0;y<s.length;y+=2){let n=a[s[y+1]];if(n==null)throw new on(-301,!1);d.push(s[y],n)}}}function vz(r,s,a){if(a){if(s.exportAs)for(let d=0;d<s.exportAs.length;d++)a[s.exportAs[d]]=r;sc(s)&&(a[""]=r)}}function xz(r,s,a){r.flags|=1,r.directiveStart=s,r.directiveEnd=s+a,r.providerIndexes=s}function bz(r,s,a,d,y){r.data[d]=y;let n=y.factory||(y.factory=pd(y.type,!0)),R=new Cu(n,sc(y),Pn);r.blueprint[d]=R,a[d]=R,fz(r,s,d,FA(r,a,y.hostVars,cc),y)}function wz(r,s,a){let d=Wo(s,r),y=jA(a),n=r[Ra].rendererFactory,R=16;a.signals?R=4096:a.onPush&&(R=64);let j=vv(r,yv(r,y,null,R,d,s,null,n.createRenderer(d,a),null,null,null));r[s.index]=j}function Ez(r,s,a,d,y,n){let R=Wo(r,s);Iz(s[qi],R,n,r.value,a,d,y)}function Iz(r,s,a,d,y,n,R){if(n==null)r.removeAttribute(s,y,a);else{let j=R==null?$1(n):R(n,d||"",y);r.setAttribute(s,y,j,a)}}function Tz(r,s,a,d,y,n){let R=n[s];if(R!==null)for(let j=0;j<R.length;){let $=R[j++],ie=R[j++],pe=R[j++],Me=R[j++];LA(d,a,$,ie,pe,Me)}}function Cz(r,s,a){let d=null,y=0;for(;y<a.length;){let n=a[y];if(n===0){y+=4;continue}else if(n===5){y+=2;continue}if(typeof n=="number")break;if(r.hasOwnProperty(n)){d===null&&(d=[]);let R=r[n];for(let j=0;j<R.length;j+=3)if(R[j]===s){d.push(n,R[j+1],R[j+2],a[y+1]);break}}y+=2}return d}function qA(r,s,a,d){return[r,!0,0,s,null,d,null,a,null,null]}function WA(r,s){let a=r.contentQueries;if(a!==null){let d=oi(null);try{for(let y=0;y<a.length;y+=2){let n=a[y],R=a[y+1];if(R!==-1){let j=r.data[R];LS(n),j.contentQueries(2,s[R],R)}}}finally{oi(d)}}}function vv(r,s){return r[am]?r[dM][Ts]=s:r[am]=s,r[dM]=s,s}function w1(r,s,a){LS(0);let d=oi(null);try{s(r,a)}finally{oi(d)}}function Dz(r){return r[By]??=[]}function Mz(r){return r.cleanup??=[]}function ZA(r,s){let a=r[yd],d=a?a.get(To,null):null;d&&d.handleError(s)}function gw(r,s,a,d,y){for(let n=0;n<a.length;){let R=a[n++],j=a[n++],$=a[n++],ie=s[R],pe=r.data[R];LA(pe,ie,d,j,$,y)}}function Sz(r,s,a){let d=wS(s,r);j3(r[qi],d,a)}function Az(r,s){let a=lc(s,r),d=a[Yn];Rz(d,a);let y=a[La];y!==null&&a[sm]===null&&(a[sm]=cw(y,a[yd])),_w(d,a,a[Cs])}function Rz(r,s){for(let a=s.length;a<r.blueprint.length;a++)s.push(r.blueprint[a])}function _w(r,s,a){K1(s);try{let d=r.viewQuery;d!==null&&w1(1,d,a);let y=r.template;y!==null&&NA(r,s,y,1,a),r.firstCreatePass&&(r.firstCreatePass=!1),s[xd]?.finishViewCreation(r),r.staticContentQueries&&WA(r,s),r.staticViewQueries&&w1(2,r.viewQuery,a);let n=r.components;n!==null&&Pz(s,n)}catch(d){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),d}finally{s[En]&=-5,Q1()}}function Pz(r,s){for(let a=0;a<s.length;a++)Az(r,s[a])}function XA(r,s,a,d){let y=oi(null);try{let n=s.tView,j=r[En]&4096?4096:16,$=yv(r,n,a,j,null,s,null,null,d?.injector??null,d?.embeddedViewInjector??null,d?.dehydratedView??null),ie=r[s.index];$[vd]=ie;let pe=r[xd];return pe!==null&&($[xd]=pe.createEmbeddedView(n)),_w(n,$,a),$}finally{oi(y)}}function E1(r,s){return!s||s.firstChild===null||iA(r)}function YA(r,s,a,d=!0){let y=s[Yn];if(H3(y,s,r,a),d){let R=x1(a,r),j=s[qi],$=MA(j,r[Eu]);$!==null&&$3(y,r[oo],j,s,$,R)}let n=s[sm];n!==null&&n.firstChild!==null&&(n.firstChild=null)}function Yy(r,s,a,d,y=!1){for(;a!==null;){if(a.type===128){a=y?a.projectionNext:a.next;continue}let n=s[a.index];n!==null&&d.push(Ks(n)),Fa(n)&&Oz(n,d);let R=a.type;if(R&8)Yy(r,s,a.child,d);else if(R&32){let j=hw(a,s),$;for(;$=j();)d.push($)}else if(R&16){let j=AA(s,a);if(Array.isArray(j))d.push(...j);else{let $=Iu(s[Ho]);Yy($[Yn],$,j,d,!0)}}a=y?a.projectionNext:a.next}return d}function Oz(r,s){for(let a=Go;a<r.length;a++){let d=r[a],y=d[Yn].firstChild;y!==null&&Yy(d[Yn],d,y,s)}r[Eu]!==r[La]&&s.push(r[Eu])}var JA=[];function kz(r){return r[$o]??Lz(r)}function Lz(r){let s=JA.pop()??Object.create(Nz);return s.lView=r,s}function Fz(r){r.lView[$o]!==r&&(r.lView=null,JA.push(r))}var Nz=Un(bt({},Wp),{consumerIsAlwaysLive:!0,consumerMarkedDirty:r=>{dv(r.lView)},consumerOnSignalRead(){this.lView[$o]=this}});function zz(r){let s=r[$o]??Object.create(Bz);return s.lView=r,s}var Bz=Un(bt({},Wp),{consumerIsAlwaysLive:!0,consumerMarkedDirty:r=>{let s=Iu(r.lView);for(;s&&!KA(s[Yn]);)s=Iu(s);s&&TS(s)},consumerOnSignalRead(){this.lView[$o]=this}});function KA(r){return r.type!==2}var Vz=100;function QA(r,s=!0,a=0){let d=r[Ra],y=d.rendererFactory,n=!1;n||y.begin?.();try{jz(r,a)}catch(R){throw s&&ZA(r,R),R}finally{n||(y.end?.(),d.inlineEffectRunner?.flush())}}function jz(r,s){let a=OS();try{pM(!0),I1(r,s);let d=0;for(;hv(r);){if(d===Vz)throw new on(103,!1);d++,I1(r,1)}}finally{pM(a)}}function Uz(r,s,a,d){let y=s[En];if((y&256)===256)return;let n=!1,R=!1;!n&&s[Ra].inlineEffectRunner?.flush(),K1(s);let j=!0,$=null,ie=null;n||(KA(r)?(ie=kz(s),$=X_(ie)):yD()===null?(j=!1,ie=zz(s),$=X_(ie)):s[$o]&&(lb(s[$o]),s[$o]=null));try{IS(s),PN(r.bindingStartIndex),a!==null&&NA(r,s,a,2,d);let pe=(y&3)===3;if(!n)if(pe){let Be=r.preOrderCheckHooks;Be!==null&&Ry(s,Be,null)}else{let Be=r.preOrderHooks;Be!==null&&Py(s,Be,0,null),Pb(s,0)}if(R||$z(s),e2(s,0),r.contentQueries!==null&&WA(r,s),!n)if(pe){let Be=r.contentCheckHooks;Be!==null&&Ry(s,Be)}else{let Be=r.contentHooks;Be!==null&&Py(s,Be,1),Pb(s,1)}iz(r,s);let Me=r.components;Me!==null&&n2(s,Me,0);let He=r.viewQuery;if(He!==null&&w1(2,He,d),!n)if(pe){let Be=r.viewCheckHooks;Be!==null&&Ry(s,Be)}else{let Be=r.viewHooks;Be!==null&&Py(s,Be,2),Pb(s,2)}if(r.firstUpdatePass===!0&&(r.firstUpdatePass=!1),s[Rb]){for(let Be of s[Rb])Be();s[Rb]=null}n||(s[En]&=-73)}catch(pe){throw n||dv(s),pe}finally{ie!==null&&(sb(ie,$),j&&Fz(ie)),Q1()}}function e2(r,s){for(let a=oA(r);a!==null;a=sA(a))for(let d=Go;d<a.length;d++){let y=a[d];t2(y,s)}}function $z(r){for(let s=oA(r);s!==null;s=sA(s)){if(!(s[En]&Uy.HasTransplantedViews))continue;let a=s[jy];for(let d=0;d<a.length;d++){let y=a[d];TS(y)}}}function Gz(r,s,a){let d=lc(s,r);t2(d,a)}function t2(r,s){J1(r)&&I1(r,s)}function I1(r,s){let d=r[Yn],y=r[En],n=r[$o],R=!!(s===0&&y&16);if(R||=!!(y&64&&s===0),R||=!!(y&1024),R||=!!(n?.dirty&&ab(n)),R||=!1,n&&(n.dirty=!1),r[En]&=-9217,R)Uz(d,r,d.template,r[Cs]);else if(y&8192){e2(r,1);let j=d.components;j!==null&&n2(r,j,1)}}function n2(r,s,a){for(let d=0;d<s.length;d++)Gz(r,s[d],a)}function yw(r,s){let a=OS()?64:1088;for(r[Ra].changeDetectionScheduler?.notify(s);r;){r[En]|=a;let d=Iu(r);if(Jb(r)&&!d)return r;r=d}return null}var Mu=class{get rootNodes(){let s=this._lView,a=s[Yn];return Yy(a,s,a.firstChild,[])}constructor(s,a,d=!0){this._lView=s,this._cdRefInjectingView=a,this.notifyErrorHandler=d,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Cs]}set context(s){this._lView[Cs]=s}get destroyed(){return(this._lView[En]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let s=this._lView[Ur];if(Fa(s)){let a=s[Vy],d=a?a.indexOf(this):-1;d>-1&&(v1(s,d),Ny(a,d))}this._attachedToViewContainer=!1}TA(this._lView[Yn],this._lView)}onDestroy(s){CS(this._lView,s)}markForCheck(){yw(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[En]&=-129}reattach(){Qb(this._lView),this._lView[En]|=128}detectChanges(){this._lView[En]|=1024,QA(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new on(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let s=Jb(this._lView),a=this._lView[vd];a!==null&&!s&&dw(a,this._lView),EA(this._lView[Yn],this._lView)}attachToAppRef(s){if(this._attachedToViewContainer)throw new on(902,!1);this._appRef=s;let a=Jb(this._lView),d=this._lView[vd];d!==null&&!a&&IA(d,this._lView),Qb(this._lView)}},xv=(()=>{class r{static{this.__NG_ELEMENT_ID__=Wz}}return r})(),Hz=xv,qz=class extends Hz{constructor(s,a,d){super(),this._declarationLView=s,this._declarationTContainer=a,this.elementRef=d}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(s,a){return this.createEmbeddedViewImpl(s,a)}createEmbeddedViewImpl(s,a,d){let y=XA(this._declarationLView,this._declarationTContainer,s,{embeddedViewInjector:a,dehydratedView:d});return new Mu(y)}};function Wz(){return Zz(Gr(),bi())}function Zz(r,s){return r.type&4?new qz(s,r,mv(r,s)):null}var LW=new RegExp(`^(\\d+)*(${y3}|${_3})*(.*)`);var Xz=()=>null;function T1(r,s){return Xz(r,s)}var wd=class{},bv=new Zt("",{providedIn:"root",factory:()=>!1});var i2=new Zt(""),r2=new Zt(""),C1=class{},Jy=class{};function Yz(r){let s=Error(`No component factory found for ${jr(r)}.`);return s[Jz]=r,s}var Jz="ngComponent";var D1=class{resolveComponentFactory(s){throw Yz(s)}},Ed=class{static{this.NULL=new D1}},Id=class{},uc=(()=>{class r{constructor(){this.destroyNode=null}static{this.__NG_ELEMENT_ID__=()=>Kz()}}return r})();function Kz(){let r=bi(),s=Gr(),a=lc(s.index,r);return(ic(a)?a:r)[qi]}var Qz=(()=>{class r{static{this.\u0275prov=Ft({token:r,providedIn:"root",factory:()=>null})}}return r})();function M1(r,s,a){let d=a?r.styles:null,y=a?r.classes:null,n=0;if(s!==null)for(let R=0;R<s.length;R++){let j=s[R];if(typeof j=="number")n=j;else if(n==1)y=$b(y,j);else if(n==2){let $=j,ie=s[++R];d=$b(d,$+": "+ie+";")}}a?r.styles=d:r.stylesWithoutHost=d,a?r.classes=y:r.classesWithoutHost=y}var Ky=class extends Ed{constructor(s){super(),this.ngModule=s}resolveComponentFactory(s){let a=oc(s);return new Td(a,this.ngModule)}};function PM(r,s){let a=[];for(let d in r){if(!r.hasOwnProperty(d))continue;let y=r[d];if(y===void 0)continue;let n=Array.isArray(y),R=n?y[0]:y,j=n?y[1]:rc.None;s?a.push({propName:R,templateName:d,isSignal:(j&rc.SignalBased)!==0}):a.push({propName:R,templateName:d})}return a}function eB(r){let s=r.toLowerCase();return s==="svg"?bN:s==="math"?wN:null}var Td=class extends Jy{get inputs(){let s=this.componentDef,a=s.inputTransforms,d=PM(s.inputs,!0);if(a!==null)for(let y of d)a.hasOwnProperty(y.propName)&&(y.transform=a[y.propName]);return d}get outputs(){return PM(this.componentDef.outputs,!1)}constructor(s,a){super(),this.componentDef=s,this.ngModule=a,this.componentType=s.type,this.selector=eN(s.selectors),this.ngContentSelectors=s.ngContentSelectors?s.ngContentSelectors:[],this.isBoundToModule=!!a}create(s,a,d,y){let n=oi(null);try{y=y||this.ngModule;let R=y instanceof Dr?y:y?.injector;R&&this.componentDef.getStandaloneInjector!==null&&(R=this.componentDef.getStandaloneInjector(R)||R);let j=R?new t1(s,R):s,$=j.get(Id,null);if($===null)throw new on(407,!1);let ie=j.get(Qz,null),pe=j.get(wd,null),Me={rendererFactory:$,sanitizer:ie,inlineEffectRunner:null,changeDetectionScheduler:pe},He=$.createRenderer(null,this.componentDef),Be=this.componentDef.selectors[0][0]||"div",lt=d?sz(He,d,this.componentDef.encapsulation,j):wA(He,Be,eB(Be)),rt=512;this.componentDef.signals?rt|=4096:this.componentDef.onPush||(rt|=16);let At=null;lt!==null&&(At=cw(lt,j,!0));let Kt=mw(0,null,null,1,0,null,null,null,null,null,null),St=yv(null,Kt,null,rt,null,null,Me,He,j,null,At);K1(St);let _n,hi,Dt=null;try{let ai=this.componentDef,Zi,kt=null;ai.findHostDirectiveDefs?(Zi=[],kt=new Map,ai.findHostDirectiveDefs(ai,Zi,kt),Zi.push(ai)):Zi=[ai];let Bt=tB(St,lt);Dt=nB(Bt,lt,ai,Zi,St,Me,He),hi=ES(Kt,Js),lt&&oB(He,ai,lt,d),a!==void 0&&sB(hi,this.ngContentSelectors,a),_n=rB(Dt,ai,Zi,kt,St,[aB]),_w(Kt,St,null)}catch(ai){throw Dt!==null&&c1(Dt),c1(St),ai}finally{Q1()}return new S1(this.componentType,_n,mv(hi,St),St,hi)}finally{oi(n)}}},S1=class extends C1{constructor(s,a,d,y,n){super(),this.location=d,this._rootLView=y,this._tNode=n,this.previousInputValues=null,this.instance=a,this.hostView=this.changeDetectorRef=new Mu(y,void 0,!1),this.componentType=s}setInput(s,a){let d=this._tNode.inputs,y;if(d!==null&&(y=d[s])){if(this.previousInputValues??=new Map,this.previousInputValues.has(s)&&Object.is(this.previousInputValues.get(s),a))return;let n=this._rootLView;gw(n[Yn],n,y,s,a),this.previousInputValues.set(s,a);let R=lc(this._tNode.index,n);yw(R,1)}}get injector(){return new wu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(s){this.hostView.onDestroy(s)}};function tB(r,s){let a=r[Yn],d=Js;return r[d]=s,ym(a,d,2,"#host",null)}function nB(r,s,a,d,y,n,R){let j=y[Yn];iB(d,r,s,R);let $=null;s!==null&&($=cw(s,y[yd]));let ie=n.rendererFactory.createRenderer(s,a),pe=16;a.signals?pe=4096:a.onPush&&(pe=64);let Me=yv(y,jA(a),null,pe,y[r.index],r,n,ie,null,null,$);return j.firstCreatePass&&b1(j,r,d.length-1),vv(y,Me),y[r.index]=Me}function iB(r,s,a,d){for(let y of r)s.mergedAttrs=rm(s.mergedAttrs,y.hostAttrs);s.mergedAttrs!==null&&(M1(s,s.mergedAttrs,!0),a!==null&&OA(d,a,s))}function rB(r,s,a,d,y,n){let R=Gr(),j=y[Yn],$=Wo(R,y);GA(j,y,R,a,null,d);for(let pe=0;pe<a.length;pe++){let Me=R.directiveStart+pe,He=bd(y,j,Me,R);Du(He,y)}HA(j,y,R),$&&Du($,y);let ie=bd(y,j,R.directiveStart+R.componentOffset,R);if(r[Cs]=y[Cs]=ie,n!==null)for(let pe of n)pe(ie,s);return zA(j,R,y),ie}function oB(r,s,a,d){if(d)Wb(r,a,["ng-version","18.2.12"]);else{let{attrs:y,classes:n}=tN(s.selectors[0]);y&&Wb(r,a,y),n&&n.length>0&&PA(r,a,n.join(" "))}}function sB(r,s,a){let d=r.projection=[];for(let y=0;y<s.length;y++){let n=a[y];d.push(n!=null?Array.from(n):null)}}function aB(){let r=Gr();iw(bi()[Yn],r)}var Pd=(()=>{class r{static{this.__NG_ELEMENT_ID__=lB}}return r})();function lB(){let r=Gr();return uB(r,bi())}var cB=Pd,o2=class extends cB{constructor(s,a,d){super(),this._lContainer=s,this._hostTNode=a,this._hostLView=d}get element(){return mv(this._hostTNode,this._hostLView)}get injector(){return new wu(this._hostTNode,this._hostLView)}get parentInjector(){let s=rw(this._hostTNode,this._hostLView);if($S(s)){let a=Hy(s,this._hostLView),d=Gy(s),y=a[Yn].data[d+8];return new wu(y,a)}else return new wu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(s){let a=OM(this._lContainer);return a!==null&&a[s]||null}get length(){return this._lContainer.length-Go}createEmbeddedView(s,a,d){let y,n;typeof d=="number"?y=d:d!=null&&(y=d.index,n=d.injector);let R=T1(this._lContainer,s.ssrId),j=s.createEmbeddedViewImpl(a||{},n,R);return this.insertImpl(j,y,E1(this._hostTNode,R)),j}createComponent(s,a,d,y,n){let R=s&&!_N(s),j;if(R)j=a;else{let lt=a||{};j=lt.index,d=lt.injector,y=lt.projectableNodes,n=lt.environmentInjector||lt.ngModuleRef}let $=R?s:new Td(oc(s)),ie=d||this.parentInjector;if(!n&&$.ngModule==null){let rt=(R?ie:this.parentInjector).get(Dr,null);rt&&(n=rt)}let pe=oc($.componentType??{}),Me=T1(this._lContainer,pe?.id??null),He=Me?.firstChild??null,Be=$.create(ie,y,He,n);return this.insertImpl(Be.hostView,j,E1(this._hostTNode,Me)),Be}insert(s,a){return this.insertImpl(s,a,!0)}insertImpl(s,a,d){let y=s._lView;if(EN(y)){let j=this.indexOf(s);if(j!==-1)this.detach(j);else{let $=y[Ur],ie=new o2($,$[oo],$[Ur]);ie.detach(ie.indexOf(s))}}let n=this._adjustIndex(a),R=this._lContainer;return YA(R,y,n,d),s.attachToViewContainerRef(),KM(Nb(R),n,s),s}move(s,a){return this.insert(s,a)}indexOf(s){let a=OM(this._lContainer);return a!==null?a.indexOf(s):-1}remove(s){let a=this._adjustIndex(s,-1),d=v1(this._lContainer,a);d&&(Ny(Nb(this._lContainer),a),TA(d[Yn],d))}detach(s){let a=this._adjustIndex(s,-1),d=v1(this._lContainer,a);return d&&Ny(Nb(this._lContainer),a)!=null?new Mu(d):null}_adjustIndex(s,a=0){return s??this.length+a}};function OM(r){return r[Vy]}function Nb(r){return r[Vy]||(r[Vy]=[])}function uB(r,s){let a,d=s[r.index];return Fa(d)?a=d:(a=qA(d,s,null,r),s[r.index]=a,vv(s,a)),dB(a,s,r,d),new o2(a,r,s)}function hB(r,s){let a=r[qi],d=a.createComment(""),y=Wo(s,r),n=MA(a,y);return Xy(a,n,d,X3(a,y),!1),d}var dB=mB,fB=()=>!1;function pB(r,s,a){return fB(r,s,a)}function mB(r,s,a,d){if(r[Eu])return;let y;a.type&8?y=Ks(d):y=hB(s,a),r[Eu]=y}var kM=new Set;function Od(r){kM.has(r)||(kM.add(r),performance?.mark?.("mark_feature_usage",{detail:{feature:r}}))}function s2(r){return typeof r=="function"&&r[Aa]!==void 0}function wv(r,s){Od("NgSignals");let a=SD(r),d=a[Aa];return s?.equal&&(d.equal=s.equal),a.set=y=>cb(d,y),a.update=y=>AD(d,y),a.asReadonly=gB.bind(a),a}function gB(){let r=this[Aa];if(r.readonlyFn===void 0){let s=()=>this();s[Aa]=r,r.readonlyFn=s}return r.readonlyFn}function a2(r){return s2(r)&&typeof r.set=="function"}function _B(r){return Object.getPrototypeOf(r.prototype).constructor}function hc(r){let s=_B(r.type),a=!0,d=[r];for(;s;){let y;if(sc(r))y=s.\u0275cmp||s.\u0275dir;else{if(s.\u0275cmp)throw new on(903,!1);y=s.\u0275dir}if(y){if(a){d.push(y);let R=r;R.inputs=Dy(r.inputs),R.inputTransforms=Dy(r.inputTransforms),R.declaredInputs=Dy(r.declaredInputs),R.outputs=Dy(r.outputs);let j=y.hostBindings;j&&wB(r,j);let $=y.viewQuery,ie=y.contentQueries;if($&&xB(r,$),ie&&bB(r,ie),yB(r,y),bF(r.outputs,y.outputs),sc(y)&&y.data.animation){let pe=r.data;pe.animation=(pe.animation||[]).concat(y.data.animation)}}let n=y.features;if(n)for(let R=0;R<n.length;R++){let j=n[R];j&&j.ngInherit&&j(r),j===hc&&(a=!1)}}s=Object.getPrototypeOf(s)}vB(d)}function yB(r,s){for(let a in s.inputs){if(!s.inputs.hasOwnProperty(a)||r.inputs.hasOwnProperty(a))continue;let d=s.inputs[a];if(d!==void 0&&(r.inputs[a]=d,r.declaredInputs[a]=s.declaredInputs[a],s.inputTransforms!==null)){let y=Array.isArray(d)?d[0]:d;if(!s.inputTransforms.hasOwnProperty(y))continue;r.inputTransforms??={},r.inputTransforms[y]=s.inputTransforms[y]}}}function vB(r){let s=0,a=null;for(let d=r.length-1;d>=0;d--){let y=r[d];y.hostVars=s+=y.hostVars,y.hostAttrs=rm(y.hostAttrs,a=rm(a,y.hostAttrs))}}function Dy(r){return r===md?{}:r===ro?[]:r}function xB(r,s){let a=r.viewQuery;a?r.viewQuery=(d,y)=>{s(d,y),a(d,y)}:r.viewQuery=s}function bB(r,s){let a=r.contentQueries;a?r.contentQueries=(d,y,n)=>{s(d,y,n),a(d,y,n)}:r.contentQueries=s}function wB(r,s){let a=r.hostBindings;a?r.hostBindings=(d,y)=>{s(d,y),a(d,y)}:r.hostBindings=s}function ea(r){let s=r.inputConfig,a={};for(let d in s)if(s.hasOwnProperty(d)){let y=s[d];Array.isArray(y)&&y[3]&&(a[d]=y[3])}r.inputTransforms=a}var ac=class{},lm=class{};var A1=class extends ac{constructor(s,a,d,y=!0){super(),this.ngModuleType=s,this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Ky(this);let n=lS(s);this._bootstrapComponents=bA(n.bootstrap),this._r3Injector=KS(s,a,[{provide:ac,useValue:this},{provide:Ed,useValue:this.componentFactoryResolver},...d],jr(s),new Set(["environment"])),y&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let s=this._r3Injector;!s.destroyed&&s.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(s){this.destroyCbs.push(s)}},R1=class extends lm{constructor(s){super(),this.moduleType=s}create(s){return new A1(this.moduleType,s,[])}};var Qy=class extends ac{constructor(s){super(),this.componentFactoryResolver=new Ky(this),this.instance=null;let a=new om([...s.providers,{provide:ac,useValue:this},{provide:Ed,useValue:this.componentFactoryResolver}],s.parent||lv(),s.debugName,new Set(["environment"]));this.injector=a,s.runEnvironmentInitializers&&a.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(s){this.injector.onDestroy(s)}};function vw(r,s,a=null){return new Qy({providers:r,parent:s,debugName:a,runEnvironmentInitializers:!0}).injector}function l2(r){return IB(r)?Array.isArray(r)||!(r instanceof Map)&&Symbol.iterator in r:!1}function EB(r,s){if(Array.isArray(r))for(let a=0;a<r.length;a++)s(r[a]);else{let a=r[Symbol.iterator](),d;for(;!(d=a.next()).done;)s(d.value)}}function IB(r){return r!==null&&(typeof r=="function"||typeof r=="object")}function kd(r,s,a){let d=r[s];return Object.is(d,a)?!1:(r[s]=a,!0)}function TB(r){return(r.flags&32)===32}function CB(r,s,a,d,y,n,R,j,$){let ie=s.consts,pe=ym(s,r,4,R||null,j||null);$A(s,a,pe,$y(ie,$)),iw(s,pe);let Me=pe.tView=mw(2,pe,d,y,n,s.directiveRegistry,s.pipeRegistry,null,s.schemas,ie,null);return s.queries!==null&&(s.queries.template(s,pe),Me.queries=s.queries.embeddedTView(pe)),pe}function c2(r,s,a,d,y,n,R,j,$,ie){let pe=a+Js,Me=s.firstCreatePass?CB(pe,s,r,d,y,n,R,j,$):s.data[pe];pm(Me,!1);let He=DB(s,r,Me,a);tw()&&fw(s,r,He,Me),Du(He,r);let Be=qA(He,r,He,Me);return r[pe]=Be,vv(r,Be),pB(Be,Me,r),Y1(Me)&&BA(s,r,Me),$!=null&&VA(r,Me,ie),Me}function ta(r,s,a,d,y,n,R,j){let $=bi(),ie=$r(),pe=$y(ie.consts,n);return c2($,ie,r,s,a,d,y,pe,R,j),ta}var DB=MB;function MB(r,s,a,d){return nw(!0),s[qi].createComment("")}var tm=function(r){return r[r.EarlyRead=0]="EarlyRead",r[r.Write=1]="Write",r[r.MixedReadWrite=2]="MixedReadWrite",r[r.Read=3]="Read",r}(tm||{}),SB=(()=>{class r{constructor(){this.impl=null}execute(){this.impl?.execute()}static{this.\u0275prov=Ft({token:r,providedIn:"root",factory:()=>new r})}}return r})(),LM=class r{constructor(){this.ngZone=yt(ci),this.scheduler=yt(wd),this.errorHandler=yt(To,{optional:!0}),this.sequences=new Set,this.deferredRegistrations=new Set,this.executing=!1}static{this.PHASES=[tm.EarlyRead,tm.Write,tm.MixedReadWrite,tm.Read]}execute(){this.executing=!0;for(let s of r.PHASES)for(let a of this.sequences)if(!(a.erroredOrDestroyed||!a.hooks[s]))try{a.pipelinedValue=this.ngZone.runOutsideAngular(()=>a.hooks[s](a.pipelinedValue))}catch(d){a.erroredOrDestroyed=!0,this.errorHandler?.handleError(d)}this.executing=!1;for(let s of this.sequences)s.afterRun(),s.once&&(this.sequences.delete(s),s.destroy());for(let s of this.deferredRegistrations)this.sequences.add(s);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear()}register(s){this.executing?this.deferredRegistrations.add(s):(this.sequences.add(s),this.scheduler.notify(6))}unregister(s){this.executing&&this.sequences.has(s)?(s.erroredOrDestroyed=!0,s.pipelinedValue=void 0,s.once=!0):(this.sequences.delete(s),this.deferredRegistrations.delete(s))}static{this.\u0275prov=Ft({token:r,providedIn:"root",factory:()=>new r})}};function dc(r,s,a,d){let y=bi(),n=fv();if(kd(y,n,s)){let R=$r(),j=ew();Ez(j,y,r,s,a,d)}return dc}function AB(r,s,a,d){return kd(r,fv(),a)?s+$1(a)+d:cc}function My(r,s){return r<<17|s<<2}function Su(r){return r>>17&32767}function RB(r){return(r&2)==2}function PB(r,s){return r&131071|s<<17}function P1(r){return r|2}function Cd(r){return(r&131068)>>2}function zb(r,s){return r&-131069|s<<2}function OB(r){return(r&1)===1}function O1(r){return r|1}function kB(r,s,a,d,y,n){let R=n?s.classBindings:s.styleBindings,j=Su(R),$=Cd(R);r[d]=a;let ie=!1,pe;if(Array.isArray(a)){let Me=a;pe=Me[1],(pe===null||hm(Me,pe)>0)&&(ie=!0)}else pe=a;if(y)if($!==0){let He=Su(r[j+1]);r[d+1]=My(He,j),He!==0&&(r[He+1]=zb(r[He+1],d)),r[j+1]=PB(r[j+1],d)}else r[d+1]=My(j,0),j!==0&&(r[j+1]=zb(r[j+1],d)),j=d;else r[d+1]=My($,0),j===0?j=d:r[$+1]=zb(r[$+1],d),$=d;ie&&(r[d+1]=P1(r[d+1])),FM(r,pe,d,!0),FM(r,pe,d,!1),LB(s,pe,r,d,n),R=My(j,$),n?s.classBindings=R:s.styleBindings=R}function LB(r,s,a,d,y){let n=y?r.residualClasses:r.residualStyles;n!=null&&typeof s=="string"&&hm(n,s)>=0&&(a[d+1]=O1(a[d+1]))}function FM(r,s,a,d){let y=r[a+1],n=s===null,R=d?Su(y):Cd(y),j=!1;for(;R!==0&&(j===!1||n);){let $=r[R],ie=r[R+1];FB($,s)&&(j=!0,r[R+1]=d?O1(ie):P1(ie)),R=d?Su(ie):Cd(ie)}j&&(r[a+1]=d?P1(y):O1(y))}function FB(r,s){return r===null||s==null||(Array.isArray(r)?r[1]:r)===s?!0:Array.isArray(r)&&typeof s=="string"?hm(r,s)>=0:!1}var Is={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function NB(r){return r.substring(Is.key,Is.keyEnd)}function zB(r){return BB(r),u2(r,h2(r,0,Is.textEnd))}function u2(r,s){let a=Is.textEnd;return a===s?-1:(s=Is.keyEnd=VB(r,Is.key=s,a),h2(r,s,a))}function BB(r){Is.key=0,Is.keyEnd=0,Is.value=0,Is.valueEnd=0,Is.textEnd=r.length}function h2(r,s,a){for(;s<a&&r.charCodeAt(s)<=32;)s++;return s}function VB(r,s,a){for(;s<a&&r.charCodeAt(s)>32;)s++;return s}function Hr(r,s,a){let d=bi(),y=fv();if(kd(d,y,s)){let n=$r(),R=ew();UA(n,R,d,r,s,d[qi],a,!1)}return Hr}function k1(r,s,a,d,y){let n=s.inputs,R=y?"class":"style";gw(r,a,n[R],R,d)}function qr(r,s){return UB(r,s,null,!0),qr}function xw(r){$B(XB,jB,r,!0)}function jB(r,s){for(let a=zB(s);a>=0;a=u2(s,a))W1(r,NB(s),!0)}function UB(r,s,a,d){let y=bi(),n=$r(),R=kS(2);if(n.firstUpdatePass&&f2(n,r,R,d),s!==cc&&kd(y,R,s)){let j=n.data[Ru()];p2(n,j,y,y[qi],r,y[R+1]=JB(s,a),d,R)}}function $B(r,s,a,d){let y=$r(),n=kS(2);y.firstUpdatePass&&f2(y,null,n,d);let R=bi();if(a!==cc&&kd(R,n,a)){let j=y.data[Ru()];if(m2(j,d)&&!d2(y,n)){let $=d?j.classesWithoutHost:j.stylesWithoutHost;$!==null&&(a=$b($,a||"")),k1(y,j,R,a,d)}else YB(y,j,R,R[qi],R[n+1],R[n+1]=ZB(r,s,a),d,n)}}function d2(r,s){return s>=r.expandoStartIndex}function f2(r,s,a,d){let y=r.data;if(y[a+1]===null){let n=y[Ru()],R=d2(r,a);m2(n,d)&&s===null&&!R&&(s=!1),s=GB(y,n,s,d),kB(y,n,s,a,R,d)}}function GB(r,s,a,d){let y=FN(r),n=d?s.residualClasses:s.residualStyles;if(y===null)(d?s.classBindings:s.styleBindings)===0&&(a=Bb(null,r,s,a,d),a=cm(a,s.attrs,d),n=null);else{let R=s.directiveStylingLast;if(R===-1||r[R]!==y)if(a=Bb(y,r,s,a,d),n===null){let $=HB(r,s,d);$!==void 0&&Array.isArray($)&&($=Bb(null,r,s,$[1],d),$=cm($,s.attrs,d),qB(r,s,d,$))}else n=WB(r,s,d)}return n!==void 0&&(d?s.residualClasses=n:s.residualStyles=n),a}function HB(r,s,a){let d=a?s.classBindings:s.styleBindings;if(Cd(d)!==0)return r[Su(d)]}function qB(r,s,a,d){let y=a?s.classBindings:s.styleBindings;r[Su(y)]=d}function WB(r,s,a){let d,y=s.directiveEnd;for(let n=1+s.directiveStylingLast;n<y;n++){let R=r[n].hostAttrs;d=cm(d,R,a)}return cm(d,s.attrs,a)}function Bb(r,s,a,d,y){let n=null,R=a.directiveEnd,j=a.directiveStylingLast;for(j===-1?j=a.directiveStart:j++;j<R&&(n=s[j],d=cm(d,n.hostAttrs,y),n!==r);)j++;return r!==null&&(a.directiveStylingLast=j),d}function cm(r,s,a){let d=a?1:2,y=-1;if(s!==null)for(let n=0;n<s.length;n++){let R=s[n];typeof R=="number"?y=R:y===d&&(Array.isArray(r)||(r=r===void 0?[]:["",r]),W1(r,R,a?!0:s[++n]))}return r===void 0?null:r}function ZB(r,s,a){if(a==null||a==="")return ro;let d=[],y=za(a);if(Array.isArray(y))for(let n=0;n<y.length;n++)r(d,y[n],!0);else if(typeof y=="object")for(let n in y)y.hasOwnProperty(n)&&r(d,n,y[n]);else typeof y=="string"&&s(d,y);return d}function XB(r,s,a){let d=String(s);d!==""&&!d.includes(" ")&&W1(r,d,a)}function YB(r,s,a,d,y,n,R,j){y===cc&&(y=ro);let $=0,ie=0,pe=0<y.length?y[0]:null,Me=0<n.length?n[0]:null;for(;pe!==null||Me!==null;){let He=$<y.length?y[$+1]:void 0,Be=ie<n.length?n[ie+1]:void 0,lt=null,rt;pe===Me?($+=2,ie+=2,He!==Be&&(lt=Me,rt=Be)):Me===null||pe!==null&&pe<Me?($+=2,lt=pe):(ie+=2,lt=Me,rt=Be),lt!==null&&p2(r,s,a,d,lt,rt,R,j),pe=$<y.length?y[$]:null,Me=ie<n.length?n[ie]:null}}function p2(r,s,a,d,y,n,R,j){if(!(s.type&3))return;let $=r.data,ie=$[j+1],pe=OB(ie)?NM($,s,a,y,Cd(ie),R):void 0;if(!ev(pe)){ev(n)||RB(ie)&&(n=NM($,null,a,y,j,R));let Me=wS(Ru(),a);tz(d,R,Me,y,n)}}function NM(r,s,a,d,y,n){let R=s===null,j;for(;y>0;){let $=r[y],ie=Array.isArray($),pe=ie?$[1]:$,Me=pe===null,He=a[y+1];He===cc&&(He=Me?ro:void 0);let Be=Me?Sb(He,d):pe===d?He:void 0;if(ie&&!ev(Be)&&(Be=Sb($,d)),ev(Be)&&(j=Be,R))return j;let lt=r[y+1];y=R?Su(lt):Cd(lt)}if(s!==null){let $=n?s.residualClasses:s.residualStyles;$!=null&&(j=Sb($,d))}return j}function ev(r){return r!==void 0}function JB(r,s){return r==null||r===""||(typeof s=="string"?r=r+s:typeof r=="object"&&(r=jr(za(r)))),r}function m2(r,s){return(r.flags&(s?8:16))!==0}function KB(r,s,a,d,y,n){let R=s.consts,j=$y(R,y),$=ym(s,r,2,d,j);return $A(s,a,$,$y(R,n)),$.attrs!==null&&M1($,$.attrs,!1),$.mergedAttrs!==null&&M1($,$.mergedAttrs,!0),s.queries!==null&&s.queries.elementStart(s,$),$}function gi(r,s,a,d){let y=bi(),n=$r(),R=Js+r,j=y[qi],$=n.firstCreatePass?KB(R,n,y,s,a,d):n.data[R],ie=QB(n,y,$,j,s,r);y[R]=ie;let pe=Y1($);return pm($,!0),OA(j,ie,$),!TB($)&&tw()&&fw(n,y,ie,$),CN()===0&&Du(ie,y),DN(),pe&&(BA(n,y,$),zA(n,$,y)),d!==null&&VA(y,$),gi}function wi(){let r=Gr();RS()?PS():(r=r.parent,pm(r,!1));let s=r;SN(s)&&AN(),MN();let a=$r();return a.firstCreatePass&&(iw(a,r),_S(r)&&a.queries.elementEnd(r)),s.classesWithoutHost!=null&&$N(s)&&k1(a,s,bi(),s.classesWithoutHost,!0),s.stylesWithoutHost!=null&&GN(s)&&k1(a,s,bi(),s.stylesWithoutHost,!1),wi}function na(r,s,a,d){return gi(r,s,a,d),wi(),na}var QB=(r,s,a,d,y,n)=>(nw(!0),wA(d,y,BN()));function vm(){return bi()}var tv="en-US";var eV=tv;function tV(r){typeof r=="string"&&(eV=r.toLowerCase().replace(/_/g,"-"))}var nV=(r,s,a)=>{};function Co(r,s,a,d){let y=bi(),n=$r(),R=Gr();return g2(n,y,y[qi],R,r,s,d),Co}function iV(r,s,a,d){let y=r.cleanup;if(y!=null)for(let n=0;n<y.length-1;n+=2){let R=y[n];if(R===a&&y[n+1]===d){let j=s[By],$=y[n+2];return j.length>$?j[$]:null}typeof R=="string"&&(n+=2)}return null}function g2(r,s,a,d,y,n,R){let j=Y1(d),ie=r.firstCreatePass&&Mz(r),pe=s[Cs],Me=Dz(s),He=!0;if(d.type&3||R){let rt=Wo(d,s),At=R?R(rt):rt,Kt=Me.length,St=R?hi=>R(Ks(hi[d.index])):d.index,_n=null;if(!R&&j&&(_n=iV(r,s,y,d.index)),_n!==null){let hi=_n.__ngLastListenerFn__||_n;hi.__ngNextListenerFn__=n,_n.__ngLastListenerFn__=n,He=!1}else{n=BM(d,s,pe,n),nV(rt,y,n);let hi=a.listen(At,y,n);Me.push(n,hi),ie&&ie.push(y,St,Kt,Kt+1)}}else n=BM(d,s,pe,n);let Be=d.outputs,lt;if(He&&Be!==null&&(lt=Be[y])){let rt=lt.length;if(rt)for(let At=0;At<rt;At+=2){let Kt=lt[At],St=lt[At+1],Dt=s[Kt][St].subscribe(n),ai=Me.length;Me.push(n,Dt),ie&&ie.push(y,d.index,ai,-(ai+1))}}}function zM(r,s,a,d){let y=oi(null);try{return Zs(6,s,a),a(d)!==!1}catch(n){return ZA(r,n),!1}finally{Zs(7,s,a),oi(y)}}function BM(r,s,a,d){return function y(n){if(n===Function)return d;let R=r.componentOffset>-1?lc(r.index,s):s;yw(R,5);let j=zM(s,a,d,n),$=y.__ngNextListenerFn__;for(;$;)j=zM(s,a,$,n)&&j,$=$.__ngNextListenerFn__;return j}}function Wr(r=1){return zN(r)}function rV(r,s){let a=null,d=XF(r);for(let y=0;y<s.length;y++){let n=s[y];if(n==="*"){a=y;continue}if(d===null?rS(r,n,!0):KF(d,n))return y}return a}function Ev(r){let s=bi()[Ho][oo];if(!s.projection){let a=r?r.length:1,d=s.projection=VF(a,null),y=d.slice(),n=s.child;for(;n!==null;){if(n.type!==128){let R=r?rV(n,r):0;R!==null&&(y[R]?y[R].projectionNext=n:d[R]=n,y[R]=n)}n=n.next}}}function Iv(r,s=0,a,d,y,n){let R=bi(),j=$r(),$=d?r+1:null;$!==null&&c2(R,j,$,d,y,n,null,a);let ie=ym(j,Js+r,16,null,a||null);ie.projection===null&&(ie.projection=s),PS();let Me=!R[sm]||SS();R[Ho][oo].projection[ie.projection]===null&&$!==null?oV(R,j,$):Me&&(ie.flags&32)!==32&&Q3(j,R,ie)}function oV(r,s,a){let d=Js+a,y=s.data[d],n=r[d],R=T1(n,y.tView.ssrId),j=XA(r,y,void 0,{dehydratedView:R});YA(n,j,0,E1(y,R))}function sr(r,s=""){let a=bi(),d=$r(),y=r+Js,n=d.firstCreatePass?ym(d,y,1,s,null):d.data[y],R=sV(d,a,n,s,r);a[y]=R,tw()&&fw(d,a,R,n),pm(n,!1)}var sV=(r,s,a,d,y)=>(nw(!0),V3(s[qi],d));function fc(r){return pc("",r,""),fc}function pc(r,s,a){let d=bi(),y=AB(d,r,s,a);return y!==cc&&Sz(d,Ru(),y),pc}function bw(r,s,a){a2(s)&&(s=s());let d=bi(),y=fv();if(kd(d,y,s)){let n=$r(),R=ew();UA(n,R,d,r,s,d[qi],a,!1)}return bw}function _2(r,s){let a=a2(r);return a&&r.set(s),a}function ww(r,s){let a=bi(),d=$r(),y=Gr();return g2(d,a,a[qi],y,r,s),ww}function aV(r,s,a){let d=$r();if(d.firstCreatePass){let y=sc(r);L1(a,d.data,d.blueprint,y,!0),L1(s,d.data,d.blueprint,y,!1)}}function L1(r,s,a,d,y){if(r=Vr(r),Array.isArray(r))for(let n=0;n<r.length;n++)L1(r[n],s,a,d,y);else{let n=$r(),R=bi(),j=Gr(),$=_d(r)?r:Vr(r.provide),ie=pS(r),pe=j.providerIndexes&1048575,Me=j.directiveStart,He=j.providerIndexes>>20;if(_d(r)||!r.multi){let Be=new Cu(ie,y,Pn),lt=jb($,s,y?pe:pe+He,Me);lt===-1?(i1(qy(j,R),n,$),Vb(n,r,s.length),s.push($),j.directiveStart++,j.directiveEnd++,y&&(j.providerIndexes+=1048576),a.push(Be),R.push(Be)):(a[lt]=Be,R[lt]=Be)}else{let Be=jb($,s,pe+He,Me),lt=jb($,s,pe,pe+He),rt=Be>=0&&a[Be],At=lt>=0&&a[lt];if(y&&!At||!y&&!rt){i1(qy(j,R),n,$);let Kt=uV(y?cV:lV,a.length,y,d,ie);!y&&At&&(a[lt].providerFactory=Kt),Vb(n,r,s.length,0),s.push($),j.directiveStart++,j.directiveEnd++,y&&(j.providerIndexes+=1048576),a.push(Kt),R.push(Kt)}else{let Kt=y2(a[y?lt:Be],ie,!y&&d);Vb(n,r,Be>-1?Be:lt,Kt)}!y&&d&&At&&a[lt].componentProviders++}}}function Vb(r,s,a,d){let y=_d(s),n=cN(s);if(y||n){let $=(n?Vr(s.useClass):s).prototype.ngOnDestroy;if($){let ie=r.destroyHooks||(r.destroyHooks=[]);if(!y&&s.multi){let pe=ie.indexOf(a);pe===-1?ie.push(a,[d,$]):ie[pe+1].push(d,$)}else ie.push(a,$)}}}function y2(r,s,a){return a&&r.componentProviders++,r.multi.push(s)-1}function jb(r,s,a,d){for(let y=a;y<d;y++)if(s[y]===r)return y;return-1}function lV(r,s,a,d){return F1(this.multi,[])}function cV(r,s,a,d){let y=this.multi,n;if(this.providerFactory){let R=this.providerFactory.componentProviders,j=bd(a,a[Yn],this.providerFactory.index,d);n=j.slice(0,R),F1(y,n);for(let $=R;$<j.length;$++)n.push(j[$])}else n=[],F1(y,n);return n}function F1(r,s){for(let a=0;a<r.length;a++){let d=r[a];s.push(d())}return s}function uV(r,s,a,d,y){let n=new Cu(r,a,Pn);return n.multi=[],n.index=s,n.componentProviders=0,y2(n,y,d&&!a),n}function Va(r,s=[]){return a=>{a.providersResolver=(d,y)=>aV(d,y?y(r):r,s)}}var hV=(()=>{class r{constructor(a){this._injector=a,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(a){if(!a.standalone)return null;if(!this.cachedInjectors.has(a)){let d=hS(!1,a.type),y=d.length>0?vw([d],this._injector,`Standalone[${a.type.name}]`):null;this.cachedInjectors.set(a,y)}return this.cachedInjectors.get(a)}ngOnDestroy(){try{for(let a of this.cachedInjectors.values())a!==null&&a.destroy()}finally{this.cachedInjectors.clear()}}static{this.\u0275prov=Ft({token:r,providedIn:"environment",factory:()=>new r(Ot(Dr))})}}return r})();function Zo(r){Od("NgStandalone"),r.getStandaloneInjector=s=>s.get(hV).getOrCreateStandaloneInjector(r)}var Tv=(()=>{class r{log(a){console.log(a)}warn(a){console.warn(a)}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"platform"})}}return r})();var v2=new Zt("");function Pu(r){return!!r&&typeof r.then=="function"}function x2(r){return!!r&&typeof r.subscribe=="function"}var b2=new Zt(""),w2=(()=>{class r{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,d)=>{this.resolve=a,this.reject=d}),this.appInits=yt(b2,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let a=[];for(let y of this.appInits){let n=y();if(Pu(n))a.push(n);else if(x2(n)){let R=new Promise((j,$)=>{n.subscribe({complete:j,error:$})});a.push(R)}}let d=()=>{this.done=!0,this.resolve()};Promise.all(a).then(()=>{d()}).catch(y=>{this.reject(y)}),a.length===0&&d(),this.initialized=!0}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),Cv=new Zt("");function dV(){MD(()=>{throw new on(600,!1)})}function fV(r){return r.isBoundToModule}var pV=10;function mV(r,s,a){try{let d=a();return Pu(d)?d.catch(y=>{throw s.runOutsideAngular(()=>r.handleError(y)),y}):d}catch(d){throw s.runOutsideAngular(()=>r.handleError(d)),d}}var ia=(()=>{class r{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=yt(u3),this.afterRenderManager=yt(SB),this.zonelessEnabled=yt(bv),this.dirtyFlags=0,this.deferredDirtyFlags=0,this.externalTestViews=new Set,this.beforeRender=new Gi,this.afterTick=new Gi,this.componentTypes=[],this.components=[],this.isStable=yt(Na).hasPendingTasks.pipe(an(a=>!a)),this._injector=yt(Dr)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}whenStable(){let a;return new Promise(d=>{a=this.isStable.subscribe({next:y=>{y&&d()}})}).finally(()=>{a.unsubscribe()})}get injector(){return this._injector}bootstrap(a,d){let y=a instanceof Jy;if(!this._injector.get(w2).done){let He=!y&&aS(a),Be=!1;throw new on(405,Be)}let R;y?R=a:R=this._injector.get(Ed).resolveComponentFactory(a),this.componentTypes.push(R.componentType);let j=fV(R)?void 0:this._injector.get(ac),$=d||R.selector,ie=R.create(Pa.NULL,[],$,j),pe=ie.location.nativeElement,Me=ie.injector.get(v2,null);return Me?.registerApplication(pe),ie.onDestroy(()=>{this.detachView(ie.hostView),Oy(this.components,ie),Me?.unregisterApplication(pe)}),this._loadComponent(ie),ie}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){if(this._runningTick)throw new on(101,!1);let a=oi(null);try{this._runningTick=!0,this.synchronize()}catch(d){this.internalErrorHandler(d)}finally{this._runningTick=!1,oi(a),this.afterTick.next()}}synchronize(){let a=null;this._injector.destroyed||(a=this._injector.get(Id,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let d=0;for(;this.dirtyFlags!==0&&d++<pV;)this.synchronizeOnce(a)}synchronizeOnce(a){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&7){let d=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8,this.beforeRender.next(d);for(let{_lView:y,notifyErrorHandler:n}of this._views)gV(y,n,d,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&7)return}else a?.begin?.(),a?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:a})=>hv(a))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(a){let d=a;this._views.push(d),d.attachToAppRef(this)}detachView(a){let d=a;Oy(this._views,d),d.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a);let d=this._injector.get(Cv,[]);[...this._bootstrapListeners,...d].forEach(y=>y(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>Oy(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new on(406,!1);let a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function Oy(r,s){let a=r.indexOf(s);a>-1&&r.splice(a,1)}function gV(r,s,a,d){if(!a&&!hv(r))return;QA(r,s,a&&!d?0:1)}var N1=class{constructor(s,a){this.ngModuleFactory=s,this.componentFactories=a}},Ew=(()=>{class r{compileModuleSync(a){return new R1(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){let d=this.compileModuleSync(a),y=lS(a),n=bA(y.declarations).reduce((R,j)=>{let $=oc(j);return $&&R.push(new Td($)),R},[]);return new N1(d,n)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var _V=(()=>{class r{constructor(){this.zone=yt(ci),this.changeDetectionScheduler=yt(wd),this.applicationRef=yt(ia)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),yV=new Zt("",{factory:()=>!1});function E2({ngZoneFactory:r,ignoreChangesOutsideZone:s,scheduleInRootZone:a}){return r??=()=>new ci(Un(bt({},T2()),{scheduleInRootZone:a})),[{provide:ci,useFactory:r},{provide:gd,multi:!0,useFactory:()=>{let d=yt(_V,{optional:!0});return()=>d.initialize()}},{provide:gd,multi:!0,useFactory:()=>{let d=yt(vV);return()=>{d.initialize()}}},s===!0?{provide:i2,useValue:!0}:[],{provide:r2,useValue:a??QS}]}function I2(r){let s=r?.ignoreChangesOutsideZone,a=r?.scheduleInRootZone,d=E2({ngZoneFactory:()=>{let y=T2(r);return y.scheduleInRootZone=a,y.shouldCoalesceEventChangeDetection&&Od("NgZone_CoalesceEvent"),new ci(y)},ignoreChangesOutsideZone:s,scheduleInRootZone:a});return Md([{provide:yV,useValue:!0},{provide:bv,useValue:!1},d])}function T2(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:r?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:r?.runCoalescing??!1}}var vV=(()=>{class r{constructor(){this.subscription=new Oi,this.initialized=!1,this.zone=yt(ci),this.pendingTasks=yt(Na)}initialize(){if(this.initialized)return;this.initialized=!0;let a=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(a=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{ci.assertNotInAngularZone(),queueMicrotask(()=>{a!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(a),a=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{ci.assertInAngularZone(),a??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var xV=(()=>{class r{constructor(){this.appRef=yt(ia),this.taskService=yt(Na),this.ngZone=yt(ci),this.zonelessEnabled=yt(bv),this.disableScheduling=yt(i2,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new Oi,this.angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Zy):null,this.scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(yt(r2,{optional:!0})??!1),this.cancelScheduledCallback=null,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof l1||!this.zoneIsDefined)}notify(a){if(!this.zonelessEnabled&&a===5)return;switch(a){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 7:{this.appRef.deferredDirtyFlags|=8;break}case 9:case 8:case 6:case 10:default:this.appRef.dirtyFlags|=8}if(!this.shouldScheduleTick())return;let d=this.useMicrotaskScheduler?xM:tA;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>d(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>d(()=>this.tick()))}shouldScheduleTick(){return!(this.disableScheduling||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Zy+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let a=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(d){throw this.taskService.remove(a),d}finally{this.cleanup()}this.useMicrotaskScheduler=!0,xM(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(a)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let a=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(a)}}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function bV(){return typeof $localize<"u"&&$localize.locale||tv}var Dv=new Zt("",{providedIn:"root",factory:()=>yt(Dv,Bn.Optional|Bn.SkipSelf)||bV()});var z1=new Zt("");function Sy(r){return!r.moduleRef}function wV(r){let s=Sy(r)?r.r3Injector:r.moduleRef.injector,a=s.get(ci);return a.run(()=>{Sy(r)?r.r3Injector.resolveInjectorInitializers():r.moduleRef.resolveInjectorInitializers();let d=s.get(To,null),y;if(a.runOutsideAngular(()=>{y=a.onError.subscribe({next:n=>{d.handleError(n)}})}),Sy(r)){let n=()=>s.destroy(),R=r.platformInjector.get(z1);R.add(n),s.onDestroy(()=>{y.unsubscribe(),R.delete(n)})}else{let n=()=>r.moduleRef.destroy(),R=r.platformInjector.get(z1);R.add(n),r.moduleRef.onDestroy(()=>{Oy(r.allPlatformModules,r.moduleRef),y.unsubscribe(),R.delete(n)})}return mV(d,a,()=>{let n=s.get(w2);return n.runInitializers(),n.donePromise.then(()=>{let R=s.get(Dv,tv);if(tV(R||tv),Sy(r)){let j=s.get(ia);return r.rootComponent!==void 0&&j.bootstrap(r.rootComponent),j}else return EV(r.moduleRef,r.allPlatformModules),r.moduleRef})})})}function EV(r,s){let a=r.injector.get(ia);if(r._bootstrapComponents.length>0)r._bootstrapComponents.forEach(d=>a.bootstrap(d));else if(r.instance.ngDoBootstrap)r.instance.ngDoBootstrap(a);else throw new on(-403,!1);s.push(r)}var ky=null;function IV(r=[],s){return Pa.create({name:s,providers:[{provide:av,useValue:"platform"},{provide:z1,useValue:new Set([()=>ky=null])},...r]})}function TV(r=[]){if(ky)return ky;let s=IV(r);return ky=s,dV(),CV(s),s}function CV(r){r.get(aw,null)?.forEach(a=>a())}var ja=(()=>{class r{static{this.__NG_ELEMENT_ID__=DV}}return r})();function DV(r){return MV(Gr(),bi(),(r&16)===16)}function MV(r,s,a){if(uv(r)&&!a){let d=lc(r.index,s);return new Mu(d,d)}else if(r.type&175){let d=s[Ho];return new Mu(d,s)}return null}var B1=class{constructor(){}supports(s){return l2(s)}create(s){return new V1(s)}},SV=(r,s)=>s,V1=class{constructor(s){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=s||SV}forEachItem(s){let a;for(a=this._itHead;a!==null;a=a._next)s(a)}forEachOperation(s){let a=this._itHead,d=this._removalsHead,y=0,n=null;for(;a||d;){let R=!d||a&&a.currentIndex<VM(d,y,n)?a:d,j=VM(R,y,n),$=R.currentIndex;if(R===d)y--,d=d._nextRemoved;else if(a=a._next,R.previousIndex==null)y++;else{n||(n=[]);let ie=j-y,pe=$-y;if(ie!=pe){for(let He=0;He<ie;He++){let Be=He<n.length?n[He]:n[He]=0,lt=Be+He;pe<=lt&&lt<ie&&(n[He]=Be+1)}let Me=R.previousIndex;n[Me]=pe-ie}}j!==$&&s(R,j,$)}}forEachPreviousItem(s){let a;for(a=this._previousItHead;a!==null;a=a._nextPrevious)s(a)}forEachAddedItem(s){let a;for(a=this._additionsHead;a!==null;a=a._nextAdded)s(a)}forEachMovedItem(s){let a;for(a=this._movesHead;a!==null;a=a._nextMoved)s(a)}forEachRemovedItem(s){let a;for(a=this._removalsHead;a!==null;a=a._nextRemoved)s(a)}forEachIdentityChange(s){let a;for(a=this._identityChangesHead;a!==null;a=a._nextIdentityChange)s(a)}diff(s){if(s==null&&(s=[]),!l2(s))throw new on(900,!1);return this.check(s)?this:null}onDestroy(){}check(s){this._reset();let a=this._itHead,d=!1,y,n,R;if(Array.isArray(s)){this.length=s.length;for(let j=0;j<this.length;j++)n=s[j],R=this._trackByFn(j,n),a===null||!Object.is(a.trackById,R)?(a=this._mismatch(a,n,R,j),d=!0):(d&&(a=this._verifyReinsertion(a,n,R,j)),Object.is(a.item,n)||this._addIdentityChange(a,n)),a=a._next}else y=0,EB(s,j=>{R=this._trackByFn(y,j),a===null||!Object.is(a.trackById,R)?(a=this._mismatch(a,j,R,y),d=!0):(d&&(a=this._verifyReinsertion(a,j,R,y)),Object.is(a.item,j)||this._addIdentityChange(a,j)),a=a._next,y++}),this.length=y;return this._truncate(a),this.collection=s,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let s;for(s=this._previousItHead=this._itHead;s!==null;s=s._next)s._nextPrevious=s._next;for(s=this._additionsHead;s!==null;s=s._nextAdded)s.previousIndex=s.currentIndex;for(this._additionsHead=this._additionsTail=null,s=this._movesHead;s!==null;s=s._nextMoved)s.previousIndex=s.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(s,a,d,y){let n;return s===null?n=this._itTail:(n=s._prev,this._remove(s)),s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(d,null),s!==null?(Object.is(s.item,a)||this._addIdentityChange(s,a),this._reinsertAfter(s,n,y)):(s=this._linkedRecords===null?null:this._linkedRecords.get(d,y),s!==null?(Object.is(s.item,a)||this._addIdentityChange(s,a),this._moveAfter(s,n,y)):s=this._addAfter(new j1(a,d),n,y)),s}_verifyReinsertion(s,a,d,y){let n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(d,null);return n!==null?s=this._reinsertAfter(n,s._prev,y):s.currentIndex!=y&&(s.currentIndex=y,this._addToMoves(s,y)),s}_truncate(s){for(;s!==null;){let a=s._next;this._addToRemovals(this._unlink(s)),s=a}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(s,a,d){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(s);let y=s._prevRemoved,n=s._nextRemoved;return y===null?this._removalsHead=n:y._nextRemoved=n,n===null?this._removalsTail=y:n._prevRemoved=y,this._insertAfter(s,a,d),this._addToMoves(s,d),s}_moveAfter(s,a,d){return this._unlink(s),this._insertAfter(s,a,d),this._addToMoves(s,d),s}_addAfter(s,a,d){return this._insertAfter(s,a,d),this._additionsTail===null?this._additionsTail=this._additionsHead=s:this._additionsTail=this._additionsTail._nextAdded=s,s}_insertAfter(s,a,d){let y=a===null?this._itHead:a._next;return s._next=y,s._prev=a,y===null?this._itTail=s:y._prev=s,a===null?this._itHead=s:a._next=s,this._linkedRecords===null&&(this._linkedRecords=new nv),this._linkedRecords.put(s),s.currentIndex=d,s}_remove(s){return this._addToRemovals(this._unlink(s))}_unlink(s){this._linkedRecords!==null&&this._linkedRecords.remove(s);let a=s._prev,d=s._next;return a===null?this._itHead=d:a._next=d,d===null?this._itTail=a:d._prev=a,s}_addToMoves(s,a){return s.previousIndex===a||(this._movesTail===null?this._movesTail=this._movesHead=s:this._movesTail=this._movesTail._nextMoved=s),s}_addToRemovals(s){return this._unlinkedRecords===null&&(this._unlinkedRecords=new nv),this._unlinkedRecords.put(s),s.currentIndex=null,s._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=s,s._prevRemoved=null):(s._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=s),s}_addIdentityChange(s,a){return s.item=a,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=s:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=s,s}},j1=class{constructor(s,a){this.item=s,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},U1=class{constructor(){this._head=null,this._tail=null}add(s){this._head===null?(this._head=this._tail=s,s._nextDup=null,s._prevDup=null):(this._tail._nextDup=s,s._prevDup=this._tail,s._nextDup=null,this._tail=s)}get(s,a){let d;for(d=this._head;d!==null;d=d._nextDup)if((a===null||a<=d.currentIndex)&&Object.is(d.trackById,s))return d;return null}remove(s){let a=s._prevDup,d=s._nextDup;return a===null?this._head=d:a._nextDup=d,d===null?this._tail=a:d._prevDup=a,this._head===null}},nv=class{constructor(){this.map=new Map}put(s){let a=s.trackById,d=this.map.get(a);d||(d=new U1,this.map.set(a,d)),d.add(s)}get(s,a){let d=s,y=this.map.get(d);return y?y.get(s,a):null}remove(s){let a=s.trackById;return this.map.get(a).remove(s)&&this.map.delete(a),s}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function VM(r,s,a){let d=r.previousIndex;if(d===null)return d;let y=0;return a&&d<a.length&&(y=a[d]),d+s+y}function jM(){return new Iw([new B1])}var Iw=(()=>{class r{static{this.\u0275prov=Ft({token:r,providedIn:"root",factory:jM})}constructor(a){this.factories=a}static create(a,d){if(d!=null){let y=d.factories.slice();a=a.concat(y)}return new r(a)}static extend(a){return{provide:r,useFactory:d=>r.create(a,d||jM()),deps:[[r,new H1,new sv]]}}find(a){let d=this.factories.find(y=>y.supports(a));if(d!=null)return d;throw new on(901,!1)}}return r})();function C2(r){try{let{rootComponent:s,appProviders:a,platformProviders:d}=r,y=TV(d),n=[E2({}),{provide:wd,useExisting:xV},...a||[]],R=new Qy({providers:n,parent:y,debugName:"",runEnvironmentInitializers:!1});return wV({r3Injector:R.injector,platformInjector:y,rootComponent:s})}catch(s){return Promise.reject(s)}}function Xo(r){return typeof r=="boolean"?r:r!=null&&r!=="false"}function Mv(r,s){Od("NgSignals");let a=TD(r);return s?.equal&&(a[Aa].equal=s.equal),a}function mc(r){let s=oi(null);try{return r()}finally{oi(s)}}function D2(r,s){let a=oc(r),d=s.elementInjector||lv();return new Td(a).create(d,s.projectableNodes,s.hostElement,s.environmentInjector)}var P2=null;function Ua(){return P2}function O2(r){P2??=r}var Sv=class{};var Si=new Zt(""),k2=(()=>{class r{historyGo(a){throw new Error("")}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:()=>yt(PV),providedIn:"platform"})}}return r})();var PV=(()=>{class r extends k2{constructor(){super(),this._doc=yt(Si),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ua().getBaseHref(this._doc)}onPopState(a){let d=Ua().getGlobalEventTarget(this._doc,"window");return d.addEventListener("popstate",a,!1),()=>d.removeEventListener("popstate",a)}onHashChange(a){let d=Ua().getGlobalEventTarget(this._doc,"window");return d.addEventListener("hashchange",a,!1),()=>d.removeEventListener("hashchange",a)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(a){this._location.pathname=a}pushState(a,d,y){this._history.pushState(a,d,y)}replaceState(a,d,y){this._history.replaceState(a,d,y)}forward(){this._history.forward()}back(){this._history.back()}historyGo(a=0){this._history.go(a)}getState(){return this._history.state}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:()=>new r,providedIn:"platform"})}}return r})();function L2(r,s){if(r.length==0)return s;if(s.length==0)return r;let a=0;return r.endsWith("/")&&a++,s.startsWith("/")&&a++,a==2?r+s.substring(1):a==1?r+s:r+"/"+s}function M2(r){let s=r.match(/#|\?|$/),a=s&&s.index||r.length,d=a-(r[a-1]==="/"?1:0);return r.slice(0,d)+r.slice(a)}function Ou(r){return r&&r[0]!=="?"?"?"+r:r}var Rv=(()=>{class r{historyGo(a){throw new Error("")}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:()=>yt(F2),providedIn:"root"})}}return r})(),OV=new Zt(""),F2=(()=>{class r extends Rv{constructor(a,d){super(),this._platformLocation=a,this._removeListenerFns=[],this._baseHref=d??this._platformLocation.getBaseHrefFromDOM()??yt(Si).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(a){this._removeListenerFns.push(this._platformLocation.onPopState(a),this._platformLocation.onHashChange(a))}getBaseHref(){return this._baseHref}prepareExternalUrl(a){return L2(this._baseHref,a)}path(a=!1){let d=this._platformLocation.pathname+Ou(this._platformLocation.search),y=this._platformLocation.hash;return y&&a?`${d}${y}`:d}pushState(a,d,y,n){let R=this.prepareExternalUrl(y+Ou(n));this._platformLocation.pushState(a,d,R)}replaceState(a,d,y,n){let R=this.prepareExternalUrl(y+Ou(n));this._platformLocation.replaceState(a,d,R)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(a=0){this._platformLocation.historyGo?.(a)}static{this.\u0275fac=function(d){return new(d||r)(Ot(k2),Ot(OV,8))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var xm=(()=>{class r{constructor(a){this._subject=new Hi,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=a;let d=this._locationStrategy.getBaseHref();this._basePath=FV(M2(S2(d))),this._locationStrategy.onPopState(y=>{this._subject.emit({url:this.path(!0),pop:!0,state:y.state,type:y.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(a=!1){return this.normalize(this._locationStrategy.path(a))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(a,d=""){return this.path()==this.normalize(a+Ou(d))}normalize(a){return r.stripTrailingSlash(LV(this._basePath,S2(a)))}prepareExternalUrl(a){return a&&a[0]!=="/"&&(a="/"+a),this._locationStrategy.prepareExternalUrl(a)}go(a,d="",y=null){this._locationStrategy.pushState(y,"",a,d),this._notifyUrlChangeListeners(this.prepareExternalUrl(a+Ou(d)),y)}replaceState(a,d="",y=null){this._locationStrategy.replaceState(y,"",a,d),this._notifyUrlChangeListeners(this.prepareExternalUrl(a+Ou(d)),y)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(a=0){this._locationStrategy.historyGo?.(a)}onUrlChange(a){return this._urlChangeListeners.push(a),this._urlChangeSubscription??=this.subscribe(d=>{this._notifyUrlChangeListeners(d.url,d.state)}),()=>{let d=this._urlChangeListeners.indexOf(a);this._urlChangeListeners.splice(d,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(a="",d){this._urlChangeListeners.forEach(y=>y(a,d))}subscribe(a,d,y){return this._subject.subscribe({next:a,error:d,complete:y})}static{this.normalizeQueryParams=Ou}static{this.joinWithSlash=L2}static{this.stripTrailingSlash=M2}static{this.\u0275fac=function(d){return new(d||r)(Ot(Rv))}}static{this.\u0275prov=Ft({token:r,factory:()=>kV(),providedIn:"root"})}}return r})();function kV(){return new xm(Ot(Rv))}function LV(r,s){if(!r||!s.startsWith(r))return s;let a=s.substring(r.length);return a===""||["/",";","?","#"].includes(a[0])?a:s}function S2(r){return r.replace(/\/index.html$/,"")}function FV(r){if(new RegExp("^(https?:)?//").test(r)){let[,a]=r.split(/\/\/[^\/]+/);return a}return r}function Pv(r,s){s=encodeURIComponent(s);for(let a of r.split(";")){let d=a.indexOf("="),[y,n]=d==-1?[a,""]:[a.slice(0,d),a.slice(d+1)];if(y.trim()===s)return decodeURIComponent(n)}return null}var Tw=class{constructor(s,a,d,y){this.$implicit=s,this.ngForOf=a,this.index=d,this.count=y}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},N2=(()=>{class r{set ngForOf(a){this._ngForOf=a,this._ngForOfDirty=!0}set ngForTrackBy(a){this._trackByFn=a}get ngForTrackBy(){return this._trackByFn}constructor(a,d,y){this._viewContainer=a,this._template=d,this._differs=y,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(a){a&&(this._template=a)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let a=this._ngForOf;if(!this._differ&&a)if(0)try{}catch{}else this._differ=this._differs.find(a).create(this.ngForTrackBy)}if(this._differ){let a=this._differ.diff(this._ngForOf);a&&this._applyChanges(a)}}_applyChanges(a){let d=this._viewContainer;a.forEachOperation((y,n,R)=>{if(y.previousIndex==null)d.createEmbeddedView(this._template,new Tw(y.item,this._ngForOf,-1,-1),R===null?void 0:R);else if(R==null)d.remove(n===null?void 0:n);else if(n!==null){let j=d.get(n);d.move(j,R),A2(j,y)}});for(let y=0,n=d.length;y<n;y++){let j=d.get(y).context;j.index=y,j.count=n,j.ngForOf=this._ngForOf}a.forEachIdentityChange(y=>{let n=d.get(y.currentIndex);A2(n,y)})}static ngTemplateContextGuard(a,d){return!0}static{this.\u0275fac=function(d){return new(d||r)(Pn(Pd),Pn(xv),Pn(Iw))}}static{this.\u0275dir=or({type:r,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0})}}return r})();function A2(r,s){r.context.$implicit=s.item}var z2=(()=>{class r{constructor(a,d){this._viewContainer=a,this._context=new Cw,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=d}set ngIf(a){this._context.$implicit=this._context.ngIf=a,this._updateView()}set ngIfThen(a){R2("ngIfThen",a),this._thenTemplateRef=a,this._thenViewRef=null,this._updateView()}set ngIfElse(a){R2("ngIfElse",a),this._elseTemplateRef=a,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(a,d){return!0}static{this.\u0275fac=function(d){return new(d||r)(Pn(Pd),Pn(xv))}}static{this.\u0275dir=or({type:r,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return r})(),Cw=class{constructor(){this.$implicit=null,this.ngIf=null}};function R2(r,s){if(!!!(!s||s.createEmbeddedView))throw new Error(`${r} must be a TemplateRef, but received '${jr(s)}'.`)}var Dw=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({})}}return r})(),Mw="browser",NV="server";function B2(r){return r===Mw}function Ov(r){return r===NV}var Ld=class{};var wm=class{},Lv=class{},$a=class r{constructor(s){this.normalizedNames=new Map,this.lazyUpdate=null,s?typeof s=="string"?this.lazyInit=()=>{this.headers=new Map,s.split(`
`).forEach(a=>{let d=a.indexOf(":");if(d>0){let y=a.slice(0,d),n=y.toLowerCase(),R=a.slice(d+1).trim();this.maybeSetNormalizedName(y,n),this.headers.has(n)?this.headers.get(n).push(R):this.headers.set(n,[R])}})}:typeof Headers<"u"&&s instanceof Headers?(this.headers=new Map,s.forEach((a,d)=>{this.setHeaderEntries(d,a)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(s).forEach(([a,d])=>{this.setHeaderEntries(a,d)})}:this.headers=new Map}has(s){return this.init(),this.headers.has(s.toLowerCase())}get(s){this.init();let a=this.headers.get(s.toLowerCase());return a&&a.length>0?a[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(s){return this.init(),this.headers.get(s.toLowerCase())||null}append(s,a){return this.clone({name:s,value:a,op:"a"})}set(s,a){return this.clone({name:s,value:a,op:"s"})}delete(s,a){return this.clone({name:s,value:a,op:"d"})}maybeSetNormalizedName(s,a){this.normalizedNames.has(a)||this.normalizedNames.set(a,s)}init(){this.lazyInit&&(this.lazyInit instanceof r?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(s=>this.applyUpdate(s)),this.lazyUpdate=null))}copyFrom(s){s.init(),Array.from(s.headers.keys()).forEach(a=>{this.headers.set(a,s.headers.get(a)),this.normalizedNames.set(a,s.normalizedNames.get(a))})}clone(s){let a=new r;return a.lazyInit=this.lazyInit&&this.lazyInit instanceof r?this.lazyInit:this,a.lazyUpdate=(this.lazyUpdate||[]).concat([s]),a}applyUpdate(s){let a=s.name.toLowerCase();switch(s.op){case"a":case"s":let d=s.value;if(typeof d=="string"&&(d=[d]),d.length===0)return;this.maybeSetNormalizedName(s.name,a);let y=(s.op==="a"?this.headers.get(a):void 0)||[];y.push(...d),this.headers.set(a,y);break;case"d":let n=s.value;if(!n)this.headers.delete(a),this.normalizedNames.delete(a);else{let R=this.headers.get(a);if(!R)return;R=R.filter(j=>n.indexOf(j)===-1),R.length===0?(this.headers.delete(a),this.normalizedNames.delete(a)):this.headers.set(a,R)}break}}setHeaderEntries(s,a){let d=(Array.isArray(a)?a:[a]).map(n=>n.toString()),y=s.toLowerCase();this.headers.set(y,d),this.maybeSetNormalizedName(s,y)}forEach(s){this.init(),Array.from(this.normalizedNames.keys()).forEach(a=>s(this.normalizedNames.get(a),this.headers.get(a)))}};var Aw=class{encodeKey(s){return j2(s)}encodeValue(s){return j2(s)}decodeKey(s){return decodeURIComponent(s)}decodeValue(s){return decodeURIComponent(s)}};function zV(r,s){let a=new Map;return r.length>0&&r.replace(/^\?/,"").split("&").forEach(y=>{let n=y.indexOf("="),[R,j]=n==-1?[s.decodeKey(y),""]:[s.decodeKey(y.slice(0,n)),s.decodeValue(y.slice(n+1))],$=a.get(R)||[];$.push(j),a.set(R,$)}),a}var BV=/%(\d[a-f0-9])/gi,VV={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function j2(r){return encodeURIComponent(r).replace(BV,(s,a)=>VV[a]??s)}function kv(r){return`${r}`}var _c=class r{constructor(s={}){if(this.updates=null,this.cloneFrom=null,this.encoder=s.encoder||new Aw,s.fromString){if(s.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=zV(s.fromString,this.encoder)}else s.fromObject?(this.map=new Map,Object.keys(s.fromObject).forEach(a=>{let d=s.fromObject[a],y=Array.isArray(d)?d.map(kv):[kv(d)];this.map.set(a,y)})):this.map=null}has(s){return this.init(),this.map.has(s)}get(s){this.init();let a=this.map.get(s);return a?a[0]:null}getAll(s){return this.init(),this.map.get(s)||null}keys(){return this.init(),Array.from(this.map.keys())}append(s,a){return this.clone({param:s,value:a,op:"a"})}appendAll(s){let a=[];return Object.keys(s).forEach(d=>{let y=s[d];Array.isArray(y)?y.forEach(n=>{a.push({param:d,value:n,op:"a"})}):a.push({param:d,value:y,op:"a"})}),this.clone(a)}set(s,a){return this.clone({param:s,value:a,op:"s"})}delete(s,a){return this.clone({param:s,value:a,op:"d"})}toString(){return this.init(),this.keys().map(s=>{let a=this.encoder.encodeKey(s);return this.map.get(s).map(d=>a+"="+this.encoder.encodeValue(d)).join("&")}).filter(s=>s!=="").join("&")}clone(s){let a=new r({encoder:this.encoder});return a.cloneFrom=this.cloneFrom||this,a.updates=(this.updates||[]).concat(s),a}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(s=>this.map.set(s,this.cloneFrom.map.get(s))),this.updates.forEach(s=>{switch(s.op){case"a":case"s":let a=(s.op==="a"?this.map.get(s.param):void 0)||[];a.push(kv(s.value)),this.map.set(s.param,a);break;case"d":if(s.value!==void 0){let d=this.map.get(s.param)||[],y=d.indexOf(kv(s.value));y!==-1&&d.splice(y,1),d.length>0?this.map.set(s.param,d):this.map.delete(s.param)}else{this.map.delete(s.param);break}}}),this.cloneFrom=this.updates=null)}};var Rw=class{constructor(){this.map=new Map}set(s,a){return this.map.set(s,a),this}get(s){return this.map.has(s)||this.map.set(s,s.defaultValue()),this.map.get(s)}delete(s){return this.map.delete(s),this}has(s){return this.map.has(s)}keys(){return this.map.keys()}};function jV(r){switch(r){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function U2(r){return typeof ArrayBuffer<"u"&&r instanceof ArrayBuffer}function $2(r){return typeof Blob<"u"&&r instanceof Blob}function G2(r){return typeof FormData<"u"&&r instanceof FormData}function UV(r){return typeof URLSearchParams<"u"&&r instanceof URLSearchParams}var bm=class r{constructor(s,a,d,y){this.url=a,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=s.toUpperCase();let n;if(jV(this.method)||y?(this.body=d!==void 0?d:null,n=y):n=d,n&&(this.reportProgress=!!n.reportProgress,this.withCredentials=!!n.withCredentials,n.responseType&&(this.responseType=n.responseType),n.headers&&(this.headers=n.headers),n.context&&(this.context=n.context),n.params&&(this.params=n.params),this.transferCache=n.transferCache),this.headers??=new $a,this.context??=new Rw,!this.params)this.params=new _c,this.urlWithParams=a;else{let R=this.params.toString();if(R.length===0)this.urlWithParams=a;else{let j=a.indexOf("?"),$=j===-1?"?":j<a.length-1?"&":"";this.urlWithParams=a+$+R}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||U2(this.body)||$2(this.body)||G2(this.body)||UV(this.body)?this.body:this.body instanceof _c?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||G2(this.body)?null:$2(this.body)?this.body.type||null:U2(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof _c?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(s={}){let a=s.method||this.method,d=s.url||this.url,y=s.responseType||this.responseType,n=s.transferCache??this.transferCache,R=s.body!==void 0?s.body:this.body,j=s.withCredentials??this.withCredentials,$=s.reportProgress??this.reportProgress,ie=s.headers||this.headers,pe=s.params||this.params,Me=s.context??this.context;return s.setHeaders!==void 0&&(ie=Object.keys(s.setHeaders).reduce((He,Be)=>He.set(Be,s.setHeaders[Be]),ie)),s.setParams&&(pe=Object.keys(s.setParams).reduce((He,Be)=>He.set(Be,s.setParams[Be]),pe)),new r(a,d,R,{params:pe,headers:ie,context:Me,reportProgress:$,responseType:y,withCredentials:j,transferCache:n})}},yc=function(r){return r[r.Sent=0]="Sent",r[r.UploadProgress=1]="UploadProgress",r[r.ResponseHeader=2]="ResponseHeader",r[r.DownloadProgress=3]="DownloadProgress",r[r.Response=4]="Response",r[r.User=5]="User",r}(yc||{}),Em=class{constructor(s,a=200,d="OK"){this.headers=s.headers||new $a,this.status=s.status!==void 0?s.status:a,this.statusText=s.statusText||d,this.url=s.url||null,this.ok=this.status>=200&&this.status<300}},Fv=class r extends Em{constructor(s={}){super(s),this.type=yc.ResponseHeader}clone(s={}){return new r({headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0})}},Im=class r extends Em{constructor(s={}){super(s),this.type=yc.Response,this.body=s.body!==void 0?s.body:null}clone(s={}){return new r({body:s.body!==void 0?s.body:this.body,headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0})}},gc=class extends Em{constructor(s){super(s,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${s.url||"(unknown url)"}`:this.message=`Http failure response for ${s.url||"(unknown url)"}: ${s.status} ${s.statusText}`,this.error=s.error||null}},X2=200,$V=204;function Sw(r,s){return{body:s,headers:r.headers,context:r.context,observe:r.observe,params:r.params,reportProgress:r.reportProgress,responseType:r.responseType,withCredentials:r.withCredentials,transferCache:r.transferCache}}var ku=(()=>{class r{constructor(a){this.handler=a}request(a,d,y={}){let n;if(a instanceof bm)n=a;else{let $;y.headers instanceof $a?$=y.headers:$=new $a(y.headers);let ie;y.params&&(y.params instanceof _c?ie=y.params:ie=new _c({fromObject:y.params})),n=new bm(a,d,y.body!==void 0?y.body:null,{headers:$,context:y.context,params:ie,reportProgress:y.reportProgress,responseType:y.responseType||"json",withCredentials:y.withCredentials,transferCache:y.transferCache})}let R=hn(n).pipe(Ql($=>this.handler.handle($)));if(a instanceof bm||y.observe==="events")return R;let j=R.pipe(Br($=>$ instanceof Im));switch(y.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return j.pipe(an($=>{if($.body!==null&&!($.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return $.body}));case"blob":return j.pipe(an($=>{if($.body!==null&&!($.body instanceof Blob))throw new Error("Response is not a Blob.");return $.body}));case"text":return j.pipe(an($=>{if($.body!==null&&typeof $.body!="string")throw new Error("Response is not a string.");return $.body}));case"json":default:return j.pipe(an($=>$.body))}case"response":return j;default:throw new Error(`Unreachable: unhandled observe type ${y.observe}}`)}}delete(a,d={}){return this.request("DELETE",a,d)}get(a,d={}){return this.request("GET",a,d)}head(a,d={}){return this.request("HEAD",a,d)}jsonp(a,d){return this.request("JSONP",a,{params:new _c().append(d,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(a,d={}){return this.request("OPTIONS",a,d)}patch(a,d,y={}){return this.request("PATCH",a,Sw(y,d))}post(a,d,y={}){return this.request("POST",a,Sw(y,d))}put(a,d,y={}){return this.request("PUT",a,Sw(y,d))}static{this.\u0275fac=function(d){return new(d||r)(Ot(wm))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})(),GV=/^\)\]\}',?\n/,HV="X-Request-URL";function H2(r){if(r.url)return r.url;let s=HV.toLocaleLowerCase();return r.headers.get(s)}var qV=(()=>{class r{constructor(){this.fetchImpl=yt(Pw,{optional:!0})?.fetch??((...a)=>globalThis.fetch(...a)),this.ngZone=yt(ci)}handle(a){return new Xn(d=>{let y=new AbortController;return this.doRequest(a,y.signal,d).then(Ow,n=>d.error(new gc({error:n}))),()=>y.abort()})}doRequest(a,d,y){return no(this,null,function*(){let n=this.createRequestInit(a),R;try{let Be=this.ngZone.runOutsideAngular(()=>this.fetchImpl(a.urlWithParams,bt({signal:d},n)));WV(Be),y.next({type:yc.Sent}),R=yield Be}catch(Be){y.error(new gc({error:Be,status:Be.status??0,statusText:Be.statusText,url:a.urlWithParams,headers:Be.headers}));return}let j=new $a(R.headers),$=R.statusText,ie=H2(R)??a.urlWithParams,pe=R.status,Me=null;if(a.reportProgress&&y.next(new Fv({headers:j,status:pe,statusText:$,url:ie})),R.body){let Be=R.headers.get("content-length"),lt=[],rt=R.body.getReader(),At=0,Kt,St,_n=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>no(this,null,function*(){for(;;){let{done:Dt,value:ai}=yield rt.read();if(Dt)break;if(lt.push(ai),At+=ai.length,a.reportProgress){St=a.responseType==="text"?(St??"")+(Kt??=new TextDecoder).decode(ai,{stream:!0}):void 0;let Zi=()=>y.next({type:yc.DownloadProgress,total:Be?+Be:void 0,loaded:At,partialText:St});_n?_n.run(Zi):Zi()}}}));let hi=this.concatChunks(lt,At);try{let Dt=R.headers.get("Content-Type")??"";Me=this.parseBody(a,hi,Dt)}catch(Dt){y.error(new gc({error:Dt,headers:new $a(R.headers),status:R.status,statusText:R.statusText,url:H2(R)??a.urlWithParams}));return}}pe===0&&(pe=Me?X2:0),pe>=200&&pe<300?(y.next(new Im({body:Me,headers:j,status:pe,statusText:$,url:ie})),y.complete()):y.error(new gc({error:Me,headers:j,status:pe,statusText:$,url:ie}))})}parseBody(a,d,y){switch(a.responseType){case"json":let n=new TextDecoder().decode(d).replace(GV,"");return n===""?null:JSON.parse(n);case"text":return new TextDecoder().decode(d);case"blob":return new Blob([d],{type:y});case"arraybuffer":return d.buffer}}createRequestInit(a){let d={},y=a.withCredentials?"include":void 0;if(a.headers.forEach((n,R)=>d[n]=R.join(",")),a.headers.has("Accept")||(d.Accept="application/json, text/plain, */*"),!a.headers.has("Content-Type")){let n=a.detectContentTypeHeader();n!==null&&(d["Content-Type"]=n)}return{body:a.serializeBody(),method:a.method,headers:d,credentials:y}}concatChunks(a,d){let y=new Uint8Array(d),n=0;for(let R of a)y.set(R,n),n+=R.length;return y}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})(),Pw=class{};function Ow(){}function WV(r){r.then(Ow,Ow)}function Y2(r,s){return s(r)}function ZV(r,s){return(a,d)=>s.intercept(a,{handle:y=>r(y,d)})}function XV(r,s,a){return(d,y)=>Ds(a,()=>s(d,n=>r(n,y)))}var YV=new Zt(""),kw=new Zt(""),JV=new Zt(""),J2=new Zt("",{providedIn:"root",factory:()=>!0});function KV(){let r=null;return(s,a)=>{r===null&&(r=(yt(YV,{optional:!0})??[]).reduceRight(ZV,Y2));let d=yt(Na);if(yt(J2)){let n=d.add();return r(s,a).pipe(qs(()=>d.remove(n)))}else return r(s,a)}}var q2=(()=>{class r extends wm{constructor(a,d){super(),this.backend=a,this.injector=d,this.chain=null,this.pendingTasks=yt(Na),this.contributeToStability=yt(J2)}handle(a){if(this.chain===null){let d=Array.from(new Set([...this.injector.get(kw),...this.injector.get(JV,[])]));this.chain=d.reduceRight((y,n)=>XV(y,n,this.injector),Y2)}if(this.contributeToStability){let d=this.pendingTasks.add();return this.chain(a,y=>this.backend.handle(y)).pipe(qs(()=>this.pendingTasks.remove(d)))}else return this.chain(a,d=>this.backend.handle(d))}static{this.\u0275fac=function(d){return new(d||r)(Ot(Lv),Ot(Dr))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})();var QV=/^\)\]\}',?\n/;function e4(r){return"responseURL"in r&&r.responseURL?r.responseURL:/^X-Request-URL:/m.test(r.getAllResponseHeaders())?r.getResponseHeader("X-Request-URL"):null}var W2=(()=>{class r{constructor(a){this.xhrFactory=a}handle(a){if(a.method==="JSONP")throw new on(-2800,!1);let d=this.xhrFactory;return(d.\u0275loadImpl?zi(d.\u0275loadImpl()):hn(null)).pipe(Io(()=>new Xn(n=>{let R=d.build();if(R.open(a.method,a.urlWithParams),a.withCredentials&&(R.withCredentials=!0),a.headers.forEach((rt,At)=>R.setRequestHeader(rt,At.join(","))),a.headers.has("Accept")||R.setRequestHeader("Accept","application/json, text/plain, */*"),!a.headers.has("Content-Type")){let rt=a.detectContentTypeHeader();rt!==null&&R.setRequestHeader("Content-Type",rt)}if(a.responseType){let rt=a.responseType.toLowerCase();R.responseType=rt!=="json"?rt:"text"}let j=a.serializeBody(),$=null,ie=()=>{if($!==null)return $;let rt=R.statusText||"OK",At=new $a(R.getAllResponseHeaders()),Kt=e4(R)||a.url;return $=new Fv({headers:At,status:R.status,statusText:rt,url:Kt}),$},pe=()=>{let{headers:rt,status:At,statusText:Kt,url:St}=ie(),_n=null;At!==$V&&(_n=typeof R.response>"u"?R.responseText:R.response),At===0&&(At=_n?X2:0);let hi=At>=200&&At<300;if(a.responseType==="json"&&typeof _n=="string"){let Dt=_n;_n=_n.replace(QV,"");try{_n=_n!==""?JSON.parse(_n):null}catch(ai){_n=Dt,hi&&(hi=!1,_n={error:ai,text:_n})}}hi?(n.next(new Im({body:_n,headers:rt,status:At,statusText:Kt,url:St||void 0})),n.complete()):n.error(new gc({error:_n,headers:rt,status:At,statusText:Kt,url:St||void 0}))},Me=rt=>{let{url:At}=ie(),Kt=new gc({error:rt,status:R.status||0,statusText:R.statusText||"Unknown Error",url:At||void 0});n.error(Kt)},He=!1,Be=rt=>{He||(n.next(ie()),He=!0);let At={type:yc.DownloadProgress,loaded:rt.loaded};rt.lengthComputable&&(At.total=rt.total),a.responseType==="text"&&R.responseText&&(At.partialText=R.responseText),n.next(At)},lt=rt=>{let At={type:yc.UploadProgress,loaded:rt.loaded};rt.lengthComputable&&(At.total=rt.total),n.next(At)};return R.addEventListener("load",pe),R.addEventListener("error",Me),R.addEventListener("timeout",Me),R.addEventListener("abort",Me),a.reportProgress&&(R.addEventListener("progress",Be),j!==null&&R.upload&&R.upload.addEventListener("progress",lt)),R.send(j),n.next({type:yc.Sent}),()=>{R.removeEventListener("error",Me),R.removeEventListener("abort",Me),R.removeEventListener("load",pe),R.removeEventListener("timeout",Me),a.reportProgress&&(R.removeEventListener("progress",Be),j!==null&&R.upload&&R.upload.removeEventListener("progress",lt)),R.readyState!==R.DONE&&R.abort()}})))}static{this.\u0275fac=function(d){return new(d||r)(Ot(Ld))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})(),K2=new Zt(""),t4="XSRF-TOKEN",n4=new Zt("",{providedIn:"root",factory:()=>t4}),i4="X-XSRF-TOKEN",r4=new Zt("",{providedIn:"root",factory:()=>i4}),Nv=class{},o4=(()=>{class r{constructor(a,d,y){this.doc=a,this.platform=d,this.cookieName=y,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let a=this.doc.cookie||"";return a!==this.lastCookieString&&(this.parseCount++,this.lastToken=Pv(a,this.cookieName),this.lastCookieString=a),this.lastToken}static{this.\u0275fac=function(d){return new(d||r)(Ot(Si),Ot(Qs),Ot(n4))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})();function s4(r,s){let a=r.url.toLowerCase();if(!yt(K2)||r.method==="GET"||r.method==="HEAD"||a.startsWith("http://")||a.startsWith("https://"))return s(r);let d=yt(Nv).getToken(),y=yt(r4);return d!=null&&!r.headers.has(y)&&(r=r.clone({headers:r.headers.set(y,d)})),s(r)}var Q2=function(r){return r[r.Interceptors=0]="Interceptors",r[r.LegacyInterceptors=1]="LegacyInterceptors",r[r.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",r[r.NoXsrfProtection=3]="NoXsrfProtection",r[r.JsonpSupport=4]="JsonpSupport",r[r.RequestsMadeViaParent=5]="RequestsMadeViaParent",r[r.Fetch=6]="Fetch",r}(Q2||{});function a4(r,s){return{\u0275kind:r,\u0275providers:s}}function l4(...r){let s=[ku,W2,q2,{provide:wm,useExisting:q2},{provide:Lv,useFactory:()=>yt(qV,{optional:!0})??yt(W2)},{provide:kw,useValue:s4,multi:!0},{provide:K2,useValue:!0},{provide:Nv,useClass:o4}];for(let a of r)s.push(...a.\u0275providers);return Md(s)}var Z2=new Zt("");function c4(){return a4(Q2.LegacyInterceptors,[{provide:Z2,useFactory:KV},{provide:kw,useExisting:Z2,multi:!0}])}var eR=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({providers:[l4(c4())]})}}return r})();var zw=class extends Sv{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Bw=class r extends zw{static makeCurrent(){O2(new r)}onAndCancel(s,a,d){return s.addEventListener(a,d),()=>{s.removeEventListener(a,d)}}dispatchEvent(s,a){s.dispatchEvent(a)}remove(s){s.remove()}createElement(s,a){return a=a||this.getDefaultDocument(),a.createElement(s)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(s){return s.nodeType===Node.ELEMENT_NODE}isShadowRoot(s){return s instanceof DocumentFragment}getGlobalEventTarget(s,a){return a==="window"?window:a==="document"?s:a==="body"?s.body:null}getBaseHref(s){let a=u4();return a==null?null:h4(a)}resetBaseElement(){Tm=null}getUserAgent(){return window.navigator.userAgent}getCookie(s){return Pv(document.cookie,s)}},Tm=null;function u4(){return Tm=Tm||document.querySelector("base"),Tm?Tm.getAttribute("href"):null}function h4(r){return new URL(r,document.baseURI).pathname}var d4=(()=>{class r{build(){return new XMLHttpRequest}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})(),Vw=new Zt(""),rR=(()=>{class r{constructor(a,d){this._zone=d,this._eventNameToPlugin=new Map,a.forEach(y=>{y.manager=this}),this._plugins=a.slice().reverse()}addEventListener(a,d,y){return this._findPluginFor(d).addEventListener(a,d,y)}getZone(){return this._zone}_findPluginFor(a){let d=this._eventNameToPlugin.get(a);if(d)return d;if(d=this._plugins.find(n=>n.supports(a)),!d)throw new on(5101,!1);return this._eventNameToPlugin.set(a,d),d}static{this.\u0275fac=function(d){return new(d||r)(Ot(Vw),Ot(ci))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})(),zv=class{constructor(s){this._doc=s}},Fw="ng-app-id",oR=(()=>{class r{constructor(a,d,y,n={}){this.doc=a,this.appId=d,this.nonce=y,this.platformId=n,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Ov(n),this.resetHostNodes()}addStyles(a){for(let d of a)this.changeUsageCount(d,1)===1&&this.onStyleAdded(d)}removeStyles(a){for(let d of a)this.changeUsageCount(d,-1)<=0&&this.onStyleRemoved(d)}ngOnDestroy(){let a=this.styleNodesInDOM;a&&(a.forEach(d=>d.remove()),a.clear());for(let d of this.getAllStyles())this.onStyleRemoved(d);this.resetHostNodes()}addHost(a){this.hostNodes.add(a);for(let d of this.getAllStyles())this.addStyleToHost(a,d)}removeHost(a){this.hostNodes.delete(a)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(a){for(let d of this.hostNodes)this.addStyleToHost(d,a)}onStyleRemoved(a){let d=this.styleRef;d.get(a)?.elements?.forEach(y=>y.remove()),d.delete(a)}collectServerRenderedStyles(){let a=this.doc.head?.querySelectorAll(`style[${Fw}="${this.appId}"]`);if(a?.length){let d=new Map;return a.forEach(y=>{y.textContent!=null&&d.set(y.textContent,y)}),d}return null}changeUsageCount(a,d){let y=this.styleRef;if(y.has(a)){let n=y.get(a);return n.usage+=d,n.usage}return y.set(a,{usage:d,elements:[]}),d}getStyleElement(a,d){let y=this.styleNodesInDOM,n=y?.get(d);if(n?.parentNode===a)return y.delete(d),n.removeAttribute(Fw),n;{let R=this.doc.createElement("style");return this.nonce&&R.setAttribute("nonce",this.nonce),R.textContent=d,this.platformIsServer&&R.setAttribute(Fw,this.appId),a.appendChild(R),R}}addStyleToHost(a,d){let y=this.getStyleElement(a,d),n=this.styleRef,R=n.get(d)?.elements;R?R.push(y):n.set(d,{elements:[y],usage:1})}resetHostNodes(){let a=this.hostNodes;a.clear(),a.add(this.doc.head)}static{this.\u0275fac=function(d){return new(d||r)(Ot(Si),Ot(mm),Ot(gm,8),Ot(Qs))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})(),Nw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Uw=/%COMP%/g,sR="%COMP%",f4=`_nghost-${sR}`,p4=`_ngcontent-${sR}`,m4=!0,g4=new Zt("",{providedIn:"root",factory:()=>m4});function _4(r){return p4.replace(Uw,r)}function y4(r){return f4.replace(Uw,r)}function aR(r,s){return s.map(a=>a.replace(Uw,r))}var tR=(()=>{class r{constructor(a,d,y,n,R,j,$,ie=null){this.eventManager=a,this.sharedStylesHost=d,this.appId=y,this.removeStylesOnCompDestroy=n,this.doc=R,this.platformId=j,this.ngZone=$,this.nonce=ie,this.rendererByCompId=new Map,this.platformIsServer=Ov(j),this.defaultRenderer=new Cm(a,R,$,this.platformIsServer)}createRenderer(a,d){if(!a||!d)return this.defaultRenderer;this.platformIsServer&&d.encapsulation===Ys.ShadowDom&&(d=Un(bt({},d),{encapsulation:Ys.Emulated}));let y=this.getOrCreateRenderer(a,d);return y instanceof Bv?y.applyToHost(a):y instanceof Dm&&y.applyStyles(),y}getOrCreateRenderer(a,d){let y=this.rendererByCompId,n=y.get(d.id);if(!n){let R=this.doc,j=this.ngZone,$=this.eventManager,ie=this.sharedStylesHost,pe=this.removeStylesOnCompDestroy,Me=this.platformIsServer;switch(d.encapsulation){case Ys.Emulated:n=new Bv($,ie,d,this.appId,pe,R,j,Me);break;case Ys.ShadowDom:return new jw($,ie,a,d,R,j,this.nonce,Me);default:n=new Dm($,ie,d,pe,R,j,Me);break}y.set(d.id,n)}return n}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(d){return new(d||r)(Ot(rR),Ot(oR),Ot(mm),Ot(g4),Ot(Si),Ot(Qs),Ot(ci),Ot(gm))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})(),Cm=class{constructor(s,a,d,y){this.eventManager=s,this.doc=a,this.ngZone=d,this.platformIsServer=y,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(s,a){return a?this.doc.createElementNS(Nw[a]||a,s):this.doc.createElement(s)}createComment(s){return this.doc.createComment(s)}createText(s){return this.doc.createTextNode(s)}appendChild(s,a){(nR(s)?s.content:s).appendChild(a)}insertBefore(s,a,d){s&&(nR(s)?s.content:s).insertBefore(a,d)}removeChild(s,a){a.remove()}selectRootElement(s,a){let d=typeof s=="string"?this.doc.querySelector(s):s;if(!d)throw new on(-5104,!1);return a||(d.textContent=""),d}parentNode(s){return s.parentNode}nextSibling(s){return s.nextSibling}setAttribute(s,a,d,y){if(y){a=y+":"+a;let n=Nw[y];n?s.setAttributeNS(n,a,d):s.setAttribute(a,d)}else s.setAttribute(a,d)}removeAttribute(s,a,d){if(d){let y=Nw[d];y?s.removeAttributeNS(y,a):s.removeAttribute(`${d}:${a}`)}else s.removeAttribute(a)}addClass(s,a){s.classList.add(a)}removeClass(s,a){s.classList.remove(a)}setStyle(s,a,d,y){y&(ka.DashCase|ka.Important)?s.style.setProperty(a,d,y&ka.Important?"important":""):s.style[a]=d}removeStyle(s,a,d){d&ka.DashCase?s.style.removeProperty(a):s.style[a]=""}setProperty(s,a,d){s!=null&&(s[a]=d)}setValue(s,a){s.nodeValue=a}listen(s,a,d){if(typeof s=="string"&&(s=Ua().getGlobalEventTarget(this.doc,s),!s))throw new Error(`Unsupported event target ${s} for event ${a}`);return this.eventManager.addEventListener(s,a,this.decoratePreventDefault(d))}decoratePreventDefault(s){return a=>{if(a==="__ngUnwrap__")return s;(this.platformIsServer?this.ngZone.runGuarded(()=>s(a)):s(a))===!1&&a.preventDefault()}}};function nR(r){return r.tagName==="TEMPLATE"&&r.content!==void 0}var jw=class extends Cm{constructor(s,a,d,y,n,R,j,$){super(s,n,R,$),this.sharedStylesHost=a,this.hostEl=d,this.shadowRoot=d.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let ie=aR(y.id,y.styles);for(let pe of ie){let Me=document.createElement("style");j&&Me.setAttribute("nonce",j),Me.textContent=pe,this.shadowRoot.appendChild(Me)}}nodeOrShadowRoot(s){return s===this.hostEl?this.shadowRoot:s}appendChild(s,a){return super.appendChild(this.nodeOrShadowRoot(s),a)}insertBefore(s,a,d){return super.insertBefore(this.nodeOrShadowRoot(s),a,d)}removeChild(s,a){return super.removeChild(null,a)}parentNode(s){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(s)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Dm=class extends Cm{constructor(s,a,d,y,n,R,j,$){super(s,n,R,j),this.sharedStylesHost=a,this.removeStylesOnCompDestroy=y,this.styles=$?aR($,d.styles):d.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Bv=class extends Dm{constructor(s,a,d,y,n,R,j,$){let ie=y+"-"+d.id;super(s,a,d,n,R,j,$,ie),this.contentAttr=_4(ie),this.hostAttr=y4(ie)}applyToHost(s){this.applyStyles(),this.setAttribute(s,this.hostAttr,"")}createElement(s,a){let d=super.createElement(s,a);return super.setAttribute(d,this.contentAttr,""),d}},v4=(()=>{class r extends zv{constructor(a){super(a)}supports(a){return!0}addEventListener(a,d,y){return a.addEventListener(d,y,!1),()=>this.removeEventListener(a,d,y)}removeEventListener(a,d,y){return a.removeEventListener(d,y)}static{this.\u0275fac=function(d){return new(d||r)(Ot(Si))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})(),iR=["alt","control","meta","shift"],x4={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},b4={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey},w4=(()=>{class r extends zv{constructor(a){super(a)}supports(a){return r.parseEventName(a)!=null}addEventListener(a,d,y){let n=r.parseEventName(d),R=r.eventCallback(n.fullKey,y,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ua().onAndCancel(a,n.domEventName,R))}static parseEventName(a){let d=a.toLowerCase().split("."),y=d.shift();if(d.length===0||!(y==="keydown"||y==="keyup"))return null;let n=r._normalizeKey(d.pop()),R="",j=d.indexOf("code");if(j>-1&&(d.splice(j,1),R="code."),iR.forEach(ie=>{let pe=d.indexOf(ie);pe>-1&&(d.splice(pe,1),R+=ie+".")}),R+=n,d.length!=0||n.length===0)return null;let $={};return $.domEventName=y,$.fullKey=R,$}static matchEventFullKeyCode(a,d){let y=x4[a.key]||a.key,n="";return d.indexOf("code.")>-1&&(y=a.code,n="code."),y==null||!y?!1:(y=y.toLowerCase(),y===" "?y="space":y==="."&&(y="dot"),iR.forEach(R=>{if(R!==y){let j=b4[R];j(a)&&(n+=R+".")}}),n+=y,n===d)}static eventCallback(a,d,y){return n=>{r.matchEventFullKeyCode(n,a)&&y.runGuarded(()=>d(n))}}static _normalizeKey(a){return a==="esc"?"escape":a}static{this.\u0275fac=function(d){return new(d||r)(Ot(Si))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac})}}return r})();function lR(r,s){return C2(bt({rootComponent:r},E4(s)))}function E4(r){return{appProviders:[...M4,...r?.providers??[]],platformProviders:D4}}function I4(){Bw.makeCurrent()}function T4(){return new To}function C4(){return lA(document),document}var D4=[{provide:Qs,useValue:Mw},{provide:aw,useValue:I4,multi:!0},{provide:Si,useFactory:C4,deps:[]}];var M4=[{provide:av,useValue:"root"},{provide:To,useFactory:T4,deps:[]},{provide:Vw,useClass:v4,multi:!0,deps:[Si,ci,Qs]},{provide:Vw,useClass:w4,multi:!0,deps:[Si]},tR,oR,rR,{provide:Id,useExisting:tR},{provide:Ld,useClass:d4,deps:[]},[]];var cR=(()=>{class r{constructor(a){this._doc=a}getTitle(){return this._doc.title}setTitle(a){this._doc.title=a||""}static{this.\u0275fac=function(d){return new(d||r)(Ot(Si))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var $w=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:function(d){let y=null;return d?y=new(d||r):y=Ot(S4),y},providedIn:"root"})}}return r})(),S4=(()=>{class r extends $w{constructor(a){super(),this._doc=a}sanitize(a,d){if(d==null)return null;switch(a){case so.NONE:return d;case so.HTML:return Rd(d,"HTML")?za(d):xA(this._doc,String(d)).toString();case so.STYLE:return Rd(d,"Style")?za(d):d;case so.SCRIPT:if(Rd(d,"Script"))return za(d);throw new on(5200,!1);case so.URL:return Rd(d,"URL")?za(d):uw(String(d));case so.RESOURCE_URL:if(Rd(d,"ResourceURL"))return za(d);throw new on(5201,!1);default:throw new on(5202,!1)}}bypassSecurityTrustHtml(a){return uA(a)}bypassSecurityTrustStyle(a){return hA(a)}bypassSecurityTrustScript(a){return dA(a)}bypassSecurityTrustUrl(a){return fA(a)}bypassSecurityTrustResourceUrl(a){return pA(a)}static{this.\u0275fac=function(d){return new(d||r)(Ot(Si))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var yR=(()=>{class r{constructor(a,d){this._renderer=a,this._elementRef=d,this.onChange=y=>{},this.onTouched=()=>{}}setProperty(a,d){this._renderer.setProperty(this._elementRef.nativeElement,a,d)}registerOnTouched(a){this.onTouched=a}registerOnChange(a){this.onChange=a}setDisabledState(a){this.setProperty("disabled",a)}static{this.\u0275fac=function(d){return new(d||r)(Pn(uc),Pn(ur))}}static{this.\u0275dir=or({type:r})}}return r})(),vR=(()=>{class r extends yR{static{this.\u0275fac=(()=>{let a;return function(y){return(a||(a=Ad(r)))(y||r)}})()}static{this.\u0275dir=or({type:r,features:[hc]})}}return r})(),Zw=new Zt("");var A4={provide:Zw,useExisting:Dd(()=>Gv),multi:!0};function R4(){let r=Ua()?Ua().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}var P4=new Zt(""),Gv=(()=>{class r extends yR{constructor(a,d,y){super(a,d),this._compositionMode=y,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!R4())}writeValue(a){let d=a??"";this.setProperty("value",d)}_handleInput(a){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(a)}_compositionStart(){this._composing=!0}_compositionEnd(a){this._composing=!1,this._compositionMode&&this.onChange(a)}static{this.\u0275fac=function(d){return new(d||r)(Pn(uc),Pn(ur),Pn(P4,8))}}static{this.\u0275dir=or({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(d,y){d&1&&Co("input",function(R){return y._handleInput(R.target.value)})("blur",function(){return y.onTouched()})("compositionstart",function(){return y._compositionStart()})("compositionend",function(R){return y._compositionEnd(R.target.value)})},features:[Va([A4]),hc]})}}return r})();var O4=new Zt(""),k4=new Zt("");function xR(r){return r!=null}function bR(r){return Pu(r)?zi(r):r}function wR(r){let s={};return r.forEach(a=>{s=a!=null?bt(bt({},s),a):s}),Object.keys(s).length===0?null:s}function ER(r,s){return s.map(a=>a(r))}function L4(r){return!r.validate}function IR(r){return r.map(s=>L4(s)?s:a=>s.validate(a))}function F4(r){if(!r)return null;let s=r.filter(xR);return s.length==0?null:function(a){return wR(ER(a,s))}}function TR(r){return r!=null?F4(IR(r)):null}function N4(r){if(!r)return null;let s=r.filter(xR);return s.length==0?null:function(a){let d=ER(a,s).map(bR);return Jp(d).pipe(an(wR))}}function CR(r){return r!=null?N4(IR(r)):null}function hR(r,s){return r===null?[s]:Array.isArray(r)?[...r,s]:[r,s]}function z4(r){return r._rawValidators}function B4(r){return r._rawAsyncValidators}function Gw(r){return r?Array.isArray(r)?r:[r]:[]}function jv(r,s){return Array.isArray(r)?r.includes(s):r===s}function dR(r,s){let a=Gw(s);return Gw(r).forEach(y=>{jv(a,y)||a.push(y)}),a}function fR(r,s){return Gw(s).filter(a=>!jv(r,a))}var Uv=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(s){this._rawValidators=s||[],this._composedValidatorFn=TR(this._rawValidators)}_setAsyncValidators(s){this._rawAsyncValidators=s||[],this._composedAsyncValidatorFn=CR(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(s){this._onDestroyCallbacks.push(s)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(s=>s()),this._onDestroyCallbacks=[]}reset(s=void 0){this.control&&this.control.reset(s)}hasError(s,a){return this.control?this.control.hasError(s,a):!1}getError(s,a){return this.control?this.control.getError(s,a):null}},Hw=class extends Uv{get formDirective(){return null}get path(){return null}},Pm=class extends Uv{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},qw=class{constructor(s){this._cd=s}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},V4={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},QZ=Un(bt({},V4),{"[class.ng-submitted]":"isSubmitted"}),DR=(()=>{class r extends qw{constructor(a){super(a)}static{this.\u0275fac=function(d){return new(d||r)(Pn(Pm,2))}}static{this.\u0275dir=or({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(d,y){d&2&&qr("ng-untouched",y.isUntouched)("ng-touched",y.isTouched)("ng-pristine",y.isPristine)("ng-dirty",y.isDirty)("ng-valid",y.isValid)("ng-invalid",y.isInvalid)("ng-pending",y.isPending)},features:[hc]})}}return r})();var Mm="VALID",Vv="INVALID",Fd="PENDING",Sm="DISABLED",zd=class{},$v=class extends zd{constructor(s,a){super(),this.value=s,this.source=a}},Am=class extends zd{constructor(s,a){super(),this.pristine=s,this.source=a}},Rm=class extends zd{constructor(s,a){super(),this.touched=s,this.source=a}},Nd=class extends zd{constructor(s,a){super(),this.status=s,this.source=a}};function j4(r){return(Hv(r)?r.validators:r)||null}function U4(r){return Array.isArray(r)?TR(r):r||null}function $4(r,s){return(Hv(s)?s.asyncValidators:r)||null}function G4(r){return Array.isArray(r)?CR(r):r||null}function Hv(r){return r!=null&&!Array.isArray(r)&&typeof r=="object"}var Ww=class{constructor(s,a){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Mv(()=>this.statusReactive()),this.statusReactive=wv(void 0),this._pristine=Mv(()=>this.pristineReactive()),this.pristineReactive=wv(!0),this._touched=Mv(()=>this.touchedReactive()),this.touchedReactive=wv(!1),this._events=new Gi,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(s),this._assignAsyncValidators(a)}get validator(){return this._composedValidatorFn}set validator(s){this._rawValidators=this._composedValidatorFn=s}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(s){this._rawAsyncValidators=this._composedAsyncValidatorFn=s}get parent(){return this._parent}get status(){return mc(this.statusReactive)}set status(s){mc(()=>this.statusReactive.set(s))}get valid(){return this.status===Mm}get invalid(){return this.status===Vv}get pending(){return this.status==Fd}get disabled(){return this.status===Sm}get enabled(){return this.status!==Sm}get pristine(){return mc(this.pristineReactive)}set pristine(s){mc(()=>this.pristineReactive.set(s))}get dirty(){return!this.pristine}get touched(){return mc(this.touchedReactive)}set touched(s){mc(()=>this.touchedReactive.set(s))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(s){this._assignValidators(s)}setAsyncValidators(s){this._assignAsyncValidators(s)}addValidators(s){this.setValidators(dR(s,this._rawValidators))}addAsyncValidators(s){this.setAsyncValidators(dR(s,this._rawAsyncValidators))}removeValidators(s){this.setValidators(fR(s,this._rawValidators))}removeAsyncValidators(s){this.setAsyncValidators(fR(s,this._rawAsyncValidators))}hasValidator(s){return jv(this._rawValidators,s)}hasAsyncValidator(s){return jv(this._rawAsyncValidators,s)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(s={}){let a=this.touched===!1;this.touched=!0;let d=s.sourceControl??this;this._parent&&!s.onlySelf&&this._parent.markAsTouched(Un(bt({},s),{sourceControl:d})),a&&s.emitEvent!==!1&&this._events.next(new Rm(!0,d))}markAllAsTouched(s={}){this.markAsTouched({onlySelf:!0,emitEvent:s.emitEvent,sourceControl:this}),this._forEachChild(a=>a.markAllAsTouched(s))}markAsUntouched(s={}){let a=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let d=s.sourceControl??this;this._forEachChild(y=>{y.markAsUntouched({onlySelf:!0,emitEvent:s.emitEvent,sourceControl:d})}),this._parent&&!s.onlySelf&&this._parent._updateTouched(s,d),a&&s.emitEvent!==!1&&this._events.next(new Rm(!1,d))}markAsDirty(s={}){let a=this.pristine===!0;this.pristine=!1;let d=s.sourceControl??this;this._parent&&!s.onlySelf&&this._parent.markAsDirty(Un(bt({},s),{sourceControl:d})),a&&s.emitEvent!==!1&&this._events.next(new Am(!1,d))}markAsPristine(s={}){let a=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let d=s.sourceControl??this;this._forEachChild(y=>{y.markAsPristine({onlySelf:!0,emitEvent:s.emitEvent})}),this._parent&&!s.onlySelf&&this._parent._updatePristine(s,d),a&&s.emitEvent!==!1&&this._events.next(new Am(!0,d))}markAsPending(s={}){this.status=Fd;let a=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new Nd(this.status,a)),this.statusChanges.emit(this.status)),this._parent&&!s.onlySelf&&this._parent.markAsPending(Un(bt({},s),{sourceControl:a}))}disable(s={}){let a=this._parentMarkedDirty(s.onlySelf);this.status=Sm,this.errors=null,this._forEachChild(y=>{y.disable(Un(bt({},s),{onlySelf:!0}))}),this._updateValue();let d=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new $v(this.value,d)),this._events.next(new Nd(this.status,d)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Un(bt({},s),{skipPristineCheck:a}),this),this._onDisabledChange.forEach(y=>y(!0))}enable(s={}){let a=this._parentMarkedDirty(s.onlySelf);this.status=Mm,this._forEachChild(d=>{d.enable(Un(bt({},s),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent}),this._updateAncestors(Un(bt({},s),{skipPristineCheck:a}),this),this._onDisabledChange.forEach(d=>d(!1))}_updateAncestors(s,a){this._parent&&!s.onlySelf&&(this._parent.updateValueAndValidity(s),s.skipPristineCheck||this._parent._updatePristine({},a),this._parent._updateTouched({},a))}setParent(s){this._parent=s}getRawValue(){return this.value}updateValueAndValidity(s={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let d=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Mm||this.status===Fd)&&this._runAsyncValidator(d,s.emitEvent)}let a=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new $v(this.value,a)),this._events.next(new Nd(this.status,a)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!s.onlySelf&&this._parent.updateValueAndValidity(Un(bt({},s),{sourceControl:a}))}_updateTreeValidity(s={emitEvent:!0}){this._forEachChild(a=>a._updateTreeValidity(s)),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Sm:Mm}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(s,a){if(this.asyncValidator){this.status=Fd,this._hasOwnPendingAsyncValidator={emitEvent:a!==!1};let d=bR(this.asyncValidator(this));this._asyncValidationSubscription=d.subscribe(y=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(y,{emitEvent:a,shouldHaveEmitted:s})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let s=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,s}return!1}setErrors(s,a={}){this.errors=s,this._updateControlsErrors(a.emitEvent!==!1,this,a.shouldHaveEmitted)}get(s){let a=s;return a==null||(Array.isArray(a)||(a=a.split(".")),a.length===0)?null:a.reduce((d,y)=>d&&d._find(y),this)}getError(s,a){let d=a?this.get(a):this;return d&&d.errors?d.errors[s]:null}hasError(s,a){return!!this.getError(s,a)}get root(){let s=this;for(;s._parent;)s=s._parent;return s}_updateControlsErrors(s,a,d){this.status=this._calculateStatus(),s&&this.statusChanges.emit(this.status),(s||d)&&this._events.next(new Nd(this.status,a)),this._parent&&this._parent._updateControlsErrors(s,a,d)}_initObservables(){this.valueChanges=new Hi,this.statusChanges=new Hi}_calculateStatus(){return this._allControlsDisabled()?Sm:this.errors?Vv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Fd)?Fd:this._anyControlsHaveStatus(Vv)?Vv:Mm}_anyControlsHaveStatus(s){return this._anyControls(a=>a.status===s)}_anyControlsDirty(){return this._anyControls(s=>s.dirty)}_anyControlsTouched(){return this._anyControls(s=>s.touched)}_updatePristine(s,a){let d=!this._anyControlsDirty(),y=this.pristine!==d;this.pristine=d,this._parent&&!s.onlySelf&&this._parent._updatePristine(s,a),y&&this._events.next(new Am(this.pristine,a))}_updateTouched(s={},a){this.touched=this._anyControlsTouched(),this._events.next(new Rm(this.touched,a)),this._parent&&!s.onlySelf&&this._parent._updateTouched(s,a)}_registerOnCollectionChange(s){this._onCollectionChange=s}_setUpdateStrategy(s){Hv(s)&&s.updateOn!=null&&(this._updateOn=s.updateOn)}_parentMarkedDirty(s){let a=this._parent&&this._parent.dirty;return!s&&!!a&&!this._parent._anyControlsDirty()}_find(s){return null}_assignValidators(s){this._rawValidators=Array.isArray(s)?s.slice():s,this._composedValidatorFn=U4(this._rawValidators)}_assignAsyncValidators(s){this._rawAsyncValidators=Array.isArray(s)?s.slice():s,this._composedAsyncValidatorFn=G4(this._rawAsyncValidators)}};var MR=new Zt("CallSetDisabledState",{providedIn:"root",factory:()=>Xw}),Xw="always";function H4(r,s){return[...s.path,r]}function q4(r,s,a=Xw){Z4(r,s),s.valueAccessor.writeValue(r.value),(r.disabled||a==="always")&&s.valueAccessor.setDisabledState?.(r.disabled),X4(r,s),J4(r,s),Y4(r,s),W4(r,s)}function pR(r,s){r.forEach(a=>{a.registerOnValidatorChange&&a.registerOnValidatorChange(s)})}function W4(r,s){if(s.valueAccessor.setDisabledState){let a=d=>{s.valueAccessor.setDisabledState(d)};r.registerOnDisabledChange(a),s._registerOnDestroy(()=>{r._unregisterOnDisabledChange(a)})}}function Z4(r,s){let a=z4(r);s.validator!==null?r.setValidators(hR(a,s.validator)):typeof a=="function"&&r.setValidators([a]);let d=B4(r);s.asyncValidator!==null?r.setAsyncValidators(hR(d,s.asyncValidator)):typeof d=="function"&&r.setAsyncValidators([d]);let y=()=>r.updateValueAndValidity();pR(s._rawValidators,y),pR(s._rawAsyncValidators,y)}function X4(r,s){s.valueAccessor.registerOnChange(a=>{r._pendingValue=a,r._pendingChange=!0,r._pendingDirty=!0,r.updateOn==="change"&&SR(r,s)})}function Y4(r,s){s.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,r.updateOn==="blur"&&r._pendingChange&&SR(r,s),r.updateOn!=="submit"&&r.markAsTouched()})}function SR(r,s){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),s.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function J4(r,s){let a=(d,y)=>{s.valueAccessor.writeValue(d),y&&s.viewToModelUpdate(d)};r.registerOnChange(a),s._registerOnDestroy(()=>{r._unregisterOnChange(a)})}function K4(r,s){if(!r.hasOwnProperty("model"))return!1;let a=r.model;return a.isFirstChange()?!0:!Object.is(s,a.currentValue)}function Q4(r){return Object.getPrototypeOf(r.constructor)===vR}function ej(r,s){if(!s)return null;Array.isArray(s);let a,d,y;return s.forEach(n=>{n.constructor===Gv?a=n:Q4(n)?d=n:y=n}),y||d||a||null}function mR(r,s){let a=r.indexOf(s);a>-1&&r.splice(a,1)}function gR(r){return typeof r=="object"&&r!==null&&Object.keys(r).length===2&&"value"in r&&"disabled"in r}var tj=class extends Ww{constructor(s=null,a,d){super(j4(a),$4(d,a)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(s),this._setUpdateStrategy(a),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Hv(a)&&(a.nonNullable||a.initialValueIsDefault)&&(gR(s)?this.defaultValue=s.value:this.defaultValue=s)}setValue(s,a={}){this.value=this._pendingValue=s,this._onChange.length&&a.emitModelToViewChange!==!1&&this._onChange.forEach(d=>d(this.value,a.emitViewToModelChange!==!1)),this.updateValueAndValidity(a)}patchValue(s,a={}){this.setValue(s,a)}reset(s=this.defaultValue,a={}){this._applyFormState(s),this.markAsPristine(a),this.markAsUntouched(a),this.setValue(this.value,a),this._pendingChange=!1}_updateValue(){}_anyControls(s){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(s){this._onChange.push(s)}_unregisterOnChange(s){mR(this._onChange,s)}registerOnDisabledChange(s){this._onDisabledChange.push(s)}_unregisterOnDisabledChange(s){mR(this._onDisabledChange,s)}_forEachChild(s){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(s){gR(s)?(this.value=this._pendingValue=s.value,s.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=s}};var nj={provide:Pm,useExisting:Dd(()=>Yw)},_R=Promise.resolve(),Yw=(()=>{class r extends Pm{constructor(a,d,y,n,R,j){super(),this._changeDetectorRef=R,this.callSetDisabledState=j,this.control=new tj,this._registered=!1,this.name="",this.update=new Hi,this._parent=a,this._setValidators(d),this._setAsyncValidators(y),this.valueAccessor=ej(this,n)}ngOnChanges(a){if(this._checkForErrors(),!this._registered||"name"in a){if(this._registered&&(this._checkName(),this.formDirective)){let d=a.name.previousValue;this.formDirective.removeControl({name:d,path:this._getPath(d)})}this._setUpControl()}"isDisabled"in a&&this._updateDisabled(a),K4(a,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(a){this.viewModel=a,this.update.emit(a)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){q4(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(a){_R.then(()=>{this.control.setValue(a,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(a){let d=a.isDisabled.currentValue,y=d!==0&&Xo(d);_R.then(()=>{y&&!this.control.disabled?this.control.disable():!y&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(a){return this._parent?H4(a,this._parent):[a]}static{this.\u0275fac=function(d){return new(d||r)(Pn(Hw,9),Pn(O4,10),Pn(k4,10),Pn(Zw,10),Pn(ja,8),Pn(MR,8))}}static{this.\u0275dir=or({type:r,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Va([nj]),hc,Au]})}}return r})();var ij={provide:Zw,useExisting:Dd(()=>Jw),multi:!0},Jw=(()=>{class r extends vR{writeValue(a){this.setProperty("value",parseFloat(a))}registerOnChange(a){this.onChange=d=>{a(d==""?null:parseFloat(d))}}static{this.\u0275fac=(()=>{let a;return function(y){return(a||(a=Ad(r)))(y||r)}})()}static{this.\u0275dir=or({type:r,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(d,y){d&1&&Co("change",function(R){return y.onChange(R.target.value)})("input",function(R){return y.onChange(R.target.value)})("blur",function(){return y.onTouched()})},features:[Va([ij]),hc]})}}return r})();var rj=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({})}}return r})();var AR=(()=>{class r{static withConfig(a){return{ngModule:r,providers:[{provide:MR,useValue:a.callSetDisabledState??Xw}]}}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({imports:[rj]})}}return r})();var Yv=qL(PR());var eE;try{eE=typeof Intl<"u"&&Intl.v8BreakIterator}catch{eE=!1}var Lu=(()=>{class r{constructor(a){this._platformId=a,this.isBrowser=this._platformId?B2(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||eE)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static{this.\u0275fac=function(d){return new(d||r)(Ot(Qs))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var Om;function sj(){if(Om==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Om=!0}))}finally{Om=Om||!1}return Om}function tE(r){return sj()?r:!!r.capture}function OR(r){return r.composedPath?r.composedPath()[0]:r.target}function kR(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}function nE(r){return Array.isArray(r)?r:[r]}function iE(r){return r instanceof ur?r.nativeElement:r}var aj=(()=>{class r{create(a){return typeof MutationObserver>"u"?null:new MutationObserver(a)}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var FR=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({providers:[aj]})}}return r})();var NR=new Set,Fu,lj=(()=>{class r{constructor(a,d){this._platform=a,this._nonce=d,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):uj}matchMedia(a){return(this._platform.WEBKIT||this._platform.BLINK)&&cj(a,this._nonce),this._matchMedia(a)}static{this.\u0275fac=function(d){return new(d||r)(Ot(Lu),Ot(gm,8))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function cj(r,s){if(!NR.has(r))try{Fu||(Fu=document.createElement("style"),s&&Fu.setAttribute("nonce",s),Fu.setAttribute("type","text/css"),document.head.appendChild(Fu)),Fu.sheet&&(Fu.sheet.insertRule(`@media ${r} {body{ }}`,0),NR.add(r))}catch(a){console.error(a)}}function uj(r){return{matches:r==="all"||r==="",media:r,addListener:()=>{},removeListener:()=>{}}}var BR=(()=>{class r{constructor(a,d){this._mediaMatcher=a,this._zone=d,this._queries=new Map,this._destroySubject=new Gi}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(a){return zR(nE(a)).some(y=>this._registerQuery(y).mql.matches)}observe(a){let y=zR(nE(a)).map(R=>this._registerQuery(R).observable),n=ad(y);return n=Kl(n.pipe(Eo(1)),n.pipe(Mb(1),wb(0))),n.pipe(an(R=>{let j={matches:!1,breakpoints:{}};return R.forEach(({matches:$,query:ie})=>{j.matches=j.matches||$,j.breakpoints[ie]=$}),j}))}_registerQuery(a){if(this._queries.has(a))return this._queries.get(a);let d=this._mediaMatcher.matchMedia(a),n={observable:new Xn(R=>{let j=$=>this._zone.run(()=>R.next($));return d.addListener(j),()=>{d.removeListener(j)}}).pipe(Kp(d),an(({matches:R})=>({query:a,matches:R})),Qp(this._destroySubject)),mql:d};return this._queries.set(a,n),n}static{this.\u0275fac=function(d){return new(d||r)(Ot(lj),Ot(ci))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function zR(r){return r.map(s=>s.split(",")).reduce((s,a)=>s.concat(a)).map(s=>s.trim())}var GR=" ";function dj(r,s,a){let d=Wv(r,s);a=a.trim(),!d.some(y=>y.trim()===a)&&(d.push(a),r.setAttribute(s,d.join(GR)))}function fj(r,s,a){let d=Wv(r,s);a=a.trim();let y=d.filter(n=>n!==a);y.length?r.setAttribute(s,y.join(GR)):r.removeAttribute(s)}function Wv(r,s){return r.getAttribute(s)?.match(/\S+/g)??[]}var HR="cdk-describedby-message",qv="cdk-describedby-host",sE=0,qR=(()=>{class r{constructor(a,d){this._platform=d,this._messageRegistry=new Map,this._messagesContainer=null,this._id=`${sE++}`,this._document=a,this._id=yt(mm)+"-"+sE++}describe(a,d,y){if(!this._canBeDescribed(a,d))return;let n=rE(d,y);typeof d!="string"?(VR(d,this._id),this._messageRegistry.set(n,{messageElement:d,referenceCount:0})):this._messageRegistry.has(n)||this._createMessageElement(d,y),this._isElementDescribedByMessage(a,n)||this._addMessageReference(a,n)}removeDescription(a,d,y){if(!d||!this._isElementNode(a))return;let n=rE(d,y);if(this._isElementDescribedByMessage(a,n)&&this._removeMessageReference(a,n),typeof d=="string"){let R=this._messageRegistry.get(n);R&&R.referenceCount===0&&this._deleteMessageElement(n)}this._messagesContainer?.childNodes.length===0&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){let a=this._document.querySelectorAll(`[${qv}="${this._id}"]`);for(let d=0;d<a.length;d++)this._removeCdkDescribedByReferenceIds(a[d]),a[d].removeAttribute(qv);this._messagesContainer?.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(a,d){let y=this._document.createElement("div");VR(y,this._id),y.textContent=a,d&&y.setAttribute("role",d),this._createMessagesContainer(),this._messagesContainer.appendChild(y),this._messageRegistry.set(rE(a,d),{messageElement:y,referenceCount:0})}_deleteMessageElement(a){this._messageRegistry.get(a)?.messageElement?.remove(),this._messageRegistry.delete(a)}_createMessagesContainer(){if(this._messagesContainer)return;let a="cdk-describedby-message-container",d=this._document.querySelectorAll(`.${a}[platform="server"]`);for(let n=0;n<d.length;n++)d[n].remove();let y=this._document.createElement("div");y.style.visibility="hidden",y.classList.add(a),y.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&y.setAttribute("platform","server"),this._document.body.appendChild(y),this._messagesContainer=y}_removeCdkDescribedByReferenceIds(a){let d=Wv(a,"aria-describedby").filter(y=>y.indexOf(HR)!=0);a.setAttribute("aria-describedby",d.join(" "))}_addMessageReference(a,d){let y=this._messageRegistry.get(d);dj(a,"aria-describedby",y.messageElement.id),a.setAttribute(qv,this._id),y.referenceCount++}_removeMessageReference(a,d){let y=this._messageRegistry.get(d);y.referenceCount--,fj(a,"aria-describedby",y.messageElement.id),a.removeAttribute(qv)}_isElementDescribedByMessage(a,d){let y=Wv(a,"aria-describedby"),n=this._messageRegistry.get(d),R=n&&n.messageElement.id;return!!R&&y.indexOf(R)!=-1}_canBeDescribed(a,d){if(!this._isElementNode(a))return!1;if(d&&typeof d=="object")return!0;let y=d==null?"":`${d}`.trim(),n=a.getAttribute("aria-label");return y?!n||n.trim()!==y:!1}_isElementNode(a){return a.nodeType===this._document.ELEMENT_NODE}static{this.\u0275fac=function(d){return new(d||r)(Ot(Si),Ot(Lu))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function rE(r,s){return typeof r=="string"?`${s||""}/${r}`:r}function VR(r,s){r.id||(r.id=`${HR}-${s}-${sE++}`)}var WR=(()=>{class r{constructor(a){this._platform=a}isDisabled(a){return a.hasAttribute("disabled")}isVisible(a){return mj(a)&&getComputedStyle(a).visibility==="visible"}isTabbable(a){if(!this._platform.isBrowser)return!1;let d=pj(Ej(a));if(d&&(jR(d)===-1||!this.isVisible(d)))return!1;let y=a.nodeName.toLowerCase(),n=jR(a);return a.hasAttribute("contenteditable")?n!==-1:y==="iframe"||y==="object"||this._platform.WEBKIT&&this._platform.IOS&&!bj(a)?!1:y==="audio"?a.hasAttribute("controls")?n!==-1:!1:y==="video"?n===-1?!1:n!==null?!0:this._platform.FIREFOX||a.hasAttribute("controls"):a.tabIndex>=0}isFocusable(a,d){return wj(a)&&!this.isDisabled(a)&&(d?.ignoreVisibility||this.isVisible(a))}static{this.\u0275fac=function(d){return new(d||r)(Ot(Lu))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function pj(r){try{return r.frameElement}catch{return null}}function mj(r){return!!(r.offsetWidth||r.offsetHeight||typeof r.getClientRects=="function"&&r.getClientRects().length)}function gj(r){let s=r.nodeName.toLowerCase();return s==="input"||s==="select"||s==="button"||s==="textarea"}function _j(r){return vj(r)&&r.type=="hidden"}function yj(r){return xj(r)&&r.hasAttribute("href")}function vj(r){return r.nodeName.toLowerCase()=="input"}function xj(r){return r.nodeName.toLowerCase()=="a"}function ZR(r){if(!r.hasAttribute("tabindex")||r.tabIndex===void 0)return!1;let s=r.getAttribute("tabindex");return!!(s&&!isNaN(parseInt(s,10)))}function jR(r){if(!ZR(r))return null;let s=parseInt(r.getAttribute("tabindex")||"",10);return isNaN(s)?-1:s}function bj(r){let s=r.nodeName.toLowerCase(),a=s==="input"&&r.type;return a==="text"||a==="password"||s==="select"||s==="textarea"}function wj(r){return _j(r)?!1:gj(r)||yj(r)||r.hasAttribute("contenteditable")||ZR(r)}function Ej(r){return r.ownerDocument&&r.ownerDocument.defaultView||window}function XR(r){return r.buttons===0||r.detail===0}function YR(r){let s=r.touches&&r.touches[0]||r.changedTouches&&r.changedTouches[0];return!!s&&s.identifier===-1&&(s.radiusX==null||s.radiusX===1)&&(s.radiusY==null||s.radiusY===1)}var Nu=function(r){return r[r.NONE=0]="NONE",r[r.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",r[r.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",r}(Nu||{}),UR="cdk-high-contrast-black-on-white",$R="cdk-high-contrast-white-on-black",oE="cdk-high-contrast-active",aE=(()=>{class r{constructor(a,d){this._platform=a,this._document=d,this._breakpointSubscription=yt(BR).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return Nu.NONE;let a=this._document.createElement("div");a.style.backgroundColor="rgb(1,2,3)",a.style.position="absolute",this._document.body.appendChild(a);let d=this._document.defaultView||window,y=d&&d.getComputedStyle?d.getComputedStyle(a):null,n=(y&&y.backgroundColor||"").replace(/ /g,"");switch(a.remove(),n){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return Nu.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return Nu.BLACK_ON_WHITE}return Nu.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let a=this._document.body.classList;a.remove(oE,UR,$R),this._hasCheckedHighContrastMode=!0;let d=this.getHighContrastMode();d===Nu.BLACK_ON_WHITE?a.add(oE,UR):d===Nu.WHITE_ON_BLACK&&a.add(oE,$R)}}static{this.\u0275fac=function(d){return new(d||r)(Ot(Lu),Ot(Si))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),JR=(()=>{class r{constructor(a){a._applyBodyHighContrastModeCssClasses()}static{this.\u0275fac=function(d){return new(d||r)(Ot(aE))}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({imports:[FR]})}}return r})();var lE=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({})}}return r})();function Cj(){return!0}var Dj=new Zt("mat-sanity-checks",{providedIn:"root",factory:Cj}),ra=(()=>{class r{constructor(a,d,y){this._sanityChecks=d,this._document=y,this._hasDoneGlobalChecks=!1,a._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(a){return kR()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[a]}static{this.\u0275fac=function(d){return new(d||r)(Ot(aE),Ot(Dj,8),Ot(Si))}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({imports:[lE,lE]})}}return r})();var Do=function(r){return r[r.FADING_IN=0]="FADING_IN",r[r.VISIBLE=1]="VISIBLE",r[r.FADING_OUT=2]="FADING_OUT",r[r.HIDDEN=3]="HIDDEN",r}(Do||{}),cE=class{constructor(s,a,d,y=!1){this._renderer=s,this.element=a,this.config=d,this._animationForciblyDisabledThroughCss=y,this.state=Do.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},QR=tE({passive:!0,capture:!0}),uE=class{constructor(){this._events=new Map,this._delegateEventHandler=s=>{let a=OR(s);a&&this._events.get(s.type)?.forEach((d,y)=>{(y===a||y.contains(a))&&d.forEach(n=>n.handleEvent(s))})}}addHandler(s,a,d,y){let n=this._events.get(a);if(n){let R=n.get(d);R?R.add(y):n.set(d,new Set([y]))}else this._events.set(a,new Map([[d,new Set([y])]])),s.runOutsideAngular(()=>{document.addEventListener(a,this._delegateEventHandler,QR)})}removeHandler(s,a,d){let y=this._events.get(s);if(!y)return;let n=y.get(a);n&&(n.delete(d),n.size===0&&y.delete(a),y.size===0&&(this._events.delete(s),document.removeEventListener(s,this._delegateEventHandler,QR)))}},eP={enterDuration:225,exitDuration:150},Mj=800,tP=tE({passive:!0,capture:!0}),nP=["mousedown","touchstart"],iP=["mouseup","mouseleave","touchend","touchcancel"],rP=class r{static{this._eventManager=new uE}constructor(s,a,d,y){this._target=s,this._ngZone=a,this._platform=y,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,y.isBrowser&&(this._containerElement=iE(d))}fadeInRipple(s,a,d={}){let y=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),n=bt(bt({},eP),d.animation);d.centered&&(s=y.left+y.width/2,a=y.top+y.height/2);let R=d.radius||Sj(s,a,y),j=s-y.left,$=a-y.top,ie=n.enterDuration,pe=document.createElement("div");pe.classList.add("mat-ripple-element"),pe.style.left=`${j-R}px`,pe.style.top=`${$-R}px`,pe.style.height=`${R*2}px`,pe.style.width=`${R*2}px`,d.color!=null&&(pe.style.backgroundColor=d.color),pe.style.transitionDuration=`${ie}ms`,this._containerElement.appendChild(pe);let Me=window.getComputedStyle(pe),He=Me.transitionProperty,Be=Me.transitionDuration,lt=He==="none"||Be==="0s"||Be==="0s, 0s"||y.width===0&&y.height===0,rt=new cE(this,pe,d,lt);pe.style.transform="scale3d(1, 1, 1)",rt.state=Do.FADING_IN,d.persistent||(this._mostRecentTransientRipple=rt);let At=null;return!lt&&(ie||n.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Kt=()=>{At&&(At.fallbackTimer=null),clearTimeout(_n),this._finishRippleTransition(rt)},St=()=>this._destroyRipple(rt),_n=setTimeout(St,ie+100);pe.addEventListener("transitionend",Kt),pe.addEventListener("transitioncancel",St),At={onTransitionEnd:Kt,onTransitionCancel:St,fallbackTimer:_n}}),this._activeRipples.set(rt,At),(lt||!ie)&&this._finishRippleTransition(rt),rt}fadeOutRipple(s){if(s.state===Do.FADING_OUT||s.state===Do.HIDDEN)return;let a=s.element,d=bt(bt({},eP),s.config.animation);a.style.transitionDuration=`${d.exitDuration}ms`,a.style.opacity="0",s.state=Do.FADING_OUT,(s._animationForciblyDisabledThroughCss||!d.exitDuration)&&this._finishRippleTransition(s)}fadeOutAll(){this._getActiveRipples().forEach(s=>s.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(s=>{s.config.persistent||s.fadeOut()})}setupTriggerEvents(s){let a=iE(s);!this._platform.isBrowser||!a||a===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=a,nP.forEach(d=>{r._eventManager.addHandler(this._ngZone,d,a,this)}))}handleEvent(s){s.type==="mousedown"?this._onMousedown(s):s.type==="touchstart"?this._onTouchStart(s):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{iP.forEach(a=>{this._triggerElement.addEventListener(a,this,tP)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(s){s.state===Do.FADING_IN?this._startFadeOutTransition(s):s.state===Do.FADING_OUT&&this._destroyRipple(s)}_startFadeOutTransition(s){let a=s===this._mostRecentTransientRipple,{persistent:d}=s.config;s.state=Do.VISIBLE,!d&&(!a||!this._isPointerDown)&&s.fadeOut()}_destroyRipple(s){let a=this._activeRipples.get(s)??null;this._activeRipples.delete(s),this._activeRipples.size||(this._containerRect=null),s===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),s.state=Do.HIDDEN,a!==null&&(s.element.removeEventListener("transitionend",a.onTransitionEnd),s.element.removeEventListener("transitioncancel",a.onTransitionCancel),a.fallbackTimer!==null&&clearTimeout(a.fallbackTimer)),s.element.remove()}_onMousedown(s){let a=XR(s),d=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+Mj;!this._target.rippleDisabled&&!a&&!d&&(this._isPointerDown=!0,this.fadeInRipple(s.clientX,s.clientY,this._target.rippleConfig))}_onTouchStart(s){if(!this._target.rippleDisabled&&!YR(s)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let a=s.changedTouches;if(a)for(let d=0;d<a.length;d++)this.fadeInRipple(a[d].clientX,a[d].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(s=>{let a=s.state===Do.VISIBLE||s.config.terminateOnPointerUp&&s.state===Do.FADING_IN;!s.config.persistent&&a&&s.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let s=this._triggerElement;s&&(nP.forEach(a=>r._eventManager.removeHandler(a,s,this)),this._pointerUpEventsRegistered&&(iP.forEach(a=>s.removeEventListener(a,this,tP)),this._pointerUpEventsRegistered=!1))}};function Sj(r,s,a){let d=Math.max(Math.abs(r-a.left),Math.abs(r-a.right)),y=Math.max(Math.abs(s-a.top),Math.abs(s-a.bottom));return Math.sqrt(d*d+y*y)}var aP=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({imports:[ra,ra]})}}return r})();var Aj=["*"],Zv;function Rj(){if(Zv===void 0&&(Zv=null,typeof window<"u")){let r=window;r.trustedTypes!==void 0&&(Zv=r.trustedTypes.createPolicy("angular#components",{createHTML:s=>s}))}return Zv}function km(r){return Rj()?.createHTML(r)||r}function lP(r){return Error(`Unable to find icon with the name "${r}"`)}function Pj(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}function cP(r){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${r}".`)}function uP(r){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${r}".`)}var Ga=class{constructor(s,a,d){this.url=s,this.svgText=a,this.options=d}},Oj=(()=>{class r{constructor(a,d,y,n){this._httpClient=a,this._sanitizer=d,this._errorHandler=n,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["material-icons","mat-ligature-font"],this._document=y}addSvgIcon(a,d,y){return this.addSvgIconInNamespace("",a,d,y)}addSvgIconLiteral(a,d,y){return this.addSvgIconLiteralInNamespace("",a,d,y)}addSvgIconInNamespace(a,d,y,n){return this._addSvgIconConfig(a,d,new Ga(y,null,n))}addSvgIconResolver(a){return this._resolvers.push(a),this}addSvgIconLiteralInNamespace(a,d,y,n){let R=this._sanitizer.sanitize(so.HTML,y);if(!R)throw uP(y);let j=km(R);return this._addSvgIconConfig(a,d,new Ga("",j,n))}addSvgIconSet(a,d){return this.addSvgIconSetInNamespace("",a,d)}addSvgIconSetLiteral(a,d){return this.addSvgIconSetLiteralInNamespace("",a,d)}addSvgIconSetInNamespace(a,d,y){return this._addSvgIconSetConfig(a,new Ga(d,null,y))}addSvgIconSetLiteralInNamespace(a,d,y){let n=this._sanitizer.sanitize(so.HTML,d);if(!n)throw uP(d);let R=km(n);return this._addSvgIconSetConfig(a,new Ga("",R,y))}registerFontClassAlias(a,d=a){return this._fontCssClassesByAlias.set(a,d),this}classNameForFontAlias(a){return this._fontCssClassesByAlias.get(a)||a}setDefaultFontSetClass(...a){return this._defaultFontSetClass=a,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(a){let d=this._sanitizer.sanitize(so.RESOURCE_URL,a);if(!d)throw cP(a);let y=this._cachedIconsByUrl.get(d);return y?hn(Xv(y)):this._loadSvgIconFromConfig(new Ga(a,null)).pipe(Ui(n=>this._cachedIconsByUrl.set(d,n)),an(n=>Xv(n)))}getNamedSvgIcon(a,d=""){let y=hP(d,a),n=this._svgIconConfigs.get(y);if(n)return this._getSvgFromConfig(n);if(n=this._getIconConfigFromResolvers(d,a),n)return this._svgIconConfigs.set(y,n),this._getSvgFromConfig(n);let R=this._iconSetConfigs.get(d);return R?this._getSvgFromIconSetConfigs(a,R):Jl(lP(y))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(a){return a.svgText?hn(Xv(this._svgElementFromConfig(a))):this._loadSvgIconFromConfig(a).pipe(an(d=>Xv(d)))}_getSvgFromIconSetConfigs(a,d){let y=this._extractIconWithNameFromAnySet(a,d);if(y)return hn(y);let n=d.filter(R=>!R.svgText).map(R=>this._loadSvgIconSetFromConfig(R).pipe(Hs(j=>{let ie=`Loading icon set URL: ${this._sanitizer.sanitize(so.RESOURCE_URL,R.url)} failed: ${j.message}`;return this._errorHandler.handleError(new Error(ie)),hn(null)})));return Jp(n).pipe(an(()=>{let R=this._extractIconWithNameFromAnySet(a,d);if(!R)throw lP(a);return R}))}_extractIconWithNameFromAnySet(a,d){for(let y=d.length-1;y>=0;y--){let n=d[y];if(n.svgText&&n.svgText.toString().indexOf(a)>-1){let R=this._svgElementFromConfig(n),j=this._extractSvgIconFromSet(R,a,n.options);if(j)return j}}return null}_loadSvgIconFromConfig(a){return this._fetchIcon(a).pipe(Ui(d=>a.svgText=d),an(()=>this._svgElementFromConfig(a)))}_loadSvgIconSetFromConfig(a){return a.svgText?hn(null):this._fetchIcon(a).pipe(Ui(d=>a.svgText=d))}_extractSvgIconFromSet(a,d,y){let n=a.querySelector(`[id="${d}"]`);if(!n)return null;let R=n.cloneNode(!0);if(R.removeAttribute("id"),R.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(R,y);if(R.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(R),y);let j=this._svgElementFromString(km("<svg></svg>"));return j.appendChild(R),this._setSvgAttributes(j,y)}_svgElementFromString(a){let d=this._document.createElement("DIV");d.innerHTML=a;let y=d.querySelector("svg");if(!y)throw Error("<svg> tag not found");return y}_toSvgElement(a){let d=this._svgElementFromString(km("<svg></svg>")),y=a.attributes;for(let n=0;n<y.length;n++){let{name:R,value:j}=y[n];R!=="id"&&d.setAttribute(R,j)}for(let n=0;n<a.childNodes.length;n++)a.childNodes[n].nodeType===this._document.ELEMENT_NODE&&d.appendChild(a.childNodes[n].cloneNode(!0));return d}_setSvgAttributes(a,d){return a.setAttribute("fit",""),a.setAttribute("height","100%"),a.setAttribute("width","100%"),a.setAttribute("preserveAspectRatio","xMidYMid meet"),a.setAttribute("focusable","false"),d&&d.viewBox&&a.setAttribute("viewBox",d.viewBox),a}_fetchIcon(a){let{url:d,options:y}=a,n=y?.withCredentials??!1;if(!this._httpClient)throw Pj();if(d==null)throw Error(`Cannot fetch icon from URL "${d}".`);let R=this._sanitizer.sanitize(so.RESOURCE_URL,d);if(!R)throw cP(d);let j=this._inProgressUrlFetches.get(R);if(j)return j;let $=this._httpClient.get(R,{responseType:"text",withCredentials:n}).pipe(an(ie=>km(ie)),qs(()=>this._inProgressUrlFetches.delete(R)),Db());return this._inProgressUrlFetches.set(R,$),$}_addSvgIconConfig(a,d,y){return this._svgIconConfigs.set(hP(a,d),y),this}_addSvgIconSetConfig(a,d){let y=this._iconSetConfigs.get(a);return y?y.push(d):this._iconSetConfigs.set(a,[d]),this}_svgElementFromConfig(a){if(!a.svgElement){let d=this._svgElementFromString(a.svgText);this._setSvgAttributes(d,a.options),a.svgElement=d}return a.svgElement}_getIconConfigFromResolvers(a,d){for(let y=0;y<this._resolvers.length;y++){let n=this._resolvers[y](d,a);if(n)return kj(n)?new Ga(n.url,null,n.options):new Ga(n,null)}}static{this.\u0275fac=function(d){return new(d||r)(Ot(ku,8),Ot($w),Ot(Si,8),Ot(To))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function Xv(r){return r.cloneNode(!0)}function hP(r,s){return r+":"+s}function kj(r){return!!(r.url&&r.options)}var Lj=new Zt("MAT_ICON_DEFAULT_OPTIONS"),Fj=new Zt("mat-icon-location",{providedIn:"root",factory:Nj});function Nj(){let r=yt(Si),s=r?r.location:null;return{getPathname:()=>s?s.pathname+s.search:""}}var dP=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],zj=dP.map(r=>`[${r}]`).join(", "),Bj=/^url\(['"]?#(.*?)['"]?\)$/,fP=(()=>{class r{get color(){return this._color||this._defaultColor}set color(a){this._color=a}get svgIcon(){return this._svgIcon}set svgIcon(a){a!==this._svgIcon&&(a?this._updateSvgIcon(a):this._svgIcon&&this._clearSvgElement(),this._svgIcon=a)}get fontSet(){return this._fontSet}set fontSet(a){let d=this._cleanupFontValue(a);d!==this._fontSet&&(this._fontSet=d,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(a){let d=this._cleanupFontValue(a);d!==this._fontIcon&&(this._fontIcon=d,this._updateFontIconClasses())}constructor(a,d,y,n,R,j){this._elementRef=a,this._iconRegistry=d,this._location=n,this._errorHandler=R,this.inline=!1,this._previousFontSetClass=[],this._currentIconFetch=Oi.EMPTY,j&&(j.color&&(this.color=this._defaultColor=j.color),j.fontSet&&(this.fontSet=j.fontSet)),y||a.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(a){if(!a)return["",""];let d=a.split(":");switch(d.length){case 1:return["",d[0]];case 2:return d;default:throw Error(`Invalid icon name: "${a}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let a=this._elementsWithExternalReferences;if(a&&a.size){let d=this._location.getPathname();d!==this._previousPath&&(this._previousPath=d,this._prependPathToReferences(d))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(a){this._clearSvgElement();let d=this._location.getPathname();this._previousPath=d,this._cacheChildrenWithExternalReferences(a),this._prependPathToReferences(d),this._elementRef.nativeElement.appendChild(a)}_clearSvgElement(){let a=this._elementRef.nativeElement,d=a.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();d--;){let y=a.childNodes[d];(y.nodeType!==1||y.nodeName.toLowerCase()==="svg")&&y.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let a=this._elementRef.nativeElement,d=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(y=>y.length>0);this._previousFontSetClass.forEach(y=>a.classList.remove(y)),d.forEach(y=>a.classList.add(y)),this._previousFontSetClass=d,this.fontIcon!==this._previousFontIconClass&&!d.includes("mat-ligature-font")&&(this._previousFontIconClass&&a.classList.remove(this._previousFontIconClass),this.fontIcon&&a.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(a){return typeof a=="string"?a.trim().split(" ")[0]:a}_prependPathToReferences(a){let d=this._elementsWithExternalReferences;d&&d.forEach((y,n)=>{y.forEach(R=>{n.setAttribute(R.name,`url('${a}#${R.value}')`)})})}_cacheChildrenWithExternalReferences(a){let d=a.querySelectorAll(zj),y=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let n=0;n<d.length;n++)dP.forEach(R=>{let j=d[n],$=j.getAttribute(R),ie=$?$.match(Bj):null;if(ie){let pe=y.get(j);pe||(pe=[],y.set(j,pe)),pe.push({name:R,value:ie[1]})}})}_updateSvgIcon(a){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),a){let[d,y]=this._splitIconName(a);d&&(this._svgNamespace=d),y&&(this._svgName=y),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(y,d).pipe(Eo(1)).subscribe(n=>this._setSvgElement(n),n=>{let R=`Error retrieving icon ${d}:${y}! ${n.message}`;this._errorHandler.handleError(new Error(R))})}}static{this.\u0275fac=function(d){return new(d||r)(Pn(ur),Pn(Oj),pv("aria-hidden"),Pn(Fj),Pn(To),Pn(Lj,8))}}static{this.\u0275cmp=qo({type:r,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(d,y){d&2&&(dc("data-mat-icon-type",y._usingFontIcon()?"font":"svg")("data-mat-icon-name",y._svgName||y.fontIcon)("data-mat-icon-namespace",y._svgNamespace||y.fontSet)("fontIcon",y._usingFontIcon()?y.fontIcon:null),xw(y.color?"mat-"+y.color:""),qr("mat-icon-inline",y.inline)("mat-icon-no-color",y.color!=="primary"&&y.color!=="accent"&&y.color!=="warn"))},inputs:{color:"color",inline:[2,"inline","inline",Xo],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],standalone:!0,features:[ea,Zo],ngContentSelectors:Aj,decls:1,vars:0,template:function(d,y){d&1&&(Ev(),Iv(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0})}}return r})(),pP=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({imports:[ra,ra]})}}return r})();var jj=0,mP="mat-badge-content",hE=new Set,Uj=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275cmp=qo({type:r,selectors:[["ng-component"]],standalone:!0,features:[Zo],decls:0,vars:0,template:function(d,y){},styles:[".mat-badge{position:relative}.mat-badge.mat-badge{overflow:visible}.mat-badge-content{position:absolute;text-align:center;display:inline-block;transition:transform 200ms ease-in-out;transform:scale(0.6);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box;pointer-events:none;background-color:var(--mat-badge-background-color, var(--mat-app-error));color:var(--mat-badge-text-color, var(--mat-app-on-error));font-family:var(--mat-badge-text-font, var(--mat-app-label-small-font));font-weight:var(--mat-badge-text-weight, var(--mat-app-label-small-weight));border-radius:var(--mat-badge-container-shape, var(--mat-app-corner-full))}.cdk-high-contrast-active .mat-badge-content{outline:solid 1px;border-radius:0}.mat-badge-above .mat-badge-content{bottom:100%}.mat-badge-below .mat-badge-content{top:100%}.mat-badge-before .mat-badge-content{right:100%}[dir=rtl] .mat-badge-before .mat-badge-content{right:auto;left:100%}.mat-badge-after .mat-badge-content{left:100%}[dir=rtl] .mat-badge-after .mat-badge-content{left:auto;right:100%}.mat-badge-disabled .mat-badge-content{background-color:var(--mat-badge-disabled-state-background-color);color:var(--mat-badge-disabled-state-text-color, var(--mat-app-on-error))}.mat-badge-hidden .mat-badge-content{display:none}.ng-animate-disabled .mat-badge-content,.mat-badge-content._mat-animation-noopable{transition:none}.mat-badge-content.mat-badge-active{transform:none}.mat-badge-small .mat-badge-content{width:var(--mat-badge-legacy-small-size-container-size);height:var(--mat-badge-legacy-small-size-container-size);min-width:var(--mat-badge-small-size-container-size);min-height:var(--mat-badge-small-size-container-size);line-height:var(--mat-badge-small-size-line-height);padding:var(--mat-badge-small-size-container-padding);font-size:var(--mat-badge-small-size-text-size);margin:var(--mat-badge-small-size-container-offset)}.mat-badge-small.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-small-size-container-overlap-offset)}.mat-badge-medium .mat-badge-content{width:var(--mat-badge-legacy-container-size);height:var(--mat-badge-legacy-container-size);min-width:var(--mat-badge-container-size);min-height:var(--mat-badge-container-size);line-height:var(--mat-badge-line-height);padding:var(--mat-badge-container-padding);font-size:var(--mat-badge-text-size, var(--mat-app-label-small-size));margin:var(--mat-badge-container-offset)}.mat-badge-medium.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-container-overlap-offset)}.mat-badge-large .mat-badge-content{width:var(--mat-badge-legacy-large-size-container-size);height:var(--mat-badge-legacy-large-size-container-size);min-width:var(--mat-badge-large-size-container-size);min-height:var(--mat-badge-large-size-container-size);line-height:var(--mat-badge-large-size-line-height);padding:var(--mat-badge-large-size-container-padding);font-size:var(--mat-badge-large-size-text-size, var(--mat-app-label-small-size));margin:var(--mat-badge-large-size-container-offset)}.mat-badge-large.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-large-size-container-overlap-offset)}"],encapsulation:2,changeDetection:0})}}return r})(),gP=(()=>{class r{get color(){return this._color}set color(a){this._setColor(a),this._color=a}get content(){return this._content}set content(a){this._updateRenderedContent(a)}get description(){return this._description}set description(a){this._updateDescription(a)}constructor(a,d,y,n,R){this._ngZone=a,this._elementRef=d,this._ariaDescriber=y,this._renderer=n,this._animationMode=R,this._color="primary",this.overlap=!0,this.position="above after",this.size="medium",this._id=jj++,this._isInitialized=!1,this._interactivityChecker=yt(WR),this._document=yt(Si);let j=yt(ia);if(!hE.has(j)){hE.add(j);let $=D2(Uj,{environmentInjector:yt(Dr)});j.onDestroy(()=>{hE.delete(j),$.destroy()})}}isAbove(){return this.position.indexOf("below")===-1}isAfter(){return this.position.indexOf("before")===-1}getBadgeElement(){return this._badgeElement}ngOnInit(){this._clearExistingBadges(),this.content&&!this._badgeElement&&(this._badgeElement=this._createBadgeElement(),this._updateRenderedContent(this.content)),this._isInitialized=!0}ngOnDestroy(){this._renderer.destroyNode&&(this._renderer.destroyNode(this._badgeElement),this._inlineBadgeDescription?.remove()),this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.description)}_isHostInteractive(){return this._interactivityChecker.isFocusable(this._elementRef.nativeElement,{ignoreVisibility:!0})}_createBadgeElement(){let a=this._renderer.createElement("span"),d="mat-badge-active";return a.setAttribute("id",`mat-badge-content-${this._id}`),a.setAttribute("aria-hidden","true"),a.classList.add(mP),this._animationMode==="NoopAnimations"&&a.classList.add("_mat-animation-noopable"),this._elementRef.nativeElement.appendChild(a),typeof requestAnimationFrame=="function"&&this._animationMode!=="NoopAnimations"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{a.classList.add(d)})}):a.classList.add(d),a}_updateRenderedContent(a){let d=`${a??""}`.trim();this._isInitialized&&d&&!this._badgeElement&&(this._badgeElement=this._createBadgeElement()),this._badgeElement&&(this._badgeElement.textContent=d),this._content=d}_updateDescription(a){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.description),(!a||this._isHostInteractive())&&this._removeInlineDescription(),this._description=a,this._isHostInteractive()?this._ariaDescriber.describe(this._elementRef.nativeElement,a):this._updateInlineDescription()}_updateInlineDescription(){this._inlineBadgeDescription||(this._inlineBadgeDescription=this._document.createElement("span"),this._inlineBadgeDescription.classList.add("cdk-visually-hidden")),this._inlineBadgeDescription.textContent=this.description,this._badgeElement?.appendChild(this._inlineBadgeDescription)}_removeInlineDescription(){this._inlineBadgeDescription?.remove(),this._inlineBadgeDescription=void 0}_setColor(a){let d=this._elementRef.nativeElement.classList;d.remove(`mat-badge-${this._color}`),a&&d.add(`mat-badge-${a}`)}_clearExistingBadges(){let a=this._elementRef.nativeElement.querySelectorAll(`:scope > .${mP}`);for(let d of Array.from(a))d!==this._badgeElement&&d.remove()}static{this.\u0275fac=function(d){return new(d||r)(Pn(ci),Pn(ur),Pn(qR),Pn(uc),Pn(lw,8))}}static{this.\u0275dir=or({type:r,selectors:[["","matBadge",""]],hostAttrs:[1,"mat-badge"],hostVars:20,hostBindings:function(d,y){d&2&&qr("mat-badge-overlap",y.overlap)("mat-badge-above",y.isAbove())("mat-badge-below",!y.isAbove())("mat-badge-before",!y.isAfter())("mat-badge-after",y.isAfter())("mat-badge-small",y.size==="small")("mat-badge-medium",y.size==="medium")("mat-badge-large",y.size==="large")("mat-badge-hidden",y.hidden||!y.content)("mat-badge-disabled",y.disabled)},inputs:{color:[0,"matBadgeColor","color"],overlap:[2,"matBadgeOverlap","overlap",Xo],disabled:[2,"matBadgeDisabled","disabled",Xo],position:[0,"matBadgePosition","position"],content:[0,"matBadge","content"],description:[0,"matBadgeDescription","description"],size:[0,"matBadgeSize","size"],hidden:[2,"matBadgeHidden","hidden",Xo]},standalone:!0,features:[ea]})}}return r})(),_P=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({imports:[JR,ra,ra]})}}return r})();var yP=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275mod=Ti({type:r})}static{this.\u0275inj=Ii({imports:[ra,aP]})}}return r})();var Bd=class r{constructor(s){this.http=s}fileCache={};FOLDER_NAME="v21";BASE_URL="/";TRENDS_URL=`${this.BASE_URL}data/${this.FOLDER_NAME}/trends.json`;getCurrentTrends(){return Yp(this.http.get(this.TRENDS_URL).pipe(an(s=>Hj(s))))}fetchFile(s){return new Promise((a,d)=>{if(s in this.fileCache){a(this.fileCache[s]);return}this.http.get(s).toPromise().then(y=>{this.fileCache[s]=y,a(y)})})}getTrendTimeseries(s){return Yp(this.http.get(`${this.BASE_URL}/${s.timeseriesURL}`)).then(a=>a.sort((d,y)=>new Date(d.timestamp).getTime()-new Date(y.timestamp).getTime()))}tileCache={};getTileUrl(s,a,d,y,n){let R=s.tile_dir;return n?`${R}/timeseries/${n}/${a}/${d}_${y}.geojson`:`${R}/${a}/${d}_${y}.geojson`}getTrendTile(s,a,d,y,n){return no(this,null,function*(){let R=this.getTileUrl(s,a,d,y,n),j=`${s.id}_${a}_${d}_${y}_${n||""}`;if(this.tileCache[j])return this.tileCache[j];let $=`${this.BASE_URL}/${R}`;try{let ie=yield Yp(this.http.get($));return this.tileCache[j]=ie,ie}catch(ie){return ie.status!==404&&console.error(`Error loading tile: ${$}`,ie),null}})}getTrendVisibleTiles(s,a,d,y){return no(this,null,function*(){console.log(d);let n=Object.keys(s.tileIndex).map(Me=>Number(Me)).filter(Me=>Me<=d);n.sort((Me,He)=>Me-He),d=n[n.length-1];let R=s.tileIndex[d]||[],ie=this.getBoundsTiles(a,d).map(({x:Me,y:He})=>`${Me}_${He}`).filter(Me=>R.includes(Me)).map(Me=>{let[He,Be]=Me.split("_").map(Number);return this.getTrendTile(s,d,He,Be,y)});return(yield Promise.all(ie)).filter(Me=>Me!==null)})}getBoundsTiles(s,a){let d=[],y=this.latLonToTile(s.getNorth(),s.getWest(),a),n=this.latLonToTile(s.getSouth(),s.getEast(),a);for(let R=y.x;R<=n.x;R++)for(let j=y.y;j<=n.y;j++)d.push({x:R,y:j});return d}latLonToTile(s,a,d){let y=Math.pow(2,d),n=Math.floor((a+180)/360*y),R=s*Math.PI/180,j=Math.floor((1-Math.asinh(Math.tan(R))/Math.PI)/2*y);return{x:Math.max(0,Math.min(y-1,n)),y:Math.max(0,Math.min(y-1,j))}}static \u0275fac=function(a){return new(a||r)(Ot(ku))};static \u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})};function Hj(r){try{return r.map(s=>({id:s.id,name:s.name,is_active:s.is_active,started_at:new Date(s.started_at),expired_at:new Date(s.expired_at),topic:s.topic,is_global:s.is_global,heatmap_filename:s.heatmap_filename,timeseries_points:s.timeseries_points,tile_dir:s.tile_dir,min_zoom:Number(s.min_zoom),max_zoom:Number(s.min_zoom),tileIndex:s.tile_index,timeseriesURL:s.timeseries_url,locations:s.locations.map(a=>({locationId:a.locationId}))}))}catch(s){throw console.error("Error parsing trends:",s),new Error("Failed to parse trends data")}}var Wj={id:1,lat:32.7157,lon:-117.1611,name:"San Diego"},Zj={id:2,lat:34.0522,lon:-118.2437,name:"Los Angeles"},Xj={id:3,lat:37.7749,lon:-122.4194,name:"San Francisco"},Yj={id:4,lat:28.5384,lon:-81.3789,name:"Orlando"},Jj={id:5,lat:25.7617,lon:-80.1918,name:"Miami"},Kj={id:6,lat:47.6062,lon:-122.3321,name:"Seattle"},Qj={id:7,lat:45.5155,lon:-122.6789,name:"Portland"},e5={id:8,lat:41.8781,lon:-87.6298,name:"Chicago"},t5={id:9,lat:40.4406,lon:-79.9959,name:"Pittsburgh"},n5={id:10,lat:42.3314,lon:-83.0458,name:"Detroit"},i5={id:11,lat:39.9612,lon:-82.9988,name:"Columbus"},r5={id:12,lat:39.9526,lon:-75.1652,name:"Philadelphia"},o5={id:13,lat:39.2904,lon:-76.6122,name:"Baltimore"},s5={id:14,lat:42.3601,lon:-71.0589,name:"Boston"},a5={id:15,lat:38.9072,lon:-77.0369,name:"Washington DC"},l5={id:16,lat:40.7128,lon:-74.006,name:"New York"},c5={id:17,lat:30.2672,lon:-97.7431,name:"Austin"},u5={id:18,lat:32.7767,lon:-96.797,name:"Dallas"},h5={id:19,lat:29.7604,lon:-95.3698,name:"Houston"},d5={id:20,lat:29.4241,lon:-98.4936,name:"San Antonio"},f5=[Wj,Zj,Xj,Yj,Jj,Kj,Qj,e5,t5,n5,i5,r5,o5,s5,a5,l5,c5,u5,h5,d5],dE=Object.fromEntries(f5.map(r=>[r.id,r])),vP={SPORT:"sports_football",FINANCES:"attach_money",TECH:"computer",ENTERTAINMENT:"live_tv",POLITICS:"groups"},xP=[{name:"Sport",topicEnum:"SPORT"},{name:"Finances",topicEnum:"FINANCES"},{name:"Technology",topicEnum:"TECH"},{name:"Entertainment",topicEnum:"ENTERTAINMENT"},{name:"Politics",topicEnum:"POLITICS"}];function m5(r,s){if(r&1&&(gi(0,"mat-icon",16),sr(1,"home"),wi()),r&2){let a=Wr().$implicit,d=Wr();Hr("matBadge",d.getTopicLocalTrendsCount(a.topicEnum))}}function g5(r,s){if(r&1&&(gi(0,"mat-icon",16),sr(1,"public"),wi()),r&2){let a=Wr().$implicit,d=Wr();Hr("matBadge",d.getTopicGlobalTrendsCount(a.topicEnum))}}function _5(r,s){if(r&1){let a=vm();gi(0,"div",14),Co("click",function(){let y=dm(a).$implicit,n=Wr();return fm(n.onTopicClick(y.topicEnum))}),gi(1,"div")(2,"span")(3,"mat-icon"),sr(4),wi(),sr(5),wi(),ta(6,m5,2,1,"mat-icon",15)(7,g5,2,1,"mat-icon",15),wi()()}if(r&2){let a=s.$implicit,d=Wr();qr("selected",d.checkTopicSelected(a.topicEnum)),Wi(4),fc(d.getTopicIcon(a.topicEnum)),Wi(),pc(" ",a.name," "),Wi(),Hr("ngIf",d.getTopicLocalTrendsCount(a.topicEnum)>0),Wi(),Hr("ngIf",d.getTopicGlobalTrendsCount(a.topicEnum)>0)}}function y5(r,s){if(r&1){let a=vm();gi(0,"div",17),sr(1),gi(2,"mat-icon",14),Co("click",function(){dm(a);let y=Wr();return fm(y.resetLocation())}),sr(3,"cancel"),wi()()}if(r&2){let a=Wr();Wi(),pc(" Location: ",a.getLocationName(a.selectedLocationId)," ")}}function v5(r,s){if(r&1){let a=vm();gi(0,"div",18),Co("click",function(){let y=dm(a).$implicit,n=Wr();return fm(n.onTrendClick(y))}),gi(1,"mat-icon"),sr(2),wi(),gi(3,"span"),sr(4),wi()()}if(r&2){let a=s.$implicit,d=Wr();qr("selected",d.checkTrendSelected(a)),Wi(2),fc(d.getTopicIcon(a.topic)),Wi(2),fc(a.name)}}function x5(r,s){if(r&1){let a=vm();gi(0,"div",18),Co("click",function(){let y=dm(a).$implicit,n=Wr();return fm(n.onTrendClick(y))}),gi(1,"mat-icon"),sr(2),wi(),gi(3,"span"),sr(4),wi()()}if(r&2){let a=s.$implicit,d=Wr();qr("selected",d.checkTrendSelected(a)),Wi(2),fc(d.getTopicIcon(a.topic)),Wi(2),fc(a.name)}}function b5(r,s){r&1&&(gi(0,"div",19),sr(1," Select Trend to Display Timeline "),wi())}var Vd=class r{constructor(s,a){this.fetchService=s;this.http=a}map;MAP_CENTER=[-107.5795,37.8283];DEFAULT_ZOOM=3.5;speed=1e3;currentTopics=xP;selectedTopic;selectedTrend;selectedLocationId;currentTrends=[];trendsTopics=[];filteredGlobalTrends=[];filteredLocalTrends=[];trendsMap=[];locationTrends=[];renderListener;AllMarkers={};canvas;sliderMaxValue=30;sliderCurrentValue=30;sliderDisabled=!0;timeseriesPoints=[];timeseriesData=[];maxTimeseriesValue=0;ngOnInit(){return no(this,null,function*(){this.canvas=document.getElementById("trend-chart").querySelector("canvas");let[s,a]=yield Promise.all([this.fetchService.getCurrentTrends(),this.initializeMap()]);console.log(s),this.currentTrends=s,this.updateTrends(),this.setupMapLayers(),this.updateMapLocations()})}ngOnDestroy(){this.map&&this.map.remove()}initializeMap(){return Yv.default.accessToken="pk.eyJ1Ijoia3JpbmFydCIsImEiOiJjbTh6M3Rhc2cwN3RkMnJvYzJ4eHIyMnBmIn0.EaEZQyNtl9GN4eL9GqUT4Q",this.map=new Yv.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:this.MAP_CENTER,zoom:this.DEFAULT_ZOOM,renderWorldCopies:!1}),this.map.on("moveend",()=>{let s=Math.floor(this.map.getZoom());this.selectedLocationId!==void 0&&this.selectedTrend==null&&s<6&&(this.selectedLocationId=void 0,this.updateTrends(),this.showMarkers())}),new Promise((s,a)=>{this.map.on("load",()=>{s()})})}setupMapLayers(){this.map.setLayoutProperty("country-label","visibility","none"),this.map.setLayoutProperty("state-label","visibility","none"),this.map.setLayoutProperty("settlement-label","visibility","none"),this.map.setLayoutProperty("road-number-shield","visibility","none"),this.map.setLayoutProperty("road-label","visibility","none"),this.map.addSource("country-boundaries",{type:"vector",url:"mapbox://mapbox.country-boundaries-v1"}),this.map.addLayer({id:"country-boundaries",type:"fill",source:"country-boundaries","source-layer":"country_boundaries",paint:{"fill-color":"gray","fill-opacity":1},filter:["!=",["get","iso_3166_1"],"US"]})}updateTrends(){this.udpateTrendsTopics(),this.updateTrendsList(),this.updateTrendsMap(),this.buildLocationTrends()}udpateTrendsTopics(){let s=this.currentTrends;this.selectedLocationId!==void 0&&(s=s.filter(a=>a.locations.map(d=>d.locationId).includes(this.selectedLocationId))),this.trendsTopics=s}updateTrendsList(){let s=this.currentTrends;this.selectedTopic!==void 0&&(s=s.filter(a=>a.topic===this.selectedTopic)),this.selectedLocationId!==void 0&&(s=s.filter(a=>a.locations.map(d=>d.locationId).includes(this.selectedLocationId))),this.filteredGlobalTrends=s.filter(a=>a.is_global),this.filteredLocalTrends=s.filter(a=>!a.is_global)}updateTrendsMap(){let s=this.currentTrends;this.selectedTopic!==void 0&&(s=s.filter(a=>a.topic===this.selectedTopic)),this.trendsMap=s}onTopicClick(s){this.selectedTopic===s?this.selectedTopic=void 0:this.selectedTopic=s,this.selectedTrend=void 0,this.updateTrends(),this.showMarkers()}checkTopicSelected(s){return this.selectedTopic!==void 0&&this.selectedTopic===s}getTopicIcon(s){return vP[s]}getTopicLocalTrendsCount(s){return this.trendsTopics.filter(a=>!a.is_global&&a.topic==s).length}getTopicGlobalTrendsCount(s){return this.trendsTopics.filter(a=>a.is_global&&a.topic==s).length}onTrendClick(s){if(this.selectedTrend?.id===s.id){this.selectedTrend=void 0;let a=Math.floor(this.map.getZoom());this.selectedLocationId!==void 0&&a<6&&(this.selectedLocationId=void 0)}else this.selectedTrend=s;this.updateTrends(),this.selectedTrend?this.showTrend():this.showMarkers()}showTrend(){return no(this,null,function*(){this.clearMarkers(),yield this.loadTimeseriesData(this.selectedTrend),this.showTrendHeatmap(this.selectedTrend)})}showMarkers(){this.clearHeatmap(),this.updateMapLocations(),this.sliderDisabled=!0,this.sliderCurrentValue=this.sliderMaxValue,this.resetTimeseriesVisualization()}checkTrendSelected(s){return this.selectedTrend!==void 0&&this.selectedTrend.id===s.id}buildLocationTrends(){let s={};for(let a of this.trendsMap)for(let d of a.locations){let y=dE[d.locationId];y.id in s||(s[y.id]={id:y.id,name:y.name,lon:y.lon,lat:y.lat,localTrends:[],globalTrends:[]});let n=s[d.locationId];a.is_global?n.globalTrends.push(a):n.localTrends.push(a)}this.locationTrends=Object.values(s)}selectLocation(s){this.selectedLocationId=s,this.updateTrends(),this.clearMarkers(),console.log(`selected location: ${s}`),console.log(`filtered global trends: ${this.filteredGlobalTrends}`),console.log(`filtered local trends: ${this.filteredLocalTrends}`),this.filteredGlobalTrends.length>0?this.onTrendClick(this.filteredGlobalTrends[0]):this.filteredLocalTrends.length>0&&this.onTrendClick(this.filteredLocalTrends[0])}resetLocation(){this.selectedLocationId=void 0,this.selectedTrend=void 0,this.updateTrends(),this.showMarkers()}getLocationName(s){return dE[s].name}clearMarkers(){this.renderListener&&this.map.off("render",this.renderListener),this.map.getLayer("clusters")&&this.map.removeLayer("clusters"),this.map.getSource("trends")&&this.map.removeSource("trends");for(let s in this.AllMarkers)this.AllMarkers[s].remove()}updateMapLocations(){if(this.selectedLocationId!==void 0)return;this.clearMarkers();let s={type:"FeatureCollection",features:this.locationTrends.map(y=>({type:"Feature",geometry:{type:"Point",coordinates:[y.lon,y.lat]},properties:{locationID:y.id,name:y.name,globalTrends:y.globalTrends,localTrends:y.localTrends}}))};this.map.addSource("trends",{type:"geojson",data:s,cluster:!0,clusterMaxZoom:14,clusterRadius:65}),this.map.addLayer({id:"clusters",type:"circle",source:"trends",filter:["has","point_count"],paint:{"circle-color":"#ff0000","circle-radius":10,"circle-opacity":0}}),this.AllMarkers={};let a={},d=()=>no(this,null,function*(){let y={},n=this.map.querySourceFeatures("trends");for(let R of n){let j=R.properties;if(!j.cluster){let pe=`point_${j.name}`,Me=this.AllMarkers[pe];if(!Me){let He=R.geometry.coordinates,Be=this.createMarker(j.name,JSON.parse(j.globalTrends).length,JSON.parse(j.localTrends).length,He[0],He[1],!1,Number(j.locationID));Be&&(this.AllMarkers[pe]=Be)}Me&&(y[pe]=Me,a[pe]||Me.addTo(this.map));continue}let $=`${j.cluster_id}`,ie=this.AllMarkers[$];if(!ie){let pe=R.geometry.coordinates,Me=yield this.getClusterLeaves(j.cluster_id),He=`${Me[0].properties.name} + ${Me.length-1}`,Be=[],lt=[];for(let St of Me)Be.push(...St.properties.globalTrends.map(_n=>_n.id)),lt.push(...St.properties.localTrends.map(_n=>_n.id));let rt=[...new Set(Be)].length,At=[...new Set(lt)].length,Kt=this.createMarker(He,rt,At,pe[0],pe[1],!0,Number($));Kt&&(this.AllMarkers[$]=Kt)}y[$]=ie,!a[$]&&ie&&ie.addTo(this.map)}for(let R in a)!y[R]&&a[R]&&a[R].remove();a=y});this.renderListener=()=>{this.map.isSourceLoaded("trends")&&d()},this.map.on("render",this.renderListener)}getClusterLeaves(s){return new Promise((a,d)=>{this.map.getSource("trends").getClusterLeaves(s,100,0,(y,n)=>{y?d(y):a(n)})})}createMarker(s,a,d,y,n,R,j){if(a==0&&d==0)return;let $=document.createElement("div");$.className="marker",R?$.addEventListener("click",()=>{this.map.getSource("trends").getClusterExpansionZoom(j,(He,Be)=>{He||this.map.flyTo({center:[y,n],zoom:Be+2})})}):$.addEventListener("click",()=>{this.map.flyTo({center:[y,n],zoom:9.5}),this.selectLocation(j)});let ie=this;if(a>0){let He=document.createElement("div");He.className="icon-with-badge";let Be=document.createElement("span");Be.className="material-icons",Be.textContent="public";let lt=document.createElement("span");lt.className="badge",lt.textContent=a.toString(),He.appendChild(Be),He.appendChild(lt),$.appendChild(He)}if(d>0){let He=document.createElement("div");He.className="icon-with-badge";let Be=document.createElement("span");Be.className="material-icons",Be.textContent="home";let lt=document.createElement("span");lt.className="badge",lt.textContent=d.toString(),He.appendChild(Be),He.appendChild(lt),$.appendChild(He)}let pe=new Yv.default.Marker({element:$}).setLngLat([y,n]),Me=document.createElement("div");return Me.className="title",Me.textContent=`${s}`,$.appendChild(Me),pe}clearHeatmap(){this.map.getLayer("heatmap")&&this.map.removeLayer("heatmap"),this.map.getSource("heatmap")&&this.map.removeSource("heatmap")}showTrendHeatmap(s){return no(this,null,function*(){this.clearHeatmap(),this.map.addSource("heatmap",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.addHeatmapLayer(),s.timeseries_points&&(this.timeseriesPoints=s.timeseries_points,this.sliderMaxValue=this.timeseriesPoints.length-1,this.sliderCurrentValue=this.sliderMaxValue,this.sliderDisabled=!1),yield this.updateVisibleTiles(),this.map.on("zoom",this.updateVisibleTiles.bind(this))})}updateVisibleTiles(){return no(this,null,function*(){if(!this.selectedTrend)return;let s=Math.floor(this.map.getZoom()),a=this.map.getBounds(),d=this.sliderDisabled?void 0:this.timeseriesPoints[this.sliderCurrentValue],y=yield this.fetchService.getTrendVisibleTiles(this.selectedTrend,a,s,d);if(y.length===0)return;let n={type:"FeatureCollection",features:y.flatMap(R=>R.features)};this.map.getSource("heatmap").setData(n)})}addHeatmapLayer(){let a=(this.timeseriesData[this.sliderCurrentValue]?.value||0)/this.maxTimeseriesValue;this.map.addLayer({id:"heatmap",type:"heatmap",source:"heatmap",paint:{"heatmap-weight":["interpolate",["linear"],["get","intensity"],0,0,1,a],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,a,5,a*1.5,10,a*2,15,a*3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(255,0,0,0)",.2,"rgba(255,195,155,0.8)",.4,"rgba(255,165,120,0.8)",.6,"rgba(255,95,85,0.8)",.8,"rgba(255,45,45,0.8)",1,"rgba(178,0,0,0.8)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,1,5.9,70,6.1,20,8.9,120,9.1,90,11.9,200,12.1,110,20,200],"heatmap-opacity":.9}})}onSliderInput(s){let a=s.target.value;this.sliderCurrentValue=Number(a),this.map.getLayer("heatmap")&&this.map.removeLayer("heatmap"),this.addHeatmapLayer(),this.updateVisibleTiles()}resetTimeseriesVisualization(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height)}loadTimeseriesData(s){return no(this,null,function*(){this.resetTimeseriesVisualization(),this.timeseriesData=yield this.fetchService.getTrendTimeseries(s),this.maxTimeseriesValue=Math.max(...this.timeseriesData.map($=>$.value));let d=this.canvas.getContext("2d"),y=this.canvas.parentElement?.clientWidth,n=50,R=10;this.canvas.width=y,this.canvas.height=n+R,d.fillStyle="rgba(255, 255, 255, 0.0)",d.fillRect(0,0,y,n);let j=Math.max(...this.timeseriesData.map($=>$.value));if(this.timeseriesData.length>1){d.beginPath(),d.strokeStyle="#2196F3",d.lineWidth=2;let $=y/(this.timeseriesData.length-1);this.timeseriesData.forEach((ie,pe)=>{let Me=pe*$,He=n-ie.value/j*n+R;pe===0?d.moveTo(Me,He):d.lineTo(Me,He)}),d.stroke()}})}static \u0275fac=function(a){return new(a||r)(Pn(Bd),Pn(ku))};static \u0275cmp=qo({type:r,selectors:[["app-map"]],standalone:!0,features:[Va([Bd]),Zo],decls:28,vars:16,consts:[["id","map"],["id","topics-container"],[3,"selected","click",4,"ngFor","ngForOf"],["id","selected-location-container",4,"ngIf"],["id","trends-container"],[1,"title"],[1,"trends-list"],["class","trend-wrap",3,"selected","click",4,"ngFor","ngForOf"],["id","timeline-container"],[1,"icon-wrap"],["id","timeseries-container"],["id","trend-chart"],["id","slider","type","range",3,"ngModelChange","input","min","max","ngModel","step","disabled"],["class","info-label","style"," ",4,"ngIf"],[3,"click"],["matBadgeSize","small",3,"matBadge",4,"ngIf"],["matBadgeSize","small",3,"matBadge"],["id","selected-location-container"],[1,"trend-wrap",3,"click"],[1,"info-label"]],template:function(a,d){a&1&&(na(0,"div",0),gi(1,"div",1),ta(2,_5,8,6,"div",2),wi(),ta(3,y5,4,1,"div",3),gi(4,"div",4)(5,"div",5)(6,"mat-icon"),sr(7,"public"),wi(),gi(8,"span"),sr(9),wi()(),gi(10,"div",6),ta(11,v5,5,4,"div",7),wi(),gi(12,"div",5)(13,"mat-icon"),sr(14,"home"),wi(),gi(15,"span"),sr(16),wi()(),gi(17,"div",6),ta(18,x5,5,4,"div",7),wi()(),gi(19,"div",8)(20,"div",9)(21,"mat-icon"),sr(22,"schedule"),wi()(),gi(23,"div",10)(24,"div",11),na(25,"canvas"),wi(),gi(26,"input",12),ww("ngModelChange",function(n){return _2(d.sliderCurrentValue,n)||(d.sliderCurrentValue=n),n}),Co("input",function(n){return d.onSliderInput(n)}),wi()(),ta(27,b5,2,0,"div",13),wi()),a&2&&(Wi(2),Hr("ngForOf",d.currentTopics),Wi(),Hr("ngIf",d.selectedLocationId),Wi(6),pc("Global Trends (",d.filteredGlobalTrends.length,")"),Wi(2),Hr("ngForOf",d.filteredGlobalTrends),Wi(5),pc("Local Trends (",d.filteredLocalTrends.length,")"),Wi(2),Hr("ngForOf",d.filteredLocalTrends),Wi(3),qr("disabled",d.sliderDisabled),Wi(5),qr("disabled",d.sliderDisabled),Hr("min",0)("max",d.sliderMaxValue),bw("ngModel",d.sliderCurrentValue),Hr("step",1)("disabled",d.sliderDisabled),Wi(),Hr("ngIf",d.sliderDisabled))},dependencies:[Dw,N2,z2,eR,pP,fP,_P,gP,AR,Gv,Jw,DR,Yw,yP],styles:["#map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}#topics-container[_ngcontent-%COMP%]{position:absolute;top:30px;left:50px;margin:0 auto;background:#fff9;border-radius:4px;display:flex;flex-direction:row;justify-content:center}#topics-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;padding:15px 30px 12px;cursor:pointer}#topics-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:hover{background:#d3d3d3}#topics-container[_ngcontent-%COMP%] > div.selected[_ngcontent-%COMP%]{background:#a9a9a9}#topics-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:18px}#topics-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:18px;padding-top:7px}#topics-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]{margin-left:2px;font-size:20px}#topics-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > mat-icon[_ngcontent-%COMP%]:nth-child(3){margin-left:8px}#selected-location-container[_ngcontent-%COMP%]{background:#fff9;position:absolute;width:330px;left:50px;top:100px;padding:20px;font-size:18px}#selected-location-container[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{cursor:pointer;position:relative;top:5px}#trends-container[_ngcontent-%COMP%]{background:#fff9;position:absolute;width:330px;left:50px;top:180px}#trends-container[_ngcontent-%COMP%]   div.title[_ngcontent-%COMP%]{font-size:20px;margin-left:20px;margin-top:30px;margin-bottom:5px;font-weight:700}#trends-container[_ngcontent-%COMP%]   div.title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:10px;position:relative;top:-2px}#trends-container[_ngcontent-%COMP%]   div.title[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:26px}#trends-container[_ngcontent-%COMP%]   div.trends-list[_ngcontent-%COMP%]{overflow:scroll;max-height:200px}#trends-container[_ngcontent-%COMP%]   div.trends-list[_ngcontent-%COMP%]   div.trend-wrap[_ngcontent-%COMP%]{padding:6px 35px}#trends-container[_ngcontent-%COMP%]   div.trends-list[_ngcontent-%COMP%]   div.trend-wrap[_ngcontent-%COMP%]:hover{background:#d3d3d3;cursor:pointer}#trends-container[_ngcontent-%COMP%]   div.trends-list[_ngcontent-%COMP%]   div.trend-wrap.selected[_ngcontent-%COMP%]{background:#a9a9a9}#trends-container[_ngcontent-%COMP%]   div.trends-list[_ngcontent-%COMP%]   div.trend-wrap.ended-recently[_ngcontent-%COMP%]{color:gray}#trends-container[_ngcontent-%COMP%]   div.trends-list[_ngcontent-%COMP%]   div.trend-wrap[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;position:relative;top:-2px}#trends-container[_ngcontent-%COMP%]   div.trends-list[_ngcontent-%COMP%]   div.trend-wrap[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:22px;padding-top:4px;margin-right:10px}#timeline-container[_ngcontent-%COMP%]{position:absolute;bottom:30px;left:50px;width:80%;background:#fff9;padding:10px;border-radius:4px;display:flex;flex-direction:row}#timeline-container[_ngcontent-%COMP%]   .icon-wrap[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-right:10px}#timeline-container[_ngcontent-%COMP%]   #timeseries-container[_ngcontent-%COMP%]{position:relative;width:100%;height:50px}#timeline-container[_ngcontent-%COMP%]   #timeseries-container[_ngcontent-%COMP%]   #trend-chart[_ngcontent-%COMP%]{width:100%}#timeline-container[_ngcontent-%COMP%]   #timeseries-container[_ngcontent-%COMP%]   #trend-chart[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{height:50px;width:100%}#timeline-container[_ngcontent-%COMP%]   #timeseries-container[_ngcontent-%COMP%]   #slider[_ngcontent-%COMP%]{width:100%;position:absolute;left:0;-webkit-appearance:none;height:4px;background:transparent;border-radius:2px;outline:none;margin-top:-33px}#timeline-container[_ngcontent-%COMP%]   #timeseries-container[_ngcontent-%COMP%]   #slider[_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:15px;height:50px;background:#2563eb;background:url(/assets/images/drag.png) center no-repeat,#2563eb;background-size:10px 15px,auto;border-radius:2px;cursor:pointer;margin-top:0;box-shadow:0 4px 6px #0000001a;transition:transform .2s,box-shadow .2s}#timeline-container[_ngcontent-%COMP%]   #timeseries-container[_ngcontent-%COMP%]   #slider[_ngcontent-%COMP%]::-webkit-slider-thumb:hover{background:url(/assets/images/drag.png) center no-repeat,#4177ee;background-size:10px 15px,auto}#timeline-container[_ngcontent-%COMP%]   #timeseries-container[_ngcontent-%COMP%]   #slider.disabled[_ngcontent-%COMP%]::-webkit-slider-thumb{display:none;background:url(/assets/images/drag-disabled.png) center no-repeat,gray;background-size:10px 15px,auto;cursor:auto}#timeline-container[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{position:absolute;left:0;width:100%;text-align:center;padding-top:10px;font-size:14pt}"]})};var Jv=class r{title="ui";static \u0275fac=function(a){return new(a||r)};static \u0275cmp=qo({type:r,selectors:[["app-root"]],standalone:!0,features:[Zo],decls:1,vars:0,template:function(a,d){a&1&&na(0,"app-map")},dependencies:[Vd],styles:["body[_ngcontent-%COMP%]{margin:0;padding:0}#map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}#controls-container[_ngcontent-%COMP%]{position:absolute;bottom:30px;left:50px;width:80%;background:#fff9;padding:10px;border-radius:4px}#slider[_ngcontent-%COMP%]{width:100%;margin:10px 0}#play-controls[_ngcontent-%COMP%]{margin-top:10px;display:flex;gap:10px;align-items:center}button[_ngcontent-%COMP%]{padding:5px 15px;border:none;border-radius:4px;background:#4a4a4a;color:#fff;cursor:pointer;font-family:Arial,sans-serif;transition:background .3s}button[_ngcontent-%COMP%]:hover{background:#666}#speed-control[_ngcontent-%COMP%]{margin-left:20px;display:flex;align-items:center;gap:10px}#trends-controls-container[_ngcontent-%COMP%]{position:absolute;top:30px;left:50px;width:80%;background:#fff9;padding:10px;border-radius:4px}"]})};var kn="primary",Jm=Symbol("RouteTitle"),_E=class{constructor(s){this.params=s||{}}has(s){return Object.prototype.hasOwnProperty.call(this.params,s)}get(s){if(this.has(s)){let a=this.params[s];return Array.isArray(a)?a[0]:a}return null}getAll(s){if(this.has(s)){let a=this.params[s];return Array.isArray(a)?a:[a]}return[]}get keys(){return Object.keys(this.params)}};function qd(r){return new _E(r)}function w5(r,s,a){let d=a.path.split("/");if(d.length>r.length||a.pathMatch==="full"&&(s.hasChildren()||d.length<r.length))return null;let y={};for(let n=0;n<d.length;n++){let R=d[n],j=r[n];if(R[0]===":")y[R.substring(1)]=j;else if(R!==j.path)return null}return{consumed:r.slice(0,d.length),posParams:y}}function E5(r,s){if(r.length!==s.length)return!1;for(let a=0;a<r.length;++a)if(!oa(r[a],s[a]))return!1;return!0}function oa(r,s){let a=r?yE(r):void 0,d=s?yE(s):void 0;if(!a||!d||a.length!=d.length)return!1;let y;for(let n=0;n<a.length;n++)if(y=a[n],!MP(r[y],s[y]))return!1;return!0}function yE(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}function MP(r,s){if(Array.isArray(r)&&Array.isArray(s)){if(r.length!==s.length)return!1;let a=[...r].sort(),d=[...s].sort();return a.every((y,n)=>d[n]===y)}else return r===s}function SP(r){return r.length>0?r[r.length-1]:null}function vc(r){return xb(r)?r:Pu(r)?zi(Promise.resolve(r)):hn(r)}var I5={exact:RP,subset:PP},AP={exact:T5,subset:C5,ignored:()=>!0};function bP(r,s,a){return I5[a.paths](r.root,s.root,a.matrixParams)&&AP[a.queryParams](r.queryParams,s.queryParams)&&!(a.fragment==="exact"&&r.fragment!==s.fragment)}function T5(r,s){return oa(r,s)}function RP(r,s,a){if(!Bu(r.segments,s.segments)||!e0(r.segments,s.segments,a)||r.numberOfChildren!==s.numberOfChildren)return!1;for(let d in s.children)if(!r.children[d]||!RP(r.children[d],s.children[d],a))return!1;return!0}function C5(r,s){return Object.keys(s).length<=Object.keys(r).length&&Object.keys(s).every(a=>MP(r[a],s[a]))}function PP(r,s,a){return OP(r,s,s.segments,a)}function OP(r,s,a,d){if(r.segments.length>a.length){let y=r.segments.slice(0,a.length);return!(!Bu(y,a)||s.hasChildren()||!e0(y,a,d))}else if(r.segments.length===a.length){if(!Bu(r.segments,a)||!e0(r.segments,a,d))return!1;for(let y in s.children)if(!r.children[y]||!PP(r.children[y],s.children[y],d))return!1;return!0}else{let y=a.slice(0,r.segments.length),n=a.slice(r.segments.length);return!Bu(r.segments,y)||!e0(r.segments,y,d)||!r.children[kn]?!1:OP(r.children[kn],s,n,d)}}function e0(r,s,a){return s.every((d,y)=>AP[a](r[y].parameters,d.parameters))}var qa=class{constructor(s=new ui([],{}),a={},d=null){this.root=s,this.queryParams=a,this.fragment=d}get queryParamMap(){return this._queryParamMap??=qd(this.queryParams),this._queryParamMap}toString(){return S5.serialize(this)}},ui=class{constructor(s,a){this.segments=s,this.children=a,this.parent=null,Object.values(a).forEach(d=>d.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return t0(this)}},zu=class{constructor(s,a){this.path=s,this.parameters=a}get parameterMap(){return this._parameterMap??=qd(this.parameters),this._parameterMap}toString(){return LP(this)}};function D5(r,s){return Bu(r,s)&&r.every((a,d)=>oa(a.parameters,s[d].parameters))}function Bu(r,s){return r.length!==s.length?!1:r.every((a,d)=>a.path===s[d].path)}function M5(r,s){let a=[];return Object.entries(r.children).forEach(([d,y])=>{d===kn&&(a=a.concat(s(y,d)))}),Object.entries(r.children).forEach(([d,y])=>{d!==kn&&(a=a.concat(s(y,d)))}),a}var GE=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:()=>new jm,providedIn:"root"})}}return r})(),jm=class{parse(s){let a=new xE(s);return new qa(a.parseRootSegment(),a.parseQueryParams(),a.parseFragment())}serialize(s){let a=`/${Lm(s.root,!0)}`,d=P5(s.queryParams),y=typeof s.fragment=="string"?`#${A5(s.fragment)}`:"";return`${a}${d}${y}`}},S5=new jm;function t0(r){return r.segments.map(s=>LP(s)).join("/")}function Lm(r,s){if(!r.hasChildren())return t0(r);if(s){let a=r.children[kn]?Lm(r.children[kn],!1):"",d=[];return Object.entries(r.children).forEach(([y,n])=>{y!==kn&&d.push(`${y}:${Lm(n,!1)}`)}),d.length>0?`${a}(${d.join("//")})`:a}else{let a=M5(r,(d,y)=>y===kn?[Lm(r.children[kn],!1)]:[`${y}:${Lm(d,!1)}`]);return Object.keys(r.children).length===1&&r.children[kn]!=null?`${t0(r)}/${a[0]}`:`${t0(r)}/(${a.join("//")})`}}function kP(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Kv(r){return kP(r).replace(/%3B/gi,";")}function A5(r){return encodeURI(r)}function vE(r){return kP(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function n0(r){return decodeURIComponent(r)}function wP(r){return n0(r.replace(/\+/g,"%20"))}function LP(r){return`${vE(r.path)}${R5(r.parameters)}`}function R5(r){return Object.entries(r).map(([s,a])=>`;${vE(s)}=${vE(a)}`).join("")}function P5(r){let s=Object.entries(r).map(([a,d])=>Array.isArray(d)?d.map(y=>`${Kv(a)}=${Kv(y)}`).join("&"):`${Kv(a)}=${Kv(d)}`).filter(a=>a);return s.length?`?${s.join("&")}`:""}var O5=/^[^\/()?;#]+/;function fE(r){let s=r.match(O5);return s?s[0]:""}var k5=/^[^\/()?;=#]+/;function L5(r){let s=r.match(k5);return s?s[0]:""}var F5=/^[^=?&#]+/;function N5(r){let s=r.match(F5);return s?s[0]:""}var z5=/^[^&#]+/;function B5(r){let s=r.match(z5);return s?s[0]:""}var xE=class{constructor(s){this.url=s,this.remaining=s}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new ui([],{}):new ui([],this.parseChildren())}parseQueryParams(){let s={};if(this.consumeOptional("?"))do this.parseQueryParam(s);while(this.consumeOptional("&"));return s}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let s=[];for(this.peekStartsWith("(")||s.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),s.push(this.parseSegment());let a={};this.peekStartsWith("/(")&&(this.capture("/"),a=this.parseParens(!0));let d={};return this.peekStartsWith("(")&&(d=this.parseParens(!1)),(s.length>0||Object.keys(a).length>0)&&(d[kn]=new ui(s,a)),d}parseSegment(){let s=fE(this.remaining);if(s===""&&this.peekStartsWith(";"))throw new on(4009,!1);return this.capture(s),new zu(n0(s),this.parseMatrixParams())}parseMatrixParams(){let s={};for(;this.consumeOptional(";");)this.parseParam(s);return s}parseParam(s){let a=L5(this.remaining);if(!a)return;this.capture(a);let d="";if(this.consumeOptional("=")){let y=fE(this.remaining);y&&(d=y,this.capture(d))}s[n0(a)]=n0(d)}parseQueryParam(s){let a=N5(this.remaining);if(!a)return;this.capture(a);let d="";if(this.consumeOptional("=")){let R=B5(this.remaining);R&&(d=R,this.capture(d))}let y=wP(a),n=wP(d);if(s.hasOwnProperty(y)){let R=s[y];Array.isArray(R)||(R=[R],s[y]=R),R.push(n)}else s[y]=n}parseParens(s){let a={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let d=fE(this.remaining),y=this.remaining[d.length];if(y!=="/"&&y!==")"&&y!==";")throw new on(4010,!1);let n;d.indexOf(":")>-1?(n=d.slice(0,d.indexOf(":")),this.capture(n),this.capture(":")):s&&(n=kn);let R=this.parseChildren();a[n]=Object.keys(R).length===1?R[kn]:new ui([],R),this.consumeOptional("//")}return a}peekStartsWith(s){return this.remaining.startsWith(s)}consumeOptional(s){return this.peekStartsWith(s)?(this.remaining=this.remaining.substring(s.length),!0):!1}capture(s){if(!this.consumeOptional(s))throw new on(4011,!1)}};function FP(r){return r.segments.length>0?new ui([],{[kn]:r}):r}function NP(r){let s={};for(let[d,y]of Object.entries(r.children)){let n=NP(y);if(d===kn&&n.segments.length===0&&n.hasChildren())for(let[R,j]of Object.entries(n.children))s[R]=j;else(n.segments.length>0||n.hasChildren())&&(s[d]=n)}let a=new ui(r.segments,s);return V5(a)}function V5(r){if(r.numberOfChildren===1&&r.children[kn]){let s=r.children[kn];return new ui(r.segments.concat(s.segments),s.children)}return r}function Um(r){return r instanceof qa}function j5(r,s,a=null,d=null){let y=zP(r);return BP(y,s,a,d)}function zP(r){let s;function a(n){let R={};for(let $ of n.children){let ie=a($);R[$.outlet]=ie}let j=new ui(n.url,R);return n===r&&(s=j),j}let d=a(r.root),y=FP(d);return s??y}function BP(r,s,a,d){let y=r;for(;y.parent;)y=y.parent;if(s.length===0)return pE(y,y,y,a,d);let n=U5(s);if(n.toRoot())return pE(y,y,new ui([],{}),a,d);let R=$5(n,y,r),j=R.processChildren?zm(R.segmentGroup,R.index,n.commands):jP(R.segmentGroup,R.index,n.commands);return pE(y,R.segmentGroup,j,a,d)}function i0(r){return typeof r=="object"&&r!=null&&!r.outlets&&!r.segmentPath}function $m(r){return typeof r=="object"&&r!=null&&r.outlets}function pE(r,s,a,d,y){let n={};d&&Object.entries(d).forEach(([$,ie])=>{n[$]=Array.isArray(ie)?ie.map(pe=>`${pe}`):`${ie}`});let R;r===s?R=a:R=VP(r,s,a);let j=FP(NP(R));return new qa(j,n,y)}function VP(r,s,a){let d={};return Object.entries(r.children).forEach(([y,n])=>{n===s?d[y]=a:d[y]=VP(n,s,a)}),new ui(r.segments,d)}var r0=class{constructor(s,a,d){if(this.isAbsolute=s,this.numberOfDoubleDots=a,this.commands=d,s&&d.length>0&&i0(d[0]))throw new on(4003,!1);let y=d.find($m);if(y&&y!==SP(d))throw new on(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function U5(r){if(typeof r[0]=="string"&&r.length===1&&r[0]==="/")return new r0(!0,0,r);let s=0,a=!1,d=r.reduce((y,n,R)=>{if(typeof n=="object"&&n!=null){if(n.outlets){let j={};return Object.entries(n.outlets).forEach(([$,ie])=>{j[$]=typeof ie=="string"?ie.split("/"):ie}),[...y,{outlets:j}]}if(n.segmentPath)return[...y,n.segmentPath]}return typeof n!="string"?[...y,n]:R===0?(n.split("/").forEach((j,$)=>{$==0&&j==="."||($==0&&j===""?a=!0:j===".."?s++:j!=""&&y.push(j))}),y):[...y,n]},[]);return new r0(a,s,d)}var $d=class{constructor(s,a,d){this.segmentGroup=s,this.processChildren=a,this.index=d}};function $5(r,s,a){if(r.isAbsolute)return new $d(s,!0,0);if(!a)return new $d(s,!1,NaN);if(a.parent===null)return new $d(a,!0,0);let d=i0(r.commands[0])?0:1,y=a.segments.length-1+d;return G5(a,y,r.numberOfDoubleDots)}function G5(r,s,a){let d=r,y=s,n=a;for(;n>y;){if(n-=y,d=d.parent,!d)throw new on(4005,!1);y=d.segments.length}return new $d(d,!1,y-n)}function H5(r){return $m(r[0])?r[0].outlets:{[kn]:r}}function jP(r,s,a){if(r??=new ui([],{}),r.segments.length===0&&r.hasChildren())return zm(r,s,a);let d=q5(r,s,a),y=a.slice(d.commandIndex);if(d.match&&d.pathIndex<r.segments.length){let n=new ui(r.segments.slice(0,d.pathIndex),{});return n.children[kn]=new ui(r.segments.slice(d.pathIndex),r.children),zm(n,0,y)}else return d.match&&y.length===0?new ui(r.segments,{}):d.match&&!r.hasChildren()?bE(r,s,a):d.match?zm(r,0,y):bE(r,s,a)}function zm(r,s,a){if(a.length===0)return new ui(r.segments,{});{let d=H5(a),y={};if(Object.keys(d).some(n=>n!==kn)&&r.children[kn]&&r.numberOfChildren===1&&r.children[kn].segments.length===0){let n=zm(r.children[kn],s,a);return new ui(r.segments,n.children)}return Object.entries(d).forEach(([n,R])=>{typeof R=="string"&&(R=[R]),R!==null&&(y[n]=jP(r.children[n],s,R))}),Object.entries(r.children).forEach(([n,R])=>{d[n]===void 0&&(y[n]=R)}),new ui(r.segments,y)}}function q5(r,s,a){let d=0,y=s,n={match:!1,pathIndex:0,commandIndex:0};for(;y<r.segments.length;){if(d>=a.length)return n;let R=r.segments[y],j=a[d];if($m(j))break;let $=`${j}`,ie=d<a.length-1?a[d+1]:null;if(y>0&&$===void 0)break;if($&&ie&&typeof ie=="object"&&ie.outlets===void 0){if(!IP($,ie,R))return n;d+=2}else{if(!IP($,{},R))return n;d++}y++}return{match:!0,pathIndex:y,commandIndex:d}}function bE(r,s,a){let d=r.segments.slice(0,s),y=0;for(;y<a.length;){let n=a[y];if($m(n)){let $=W5(n.outlets);return new ui(d,$)}if(y===0&&i0(a[0])){let $=r.segments[s];d.push(new zu($.path,EP(a[0]))),y++;continue}let R=$m(n)?n.outlets[kn]:`${n}`,j=y<a.length-1?a[y+1]:null;R&&j&&i0(j)?(d.push(new zu(R,EP(j))),y+=2):(d.push(new zu(R,{})),y++)}return new ui(d,{})}function W5(r){let s={};return Object.entries(r).forEach(([a,d])=>{typeof d=="string"&&(d=[d]),d!==null&&(s[a]=bE(new ui([],{}),0,d))}),s}function EP(r){let s={};return Object.entries(r).forEach(([a,d])=>s[a]=`${d}`),s}function IP(r,s,a){return r==a.path&&oa(s,a.parameters)}var Bm="imperative",vr=function(r){return r[r.NavigationStart=0]="NavigationStart",r[r.NavigationEnd=1]="NavigationEnd",r[r.NavigationCancel=2]="NavigationCancel",r[r.NavigationError=3]="NavigationError",r[r.RoutesRecognized=4]="RoutesRecognized",r[r.ResolveStart=5]="ResolveStart",r[r.ResolveEnd=6]="ResolveEnd",r[r.GuardsCheckStart=7]="GuardsCheckStart",r[r.GuardsCheckEnd=8]="GuardsCheckEnd",r[r.RouteConfigLoadStart=9]="RouteConfigLoadStart",r[r.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",r[r.ChildActivationStart=11]="ChildActivationStart",r[r.ChildActivationEnd=12]="ChildActivationEnd",r[r.ActivationStart=13]="ActivationStart",r[r.ActivationEnd=14]="ActivationEnd",r[r.Scroll=15]="Scroll",r[r.NavigationSkipped=16]="NavigationSkipped",r}(vr||{}),Yo=class{constructor(s,a){this.id=s,this.url=a}},Gm=class extends Yo{constructor(s,a,d="imperative",y=null){super(s,a),this.type=vr.NavigationStart,this.navigationTrigger=d,this.restoredState=y}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Vu=class extends Yo{constructor(s,a,d){super(s,a),this.urlAfterRedirects=d,this.type=vr.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},So=function(r){return r[r.Redirect=0]="Redirect",r[r.SupersededByNewNavigation=1]="SupersededByNewNavigation",r[r.NoDataFromResolver=2]="NoDataFromResolver",r[r.GuardRejected=3]="GuardRejected",r}(So||{}),wE=function(r){return r[r.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",r[r.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",r}(wE||{}),Ha=class extends Yo{constructor(s,a,d,y){super(s,a),this.reason=d,this.code=y,this.type=vr.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},ju=class extends Yo{constructor(s,a,d,y){super(s,a),this.reason=d,this.code=y,this.type=vr.NavigationSkipped}},Hm=class extends Yo{constructor(s,a,d,y){super(s,a),this.error=d,this.target=y,this.type=vr.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},o0=class extends Yo{constructor(s,a,d,y){super(s,a),this.urlAfterRedirects=d,this.state=y,this.type=vr.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},EE=class extends Yo{constructor(s,a,d,y){super(s,a),this.urlAfterRedirects=d,this.state=y,this.type=vr.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},IE=class extends Yo{constructor(s,a,d,y,n){super(s,a),this.urlAfterRedirects=d,this.state=y,this.shouldActivate=n,this.type=vr.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},TE=class extends Yo{constructor(s,a,d,y){super(s,a),this.urlAfterRedirects=d,this.state=y,this.type=vr.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},CE=class extends Yo{constructor(s,a,d,y){super(s,a),this.urlAfterRedirects=d,this.state=y,this.type=vr.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},DE=class{constructor(s){this.route=s,this.type=vr.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},ME=class{constructor(s){this.route=s,this.type=vr.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},SE=class{constructor(s){this.snapshot=s,this.type=vr.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},AE=class{constructor(s){this.snapshot=s,this.type=vr.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},RE=class{constructor(s){this.snapshot=s,this.type=vr.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},PE=class{constructor(s){this.snapshot=s,this.type=vr.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var qm=class{},Wd=class{constructor(s,a){this.url=s,this.navigationBehaviorOptions=a}};function Z5(r,s){return r.providers&&!r._injector&&(r._injector=vw(r.providers,s,`Route: ${r.path}`)),r._injector??s}function Ms(r){return r.outlet||kn}function X5(r,s){let a=r.filter(d=>Ms(d)===s);return a.push(...r.filter(d=>Ms(d)!==s)),a}function Km(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let s=r.parent;s;s=s.parent){let a=s.routeConfig;if(a?._loadedInjector)return a._loadedInjector;if(a?._injector)return a._injector}return null}var OE=class{get injector(){return Km(this.route?.snapshot)??this.rootInjector}set injector(s){}constructor(s){this.rootInjector=s,this.outlet=null,this.route=null,this.children=new d0(this.rootInjector),this.attachRef=null}},d0=(()=>{class r{constructor(a){this.rootInjector=a,this.contexts=new Map}onChildOutletCreated(a,d){let y=this.getOrCreateContext(a);y.outlet=d,this.contexts.set(a,y)}onChildOutletDestroyed(a){let d=this.getContext(a);d&&(d.outlet=null,d.attachRef=null)}onOutletDeactivated(){let a=this.contexts;return this.contexts=new Map,a}onOutletReAttached(a){this.contexts=a}getOrCreateContext(a){let d=this.getContext(a);return d||(d=new OE(this.rootInjector),this.contexts.set(a,d)),d}getContext(a){return this.contexts.get(a)||null}static{this.\u0275fac=function(d){return new(d||r)(Ot(Dr))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),s0=class{constructor(s){this._root=s}get root(){return this._root.value}parent(s){let a=this.pathFromRoot(s);return a.length>1?a[a.length-2]:null}children(s){let a=kE(s,this._root);return a?a.children.map(d=>d.value):[]}firstChild(s){let a=kE(s,this._root);return a&&a.children.length>0?a.children[0].value:null}siblings(s){let a=LE(s,this._root);return a.length<2?[]:a[a.length-2].children.map(y=>y.value).filter(y=>y!==s)}pathFromRoot(s){return LE(s,this._root).map(a=>a.value)}};function kE(r,s){if(r===s.value)return s;for(let a of s.children){let d=kE(r,a);if(d)return d}return null}function LE(r,s){if(r===s.value)return[s];for(let a of s.children){let d=LE(r,a);if(d.length)return d.unshift(s),d}return[]}var Mo=class{constructor(s,a){this.value=s,this.children=a}toString(){return`TreeNode(${this.value})`}};function Ud(r){let s={};return r&&r.children.forEach(a=>s[a.value.outlet]=a),s}var a0=class extends s0{constructor(s,a){super(s),this.snapshot=a,HE(this,s)}toString(){return this.snapshot.toString()}};function UP(r){let s=Y5(r),a=new _r([new zu("",{})]),d=new _r({}),y=new _r({}),n=new _r({}),R=new _r(""),j=new Zd(a,d,n,R,y,kn,r,s.root);return j.snapshot=s.root,new a0(new Mo(j,[]),s)}function Y5(r){let s={},a={},d={},y="",n=new Gd([],s,d,y,a,kn,r,null,{});return new c0("",new Mo(n,[]))}var Zd=class{constructor(s,a,d,y,n,R,j,$){this.urlSubject=s,this.paramsSubject=a,this.queryParamsSubject=d,this.fragmentSubject=y,this.dataSubject=n,this.outlet=R,this.component=j,this._futureSnapshot=$,this.title=this.dataSubject?.pipe(an(ie=>ie[Jm]))??hn(void 0),this.url=s,this.params=a,this.queryParams=d,this.fragment=y,this.data=n}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(an(s=>qd(s))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(an(s=>qd(s))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function l0(r,s,a="emptyOnly"){let d,{routeConfig:y}=r;return s!==null&&(a==="always"||y?.path===""||!s.component&&!s.routeConfig?.loadComponent)?d={params:bt(bt({},s.params),r.params),data:bt(bt({},s.data),r.data),resolve:bt(bt(bt(bt({},r.data),s.data),y?.data),r._resolvedData)}:d={params:bt({},r.params),data:bt({},r.data),resolve:bt(bt({},r.data),r._resolvedData??{})},y&&GP(y)&&(d.resolve[Jm]=y.title),d}var Gd=class{get title(){return this.data?.[Jm]}constructor(s,a,d,y,n,R,j,$,ie){this.url=s,this.params=a,this.queryParams=d,this.fragment=y,this.data=n,this.outlet=R,this.component=j,this.routeConfig=$,this._resolve=ie}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=qd(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=qd(this.queryParams),this._queryParamMap}toString(){let s=this.url.map(d=>d.toString()).join("/"),a=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${s}', path:'${a}')`}},c0=class extends s0{constructor(s,a){super(a),this.url=s,HE(this,a)}toString(){return $P(this._root)}};function HE(r,s){s.value._routerState=r,s.children.forEach(a=>HE(r,a))}function $P(r){let s=r.children.length>0?` { ${r.children.map($P).join(", ")} } `:"";return`${r.value}${s}`}function mE(r){if(r.snapshot){let s=r.snapshot,a=r._futureSnapshot;r.snapshot=a,oa(s.queryParams,a.queryParams)||r.queryParamsSubject.next(a.queryParams),s.fragment!==a.fragment&&r.fragmentSubject.next(a.fragment),oa(s.params,a.params)||r.paramsSubject.next(a.params),E5(s.url,a.url)||r.urlSubject.next(a.url),oa(s.data,a.data)||r.dataSubject.next(a.data)}else r.snapshot=r._futureSnapshot,r.dataSubject.next(r._futureSnapshot.data)}function FE(r,s){let a=oa(r.params,s.params)&&D5(r.url,s.url),d=!r.parent!=!s.parent;return a&&!d&&(!r.parent||FE(r.parent,s.parent))}function GP(r){return typeof r.title=="string"||r.title===null}var J5=(()=>{class r{constructor(){this.activated=null,this._activatedRoute=null,this.name=kn,this.activateEvents=new Hi,this.deactivateEvents=new Hi,this.attachEvents=new Hi,this.detachEvents=new Hi,this.parentContexts=yt(d0),this.location=yt(Pd),this.changeDetector=yt(ja),this.inputBinder=yt(qE,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(a){if(a.name){let{firstChange:d,previousValue:y}=a.name;if(d)return;this.isTrackedInParentContexts(y)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(y)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(a){return this.parentContexts.getContext(a)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let a=this.parentContexts.getContext(this.name);a?.route&&(a.attachRef?this.attach(a.attachRef,a.route):this.activateWith(a.route,a.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new on(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new on(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new on(4012,!1);this.location.detach();let a=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(a.instance),a}attach(a,d){this.activated=a,this._activatedRoute=d,this.location.insert(a.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(a.instance)}deactivate(){if(this.activated){let a=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(a)}}activateWith(a,d){if(this.isActivated)throw new on(4013,!1);this._activatedRoute=a;let y=this.location,R=a.snapshot.component,j=this.parentContexts.getOrCreateContext(this.name).children,$=new NE(a,j,y.injector);this.activated=y.createComponent(R,{index:y.length,injector:$,environmentInjector:d}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275dir=or({type:r,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Au]})}}return r})(),NE=class r{__ngOutletInjector(s){return new r(this.route,this.childContexts,s)}constructor(s,a,d){this.route=s,this.childContexts=a,this.parent=d}get(s,a){return s===Zd?this.route:s===d0?this.childContexts:this.parent.get(s,a)}},qE=new Zt("");function K5(r,s,a){let d=Wm(r,s._root,a?a._root:void 0);return new a0(d,s)}function Wm(r,s,a){if(a&&r.shouldReuseRoute(s.value,a.value.snapshot)){let d=a.value;d._futureSnapshot=s.value;let y=Q5(r,s,a);return new Mo(d,y)}else{if(r.shouldAttach(s.value)){let n=r.retrieve(s.value);if(n!==null){let R=n.route;return R.value._futureSnapshot=s.value,R.children=s.children.map(j=>Wm(r,j)),R}}let d=eU(s.value),y=s.children.map(n=>Wm(r,n));return new Mo(d,y)}}function Q5(r,s,a){return s.children.map(d=>{for(let y of a.children)if(r.shouldReuseRoute(d.value,y.value.snapshot))return Wm(r,d,y);return Wm(r,d)})}function eU(r){return new Zd(new _r(r.url),new _r(r.params),new _r(r.queryParams),new _r(r.fragment),new _r(r.data),r.outlet,r.component,r)}var Zm=class{constructor(s,a){this.redirectTo=s,this.navigationBehaviorOptions=a}},HP="ngNavigationCancelingError";function u0(r,s){let{redirectTo:a,navigationBehaviorOptions:d}=Um(s)?{redirectTo:s,navigationBehaviorOptions:void 0}:s,y=qP(!1,So.Redirect);return y.url=a,y.navigationBehaviorOptions=d,y}function qP(r,s){let a=new Error(`NavigationCancelingError: ${r||""}`);return a[HP]=!0,a.cancellationCode=s,a}function tU(r){return WP(r)&&Um(r.url)}function WP(r){return!!r&&r[HP]}var nU=(r,s,a,d)=>an(y=>(new zE(s,y.targetRouterState,y.currentRouterState,a,d).activate(r),y)),zE=class{constructor(s,a,d,y,n){this.routeReuseStrategy=s,this.futureState=a,this.currState=d,this.forwardEvent=y,this.inputBindingEnabled=n}activate(s){let a=this.futureState._root,d=this.currState?this.currState._root:null;this.deactivateChildRoutes(a,d,s),mE(this.futureState.root),this.activateChildRoutes(a,d,s)}deactivateChildRoutes(s,a,d){let y=Ud(a);s.children.forEach(n=>{let R=n.value.outlet;this.deactivateRoutes(n,y[R],d),delete y[R]}),Object.values(y).forEach(n=>{this.deactivateRouteAndItsChildren(n,d)})}deactivateRoutes(s,a,d){let y=s.value,n=a?a.value:null;if(y===n)if(y.component){let R=d.getContext(y.outlet);R&&this.deactivateChildRoutes(s,a,R.children)}else this.deactivateChildRoutes(s,a,d);else n&&this.deactivateRouteAndItsChildren(a,d)}deactivateRouteAndItsChildren(s,a){s.value.component&&this.routeReuseStrategy.shouldDetach(s.value.snapshot)?this.detachAndStoreRouteSubtree(s,a):this.deactivateRouteAndOutlet(s,a)}detachAndStoreRouteSubtree(s,a){let d=a.getContext(s.value.outlet),y=d&&s.value.component?d.children:a,n=Ud(s);for(let R of Object.values(n))this.deactivateRouteAndItsChildren(R,y);if(d&&d.outlet){let R=d.outlet.detach(),j=d.children.onOutletDeactivated();this.routeReuseStrategy.store(s.value.snapshot,{componentRef:R,route:s,contexts:j})}}deactivateRouteAndOutlet(s,a){let d=a.getContext(s.value.outlet),y=d&&s.value.component?d.children:a,n=Ud(s);for(let R of Object.values(n))this.deactivateRouteAndItsChildren(R,y);d&&(d.outlet&&(d.outlet.deactivate(),d.children.onOutletDeactivated()),d.attachRef=null,d.route=null)}activateChildRoutes(s,a,d){let y=Ud(a);s.children.forEach(n=>{this.activateRoutes(n,y[n.value.outlet],d),this.forwardEvent(new PE(n.value.snapshot))}),s.children.length&&this.forwardEvent(new AE(s.value.snapshot))}activateRoutes(s,a,d){let y=s.value,n=a?a.value:null;if(mE(y),y===n)if(y.component){let R=d.getOrCreateContext(y.outlet);this.activateChildRoutes(s,a,R.children)}else this.activateChildRoutes(s,a,d);else if(y.component){let R=d.getOrCreateContext(y.outlet);if(this.routeReuseStrategy.shouldAttach(y.snapshot)){let j=this.routeReuseStrategy.retrieve(y.snapshot);this.routeReuseStrategy.store(y.snapshot,null),R.children.onOutletReAttached(j.contexts),R.attachRef=j.componentRef,R.route=j.route.value,R.outlet&&R.outlet.attach(j.componentRef,j.route.value),mE(j.route.value),this.activateChildRoutes(s,null,R.children)}else R.attachRef=null,R.route=y,R.outlet&&R.outlet.activateWith(y,R.injector),this.activateChildRoutes(s,null,R.children)}else this.activateChildRoutes(s,null,d)}},h0=class{constructor(s){this.path=s,this.route=this.path[this.path.length-1]}},Hd=class{constructor(s,a){this.component=s,this.route=a}};function iU(r,s,a){let d=r._root,y=s?s._root:null;return Fm(d,y,a,[d.value])}function rU(r){let s=r.routeConfig?r.routeConfig.canActivateChild:null;return!s||s.length===0?null:{node:r,guards:s}}function Yd(r,s){let a=Symbol(),d=s.get(r,a);return d===a?typeof r=="function"&&!HM(r)?r:s.get(r):d}function Fm(r,s,a,d,y={canDeactivateChecks:[],canActivateChecks:[]}){let n=Ud(s);return r.children.forEach(R=>{oU(R,n[R.value.outlet],a,d.concat([R.value]),y),delete n[R.value.outlet]}),Object.entries(n).forEach(([R,j])=>Vm(j,a.getContext(R),y)),y}function oU(r,s,a,d,y={canDeactivateChecks:[],canActivateChecks:[]}){let n=r.value,R=s?s.value:null,j=a?a.getContext(r.value.outlet):null;if(R&&n.routeConfig===R.routeConfig){let $=sU(R,n,n.routeConfig.runGuardsAndResolvers);$?y.canActivateChecks.push(new h0(d)):(n.data=R.data,n._resolvedData=R._resolvedData),n.component?Fm(r,s,j?j.children:null,d,y):Fm(r,s,a,d,y),$&&j&&j.outlet&&j.outlet.isActivated&&y.canDeactivateChecks.push(new Hd(j.outlet.component,R))}else R&&Vm(s,j,y),y.canActivateChecks.push(new h0(d)),n.component?Fm(r,null,j?j.children:null,d,y):Fm(r,null,a,d,y);return y}function sU(r,s,a){if(typeof a=="function")return a(r,s);switch(a){case"pathParamsChange":return!Bu(r.url,s.url);case"pathParamsOrQueryParamsChange":return!Bu(r.url,s.url)||!oa(r.queryParams,s.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!FE(r,s)||!oa(r.queryParams,s.queryParams);case"paramsChange":default:return!FE(r,s)}}function Vm(r,s,a){let d=Ud(r),y=r.value;Object.entries(d).forEach(([n,R])=>{y.component?s?Vm(R,s.children.getContext(n),a):Vm(R,null,a):Vm(R,s,a)}),y.component?s&&s.outlet&&s.outlet.isActivated?a.canDeactivateChecks.push(new Hd(s.outlet.component,y)):a.canDeactivateChecks.push(new Hd(null,y)):a.canDeactivateChecks.push(new Hd(null,y))}function Qm(r){return typeof r=="function"}function aU(r){return typeof r=="boolean"}function lU(r){return r&&Qm(r.canLoad)}function cU(r){return r&&Qm(r.canActivate)}function uU(r){return r&&Qm(r.canActivateChild)}function hU(r){return r&&Qm(r.canDeactivate)}function dU(r){return r&&Qm(r.canMatch)}function ZP(r){return r instanceof ws||r?.name==="EmptyError"}var Qv=Symbol("INITIAL_VALUE");function Xd(){return Io(r=>ad(r.map(s=>s.pipe(Eo(1),Kp(Qv)))).pipe(an(s=>{for(let a of s)if(a!==!0){if(a===Qv)return Qv;if(a===!1||fU(a))return a}return!0}),Br(s=>s!==Qv),Eo(1)))}function fU(r){return Um(r)||r instanceof Zm}function pU(r,s){return rr(a=>{let{targetSnapshot:d,currentSnapshot:y,guards:{canActivateChecks:n,canDeactivateChecks:R}}=a;return R.length===0&&n.length===0?hn(Un(bt({},a),{guardsResult:!0})):mU(R,d,y,r).pipe(rr(j=>j&&aU(j)?gU(d,n,r,s):hn(j)),an(j=>Un(bt({},a),{guardsResult:j})))})}function mU(r,s,a,d){return zi(r).pipe(rr(y=>bU(y.component,y.route,a,s,d)),Ws(y=>y!==!0,!0))}function gU(r,s,a,d){return zi(s).pipe(Ql(y=>Kl(yU(y.route.parent,d),_U(y.route,d),xU(r,y.path,a),vU(r,y.route,a))),Ws(y=>y!==!0,!0))}function _U(r,s){return r!==null&&s&&s(new RE(r)),hn(!0)}function yU(r,s){return r!==null&&s&&s(new SE(r)),hn(!0)}function vU(r,s,a){let d=s.routeConfig?s.routeConfig.canActivate:null;if(!d||d.length===0)return hn(!0);let y=d.map(n=>wy(()=>{let R=Km(s)??a,j=Yd(n,R),$=cU(j)?j.canActivate(s,r):Ds(R,()=>j(s,r));return vc($).pipe(Ws())}));return hn(y).pipe(Xd())}function xU(r,s,a){let d=s[s.length-1],n=s.slice(0,s.length-1).reverse().map(R=>rU(R)).filter(R=>R!==null).map(R=>wy(()=>{let j=R.guards.map($=>{let ie=Km(R.node)??a,pe=Yd($,ie),Me=uU(pe)?pe.canActivateChild(d,r):Ds(ie,()=>pe(d,r));return vc(Me).pipe(Ws())});return hn(j).pipe(Xd())}));return hn(n).pipe(Xd())}function bU(r,s,a,d,y){let n=s&&s.routeConfig?s.routeConfig.canDeactivate:null;if(!n||n.length===0)return hn(!0);let R=n.map(j=>{let $=Km(s)??y,ie=Yd(j,$),pe=hU(ie)?ie.canDeactivate(r,s,a,d):Ds($,()=>ie(r,s,a,d));return vc(pe).pipe(Ws())});return hn(R).pipe(Xd())}function wU(r,s,a,d){let y=s.canLoad;if(y===void 0||y.length===0)return hn(!0);let n=y.map(R=>{let j=Yd(R,r),$=lU(j)?j.canLoad(s,a):Ds(r,()=>j(s,a));return vc($)});return hn(n).pipe(Xd(),XP(d))}function XP(r){return mb(Ui(s=>{if(typeof s!="boolean")throw u0(r,s)}),an(s=>s===!0))}function EU(r,s,a,d){let y=s.canMatch;if(!y||y.length===0)return hn(!0);let n=y.map(R=>{let j=Yd(R,r),$=dU(j)?j.canMatch(s,a):Ds(r,()=>j(s,a));return vc($)});return hn(n).pipe(Xd(),XP(d))}var Xm=class{constructor(s){this.segmentGroup=s||null}},Ym=class extends Error{constructor(s){super(),this.urlTree=s}};function jd(r){return Jl(new Xm(r))}function IU(r){return Jl(new on(4e3,!1))}function TU(r){return Jl(qP(!1,So.GuardRejected))}var BE=class{constructor(s,a){this.urlSerializer=s,this.urlTree=a}lineralizeSegments(s,a){let d=[],y=a.root;for(;;){if(d=d.concat(y.segments),y.numberOfChildren===0)return hn(d);if(y.numberOfChildren>1||!y.children[kn])return IU(`${s.redirectTo}`);y=y.children[kn]}}applyRedirectCommands(s,a,d,y,n){if(typeof a!="string"){let j=a,{queryParams:$,fragment:ie,routeConfig:pe,url:Me,outlet:He,params:Be,data:lt,title:rt}=y,At=Ds(n,()=>j({params:Be,data:lt,queryParams:$,fragment:ie,routeConfig:pe,url:Me,outlet:He,title:rt}));if(At instanceof qa)throw new Ym(At);a=At}let R=this.applyRedirectCreateUrlTree(a,this.urlSerializer.parse(a),s,d);if(a[0]==="/")throw new Ym(R);return R}applyRedirectCreateUrlTree(s,a,d,y){let n=this.createSegmentGroup(s,a.root,d,y);return new qa(n,this.createQueryParams(a.queryParams,this.urlTree.queryParams),a.fragment)}createQueryParams(s,a){let d={};return Object.entries(s).forEach(([y,n])=>{if(typeof n=="string"&&n[0]===":"){let j=n.substring(1);d[y]=a[j]}else d[y]=n}),d}createSegmentGroup(s,a,d,y){let n=this.createSegments(s,a.segments,d,y),R={};return Object.entries(a.children).forEach(([j,$])=>{R[j]=this.createSegmentGroup(s,$,d,y)}),new ui(n,R)}createSegments(s,a,d,y){return a.map(n=>n.path[0]===":"?this.findPosParam(s,n,y):this.findOrReturn(n,d))}findPosParam(s,a,d){let y=d[a.path.substring(1)];if(!y)throw new on(4001,!1);return y}findOrReturn(s,a){let d=0;for(let y of a){if(y.path===s.path)return a.splice(d),y;d++}return s}},VE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function CU(r,s,a,d,y){let n=YP(r,s,a);return n.matched?(d=Z5(s,d),EU(d,s,a,y).pipe(an(R=>R===!0?n:bt({},VE)))):hn(n)}function YP(r,s,a){if(s.path==="**")return DU(a);if(s.path==="")return s.pathMatch==="full"&&(r.hasChildren()||a.length>0)?bt({},VE):{matched:!0,consumedSegments:[],remainingSegments:a,parameters:{},positionalParamSegments:{}};let y=(s.matcher||w5)(a,r,s);if(!y)return bt({},VE);let n={};Object.entries(y.posParams??{}).forEach(([j,$])=>{n[j]=$.path});let R=y.consumed.length>0?bt(bt({},n),y.consumed[y.consumed.length-1].parameters):n;return{matched:!0,consumedSegments:y.consumed,remainingSegments:a.slice(y.consumed.length),parameters:R,positionalParamSegments:y.posParams??{}}}function DU(r){return{matched:!0,parameters:r.length>0?SP(r).parameters:{},consumedSegments:r,remainingSegments:[],positionalParamSegments:{}}}function TP(r,s,a,d){return a.length>0&&AU(r,a,d)?{segmentGroup:new ui(s,SU(d,new ui(a,r.children))),slicedSegments:[]}:a.length===0&&RU(r,a,d)?{segmentGroup:new ui(r.segments,MU(r,a,d,r.children)),slicedSegments:a}:{segmentGroup:new ui(r.segments,r.children),slicedSegments:a}}function MU(r,s,a,d){let y={};for(let n of a)if(f0(r,s,n)&&!d[Ms(n)]){let R=new ui([],{});y[Ms(n)]=R}return bt(bt({},d),y)}function SU(r,s){let a={};a[kn]=s;for(let d of r)if(d.path===""&&Ms(d)!==kn){let y=new ui([],{});a[Ms(d)]=y}return a}function AU(r,s,a){return a.some(d=>f0(r,s,d)&&Ms(d)!==kn)}function RU(r,s,a){return a.some(d=>f0(r,s,d))}function f0(r,s,a){return(r.hasChildren()||s.length>0)&&a.pathMatch==="full"?!1:a.path===""}function PU(r,s,a){return s.length===0&&!r.children[a]}var jE=class{};function OU(r,s,a,d,y,n,R="emptyOnly"){return new UE(r,s,a,d,y,R,n).recognize()}var kU=31,UE=class{constructor(s,a,d,y,n,R,j){this.injector=s,this.configLoader=a,this.rootComponentType=d,this.config=y,this.urlTree=n,this.paramsInheritanceStrategy=R,this.urlSerializer=j,this.applyRedirects=new BE(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(s){return new on(4002,`'${s.segmentGroup}'`)}recognize(){let s=TP(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(s).pipe(an(({children:a,rootSnapshot:d})=>{let y=new Mo(d,a),n=new c0("",y),R=j5(d,[],this.urlTree.queryParams,this.urlTree.fragment);return R.queryParams=this.urlTree.queryParams,n.url=this.urlSerializer.serialize(R),{state:n,tree:R}}))}match(s){let a=new Gd([],Object.freeze({}),Object.freeze(bt({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),kn,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,s,kn,a).pipe(an(d=>({children:d,rootSnapshot:a})),Hs(d=>{if(d instanceof Ym)return this.urlTree=d.urlTree,this.match(d.urlTree.root);throw d instanceof Xm?this.noMatchError(d):d}))}processSegmentGroup(s,a,d,y,n){return d.segments.length===0&&d.hasChildren()?this.processChildren(s,a,d,n):this.processSegment(s,a,d,d.segments,y,!0,n).pipe(an(R=>R instanceof Mo?[R]:[]))}processChildren(s,a,d,y){let n=[];for(let R of Object.keys(d.children))R==="primary"?n.unshift(R):n.push(R);return zi(n).pipe(Ql(R=>{let j=d.children[R],$=X5(a,R);return this.processSegmentGroup(s,$,j,R,y)}),Tb((R,j)=>(R.push(...j),R)),ec(null),Ib(),rr(R=>{if(R===null)return jd(d);let j=JP(R);return LU(j),hn(j)}))}processSegment(s,a,d,y,n,R,j){return zi(a).pipe(Ql($=>this.processSegmentAgainstRoute($._injector??s,a,$,d,y,n,R,j).pipe(Hs(ie=>{if(ie instanceof Xm)return hn(null);throw ie}))),Ws($=>!!$),Hs($=>{if(ZP($))return PU(d,y,n)?hn(new jE):jd(d);throw $}))}processSegmentAgainstRoute(s,a,d,y,n,R,j,$){return Ms(d)!==R&&(R===kn||!f0(y,n,d))?jd(y):d.redirectTo===void 0?this.matchSegmentAgainstRoute(s,y,d,n,R,$):this.allowRedirects&&j?this.expandSegmentAgainstRouteUsingRedirect(s,y,a,d,n,R,$):jd(y)}expandSegmentAgainstRouteUsingRedirect(s,a,d,y,n,R,j){let{matched:$,parameters:ie,consumedSegments:pe,positionalParamSegments:Me,remainingSegments:He}=YP(a,y,n);if(!$)return jd(a);typeof y.redirectTo=="string"&&y.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>kU&&(this.allowRedirects=!1));let Be=new Gd(n,ie,Object.freeze(bt({},this.urlTree.queryParams)),this.urlTree.fragment,CP(y),Ms(y),y.component??y._loadedComponent??null,y,DP(y)),lt=l0(Be,j,this.paramsInheritanceStrategy);Be.params=Object.freeze(lt.params),Be.data=Object.freeze(lt.data);let rt=this.applyRedirects.applyRedirectCommands(pe,y.redirectTo,Me,Be,s);return this.applyRedirects.lineralizeSegments(y,rt).pipe(rr(At=>this.processSegment(s,d,a,At.concat(He),R,!1,j)))}matchSegmentAgainstRoute(s,a,d,y,n,R){let j=CU(a,d,y,s,this.urlSerializer);return d.path==="**"&&(a.children={}),j.pipe(Io($=>$.matched?(s=d._injector??s,this.getChildConfig(s,d,y).pipe(Io(({routes:ie})=>{let pe=d._loadedInjector??s,{parameters:Me,consumedSegments:He,remainingSegments:Be}=$,lt=new Gd(He,Me,Object.freeze(bt({},this.urlTree.queryParams)),this.urlTree.fragment,CP(d),Ms(d),d.component??d._loadedComponent??null,d,DP(d)),rt=l0(lt,R,this.paramsInheritanceStrategy);lt.params=Object.freeze(rt.params),lt.data=Object.freeze(rt.data);let{segmentGroup:At,slicedSegments:Kt}=TP(a,He,Be,ie);if(Kt.length===0&&At.hasChildren())return this.processChildren(pe,ie,At,lt).pipe(an(_n=>new Mo(lt,_n)));if(ie.length===0&&Kt.length===0)return hn(new Mo(lt,[]));let St=Ms(d)===n;return this.processSegment(pe,ie,At,Kt,St?kn:n,!0,lt).pipe(an(_n=>new Mo(lt,_n instanceof Mo?[_n]:[])))}))):jd(a)))}getChildConfig(s,a,d){return a.children?hn({routes:a.children,injector:s}):a.loadChildren?a._loadedRoutes!==void 0?hn({routes:a._loadedRoutes,injector:a._loadedInjector}):wU(s,a,d,this.urlSerializer).pipe(rr(y=>y?this.configLoader.loadChildren(s,a).pipe(Ui(n=>{a._loadedRoutes=n.routes,a._loadedInjector=n.injector})):TU(a))):hn({routes:[],injector:s})}};function LU(r){r.sort((s,a)=>s.value.outlet===kn?-1:a.value.outlet===kn?1:s.value.outlet.localeCompare(a.value.outlet))}function FU(r){let s=r.value.routeConfig;return s&&s.path===""}function JP(r){let s=[],a=new Set;for(let d of r){if(!FU(d)){s.push(d);continue}let y=s.find(n=>d.value.routeConfig===n.value.routeConfig);y!==void 0?(y.children.push(...d.children),a.add(y)):s.push(d)}for(let d of a){let y=JP(d.children);s.push(new Mo(d.value,y))}return s.filter(d=>!a.has(d))}function CP(r){return r.data||{}}function DP(r){return r.resolve||{}}function NU(r,s,a,d,y,n){return rr(R=>OU(r,s,a,d,R.extractedUrl,y,n).pipe(an(({state:j,tree:$})=>Un(bt({},R),{targetSnapshot:j,urlAfterRedirects:$}))))}function zU(r,s){return rr(a=>{let{targetSnapshot:d,guards:{canActivateChecks:y}}=a;if(!y.length)return hn(a);let n=new Set(y.map($=>$.route)),R=new Set;for(let $ of n)if(!R.has($))for(let ie of KP($))R.add(ie);let j=0;return zi(R).pipe(Ql($=>n.has($)?BU($,d,r,s):($.data=l0($,$.parent,r).resolve,hn(void 0))),Ui(()=>j++),ld(1),rr($=>j===R.size?hn(a):wo))})}function KP(r){let s=r.children.map(a=>KP(a)).flat();return[r,...s]}function BU(r,s,a,d){let y=r.routeConfig,n=r._resolve;return y?.title!==void 0&&!GP(y)&&(n[Jm]=y.title),VU(n,r,s,d).pipe(an(R=>(r._resolvedData=R,r.data=l0(r,r.parent,a).resolve,null)))}function VU(r,s,a,d){let y=yE(r);if(y.length===0)return hn({});let n={};return zi(y).pipe(rr(R=>jU(r[R],s,a,d).pipe(Ws(),Ui(j=>{if(j instanceof Zm)throw u0(new jm,j);n[R]=j}))),ld(1),Eb(n),Hs(R=>ZP(R)?wo:Jl(R)))}function jU(r,s,a,d){let y=Km(s)??d,n=Yd(r,y),R=n.resolve?n.resolve(s,a):Ds(y,()=>n(s,a));return vc(R)}function gE(r){return Io(s=>{let a=r(s);return a?zi(a).pipe(an(()=>s)):hn(s)})}var QP=(()=>{class r{buildTitle(a){let d,y=a.root;for(;y!==void 0;)d=this.getResolvedTitleForRoute(y)??d,y=y.children.find(n=>n.outlet===kn);return d}getResolvedTitleForRoute(a){return a.data[Jm]}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:()=>yt(UU),providedIn:"root"})}}return r})(),UU=(()=>{class r extends QP{constructor(a){super(),this.title=a}updateTitle(a){let d=this.buildTitle(a);d!==void 0&&this.title.setTitle(d)}static{this.\u0275fac=function(d){return new(d||r)(Ot(cR))}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),WE=new Zt("",{providedIn:"root",factory:()=>({})}),$U=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275cmp=qo({type:r,selectors:[["ng-component"]],standalone:!0,features:[Zo],decls:1,vars:0,template:function(d,y){d&1&&na(0,"router-outlet")},dependencies:[J5],encapsulation:2})}}return r})();function ZE(r){let s=r.children&&r.children.map(ZE),a=s?Un(bt({},r),{children:s}):bt({},r);return!a.component&&!a.loadComponent&&(s||a.loadChildren)&&a.outlet&&a.outlet!==kn&&(a.component=$U),a}var XE=new Zt(""),GU=(()=>{class r{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=yt(Ew)}loadComponent(a){if(this.componentLoaders.get(a))return this.componentLoaders.get(a);if(a._loadedComponent)return hn(a._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(a);let d=vc(a.loadComponent()).pipe(an(eO),Ui(n=>{this.onLoadEndListener&&this.onLoadEndListener(a),a._loadedComponent=n}),qs(()=>{this.componentLoaders.delete(a)})),y=new od(d,()=>new Gi).pipe(rd());return this.componentLoaders.set(a,y),y}loadChildren(a,d){if(this.childrenLoaders.get(d))return this.childrenLoaders.get(d);if(d._loadedRoutes)return hn({routes:d._loadedRoutes,injector:d._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(d);let n=HU(d,this.compiler,a,this.onLoadEndListener).pipe(qs(()=>{this.childrenLoaders.delete(d)})),R=new od(n,()=>new Gi).pipe(rd());return this.childrenLoaders.set(d,R),R}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function HU(r,s,a,d){return vc(r.loadChildren()).pipe(an(eO),rr(y=>y instanceof lm||Array.isArray(y)?hn(y):zi(s.compileModuleAsync(y))),an(y=>{d&&d(r);let n,R,j=!1;return Array.isArray(y)?(R=y,j=!0):(n=y.create(a).injector,R=n.get(XE,[],{optional:!0,self:!0}).flat()),{routes:R.map(ZE),injector:n}}))}function qU(r){return r&&typeof r=="object"&&"default"in r}function eO(r){return qU(r)?r.default:r}var YE=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:()=>yt(WU),providedIn:"root"})}}return r})(),WU=(()=>{class r{shouldProcessUrl(a){return!0}extract(a){return a}merge(a,d){return a}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),ZU=new Zt("");var XU=new Zt(""),YU=(()=>{class r{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Gi,this.transitionAbortSubject=new Gi,this.configLoader=yt(GU),this.environmentInjector=yt(Dr),this.urlSerializer=yt(GE),this.rootContexts=yt(d0),this.location=yt(xm),this.inputBindingEnabled=yt(qE,{optional:!0})!==null,this.titleStrategy=yt(QP),this.options=yt(WE,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=yt(YE),this.createViewTransition=yt(ZU,{optional:!0}),this.navigationErrorHandler=yt(XU,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>hn(void 0),this.rootComponentType=null;let a=y=>this.events.next(new DE(y)),d=y=>this.events.next(new ME(y));this.configLoader.onLoadEndListener=d,this.configLoader.onLoadStartListener=a}complete(){this.transitions?.complete()}handleNavigationRequest(a){let d=++this.navigationId;this.transitions?.next(Un(bt(bt({},this.transitions.value),a),{id:d}))}setupNavigations(a,d,y){return this.transitions=new _r({id:0,currentUrlTree:d,currentRawUrl:d,extractedUrl:this.urlHandlingStrategy.extract(d),urlAfterRedirects:this.urlHandlingStrategy.extract(d),rawUrl:d,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Bm,restoredState:null,currentSnapshot:y.snapshot,targetSnapshot:null,currentRouterState:y,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Br(n=>n.id!==0),an(n=>Un(bt({},n),{extractedUrl:this.urlHandlingStrategy.extract(n.rawUrl)})),Io(n=>{let R=!1,j=!1;return hn(n).pipe(Io($=>{if(this.navigationId>n.id)return this.cancelNavigationTransition(n,"",So.SupersededByNewNavigation),wo;this.currentTransition=n,this.currentNavigation={id:$.id,initialUrl:$.rawUrl,extractedUrl:$.extractedUrl,targetBrowserUrl:typeof $.extras.browserUrl=="string"?this.urlSerializer.parse($.extras.browserUrl):$.extras.browserUrl,trigger:$.source,extras:$.extras,previousNavigation:this.lastSuccessfulNavigation?Un(bt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let ie=!a.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),pe=$.extras.onSameUrlNavigation??a.onSameUrlNavigation;if(!ie&&pe!=="reload"){let Me="";return this.events.next(new ju($.id,this.urlSerializer.serialize($.rawUrl),Me,wE.IgnoredSameUrlNavigation)),$.resolve(!1),wo}if(this.urlHandlingStrategy.shouldProcessUrl($.rawUrl))return hn($).pipe(Io(Me=>{let He=this.transitions?.getValue();return this.events.next(new Gm(Me.id,this.urlSerializer.serialize(Me.extractedUrl),Me.source,Me.restoredState)),He!==this.transitions?.getValue()?wo:Promise.resolve(Me)}),NU(this.environmentInjector,this.configLoader,this.rootComponentType,a.config,this.urlSerializer,this.paramsInheritanceStrategy),Ui(Me=>{n.targetSnapshot=Me.targetSnapshot,n.urlAfterRedirects=Me.urlAfterRedirects,this.currentNavigation=Un(bt({},this.currentNavigation),{finalUrl:Me.urlAfterRedirects});let He=new o0(Me.id,this.urlSerializer.serialize(Me.extractedUrl),this.urlSerializer.serialize(Me.urlAfterRedirects),Me.targetSnapshot);this.events.next(He)}));if(ie&&this.urlHandlingStrategy.shouldProcessUrl($.currentRawUrl)){let{id:Me,extractedUrl:He,source:Be,restoredState:lt,extras:rt}=$,At=new Gm(Me,this.urlSerializer.serialize(He),Be,lt);this.events.next(At);let Kt=UP(this.rootComponentType).snapshot;return this.currentTransition=n=Un(bt({},$),{targetSnapshot:Kt,urlAfterRedirects:He,extras:Un(bt({},rt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=He,hn(n)}else{let Me="";return this.events.next(new ju($.id,this.urlSerializer.serialize($.extractedUrl),Me,wE.IgnoredByUrlHandlingStrategy)),$.resolve(!1),wo}}),Ui($=>{let ie=new EE($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(ie)}),an($=>(this.currentTransition=n=Un(bt({},$),{guards:iU($.targetSnapshot,$.currentSnapshot,this.rootContexts)}),n)),pU(this.environmentInjector,$=>this.events.next($)),Ui($=>{if(n.guardsResult=$.guardsResult,$.guardsResult&&typeof $.guardsResult!="boolean")throw u0(this.urlSerializer,$.guardsResult);let ie=new IE($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot,!!$.guardsResult);this.events.next(ie)}),Br($=>$.guardsResult?!0:(this.cancelNavigationTransition($,"",So.GuardRejected),!1)),gE($=>{if($.guards.canActivateChecks.length)return hn($).pipe(Ui(ie=>{let pe=new TE(ie.id,this.urlSerializer.serialize(ie.extractedUrl),this.urlSerializer.serialize(ie.urlAfterRedirects),ie.targetSnapshot);this.events.next(pe)}),Io(ie=>{let pe=!1;return hn(ie).pipe(zU(this.paramsInheritanceStrategy,this.environmentInjector),Ui({next:()=>pe=!0,complete:()=>{pe||this.cancelNavigationTransition(ie,"",So.NoDataFromResolver)}}))}),Ui(ie=>{let pe=new CE(ie.id,this.urlSerializer.serialize(ie.extractedUrl),this.urlSerializer.serialize(ie.urlAfterRedirects),ie.targetSnapshot);this.events.next(pe)}))}),gE($=>{let ie=pe=>{let Me=[];pe.routeConfig?.loadComponent&&!pe.routeConfig._loadedComponent&&Me.push(this.configLoader.loadComponent(pe.routeConfig).pipe(Ui(He=>{pe.component=He}),an(()=>{})));for(let He of pe.children)Me.push(...ie(He));return Me};return ad(ie($.targetSnapshot.root)).pipe(ec(null),Eo(1))}),gE(()=>this.afterPreactivation()),Io(()=>{let{currentSnapshot:$,targetSnapshot:ie}=n,pe=this.createViewTransition?.(this.environmentInjector,$.root,ie.root);return pe?zi(pe).pipe(an(()=>n)):hn(n)}),an($=>{let ie=K5(a.routeReuseStrategy,$.targetSnapshot,$.currentRouterState);return this.currentTransition=n=Un(bt({},$),{targetRouterState:ie}),this.currentNavigation.targetRouterState=ie,n}),Ui(()=>{this.events.next(new qm)}),nU(this.rootContexts,a.routeReuseStrategy,$=>this.events.next($),this.inputBindingEnabled),Eo(1),Ui({next:$=>{R=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Vu($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects))),this.titleStrategy?.updateTitle($.targetRouterState.snapshot),$.resolve(!0)},complete:()=>{R=!0}}),Qp(this.transitionAbortSubject.pipe(Ui($=>{throw $}))),qs(()=>{!R&&!j&&this.cancelNavigationTransition(n,"",So.SupersededByNewNavigation),this.currentTransition?.id===n.id&&(this.currentNavigation=null,this.currentTransition=null)}),Hs($=>{if(j=!0,WP($))this.events.next(new Ha(n.id,this.urlSerializer.serialize(n.extractedUrl),$.message,$.cancellationCode)),tU($)?this.events.next(new Wd($.url,$.navigationBehaviorOptions)):n.resolve(!1);else{let ie=new Hm(n.id,this.urlSerializer.serialize(n.extractedUrl),$,n.targetSnapshot??void 0);try{let pe=Ds(this.environmentInjector,()=>this.navigationErrorHandler?.(ie));if(pe instanceof Zm){let{message:Me,cancellationCode:He}=u0(this.urlSerializer,pe);this.events.next(new Ha(n.id,this.urlSerializer.serialize(n.extractedUrl),Me,He)),this.events.next(new Wd(pe.redirectTo,pe.navigationBehaviorOptions))}else{this.events.next(ie);let Me=a.errorHandler($);n.resolve(!!Me)}}catch(pe){this.options.resolveNavigationPromiseOnError?n.resolve(!1):n.reject(pe)}}return wo}))}))}cancelNavigationTransition(a,d,y){let n=new Ha(a.id,this.urlSerializer.serialize(a.extractedUrl),d,y);this.events.next(n),a.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let a=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),d=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return a.toString()!==d?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function JU(r){return r!==Bm}var KU=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:()=>yt(QU),providedIn:"root"})}}return r})(),$E=class{shouldDetach(s){return!1}store(s,a){}shouldAttach(s){return!1}retrieve(s){return null}shouldReuseRoute(s,a){return s.routeConfig===a.routeConfig}},QU=(()=>{class r extends $E{static{this.\u0275fac=(()=>{let a;return function(y){return(a||(a=Ad(r)))(y||r)}})()}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),tO=(()=>{class r{static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:()=>yt(e6),providedIn:"root"})}}return r})(),e6=(()=>{class r extends tO{constructor(){super(...arguments),this.location=yt(xm),this.urlSerializer=yt(GE),this.options=yt(WE,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=yt(YE),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new qa,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=UP(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(a){return this.location.subscribe(d=>{d.type==="popstate"&&a(d.url,d.state)})}handleRouterEvent(a,d){if(a instanceof Gm)this.stateMemento=this.createStateMemento();else if(a instanceof ju)this.rawUrlTree=d.initialUrl;else if(a instanceof o0){if(this.urlUpdateStrategy==="eager"&&!d.extras.skipLocationChange){let y=this.urlHandlingStrategy.merge(d.finalUrl,d.initialUrl);this.setBrowserUrl(d.targetBrowserUrl??y,d)}}else a instanceof qm?(this.currentUrlTree=d.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(d.finalUrl,d.initialUrl),this.routerState=d.targetRouterState,this.urlUpdateStrategy==="deferred"&&!d.extras.skipLocationChange&&this.setBrowserUrl(d.targetBrowserUrl??this.rawUrlTree,d)):a instanceof Ha&&(a.code===So.GuardRejected||a.code===So.NoDataFromResolver)?this.restoreHistory(d):a instanceof Hm?this.restoreHistory(d,!0):a instanceof Vu&&(this.lastSuccessfulId=a.id,this.currentPageId=this.browserPageId)}setBrowserUrl(a,d){let y=a instanceof qa?this.urlSerializer.serialize(a):a;if(this.location.isCurrentPathEqualTo(y)||d.extras.replaceUrl){let n=this.browserPageId,R=bt(bt({},d.extras.state),this.generateNgRouterState(d.id,n));this.location.replaceState(y,"",R)}else{let n=bt(bt({},d.extras.state),this.generateNgRouterState(d.id,this.browserPageId+1));this.location.go(y,"",n)}}restoreHistory(a,d=!1){if(this.canceledNavigationResolution==="computed"){let y=this.browserPageId,n=this.currentPageId-y;n!==0?this.location.historyGo(n):this.currentUrlTree===a.finalUrl&&n===0&&(this.resetState(a),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(d&&this.resetState(a),this.resetUrlToCurrentUrlTree())}resetState(a){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,a.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(a,d){return this.canceledNavigationResolution==="computed"?{navigationId:a,\u0275routerPageId:d}:{navigationId:a}}static{this.\u0275fac=(()=>{let a;return function(y){return(a||(a=Ad(r)))(y||r)}})()}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),Nm=function(r){return r[r.COMPLETE=0]="COMPLETE",r[r.FAILED=1]="FAILED",r[r.REDIRECTING=2]="REDIRECTING",r}(Nm||{});function t6(r,s){r.events.pipe(Br(a=>a instanceof Vu||a instanceof Ha||a instanceof Hm||a instanceof ju),an(a=>a instanceof Vu||a instanceof ju?Nm.COMPLETE:(a instanceof Ha?a.code===So.Redirect||a.code===So.SupersededByNewNavigation:!1)?Nm.REDIRECTING:Nm.FAILED),Br(a=>a!==Nm.REDIRECTING),Eo(1)).subscribe(()=>{s()})}function n6(r){throw r}var i6={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},r6={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},nO=(()=>{class r{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=yt(Tv),this.stateManager=yt(tO),this.options=yt(WE,{optional:!0})||{},this.pendingTasks=yt(Na),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=yt(YU),this.urlSerializer=yt(GE),this.location=yt(xm),this.urlHandlingStrategy=yt(YE),this._events=new Gi,this.errorHandler=this.options.errorHandler||n6,this.navigated=!1,this.routeReuseStrategy=yt(KU),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=yt(XE,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!yt(qE,{optional:!0}),this.eventsSubscription=new Oi,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:a=>{this.console.warn(a)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let a=this.navigationTransitions.events.subscribe(d=>{try{let y=this.navigationTransitions.currentTransition,n=this.navigationTransitions.currentNavigation;if(y!==null&&n!==null){if(this.stateManager.handleRouterEvent(d,n),d instanceof Ha&&d.code!==So.Redirect&&d.code!==So.SupersededByNewNavigation)this.navigated=!0;else if(d instanceof Vu)this.navigated=!0;else if(d instanceof Wd){let R=d.navigationBehaviorOptions,j=this.urlHandlingStrategy.merge(d.url,y.currentRawUrl),$=bt({browserUrl:y.extras.browserUrl,info:y.extras.info,skipLocationChange:y.extras.skipLocationChange,replaceUrl:y.extras.replaceUrl||this.urlUpdateStrategy==="eager"||JU(y.source)},R);this.scheduleNavigation(j,Bm,null,$,{resolve:y.resolve,reject:y.reject,promise:y.promise})}}s6(d)&&this._events.next(d)}catch(y){this.navigationTransitions.transitionAbortSubject.next(y)}});this.eventsSubscription.add(a)}resetRootComponentType(a){this.routerState.root.component=a,this.navigationTransitions.rootComponentType=a}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Bm,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((a,d)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(a,"popstate",d)},0)})}navigateToSyncWithBrowser(a,d,y){let n={replaceUrl:!0},R=y?.navigationId?y:null;if(y){let $=bt({},y);delete $.navigationId,delete $.\u0275routerPageId,Object.keys($).length!==0&&(n.state=$)}let j=this.parseUrl(a);this.scheduleNavigation(j,d,R,n)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(a){this.config=a.map(ZE),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(a,d={}){let{relativeTo:y,queryParams:n,fragment:R,queryParamsHandling:j,preserveFragment:$}=d,ie=$?this.currentUrlTree.fragment:R,pe=null;switch(j??this.options.defaultQueryParamsHandling){case"merge":pe=bt(bt({},this.currentUrlTree.queryParams),n);break;case"preserve":pe=this.currentUrlTree.queryParams;break;default:pe=n||null}pe!==null&&(pe=this.removeEmptyProps(pe));let Me;try{let He=y?y.snapshot:this.routerState.snapshot.root;Me=zP(He)}catch{(typeof a[0]!="string"||a[0][0]!=="/")&&(a=[]),Me=this.currentUrlTree.root}return BP(Me,a,pe,ie??null)}navigateByUrl(a,d={skipLocationChange:!1}){let y=Um(a)?a:this.parseUrl(a),n=this.urlHandlingStrategy.merge(y,this.rawUrlTree);return this.scheduleNavigation(n,Bm,null,d)}navigate(a,d={skipLocationChange:!1}){return o6(a),this.navigateByUrl(this.createUrlTree(a,d),d)}serializeUrl(a){return this.urlSerializer.serialize(a)}parseUrl(a){try{return this.urlSerializer.parse(a)}catch{return this.urlSerializer.parse("/")}}isActive(a,d){let y;if(d===!0?y=bt({},i6):d===!1?y=bt({},r6):y=d,Um(a))return bP(this.currentUrlTree,a,y);let n=this.parseUrl(a);return bP(this.currentUrlTree,n,y)}removeEmptyProps(a){return Object.entries(a).reduce((d,[y,n])=>(n!=null&&(d[y]=n),d),{})}scheduleNavigation(a,d,y,n,R){if(this.disposed)return Promise.resolve(!1);let j,$,ie;R?(j=R.resolve,$=R.reject,ie=R.promise):ie=new Promise((Me,He)=>{j=Me,$=He});let pe=this.pendingTasks.add();return t6(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(pe))}),this.navigationTransitions.handleNavigationRequest({source:d,restoredState:y,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:a,extras:n,resolve:j,reject:$,promise:ie,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ie.catch(Me=>Promise.reject(Me))}static{this.\u0275fac=function(d){return new(d||r)}}static{this.\u0275prov=Ft({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function o6(r){for(let s=0;s<r.length;s++)if(r[s]==null)throw new on(4008,!1)}function s6(r){return!(r instanceof qm)&&!(r instanceof Wd)}var a6=new Zt("");function iO(r,...s){return Md([{provide:XE,multi:!0,useValue:r},[],{provide:Zd,useFactory:l6,deps:[nO]},{provide:Cv,multi:!0,useFactory:c6},s.map(a=>a.\u0275providers)])}function l6(r){return r.routerState.root}function c6(){let r=yt(Pa);return s=>{let a=r.get(ia);if(s!==a.components[0])return;let d=r.get(nO),y=r.get(u6);r.get(h6)===1&&d.initialNavigation(),r.get(d6,null,Bn.Optional)?.setUpPreloading(),r.get(a6,null,Bn.Optional)?.init(),d.resetRootComponentType(a.componentTypes[0]),y.closed||(y.next(),y.complete(),y.unsubscribe())}}var u6=new Zt("",{factory:()=>new Gi}),h6=new Zt("",{providedIn:"root",factory:()=>1});var d6=new Zt("");var rO=[{path:"",component:Vd}];var oO={providers:[I2({eventCoalescing:!0}),iO(rO)]};lR(Jv,oO).catch(r=>console.error(r));
